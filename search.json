[{"title":"ElasticSearch - function_score 系列文章（一）简介","url":"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li>ElasticSearch - function_score 系列文章（一）简介</li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（二）field_value_factor 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%89%EF%BC%89weight-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（三）weight 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E5%9B%9B%EF%BC%89%E8%A1%B0%E5%87%8F%E5%87%BD%E6%95%B0-linear%E3%80%81exp%E3%80%81gauss-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（四）衰减函数 linear、exp、gauss 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%84%E4%BB%B7%E7%B3%BB%E7%BB%9F-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（五）评价系统 具体实例</a></li>\n</ol>\n</div>\n\n\n<h2 id=\"function-score-查询\"><a href=\"#function-score-查询\" class=\"headerlink\" title=\"function_score 查询\"></a>function_score 查询</h2><ul>\n<li>在使用ES进行全文搜索时，默认情况下，返回的结果是按照 <code>相关性</code> 进行排序的——最相关的文档排在最前。为了按照相关性来排序，需要将相关性表示为一个数值。在 Elasticsearch 中， <code>相关性得分</code> 由一个浮点数进行表示，并在搜索结果中通过 <code>_score</code> 参数返回， 默认排序是 <code>_score</code> 降序。</li>\n<li><code>function_score 查询</code> 是用来控制评分过程的终极武器，它允许为每个与主查询匹配的文档应用一个函数，以达到改变甚至完全替换原始查询评分 <code>_score</code> 的目的。</li>\n<li>实际上，也能用过滤器对结果的 <code>子集</code> 应用不同的函数，这样一箭双雕：既能高效评分，又能利用过滤器缓存。</li>\n</ul>\n<h2 id=\"function-score-提供了几种加强-score-计算的函数\"><a href=\"#function-score-提供了几种加强-score-计算的函数\" class=\"headerlink\" title=\"function_score 提供了几种加强 _score 计算的函数\"></a>function_score 提供了几种加强 _score 计算的函数</h2><ol>\n<li><code>weight</code> : 为每个文档应用一个简单而不被规范化的权重提升值：当 weight 为 2 时，最终结果为 2 * _score 。</li>\n<li><code>field_value_factor</code> : 使用这个值来修改 _score ，如将 popularity 或 votes （受欢迎度或赞）作为考虑因素。</li>\n<li><code>random_score</code> : 为每个用户都使用一个不同的随机评分对结果排序，但对某一具体用户来说，看到的顺序始终是一致的。</li>\n<li><code>衰减函数 —— linear 、 exp 、 gauss</code> : 将浮动值结合到评分 _score 中，例如结合 publish_date 获得最近发布的文档，结合 geo_location 获得更接近某个具体经纬度（lat&#x2F;lon）地点的文档，结合 price 获得更接近某个特定价格的文档。</li>\n<li><code>script_score</code> : 如果需求超出以上范围时，用自定义脚本可以完全控制评分计算，实现所需逻辑。</li>\n</ol>\n<h2 id=\"function-score-查询模板\"><a href=\"#function-score-查询模板\" class=\"headerlink\" title=\"function_score 查询模板\"></a>function_score 查询模板</h2><ol>\n<li>如果要使用 function_score 改变分数，要使用 function_score 查询</li>\n<li>简单的说，就是在一个 function_score 内部 query 全文搜索得到的 _score 基础上，给他加上其他字段的评分标准，就能够得到把 &quot;全文搜索 + 其他字段&quot; 综合起来评分的效果</li>\n<li>单个加强函数的查询模板<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /mytest/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;.....&#125;, //主查询，查询完后这里自己会有一个评分，就是old_score</span><br><span class=\"line\">            &quot;field_value_factor&quot;: &#123;...&#125;, //在old_score的基础上，给他加强其他字段的评分，这里会产生一个加强score，如果只有一个加强function时，直接将加强函数名写在query下面就可以了</span><br><span class=\"line\">            &quot;boost_mode&quot;: &quot;multiply&quot;, //指定用哪种方式结合old_score和加强score成为new_score</span><br><span class=\"line\">            &quot;max_boost&quot;: 1.5 //限制加强score的最高分，但是不会限制old_score</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>多个加强函数的查询模板<ul>\n<li>如果有多个加强函数，那就要使用 functions 来包含这些加强函数们，functions 是一个数组，里面放着的是将要被使用的加强函数列表</li>\n<li>可以为 functions 里的加强函数指定一个 filter，这样做的话，只有在文档满足此 filter 的要求，此 filter 的加强函数才会应用到文挡上，也可以不指定 filter，这样的话此加强函数就会应用到全部的文挡上</li>\n<li>一个文档可以一次满足多条加强函数和多个 filter，如果一次满足多个，那么就会产生多个 加强score，因此 ES 会使用 score_mode 定义的方式来合并这些 加强score们，得到一个 总加强score，得到 总加强score之后，才会再使用 boost_mode 定义的方式去和 old_score 做合并</li>\n<li>像是下面的例子，field_value_factor 和 gauss 这两个加强函数会应用到所有文档上，而 weight 只会应用到满足 filter 的文档上，假设有个文档满足了 filter 的条件，那他就会得到 3 个 加强score，这 3 个 加强score 会使用 sum 的方式合并成一个 总加强score，然后才和 old_score 使用 multiply 的方式合并<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /mytest/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;.....&#125;,</span><br><span class=\"line\">            &quot;functions&quot;: [   //可以有多个加强函数(或是filter+加强函数)，每一个加强函数会产生一个加强score，因此functions会有多个加强score</span><br><span class=\"line\">                &#123; &quot;field_value_factor&quot;: ... &#125;,</span><br><span class=\"line\">                &#123; &quot;gauss&quot;: ... &#125;,</span><br><span class=\"line\">                &#123; &quot;filter&quot;: &#123;...&#125;, &quot;weight&quot;: ... &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            &quot;score_mode&quot;: &quot;sum&quot;, //决定加强score们怎么合并,</span><br><span class=\"line\">            &quot;boost_mode&quot;: &quot;multiply&quot; //决定总加強score怎么和old_score合并</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>不要执着在调整 function_score 上<ul>\n<li>文档相关度的调整非常玄，<code>最相关的文档</code> 是一个难以触及的模糊概念，每个人对文档排序有着不同的想法，这很容易使人陷入持续反复调整，但是却没有明显的进展</li>\n<li>为了避免跳入这种死循环，在调整 function_score 时，一定要搭配监控用户操作，才有意义<ul>\n<li>像是如果返回的文档是用户想要的高相关的文档，那么用户就会选择前 10 个中的一个文档，得到想要的结果，反之，用户可能会来回点击，或是尝试新的搜索条件</li>\n<li>一旦有了这些监控手段，想要调适完美的 function_score 就不是问题</li>\n</ul>\n</li>\n<li>因此调整 function_score 的重点在于，要透过监控用户和用户互动，慢慢去调整我们的搜索条件，而不要妄想一步登天，第一次就把文档的相关度调整到最好，这几乎是不可能的，因为，连用户自己也不知道他自己想要什么</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"function-scroe-其他辅助的参数\"><a href=\"#function-scroe-其他辅助的参数\" class=\"headerlink\" title=\"function_scroe 其他辅助的参数\"></a>function_scroe 其他辅助的参数</h2><ol>\n<li><code>boost_mode</code> : 决定 old_score 和 加强score 如何合并<ul>\n<li>multiply(默认) : new_score &#x3D; old_score * 加强score</li>\n<li>sum : new_score &#x3D; old_score + 加强score</li>\n<li>min : old_score 和 加强score 取较小值，new_score &#x3D; min(old_score, 加强score)</li>\n<li>max : old_score 和 加强score 取较大值，new_score &#x3D; max(old_score, 加强score)</li>\n<li>replace : 加强score直接替换掉 old_score，new_score &#x3D; 加强score</li>\n</ul>\n</li>\n<li><code>score_mode</code> : 决定 functions 里面的 加强score 们怎么合并，会先合并 加强score 们成一个 总加强score，再使用 总加强score 去和 old_score 做合并，换言之就是会先执行 score_mode，再执行 boost_mode<ul>\n<li>multiply (默认)</li>\n<li>sum</li>\n<li>avg</li>\n<li>first : 使用首个函数(可以有filter，也可以没有)的结果作为最终结果</li>\n<li>max</li>\n<li>min</li>\n</ul>\n</li>\n<li><code>max_boost</code> : 限制加强函数的最大效果，就是限制 加强score 最大能多少，但要注意不会限制 old_score<ul>\n<li>如果 加强score 超过了 max_boost 限制的值，会把 加强score 的值设成 max_boost 的值</li>\n<li>假设 加强score 是 5，而 max_boost 是 2，因为 加强score 超出了 max_boost 的限制，所以 max_boost 就会把 加强score 改为 2</li>\n<li>简单的说，就是 加强score &#x3D; min(加强score, max_boost)</li>\n</ul>\n</li>\n</ol>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","function_score","相关度评分"]},{"title":"ElasticSearch - function_score 系列文章（三）weight 具体实例","url":"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%89%EF%BC%89weight-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch - function_score 系列文章（一）简介</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（二）field_value_factor 具体实例</a></li>\n<li>ElasticSearch - function_score 系列文章（三）weight 具体实例</li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E5%9B%9B%EF%BC%89%E8%A1%B0%E5%87%8F%E5%87%BD%E6%95%B0-linear%E3%80%81exp%E3%80%81gauss-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（四）衰减函数 linear、exp、gauss 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%84%E4%BB%B7%E7%B3%BB%E7%BB%9F-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（五）评价系统 具体实例</a></li>\n</ol>\n</div>\n\n<h2 id=\"weight-具体实例\"><a href=\"#weight-具体实例\" class=\"headerlink\" title=\"weight 具体实例\"></a>weight 具体实例</h2><h3 id=\"1-准备数据\"><a href=\"#1-准备数据\" class=\"headerlink\" title=\"1. 准备数据\"></a>1. 准备数据</h3><ul>\n<li>先准备数据和索引，在ES插入三笔数据，其中 language 是 text 类型，like 是 long 类型(代表点赞量)<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /test_weight/_bulk?pretty</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class=\"line\">&#123;&quot;language&quot;: &quot;java&quot;, &quot;like&quot;: 5&#125;</span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class=\"line\">&#123;&quot;language&quot;: &quot;python&quot;, &quot;like&quot;: 5&#125;</span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class=\"line\">&#123;&quot;language&quot;: &quot;go&quot;, &quot;like&quot;: 10&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"2-weight-单独使用\"><a href=\"#2-weight-单独使用\" class=\"headerlink\" title=\"2. weight 单独使用\"></a>2. weight 单独使用</h3><ul>\n<li>weight加强函数可以自己单独使用，只是这样做没啥意义，因为只是会给全部的文档都增加一个固定值而已</li>\n<li>不过就DSL语法上来说，他也像其他加强函数一样，是可以直接使用的<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_weight/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;</span><br><span class=\"line\">                &quot;match_all&quot;: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;functions&quot;: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;weight&quot;: 3</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;java&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;python&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;go&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"3-weight-和-filter-搭配\"><a href=\"#3-weight-和-filter-搭配\" class=\"headerlink\" title=\"3. weight 和 filter 搭配\"></a>3. weight 和 filter 搭配</h3><ul>\n<li>functions是一个数组，里面放着的是将要被使用的加强函数列表，我们在里面使用了3个filter去过滤数据，并且每个filter都设置了一个加强函数，并且还使用了一个会应用到所有文档的field_value_factor加强函数</li>\n<li>可以为列表里的每个加强函数都指定一个filter，这样做的话，只有在文档满足此filter的要求，此filter的加强函数才会应用到文挡上，也可以不指定filter，这样的话此加强函数就会应用到全部的文挡上</li>\n<li>一个文档可以一次满足多条加强函数和多个filter，如果一次满足多个，那么就会产生多个加强score</li>\n<li>因此ES会先使用score_mode定义的方式来合并这些加强score们，得到一个总加强score，得到总加强score之后，才会再使用boost_mode定义的方式去和old_score做合并<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_weight/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;</span><br><span class=\"line\">                &quot;match_all&quot;: &#123;&#125;  //match_all查出来的所有文档的_score都是1</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;functions&quot;: [</span><br><span class=\"line\">                //第一个filter(使用weight加强函数)，如果language是java，加强score就是2</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;filter&quot;: &#123;</span><br><span class=\"line\">                        &quot;term&quot;: &#123;</span><br><span class=\"line\">                            &quot;language&quot;: &quot;java&quot;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &quot;weight&quot;: 2</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                //第二个filter(使用weight加强函数)，如果language是go，加强score就是3</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;filter&quot;: &#123;</span><br><span class=\"line\">                        &quot;term&quot;: &#123;</span><br><span class=\"line\">                            &quot;language&quot;: &quot;go&quot;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &quot;weight&quot;: 3</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                //第三个filter(使用weight加强函数)，如果like数大于等于10，加强score就是5</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;filter&quot;: &#123;</span><br><span class=\"line\">                        &quot;range&quot;: &#123;</span><br><span class=\"line\">                            &quot;like&quot;: &#123;</span><br><span class=\"line\">                                &quot;gte&quot;: 10</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &quot;weight&quot;: 5</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                //field_value_factor加强函数，会应用到所有文档上，加强score就是like值</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">                        &quot;field&quot;: &quot;like&quot;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            &quot;score_mode&quot;: &quot;multiply&quot;, //设置functions里面的加强score们怎么合并成一个总加强score</span><br><span class=\"line\">            &quot;boost_mode&quot;: &quot;multiply&quot; //设置old_score怎么和总加强score合并</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">150</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"comment\">//go同时满足filter2、filter3，且还有一个加强函数field_value_factor产生的加强，因此加强score为3, 5, 10，总加强score为3*5*10=150</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;go&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"comment\">//java只满足filter1，但是因为还有field_value_facotr产生的加强score，因此加强score为2, 5，总加强score为2*5=10</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;java&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"comment\">//python不满足任何filter，因此加强score只有field_value_factor的like值，就是5</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;python&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"4-weight-和-field-value-factor-搭配\"><a href=\"#4-weight-和-field-value-factor-搭配\" class=\"headerlink\" title=\"4. weight 和 field_value_factor 搭配\"></a>4. weight 和 field_value_factor 搭配</h3><ul>\n<li>weight加强函数也可以用来调整每个语句的贡献度，权重weight的默认值是1.0，当设置了weight，这个weight值会先和自己那个{}里的每个句子的评分相乘，之后再通过score_mode和其他加强函数合并</li>\n<li>下面的查询，公式为new_score &#x3D; old_score * [ (like值 * weight1) + weight2 ]</li>\n<li>公式解析 : weight1先加强like值(只能使用乘法)，接着再透过score_mode定义的方法(sum)和另一个加强函数weight2合并，得到一个总加强score，最后再使用boost_mode定义的方法(默认是multiply)和old_score做合并，得到new_score<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_weight/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;</span><br><span class=\"line\">                &quot;match_all&quot;: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;functions&quot;: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">                        &quot;field&quot;: &quot;like&quot;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &quot;weight&quot;: 3</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;weight&quot;: 20</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            &quot;score_mode&quot;: &quot;sum&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">50</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;go&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">35</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;python&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">35</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;java&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","function_score","相关度评分"]},{"title":"ElasticSearch - function_score 系列文章（二）field_value_factor 具体实例","url":"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch - function_score 系列文章（一）简介</a></li>\n<li>ElasticSearch - function_score 系列文章（二）field_value_factor 具体实例</li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%89%EF%BC%89weight-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（三）weight 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E5%9B%9B%EF%BC%89%E8%A1%B0%E5%87%8F%E5%87%BD%E6%95%B0-linear%E3%80%81exp%E3%80%81gauss-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（四）衰减函数 linear、exp、gauss 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%84%E4%BB%B7%E7%B3%BB%E7%BB%9F-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（五）评价系统 具体实例</a></li>\n</ol>\n</div>\n\n\n<h2 id=\"field-value-factor-具体实例\"><a href=\"#field-value-factor-具体实例\" class=\"headerlink\" title=\"field_value_factor 具体实例\"></a>field_value_factor 具体实例</h2><h3 id=\"1-准备数据\"><a href=\"#1-准备数据\" class=\"headerlink\" title=\"1. 准备数据\"></a>1. 准备数据</h3><ul>\n<li>设想有个网站供用户发布博客并且可以让他们为自己喜欢的博客点赞，我们希望将更受欢迎的博客放在搜索结果列表中相对较上的位置，同时全文搜索的评分仍然作为相关度的主要排序依据，可以简单的通过存储每个博客的点赞数来实现它</li>\n<li>首先准备数据和索引，在 ES 插入三条数据，其中 title 是 text 类型，votes 是 long 类型(代表点赞量)<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /test_field_value_factor/_bulk?pretty</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class=\"line\">&#123;&quot;title&quot;: &quot;ES 入门&quot;, &quot;votes&quot;: 2&#125;</span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class=\"line\">&#123;&quot;title&quot;: &quot;ES 进阶&quot;, &quot;votes&quot;: 5&#125;</span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class=\"line\">&#123;&quot;title&quot;: &quot;ES 最高难度&quot;, &quot;votes&quot;: 10&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"2-普通查询\"><a href=\"#2-普通查询\" class=\"headerlink\" title=\"2. 普通查询\"></a>2. 普通查询</h3><ul>\n<li>先使用一般的query，查看普通查询的原始评分如何<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_field_value_factor/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;match&quot;: &#123;</span><br><span class=\"line\">      &quot;title&quot;: &quot;ES&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.14426158</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 入门&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.14426158</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 进阶&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.11623955</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 最高难度&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"3-function-score查询\"><a href=\"#3-function-score查询\" class=\"headerlink\" title=\"3. function_score查询\"></a>3. function_score查询</h3><ul>\n<li>在搜索时，可以将 function_score 查询与 field_value_factor 结合使用，即将点赞数与全文相关度评分结合</li>\n<li>使用 function_score 的 field_value_factor 改变 _score，将 old_score 乘上 votes 的值<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_field_value_factor/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;function_score&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;ES&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;votes&quot;,</span><br><span class=\"line\">        &quot;missing&quot;: 1</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1.1623955</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 最高难度&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.72130793</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 进阶&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.28852317</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 入门&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"4-max-boost限制\"><a href=\"#4-max-boost限制\" class=\"headerlink\" title=\"4. max_boost限制\"></a>4. max_boost限制</h3><ul>\n<li>可以看到<code>ES 入门</code>的 加强score 是 2，在 max_boost 限制里，所以不受影响</li>\n<li>而<code>ES 进阶</code>和<code>ES 最高难度</code>的 field_value_factor 函数产生的 加强score 因为超过 max_boost 的限制，所以被设为 3<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_field_value_factor/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;function_score&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;ES&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;votes&quot;,</span><br><span class=\"line\">        &quot;missing&quot;: 1</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;max_boost&quot;: 3</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.43278474</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 进阶&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.34871864</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 最高难度&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.28852317</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ES 入门&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;votes&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"5-modifier、factor-参数\"><a href=\"#5-modifier、factor-参数\" class=\"headerlink\" title=\"5. modifier、factor 参数\"></a>5. modifier、factor 参数</h3><ul>\n<li>有时候线性的计算 new_score &#x3D; old_score * votes 值的效果并不是那么好， field_value_factor 中还支持 modifier、factor 参数，可以改变 votes 值对 old_score 的影响</li>\n<li><code>modifier</code> 参数支持的值<ul>\n<li>none : new_score &#x3D; old_score * votes值<ul>\n<li>默认状态就是none，线性<br>  <img src=\"/images/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/1.png\" loading=\"lazy\"></li>\n</ul>\n</li>\n<li>log1p : new_score &#x3D; old_score * log(1 + votes值)<ul>\n<li>最常用，可以让votes值字段的评分曲线更平滑<br>  <img src=\"/images/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/2.png\" loading=\"lazy\"></li>\n</ul>\n</li>\n<li>log2p : new_score &#x3D; old_score * log(2 + votes值)</li>\n<li>ln : new_score &#x3D; old_score * ln(votes值)</li>\n<li>ln1p : new_score &#x3D; old_score * ln(1 + votes值)</li>\n<li>ln2p : new_score &#x3D; old_score * ln(2 + votes值)</li>\n<li>square : 计算平方</li>\n<li>sqrt : 计算平方根</li>\n<li>reciprocal : 计算倒数</li>\n</ul>\n</li>\n<li><code>factor</code> 参数<ul>\n<li>factor作为一个调节用的参数，没有modifier那么强大会改变整个曲线，他仅改变一些常量值，设置 factor&gt;1 会提升效果，factor&lt;1 会降低效果</li>\n<li>假设 modifier 是 log1p，那么加入了 factor 的公式就是 <code>new_score = old_score * log(1 + factor * votes值)</code><br>  <img src=\"/images/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/3.png\" loading=\"lazy\"></li>\n</ul>\n</li>\n<li>对刚刚的例子加上 <code>modifier</code>、<code>factor</code><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_field_value_factor/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;function_score&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;ES&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;votes&quot;,</span><br><span class=\"line\">        &quot;modifier&quot;: &quot;log1p&quot;,</span><br><span class=\"line\">        &quot;factor&quot;: 2,</span><br><span class=\"line\">        &quot;missing&quot;: 1</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"6-boost-mode\"><a href=\"#6-boost-mode\" class=\"headerlink\" title=\"6. boost_mode\"></a>6. boost_mode</h3><ul>\n<li>就算加上了 modifier，但是 <code>全文评分 与 field_value_factor 函数值乘积</code> 的效果可能还是太大，我们可以通过参数 boost_mode 来决定 old_score 和 加强score 合并的方法</li>\n<li>如果将 boost_mode 改成 sum，可以大幅弱化最终效果，特别是使用一个较小的 factor 时</li>\n<li>加入了 boost_mode&#x3D;sum、且 factor&#x3D;0.1 的公式变为 <code>new_score = old_score + log(1 + 0.1 * votes值)</code><br><img src=\"/images/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/4.png\" loading=\"lazy\"></li>\n<li>对刚刚的例子加上 boost_mode&#x3D;sum<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_field_value_factor/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;function_score&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;ES&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;votes&quot;,</span><br><span class=\"line\">        &quot;modifier&quot;: &quot;log1p&quot;,</span><br><span class=\"line\">        &quot;factor&quot;: 0.1,</span><br><span class=\"line\">        &quot;missing&quot;: 1</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;boost_mode&quot;: &quot;sum&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","function_score","相关度评分"]},{"title":"ElasticSearch - function_score 系列文章（五）评价系统 具体实例","url":"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%84%E4%BB%B7%E7%B3%BB%E7%BB%9F-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch - function_score 系列文章（一）简介</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（二）field_value_factor 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%89%EF%BC%89weight-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（三）weight 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E5%9B%9B%EF%BC%89%E8%A1%B0%E5%87%8F%E5%87%BD%E6%95%B0-linear%E3%80%81exp%E3%80%81gauss-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（四）衰减函数 linear、exp、gauss 具体实例</a></li>\n<li>ElasticSearch - function_score 系列文章（五）评价系统 具体实例</li>\n</ol>\n</div>\n\n<h2 id=\"function-score示例1\"><a href=\"#function-score示例1\" class=\"headerlink\" title=\"function_score示例1\"></a>function_score示例1</h2><div class=\"tabs\" id=\"function_score-simple1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#function_score-simple1-1\"><code>Query DSL</code></a></li><li class=\"tab\"><a href=\"#function_score-simple1-2\"><code>Java 代码实现</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"function_score-simple1-1\"><ul>\n<li>评价系统相关度评分排序，优先级：当前用户（userId） &gt; 是否好评（goodEvaluate） &gt; 平均分（averageScore） &gt; 评价时间（evaluateTime）<ul>\n<li>当前用户：本人的评价内容必须展示在最上方，权重最大</li>\n<li>是否好评：值为1时表示好评，权重次之</li>\n<li>平均分：范围[0, 1000] 根据得分加强score</li>\n<li>评价时间倒序</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /crisps_evaluate_info/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot;: 5000,</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;function_score&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;bool&quot;: &#123;</span><br><span class=\"line\">          &quot;adjust_pure_negative&quot;: true,</span><br><span class=\"line\">          &quot;boost&quot;: 1.0</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;functions&quot;: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          &quot;filter&quot;: &#123;</span><br><span class=\"line\">            &quot;term&quot;: &#123;</span><br><span class=\"line\">              &quot;userId&quot;: &#123;</span><br><span class=\"line\">                &quot;value&quot;: &quot;767777873692352703&quot;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &quot;weight&quot;: 100000.0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          &quot;filter&quot;: &#123;</span><br><span class=\"line\">            &quot;term&quot;: &#123;</span><br><span class=\"line\">              &quot;goodEvaluate&quot;: &#123;</span><br><span class=\"line\">                &quot;value&quot;: 1</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &quot;weight&quot;: 10000.0</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          &quot;filter&quot;: &#123;</span><br><span class=\"line\">            &quot;range&quot;: &#123;</span><br><span class=\"line\">              &quot;averageScore&quot;: &#123;</span><br><span class=\"line\">                &quot;from&quot;: 0,</span><br><span class=\"line\">                &quot;to&quot;: 1000,</span><br><span class=\"line\">                &quot;include_lower&quot;: true,</span><br><span class=\"line\">                &quot;include_upper&quot;: true</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &quot;field_value_factor&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;averageScore&quot;,</span><br><span class=\"line\">            &quot;factor&quot;: 1.0,</span><br><span class=\"line\">            &quot;modifier&quot;: &quot;none&quot;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      &quot;score_mode&quot;: &quot;sum&quot;,</span><br><span class=\"line\">      &quot;boost_mode&quot;: &quot;multiply&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;_source&quot;: &#123;</span><br><span class=\"line\">    &quot;includes&quot;: [</span><br><span class=\"line\">      &quot;userId&quot;,</span><br><span class=\"line\">      &quot;goodEvaluate&quot;,</span><br><span class=\"line\">      &quot;averageScore&quot;,</span><br><span class=\"line\">      &quot;evaluateTime&quot;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &quot;excludes&quot;: []</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;sort&quot;: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;_score&quot;: &#123;</span><br><span class=\"line\">        &quot;order&quot;: &quot;desc&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;evaluateTime&quot;: &#123;</span><br><span class=\"line\">        &quot;order&quot;: &quot;desc&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"function_score-simple1-2\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Api(tags = &quot;es示例&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/yk/es&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EsController</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCrispsController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@ApiOperation(&quot;FunctionScoreQueryBuilder示例&quot;)</span></span><br><span class=\"line\">  <span class=\"meta\">@GetMapping(&quot;/function_score&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> CrispsResponse <span class=\"title function_\">functionScore</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 优先级：当前用户（userId） &gt; 是否好评（goodEvaluate） &gt; 平均分（averageScore） &gt; 评价时间（evaluateTime）</span></span><br><span class=\"line\">    FunctionScoreQueryBuilder.FilterFunctionBuilder[] filterFunctionBuilders = <span class=\"keyword\">new</span> <span class=\"title class_\">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[]&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 当前用户：本人的评价内容必须展示在最上方，权重最大</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class=\"line\">                    QueryBuilders.termQuery(<span class=\"string\">&quot;userId&quot;</span>, <span class=\"string\">&quot;767777873692352703&quot;</span>),</span><br><span class=\"line\">                    ScoreFunctionBuilders.weightFactorFunction(<span class=\"number\">100000.0f</span>)),</span><br><span class=\"line\">            <span class=\"comment\">// 是否好评：值为1时表示好评，权重次之</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class=\"line\">                    QueryBuilders.termQuery(<span class=\"string\">&quot;goodEvaluate&quot;</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\">                    ScoreFunctionBuilders.weightFactorFunction(<span class=\"number\">10000.0f</span>)),</span><br><span class=\"line\">            <span class=\"comment\">// 平均分：范围[0, 1000] 根据得分加强score</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class=\"line\">                    QueryBuilders.rangeQuery(<span class=\"string\">&quot;averageScore&quot;</span>).gte(<span class=\"number\">0</span>).lte(<span class=\"number\">1000</span>),</span><br><span class=\"line\">                    ScoreFunctionBuilders.fieldValueFactorFunction(<span class=\"string\">&quot;averageScore&quot;</span>))</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">FunctionScoreQueryBuilder</span> <span class=\"variable\">functionScoreQueryBuilder</span> <span class=\"operator\">=</span></span><br><span class=\"line\">            QueryBuilders.functionScoreQuery(QueryBuilders.boolQuery(), filterFunctionBuilders)</span><br><span class=\"line\">                    <span class=\"comment\">// 决定加强score们怎么合并</span></span><br><span class=\"line\">                    .scoreMode(FunctionScoreQuery.ScoreMode.SUM)</span><br><span class=\"line\">                    <span class=\"comment\">// 决定总加強score怎么和old_score合并</span></span><br><span class=\"line\">                    .boostMode(CombineFunction.MULTIPLY);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">SearchSourceBuilder</span> <span class=\"variable\">searchSourceBuilder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchSourceBuilder</span>()</span><br><span class=\"line\">            .size(<span class=\"number\">5000</span>)</span><br><span class=\"line\">            <span class=\"comment\">// Query DSL 应用 function_score</span></span><br><span class=\"line\">            .query(functionScoreQueryBuilder)</span><br><span class=\"line\">            <span class=\"comment\">// 指定字段显示</span></span><br><span class=\"line\">            .fetchSource(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]&#123;<span class=\"string\">&quot;userId&quot;</span>, <span class=\"string\">&quot;goodEvaluate&quot;</span>, <span class=\"string\">&quot;averageScore&quot;</span>, <span class=\"string\">&quot;evaluateTime&quot;</span>&#125;, <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]&#123;&#125;)</span><br><span class=\"line\">            <span class=\"comment\">// 排序：先_score 后evaluateTime</span></span><br><span class=\"line\">            .sort(SortBuilders.scoreSort()).sort(SortBuilders.fieldSort(<span class=\"string\">&quot;evaluateTime&quot;</span>).order(SortOrder.DESC));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 发送搜索请求</span></span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;Query DSL: &#123;&#125;&quot;</span>, searchSourceBuilder);</span><br><span class=\"line\">    DggPageResult&lt;EvaluateInfoEs&gt; pageRes = dggESTemplate.searchScrollDeepPaging(</span><br><span class=\"line\">            searchSourceBuilder, <span class=\"number\">1</span>, <span class=\"number\">10</span>, EvaluateInfoEs.class, <span class=\"string\">&quot;crisps_evaluate_info&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> success(pageRes.getList());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></div></div>\n\n\n<h2 id=\"function-score示例2\"><a href=\"#function-score示例2\" class=\"headerlink\" title=\"function_score示例2\"></a>function_score示例2</h2><div class=\"tabs\" id=\"function_score-simple2\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#function_score-simple2-1\"><code>Query DSL</code></a></li><li class=\"tab\"><a href=\"#function_score-simple2-2\"><code>Java 代码实现</code></a></li><li class=\"tab\"><a href=\"#function_score-simple2-3\"><code>TestCertDTO.class</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"function_score-simple2-1\"><ul>\n<li>用区间表示法设计证书占用时间槽，并存入es嵌套文档，用function_score评分方案解决空闲时间槽查询，对比替代bitmap编码解码方案</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /test_cert_dto/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;</span><br><span class=\"line\">                &quot;match_all&quot;: &#123;</span><br><span class=\"line\">                    &quot;boost&quot;: 1</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;functions&quot;: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;filter&quot;: &#123;</span><br><span class=\"line\">                        &quot;bool&quot;: &#123;</span><br><span class=\"line\">                            &quot;adjust_pure_negative&quot;: true,</span><br><span class=\"line\">                            &quot;boost&quot;: 1</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &quot;script_score&quot;: &#123;</span><br><span class=\"line\">                        &quot;script&quot;: &#123;</span><br><span class=\"line\">                            &quot;source&quot;: &quot;List slots = params[&#x27;_source&#x27;][&#x27;timeSlots&#x27;];for (int i; i &lt; slots.length; i++) &#123;   if ((params.from &gt;= slots[i].startStamp &amp;&amp; params.from &lt;= slots[i].endStamp)        || (params.to &gt;= slots[i].startStamp &amp;&amp; params.to &lt;= slots[i].endStamp)       || (slots[i].startStamp &gt;= params.from &amp;&amp; slots[i].startStamp &lt;= params.to)       || (slots[i].endStamp &gt;= params.from &amp;&amp; slots[i].endStamp &lt;= params.to)) &#123;       return 0;   &#125;&#125;return 1;&quot;,</span><br><span class=\"line\">                            &quot;lang&quot;: &quot;painless&quot;,</span><br><span class=\"line\">                            &quot;params&quot;: &#123;</span><br><span class=\"line\">                                &quot;from&quot;: 1585670400000,</span><br><span class=\"line\">                                &quot;to&quot;: 1585756799999</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            &quot;score_mode&quot;: &quot;sum&quot;,</span><br><span class=\"line\">            &quot;boost_mode&quot;: &quot;multiply&quot;,</span><br><span class=\"line\">            &quot;max_boost&quot;: 1,</span><br><span class=\"line\">            &quot;boost&quot;: 1</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;min_score&quot;: 1,</span><br><span class=\"line\">    &quot;sort&quot;: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;_score&quot;: &#123;</span><br><span class=\"line\">                &quot;order&quot;: &quot;desc&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"function_score-simple2-2\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Api(tags = &quot;es示例&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/yk/es&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EsController</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCrispsController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@ApiOperation(&quot;追加证书&quot;)</span></span><br><span class=\"line\">  <span class=\"meta\">@PostMapping(&quot;/addCert&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> CrispsResponse <span class=\"title function_\">addCert</span><span class=\"params\">(Long id, <span class=\"meta\">@RequestBody</span> TestCertDTO.TimeSlot timeSlot)</span> &#123;</span><br><span class=\"line\">    TestCertDTO.<span class=\"type\">TimeSlot</span> <span class=\"variable\">slot</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TestCertDTO</span>.TimeSlot(timeSlot.getStartTime(), timeSlot.getEndTime());</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;test_cert_dto&quot;</span>;</span><br><span class=\"line\">    TestCertDTO cert;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dggESTemplate.indexExists(index)) &#123;</span><br><span class=\"line\">      cert = dggESTemplate.getSingleById(index, String.valueOf(id), TestCertDTO.class);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (cert == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        cert = TestCertDTO.builder().id(id).timeSlots(Collections.singletonList(slot)).build();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (TestCertDTO.overlapped(cert.getTimeSlots(), slot)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fail(<span class=\"string\">&quot;证书时间交叉&quot;</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        cert.getTimeSlots().add(slot);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      cert = TestCertDTO.builder().id(id).timeSlots(Collections.singletonList(slot)).build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> success(dggESTemplate.createDocument(cert));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@ApiOperation(&quot;查询证书&quot;)</span></span><br><span class=\"line\">  <span class=\"meta\">@PostMapping(&quot;/queryCert&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> CrispsResponse <span class=\"title function_\">queryCert</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> TestCertDTO.TimeSlot timeSlot)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 脚本参数</span></span><br><span class=\"line\">    TestCertDTO.<span class=\"type\">TimeSlot</span> <span class=\"variable\">slot</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TestCertDTO</span>.TimeSlot(timeSlot.getStartTime(), timeSlot.getEndTime());</span><br><span class=\"line\">    Map&lt;String, Object&gt; params = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;(<span class=\"number\">2</span>);</span><br><span class=\"line\">    params.put(<span class=\"string\">&quot;from&quot;</span>, slot.getStartStamp());</span><br><span class=\"line\">    params.put(<span class=\"string\">&quot;to&quot;</span>, slot.getEndStamp());</span><br><span class=\"line\"></span><br><span class=\"line\">    FunctionScoreQueryBuilder.FilterFunctionBuilder[] filterFunctionBuilders = <span class=\"keyword\">new</span> <span class=\"title class_\">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[]&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class=\"line\">                    QueryBuilders.boolQuery(),</span><br><span class=\"line\">                    ScoreFunctionBuilders.scriptFunction(</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> <span class=\"title class_\">Script</span>(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG,</span><br><span class=\"line\">                                    <span class=\"string\">&quot;List slots = params[&#x27;_source&#x27;][&#x27;timeSlots&#x27;];&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;for (int i; i &lt; slots.length; i++) &#123;&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;   if ((params.from &gt;= slots[i].startStamp &amp;&amp; params.from &lt;= slots[i].endStamp) &quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;       || (params.to &gt;= slots[i].startStamp &amp;&amp; params.to &lt;= slots[i].endStamp)&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;       || (slots[i].startStamp &gt;= params.from &amp;&amp; slots[i].startStamp &lt;= params.to)&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;       || (slots[i].endStamp &gt;= params.from &amp;&amp; slots[i].endStamp &lt;= params.to)) &#123;&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;       return 0;&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;   &#125;&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;&#125;&quot;</span> +</span><br><span class=\"line\">                                            <span class=\"string\">&quot;return 1;&quot;</span>,</span><br><span class=\"line\">                                    params)</span><br><span class=\"line\">                    ))</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">FunctionScoreQueryBuilder</span> <span class=\"variable\">functionScoreQueryBuilder</span> <span class=\"operator\">=</span></span><br><span class=\"line\">            QueryBuilders.functionScoreQuery(QueryBuilders.matchAllQuery(), filterFunctionBuilders)</span><br><span class=\"line\">                    .scoreMode(FunctionScoreQuery.ScoreMode.SUM)</span><br><span class=\"line\">                    .boostMode(CombineFunction.MULTIPLY)</span><br><span class=\"line\">                    .maxBoost(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">SearchSourceBuilder</span> <span class=\"variable\">searchSourceBuilder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchSourceBuilder</span>().query(functionScoreQueryBuilder).minScore(<span class=\"number\">1</span>).sort(SortBuilders.scoreSort());</span><br><span class=\"line\"></span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;Before: &#123;&#125;&quot;</span>, searchSourceBuilder);</span><br><span class=\"line\">    <span class=\"type\">SearchResponse</span> <span class=\"variable\">searchResponse</span> <span class=\"operator\">=</span> dggESTemplate.deepPaging(searchSourceBuilder, <span class=\"number\">1</span>, <span class=\"number\">10</span>, <span class=\"string\">&quot;test_cert_dto&quot;</span>);</span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;After: &#123;&#125;&quot;</span>, searchSourceBuilder);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> success(searchResponse);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"function_score-simple2-3\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 证书实体类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> &lt;a href=&quot;http://www.isee.wang/&quot;&gt;isee.wang&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022/1/19 9:40</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ToString</span></span><br><span class=\"line\"><span class=\"meta\">@Builder</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@DggEsDocument(indexName = &quot;test_cert_dto&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestCertDTO</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@DggEsIdentify</span></span><br><span class=\"line\">  <span class=\"meta\">@DggEsField(fieldType = FieldType.integer_type)</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> Long id;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@DggEsField(fieldType = FieldType.nested_type)</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> List&lt;TimeSlot&gt; timeSlots;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 判断两个时间段是否重叠</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> list</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> slot</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">overlapped</span><span class=\"params\">(List&lt;TimeSlot&gt; list, TimeSlot slot)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (TimeSlot s : list) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">              (slot.getStartStamp() &gt;= s.getStartStamp() &amp;&amp; slot.getStartStamp() &lt;= s.getEndStamp())</span><br><span class=\"line\">                      || (slot.getEndStamp() &gt;= s.getStartStamp() &amp;&amp; slot.getEndStamp() &lt;= s.getEndStamp())</span><br><span class=\"line\">                      || (s.getStartStamp() &gt;= slot.getStartStamp() &amp;&amp; s.getStartStamp() &lt;= slot.getEndStamp())</span><br><span class=\"line\">                      || (s.getEndStamp() &gt;= slot.getStartStamp() &amp;&amp; s.getEndStamp() &lt;= slot.getEndStamp())</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 时间段类</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"meta\">@Data</span></span><br><span class=\"line\">  <span class=\"meta\">@ToString</span></span><br><span class=\"line\">  <span class=\"meta\">@Builder</span></span><br><span class=\"line\">  <span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\">  <span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TimeSlot</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@DggEsField(fieldType = FieldType.date_type)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalDate startTime;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@DggEsField(fieldType = FieldType.date_type)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalDate endTime;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@DggEsField(fieldType = FieldType.long_type)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long startStamp;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@DggEsField(fieldType = FieldType.long_type)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long endStamp;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">TimeSlot</span><span class=\"params\">(LocalDate startTime, LocalDate endTime)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (startTime.isAfter(endTime)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.startTime = endTime;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.endTime = startTime;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.startTime = startTime;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.endTime = endTime;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.startStamp = <span class=\"built_in\">this</span>.startTime.atTime(LocalTime.MIN).toInstant(ZoneOffset.ofHours(<span class=\"number\">8</span>)).toEpochMilli();</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.endStamp = <span class=\"built_in\">this</span>.endTime.atTime(LocalTime.MAX).toInstant(ZoneOffset.ofHours(<span class=\"number\">8</span>)).toEpochMilli();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></div></div>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","function_score","相关度评分"]},{"title":"ElasticSearch - function_score 系列文章（四）衰减函数 linear、exp、gauss 具体实例","url":"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E5%9B%9B%EF%BC%89%E8%A1%B0%E5%87%8F%E5%87%BD%E6%95%B0-linear%E3%80%81exp%E3%80%81gauss-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch - function_score 系列文章（一）简介</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89field-value-factor-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（二）field_value_factor 具体实例</a></li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%89%EF%BC%89weight-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（三）weight 具体实例</a></li>\n<li>ElasticSearch - function_score 系列文章（四）衰减函数 linear、exp、gauss 具体实例</li>\n<li><a href=\"/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%84%E4%BB%B7%E7%B3%BB%E7%BB%9F-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B\">ElasticSearch - function_score 系列文章（五）评价系统 具体实例</a></li>\n</ol>\n</div>\n\n\n<h2 id=\"1-业务场景\"><a href=\"#1-业务场景\" class=\"headerlink\" title=\"1. 业务场景\"></a>1. 业务场景</h2><ul>\n<li>很多变量都可以影响用户对于酒店的选择，像是用户可能希望酒店离市中心近一点，但是如果价格足够便宜，也愿意为了省钱，妥协选择一个更远的住处</li>\n<li>如果我们只是使用一个filter排除所有市中心方圆100米以外的酒店，再用一个filter排除每晚价格超过100元的酒店，这种作法太过强硬，可能有一间房在500米，但是超级便宜一晚只要10元，用户可能会因此愿意妥协住这间房</li>\n<li>为了解决这个问题，因此function_score查询提供了一组衰减函数(decay functions)，让我们有能力在两个滑动标准(如地点和价格)之间权衡</li>\n</ul>\n<h2 id=\"2-衰减函数\"><a href=\"#2-衰减函数\" class=\"headerlink\" title=\"2. 衰减函数\"></a>2. 衰减函数</h2><ul>\n<li>linear、exp、gauss三种衰减函数的差别只在于衰减曲线的形状，在DSL的语法上的用法完全一样<ul>\n<li>linear : 线性函数是条直线，一旦直线与横轴0香蕉，所有其他值的评分都是0</li>\n<li>exp : 指数函数是先剧烈衰减然后变缓</li>\n<li>guass(最常用) : 高斯函数则是钟形的，他的衰减速率是先缓慢，然后变快，最后又放缓<br>  <img src=\"/images/ElasticSearch-function-score-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%EF%BC%88%E5%9B%9B%EF%BC%89%E8%A1%B0%E5%87%8F%E5%87%BD%E6%95%B0-linear%E3%80%81exp%E3%80%81gauss-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B/1.png\" loading=\"lazy\"></li>\n</ul>\n</li>\n<li>衰减函数们 (linear、exp、gauss) 支持的参数<ul>\n<li>origin : 中心点，或是字段可能的最佳值，落在原点(origin)上的文档评分_score为满分1.0，支持数值、时间 以及 &quot;经纬度地理座标点&quot;(最常用) 的字段</li>\n<li>offset : 从 origin 为中心，为他设置一个偏移量offset覆盖一个范围，在此范围内所有的评分_score也都是和origin一样满分1.0</li>\n<li>scale : 衰减率，即是一个文档从origin下落时，_score改变的速度</li>\n<li>decay : 从 origin 衰减到 scale 所得的评分_score，默认为0.5 (一般不需要改变，这个参数使用默认的就好了)</li>\n<li>以上面的图为例<ul>\n<li>所有曲线(linear、exp、gauss)的origin都是40，offset是5，因此范围在40-5 &lt;&#x3D; value &lt;&#x3D; 40+5的文档的评分_score都是满分1.0</li>\n<li>而在此范围之外，评分会开始衰减，衰减率由scale值(此处是5)和decay值(此处是默认值0.5)决定，在origin +&#x2F;- (offset + scale)处的评分是decay值，也就是在30、50的评分处是0.5分</li>\n<li>也就是说，在origin + offset + scale或是origin - offset - scale的点上，得到的分数仅有decay分</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-具体实例一\"><a href=\"#3-具体实例一\" class=\"headerlink\" title=\"3. 具体实例一\"></a>3. 具体实例一</h2><ul>\n<li>先准备数据和索引，在ES插入三笔数据，其中 language 是 text 类型，like 是 long 类型(代表点赞量)<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /test_decay_functions/_bulk?pretty</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class=\"line\">&#123;&quot;language&quot;: &quot;java&quot;, &quot;like&quot;: 5&#125;</span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class=\"line\">&#123;&quot;language&quot;: &quot;python&quot;, &quot;like&quot;: 10&#125;</span><br><span class=\"line\">&#123;&quot;index&quot;: &#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class=\"line\">&#123;&quot;language&quot;: &quot;go&quot;, &quot;like&quot;: 15&#125;</span><br></pre></td></tr></table></figure></li>\n<li>以 like&#x3D;15 为中心，使用 gauss 函数<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_decay_functions/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;query&quot;: &#123;</span><br><span class=\"line\">                &quot;match_all&quot;: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;functions&quot;: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;gauss&quot;: &#123;</span><br><span class=\"line\">                        &quot;like&quot;: &#123;</span><br><span class=\"line\">                            &quot;origin&quot;: &quot;15&quot;, //如果不设置offset，offset默认为0</span><br><span class=\"line\">                            &quot;scale&quot;: &quot;5&quot;,</span><br><span class=\"line\">                            &quot;decay&quot;: &quot;0.2&quot;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span> <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;go&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">15</span> <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.2</span><span class=\"punctuation\">,</span> <span class=\"comment\">//因为改变了decay=0.2，所以当位于 origin-offset-scale=10 的位置时，分数为decay，就是0.2</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span> <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;python&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span> <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0.0016</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span> <span class=\"attr\">&quot;language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;java&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;like&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span> <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"4-具体实例二\"><a href=\"#4-具体实例二\" class=\"headerlink\" title=\"4. 具体实例二\"></a>4. 具体实例二</h2><ul>\n<li>假设有一个用户希望租一个离市中心近一点的酒店，且每晚不超过100元的酒店，而且与距离相比，我们的用户对价格更敏感，那么使用衰减函数guass查询如下<ul>\n<li>其中把price语句的origin点设为50是有原因的，由于价格的特性一定是越低越好，所以0~100元的所有价格的酒店都应该认为是比较好的，而100元以上的酒店就慢慢衰减</li>\n<li>如果我们将price的origin点设置成100，那么价格低于100元的酒店的评分反而会变低，这不是我们期望的结果，与其这样不如将origin和offset同时设成50，只让price大于100元时评分才会变低</li>\n<li>虽然这样设置也会使得price小于0元的酒店评分降低没错，不过现实生活中价格不会有负数，因此就算price&lt;0的评分会下降，也不会对我们的搜索结果造成影响(酒店的价格一定都是正的)</li>\n<li>换句话说，其实只要把origin + offset的值设为100，origin或offset是什么样的值都无所谓，只要能确保酒店价格在100元以上的酒店会衰减就好了<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /test_decay_functions2/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;function_score&quot;: &#123;</span><br><span class=\"line\">            &quot;functions&quot;: [</span><br><span class=\"line\">                //第一个gauss加强函数，决定距离的衰减率</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;gauss&quot;: &#123;</span><br><span class=\"line\">                        &quot;location&quot;: &#123;</span><br><span class=\"line\">                            &quot;origin&quot;: &#123;  //origin点设成酒店的经纬度座标</span><br><span class=\"line\">                                &quot;lat&quot;: 51.5,</span><br><span class=\"line\">                                &quot;lon&quot;: 0.12</span><br><span class=\"line\">                            &#125;,</span><br><span class=\"line\">                            &quot;offset&quot;: &quot;2km&quot;, //距离中心点2km以内都是满分1.0，2km外开始衰减</span><br><span class=\"line\">                            &quot;scale&quot;: &quot;3km&quot;  //衰减率</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                //第二个gauss加强函数，决定价格的衰减率，因为用户对价格更敏感，所以给了这个gauss加强函数2倍的权重</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;gauss&quot;: &#123;</span><br><span class=\"line\">                        &quot;price&quot;: &#123;</span><br><span class=\"line\">                            &quot;origin&quot;: &quot;50&quot;, </span><br><span class=\"line\">                            &quot;offset&quot;: &quot;50&quot;,</span><br><span class=\"line\">                            &quot;scale&quot;: &quot;20&quot;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &quot;weight&quot;: 2</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","function_score","相关度评分"]},{"title":"ElasticSearch 聚合（一）简介","url":"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch 聚合（一）简介</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B0%9D%E8%AF%95%E8%81%9A%E5%90%88\">ElasticSearch 聚合（二）尝试聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE\">ElasticSearch 聚合（三）条形图</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E3%80%81%E8%BF%87%E6%BB%A4%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E7%9A%84%E8%81%9A%E5%90%88\">ElasticSearch 聚合（四）基于范围、过滤以及排序的聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B\">ElasticSearch 聚合（五）聚合示例</a></li>\n</ol>\n</div>\n\n<h2 id=\"聚合\"><a href=\"#聚合\" class=\"headerlink\" title=\"聚合\"></a>聚合</h2><p>通过搜索，如果我们有一个查询并且希望找到匹配这个查询的文档集，就好比在大海捞针。</p>\n<p>通过聚合，我们会得到一个数据的概览。我们需要的是分析和总结全套的数据而不是寻找单个文档：</p>\n<pre><code>在大海里有多少针？\n针的平均长度是多少？\n按照针的制造商来划分，针的长度中位值是多少？\n每月加入到海中的针有多少？\n</code></pre>\n<p>聚合也可以回答更加细微的问题：</p>\n<pre><code>你最受欢迎的针的制造商是什么？\n这里面有异常的针么？\n</code></pre>\n<p>聚合允许我们向数据提出一些复杂的问题。虽然功能完全不同于搜索，但它使用相同的数据结构。这意味着聚合的执行速度很快并且就像搜索一样几乎是实时的。</p>\n<p>这对报告和仪表盘是非常强大的。你可以实时显示你的数据，让你立即回应，而不是对你的数据进行汇总（ <em>需要一周时间去运行的 Hadoop 任务</em> ），您的报告随着你的数据变化而变化，而不是预先计算的、过时的和不相关的。</p>\n<p>最后，聚合和搜索是一起的。 这意味着你可以在单个请求里同时对相同的数据进行搜索&#x2F;过滤和分析。并且由于聚合是在用户搜索的上下文里计算的，你不只是显示四星酒店的数量，而是显示匹配查询条件的四星酒店的数量。</p>\n<p>聚合是如此强大以至于许多公司已经专门为数据分析建立了大型 Elasticsearch 集群。</p>\n<h2 id=\"高阶概念\"><a href=\"#高阶概念\" class=\"headerlink\" title=\"高阶概念\"></a>高阶概念</h2><p>类似于 DSL 查询表达式，聚合也有 可组合 的语法：独立单元的功能可以被混合起来提供你需要的自定义行为。这意味着只需要学习很少的基本概念，就可以得到几乎无尽的组合。</p>\n<p>要掌握聚合，你只需要明白两个主要的概念：</p>\n<p><strong>桶（Buckets）</strong></p>\n<pre><code>满足特定条件的文档的集合\n</code></pre>\n<p><strong>指标（Metrics）</strong></p>\n<pre><code>对桶内的文档进行统计计算\n</code></pre>\n<p>这就是全部了！每个聚合都是一个或者多个桶和零个或者多个指标的组合。翻译成粗略的SQL语句来解释吧：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(color)     ⑴</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> <span class=\"keyword\">table</span></span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> color      ⑵</span><br></pre></td></tr></table></figure>\n<pre><code>⑴: COUNT(color) 相当于指标。\n⑵: GROUP BY color 相当于桶。\n</code></pre>\n<p>桶在概念上类似于 SQL 的分组（GROUP BY），而指标则类似于 COUNT() 、 SUM() 、 MAX() 等统计方法。</p>\n<p>让我们深入这两个概念 并且了解和这两个概念相关的东西。</p>\n<h3 id=\"桶\"><a href=\"#桶\" class=\"headerlink\" title=\"桶\"></a>桶</h3><p><em>桶</em> 简单来说就是满足特定条件的文档的集合：</p>\n<ul>\n<li>一个雇员属于 <em>男性</em> 桶或者 <em>女性</em> 桶</li>\n<li>奥尔巴尼属于 <em>纽约</em> 桶</li>\n<li>日期2014-10-28属于 <em>十月</em> 桶</li>\n</ul>\n<p>当聚合开始被执行，每个文档里面的值通过计算来决定符合哪个桶的条件。如果匹配到，文档将放入相应的桶并接着进行聚合操作。</p>\n<p>桶也可以被嵌套在其他桶里面，提供层次化的或者有条件的划分方案。例如，辛辛那提会被放入俄亥俄州这个桶，而 整个 俄亥俄州桶会被放入美国这个桶。</p>\n<p>Elasticsearch 有很多种类型的桶，能让你通过很多种方式来划分文档（时间、最受欢迎的词、年龄区间、地理位置等等）。其实根本上都是通过同样的原理进行操作：基于条件来划分文档。</p>\n<h3 id=\"指标\"><a href=\"#指标\" class=\"headerlink\" title=\"指标\"></a>指标</h3><p>桶能让我们划分文档到有意义的集合，但是最终我们需要的是对这些桶内的文档进行一些指标的计算。分桶是一种达到目的的手段：它提供了一种给文档分组的方法来让我们可以计算感兴趣的指标。</p>\n<p>大多数 指标 是简单的数学运算（例如最小值、平均值、最大值，还有汇总），这些是通过文档的值来计算。在实践中，指标能让你计算像平均薪资、最高出售价格、95%的查询延迟这样的数据。</p>\n<h3 id=\"桶和指标的组合\"><a href=\"#桶和指标的组合\" class=\"headerlink\" title=\"桶和指标的组合\"></a>桶和指标的组合</h3><p>聚合 是由桶和指标组成的。 聚合可能只有一个桶，可能只有一个指标，或者可能两个都有。也有可能有一些桶嵌套在其他桶里面。例如，我们可以通过所属国家来划分文档（桶），然后计算每个国家的平均薪酬（指标）。</p>\n<p>由于桶可以被嵌套，我们可以实现非常多并且非常复杂的聚合：</p>\n<p>1.通过国家划分文档（桶）</p>\n<p>2.然后通过性别划分每个国家（桶）</p>\n<p>3.然后通过年龄区间划分每种性别（桶）</p>\n<p>4.最后，为每个年龄区间计算平均薪酬（指标）</p>\n<p>最后将告诉你每个 &lt;国家, 性别, 年龄&gt; 组合的平均薪酬。所有的这些都在一个请求内完成并且只遍历一次数据！</p>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","Aggregations","聚合"]},{"title":"ElasticSearch 聚合（三）条形图","url":"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch 聚合（一）简介</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B0%9D%E8%AF%95%E8%81%9A%E5%90%88\">ElasticSearch 聚合（二）尝试聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE\">ElasticSearch 聚合（三）条形图</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E3%80%81%E8%BF%87%E6%BB%A4%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E7%9A%84%E8%81%9A%E5%90%88\">ElasticSearch 聚合（四）基于范围、过滤以及排序的聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B\">ElasticSearch 聚合（五）聚合示例</a></li>\n</ol>\n</div>\n\n<h2 id=\"条形图\"><a href=\"#条形图\" class=\"headerlink\" title=\"条形图\"></a>条形图</h2><p>聚合还有一个令人激动的特性就是能够十分容易地将它们转换成图表和图形。本章中， 我们正在通过示例数据来完成各种各样的聚合分析，最终，我们将会发现聚合功能是非常强大的。</p>\n<p>直方图 histogram 特别有用。 它本质上是一个条形图，如果有创建报表或分析仪表盘的经验，那么我们会毫无疑问的发现里面有一些图表是条形图。 创建直方图需要指定一个区间，如果我们要为售价创建一个直方图，可以将间隔设为 20,000。这样做将会在每个 $20,000 档创建一个新桶，然后文档会被分到对应的桶中。</p>\n<p>对于仪表盘来说，我们希望知道每个售价区间内汽车的销量。我们还会想知道每个售价区间内汽车所带来的收入，可以通过对每个区间内已售汽车的售价求和得到。</p>\n<p>可以用 histogram 和一个嵌套的 sum 度量得到我们想要的答案：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;:&#123;</span><br><span class=\"line\">      &quot;price&quot;:&#123;</span><br><span class=\"line\">         &quot;histogram&quot;:&#123;    ⑴</span><br><span class=\"line\">            &quot;field&quot;: &quot;price&quot;,</span><br><span class=\"line\">            &quot;interval&quot;: 20000</span><br><span class=\"line\">         &#125;,</span><br><span class=\"line\">         &quot;aggs&quot;:&#123;</span><br><span class=\"line\">            &quot;revenue&quot;: &#123;</span><br><span class=\"line\">               &quot;sum&quot;: &#123;     ⑵</span><br><span class=\"line\">                 &quot;field&quot; : &quot;price&quot;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ histogram 桶要求两个参数：一个数值字段以及一个定义桶大小间隔。\n⑵ sum 度量嵌套在每个售价区间内，用来显示每个区间内的总收入。\n</code></pre>\n<p>如我们所见，查询是围绕 price 聚合构建的，它包含一个 histogram 桶。它要求字段的类型必须是数值型的同时需要设定分组的间隔范围。 间隔设置为 20,000 意味着我们将会得到如 [0-19999, 20000-39999, ...] 这样的区间。</p>\n<p>接着，我们在直方图内定义嵌套的度量，这个 sum 度量，它会对落入某一具体售价区间的文档中 price 字段的值进行求和。 这可以为我们提供每个售价区间的收入，从而可以发现到底是普通家用车赚钱还是奢侈车赚钱。</p>\n<p>响应结果如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;revenue&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">37000</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">20000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;revenue&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">95000</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">80000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;revenue&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">80000</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">]</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>结果很容易理解，不过应该注意到直方图的键值是区间的下限。键 0 代表区间 0-19，999 ，键 20000 代表区间 20，000-39，999 ，等等。</p>\n<div class=\"note warning\"><p>我们可能会注意到空的区间，比如：$40，000-60，000，没有出现在响应中。 histogram 桶默认会忽略它，因为它有可能会导致不希望的潜在错误输出。</p>\n<p>我们会在下一小节中讨论如何包括空桶。返回空桶 <a href=\"#%E8%BF%94%E5%9B%9E%E7%A9%BA-Buckets\">返回空 Buckets</a> 。</p>\n</div>\n\n<p>可以在图 <a href=\"#\">Figure 35, “Sales and Revenue per price bracket”</a> 中看到以上数据直方图的图形化表示。</p>\n<p><strong>Figure 35. Sales and Revenue per price bracket</strong><br><img src=\"/images/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE/1.png\" alt=\"Sales and Revenue per price bracket\" title=\"Sales and Revenue per price bracket\" loading=\"lazy\"></p>\n<p>当然，我们可以为任何聚合输出的分类和统计结果创建条形图，而不只是 直方图 桶。让我们以最受欢迎 10 种汽车以及它们的平均售价、标准差这些信息创建一个条形图。 我们会用到 terms 桶和 extended_stats 度量：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot; : 0,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    &quot;makes&quot;: &#123;</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;make&quot;,</span><br><span class=\"line\">        &quot;size&quot;: 10</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123;</span><br><span class=\"line\">        &quot;stats&quot;: &#123;</span><br><span class=\"line\">          &quot;extended_stats&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;price&quot;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述代码会按受欢迎度返回制造商列表以及它们各自的统计信息。我们对其中的 stats.avg 、 stats.count 和 stats.std_deviation 信息特别感兴趣，并用 它们计算出标准差：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">std_err = std_deviation / count</span><br></pre></td></tr></table></figure>\n\n<p>创建图表如图 <a href=\"#\">Figure 36, “Average price of all makes, with error bars”</a> 。</p>\n<p><strong>Figure 36. Average price of all makes, with error bars</strong><br><img src=\"/images/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE/2.png\" alt=\"Average price of all makes, with error bars\" title=\"Average price of all makes, with error bars\" loading=\"lazy\"></p>\n<h2 id=\"按时间统计\"><a href=\"#按时间统计\" class=\"headerlink\" title=\"按时间统计\"></a>按时间统计</h2><p>如果搜索是在 Elasticsearch 中使用频率最高的，那么构建按时间统计的 date_histogram 紧随其后。 为什么你会想用 date_histogram 呢？</p>\n<p>假设你的数据带时间戳。 无论是什么数据（Apache 事件日志、股票买卖交易时间、棒球运动时间）只要带有时间戳都可以进行 date_histogram 分析。当你的数据有时间戳，你总是想在 <em>时间</em> 维度上构建指标分析：</p>\n<ul>\n<li>今年每月销售多少台汽车？</li>\n<li>这只股票最近 12 小时的价格是多少？</li>\n<li>我们网站上周每小时的平均响应延迟时间是多少？</li>\n</ul>\n<p>虽然通常的 histogram 都是条形图，但 date_histogram 倾向于转换成线状图以展示时间序列。 许多公司用 Elasticsearch <em>仅仅</em> 只是为了分析时间序列数据。 date_histogram 分析是它们最基本的需要。</p>\n<p>date_histogram 与 通常的 histogram 类似。 但不是在代表数值范围的数值字段上构建 buckets，而是在时间范围上构建 buckets。 因此每一个 bucket 都被定义成一个特定的日期大小 (比如， 1个月 或 2.5 天 )。</p>\n<div class=\"note danger\"><p><strong>可以用通常的 histogram 进行时间分析吗？</strong></p>\n<p>从技术上来讲，是可以的。 通常的 histogram bucket（桶）是可以处理日期的。 但是它不能自动识别日期。 而用 date_histogram ，你可以指定时间段如 1 个月 ，它能聪明地知道 2 月的天数比 12 月少。 date_histogram 还具有另外一个优势，即能合理地处理时区，这可以使你用客户端的时区进行图标定制，而不是用服务器端时区。</p>\n<p>通常的 histogram 会把日期看做是数字，这意味着你必须以微秒为单位指明时间间隔。另外聚合并不知道日历时间间隔，使得它对于日期而言几乎没什么用处。</p>\n</div>\n\n<p>我们的第一个例子将构建一个简单的折线图来回答如下问题： 每月销售多少台汽车？</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;: &#123;</span><br><span class=\"line\">      &quot;sales&quot;: &#123;</span><br><span class=\"line\">         &quot;date_histogram&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;sold&quot;,</span><br><span class=\"line\">            &quot;interval&quot;: &quot;month&quot;,    ⑴</span><br><span class=\"line\">            &quot;format&quot;: &quot;yyyy-MM-dd&quot;    ⑵</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 时间间隔要求是日历术语 (如每个 bucket 1 个月)。\n⑵ 我们提供日期格式以便 buckets 的键值便于阅读。\n</code></pre>\n<p>我们的查询只有一个聚合，每月构建一个 bucket。这样我们可以得到每个月销售的汽车数量。 另外还提供了一个额外的 format 参数以便 buckets 有 &quot;好看的&quot; 键值。 然而在内部，日期仍然是被简单表示成数值。这可能会使得 UI 设计者抱怨，因此可以提供常用的日期格式进行格式化以更方便阅读。</p>\n<p>结果既符合预期又有一点出人意料（看看你是否能找到意外之处）：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">   ...</span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;sales&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-01-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1388534400000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-02-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1391212800000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-05-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1398902400000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-07-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1404172800000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-08-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1406851200000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-10-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1412121600000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-11-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1414800000000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">]</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>聚合结果已经完全展示了。正如你所见，我们有代表月份的 buckets，每个月的文档数目，以及美化后的 key_as_string 。</p>\n<h3 id=\"返回空-Buckets\"><a href=\"#返回空-Buckets\" class=\"headerlink\" title=\"返回空 Buckets\"></a>返回空 Buckets</h3><p>注意到结果末尾处的奇怪之处了吗？</p>\n<p>是的，结果没错。 我们的结果少了一些月份！ date_histogram （和 histogram 一样）默认只会返回文档数目非零的 buckets。</p>\n<p>这意味着你的 histogram 总是返回最少结果。通常，你并不想要这样。对于很多应用，你可能想直接把结果导入到图形库中，而不想做任何后期加工。</p>\n<p>事实上，即使 buckets 中没有文档我们也想返回。可以通过设置两个额外参数来实现这种效果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;: &#123;</span><br><span class=\"line\">      &quot;sales&quot;: &#123;</span><br><span class=\"line\">         &quot;date_histogram&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;sold&quot;,</span><br><span class=\"line\">            &quot;interval&quot;: &quot;month&quot;,</span><br><span class=\"line\">            &quot;format&quot;: &quot;yyyy-MM-dd&quot;,</span><br><span class=\"line\">            &quot;min_doc_count&quot; : 0,    ⑴</span><br><span class=\"line\">            &quot;extended_bounds&quot; : &#123;     ⑵</span><br><span class=\"line\">                &quot;min&quot; : &quot;2014-01-01&quot;,</span><br><span class=\"line\">                &quot;max&quot; : &quot;2014-12-31&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 这个参数强制返回空 buckets。\n⑵ 这个参数强制返回整年。\n</code></pre>\n<p>这两个参数会强制返回一年中所有月份的结果，而不考虑结果中的文档数目。 min_doc_count 非常容易理解：它强制返回所有 buckets，即使 buckets 可能为空。</p>\n<p>extended_bounds 参数需要一点解释。 min_doc_count 参数强制返回空 buckets，但是 Elasticsearch 默认只返回你的数据中最小值和最大值之间的 buckets。</p>\n<p>因此如果你的数据只落在了 4 月和 7 月之间，那么你只能得到这些月份的 buckets（可能为空也可能不为空）。因此为了得到全年数据，我们需要告诉 Elasticsearch 我们想要全部 buckets， 即便那些 buckets 可能落在最小日期 <em>之前</em> 或 最大日期 <em>之后</em> 。</p>\n<p>extended_bounds 参数正是如此。一旦你加上了这两个设置，你可以把得到的结果轻易地直接插入到你的图形库中，从而得到类似 <a href=\"#\">Figure 37, “汽车销售时间图”</a> 的图表。</p>\n<p><strong>Figure 37. 汽车销售时间图</strong><br><img src=\"/images/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE/3.png\" alt=\"汽车销售时间图\" title=\"汽车销售时间图\" loading=\"lazy\"></p>\n<h3 id=\"扩展例子\"><a href=\"#扩展例子\" class=\"headerlink\" title=\"扩展例子\"></a>扩展例子</h3><p>正如我们已经见过很多次，buckets 可以嵌套进 buckets 中从而得到更复杂的分析。 作为例子，我们构建聚合以便按季度展示所有汽车品牌总销售额。同时按季度、按每个汽车品牌计算销售总额，以便可以找出哪种品牌最赚钱：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;: &#123;</span><br><span class=\"line\">      &quot;sales&quot;: &#123;</span><br><span class=\"line\">         &quot;date_histogram&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;sold&quot;,</span><br><span class=\"line\">            &quot;interval&quot;: &quot;quarter&quot;,    ⑴</span><br><span class=\"line\">            &quot;format&quot;: &quot;yyyy-MM-dd&quot;,</span><br><span class=\"line\">            &quot;min_doc_count&quot; : 0,</span><br><span class=\"line\">            &quot;extended_bounds&quot; : &#123;</span><br><span class=\"line\">                &quot;min&quot; : &quot;2014-01-01&quot;,</span><br><span class=\"line\">                &quot;max&quot; : &quot;2014-12-31&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;,</span><br><span class=\"line\">         &quot;aggs&quot;: &#123;</span><br><span class=\"line\">            &quot;per_make_sum&quot;: &#123;</span><br><span class=\"line\">               &quot;terms&quot;: &#123;</span><br><span class=\"line\">                  &quot;field&quot;: &quot;make&quot;</span><br><span class=\"line\">               &#125;,</span><br><span class=\"line\">               &quot;aggs&quot;: &#123;</span><br><span class=\"line\">                  &quot;sum_price&quot;: &#123;</span><br><span class=\"line\">                     &quot;sum&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125;    ⑵ </span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;total_sum&quot;: &#123;</span><br><span class=\"line\">               &quot;sum&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125;    ⑶</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 注意我们把时间间隔从 month 改成了 quarter 。\n⑵ 计算每种品牌的总销售金额。\n⑶ 也计算所有全部品牌的汇总销售金额。\n</code></pre>\n<p>得到的结果（截去了一大部分）如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">....</span><br><span class=\"line\"><span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;sales&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;key_as_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-01-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1388534400000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;total_sum&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">105000</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;per_make_sum&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                  <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                     <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;bmw&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                     <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                     <span class=\"attr\">&quot;sum_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">80000</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                  <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                     <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ford&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                     <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                     <span class=\"attr\">&quot;sum_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">25000</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">               <span class=\"punctuation\">]</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>我们把结果绘成图，得到如 <a href=\"#\">Figure 38, “按品牌分布的每季度销售额”</a> 所示的总销售额的折线图和每个品牌（每季度）的柱状图。</p>\n<p><strong>Figure 38. 按品牌分布的每季度销售额</strong><br><img src=\"/images/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE/4.png\" alt=\"按品牌分布的每季度销售额\" title=\"按品牌分布的每季度销售额\" loading=\"lazy\"></p>\n<h3 id=\"潜力无穷\"><a href=\"#潜力无穷\" class=\"headerlink\" title=\"潜力无穷\"></a>潜力无穷</h3><p>这些很明显都是简单例子，但图表聚合其实是潜力无穷的。 如 <a href=\"#\">Figure 39, “Kibana—​用聚合构建的实时分析面板”</a> 展示了 Kibana 中用各种聚合构建的面板。</p>\n<p><strong>Figure 39. Kibana—​用聚合构建的实时分析面板</strong><br><img src=\"/images/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE/5.png\" alt=\"Kibana—​用聚合构建的实时分析面板\" title=\"Kibana—​用聚合构建的实时分析面板\" loading=\"lazy\"></p>\n<p>因为聚合的实时性，类似这样的面板很容易查询、操作和交互。这使得它们成为需要分析数据又不会构建 Hadoop 作业的非技术人员的理想工具。</p>\n<p>当然，为了构建类似 Kibana 这样的强大面板，你可能需要更深的知识，比如基于范围、过滤以及排序的聚合。</p>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","Aggregations","聚合"]},{"title":"ElasticSearch 聚合（二）尝试聚合","url":"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B0%9D%E8%AF%95%E8%81%9A%E5%90%88/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch 聚合（一）简介</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B0%9D%E8%AF%95%E8%81%9A%E5%90%88\">ElasticSearch 聚合（二）尝试聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE\">ElasticSearch 聚合（三）条形图</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E3%80%81%E8%BF%87%E6%BB%A4%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E7%9A%84%E8%81%9A%E5%90%88\">ElasticSearch 聚合（四）基于范围、过滤以及排序的聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B\">ElasticSearch 聚合（五）聚合示例</a></li>\n</ol>\n</div>\n\n<h2 id=\"尝试聚合\"><a href=\"#尝试聚合\" class=\"headerlink\" title=\"尝试聚合\"></a>尝试聚合</h2><p>我们可以用以下几页定义不同的聚合和它们的语法， 但学习聚合的最佳途径就是用实例来说明。 一旦我们获得了聚合的思想，以及如何合理地嵌套使用它们，那么语法就变得不那么重要了。</p>\n<div class=\"note warning\"><p>聚合的桶操作和度量的完整用法可以在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS83Lngvc2VhcmNoLWFnZ3JlZ2F0aW9ucy5odG1s\">Elasticsearch 参考<i class=\"fa fa-external-link-alt\"></i></span> 中找到。本章中会涵盖其中很多内容，但在阅读完本章后查看它会有助于我们对它的整体能力有所了解。</p>\n</div>\n\n<p>所以让我们先看一个例子。我们将会创建一些对汽车经销商有用的聚合，数据是关于汽车交易的信息：车型、制造商、售价、何时被出售等。</p>\n<p>首先我们批量索引一些数据：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /cars/_bulk</span><br><span class=\"line\"></span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 10000, &quot;color&quot; : &quot;red&quot;, &quot;make&quot; : &quot;honda&quot;, &quot;sold&quot; : &quot;2014-10-28&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 20000, &quot;color&quot; : &quot;red&quot;, &quot;make&quot; : &quot;honda&quot;, &quot;sold&quot; : &quot;2014-11-05&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 30000, &quot;color&quot; : &quot;green&quot;, &quot;make&quot; : &quot;ford&quot;, &quot;sold&quot; : &quot;2014-05-18&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 15000, &quot;color&quot; : &quot;blue&quot;, &quot;make&quot; : &quot;toyota&quot;, &quot;sold&quot; : &quot;2014-07-02&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 12000, &quot;color&quot; : &quot;green&quot;, &quot;make&quot; : &quot;toyota&quot;, &quot;sold&quot; : &quot;2014-08-19&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 20000, &quot;color&quot; : &quot;red&quot;, &quot;make&quot; : &quot;honda&quot;, &quot;sold&quot; : &quot;2014-11-05&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 80000, &quot;color&quot; : &quot;red&quot;, &quot;make&quot; : &quot;bmw&quot;, &quot;sold&quot; : &quot;2014-01-01&quot; &#125;</span><br><span class=\"line\">&#123; &quot;index&quot;: &#123;&#125;&#125;</span><br><span class=\"line\">&#123; &quot;price&quot; : 25000, &quot;color&quot; : &quot;blue&quot;, &quot;make&quot; : &quot;ford&quot;, &quot;sold&quot; : &quot;2014-02-12&quot; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了数据，开始构建我们的第一个聚合。汽车经销商可能会想知道哪个颜色的汽车销量最好，用聚合可以轻易得到结果，用 <code>terms</code> 桶操作：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;size&quot; : 0,</span><br><span class=\"line\">    &quot;aggs&quot; : &#123;    ⑴</span><br><span class=\"line\">        &quot;popular_colors&quot; : &#123;      ⑵</span><br><span class=\"line\">            &quot;terms&quot; : &#123;      ⑶</span><br><span class=\"line\">              &quot;field&quot; : &quot;color&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 聚合操作被置于顶层参数 aggs 之下（如果你愿意，完整形式 aggregations 同样有效）。\n⑵ 然后，可以为聚合指定一个我们想要名称，本例中是： popular_colors 。\n⑶ 最后，定义单个桶的类型 terms 。\n</code></pre>\n<p>聚合是在特定搜索结果背景下执行的， 这也就是说它只是查询请求的另外一个顶层参数（例如，使用 &#x2F;_search 端点）。 聚合可以与查询结对，但我们会晚些在 <a href=\"\">限定聚合的范围（Scoping Aggregations）</a> 中来解决这个问题。</p>\n<div class=\"note warning\"><p>可能会注意到我们将 size 设置成 0 。我们并不关心搜索结果的具体内容，所以将返回记录数设置为 0 来提高查询速度。 设置 size: 0 与 Elasticsearch 1.x 中使用 count 搜索类型等价。</p>\n</div>\n\n<p>然后我们为聚合定义一个名字，名字的选择取决于使用者，响应的结果会以我们定义的名字为标签，这样应用就可以解析得到的结果。</p>\n<p>随后我们定义聚合本身，在本例中，我们定义了一个单 terms 桶。 这个 terms 桶会为每个碰到的唯一词项动态创建新的桶。 因为我们告诉它使用 color 字段，所以 terms 桶会为每个颜色动态创建新桶。</p>\n<p>让我们运行聚合并查看结果：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">   <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span>    ⑴</span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;popular_colors&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>     ⑵</span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;red&quot;</span><span class=\"punctuation\">,</span>    ⑶</span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span>     ⑷</span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;blue&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;green&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">]</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 因为我们设置了 size 参数，所以不会有 hits 搜索结果返回。\n⑵ popular_colors 聚合是作为 aggregations 字段的一部分被返回的。\n⑶ 每个桶的 key 都与 color 字段里找到的唯一词对应。它总会包含 doc_count 字段，告诉我们包含该词项的文档数量。\n⑷ 每个桶的数量代表该颜色的文档数量。\n</code></pre>\n<p>响应包含多个桶，每个对应一个唯一颜色（例如：红 或 绿）。每个桶也包括 <code>聚合进</code> 该桶的所有文档的数量。例如，有四辆红色的车。</p>\n<p>前面的这个例子完全是实时执行的：一旦文档可以被搜到，它就能被聚合。这也就意味着我们可以直接将聚合的结果源源不断的传入图形库，然后生成实时的仪表盘。 不久，你又销售了一辆银色的车，我们的图形就会立即动态更新银色车的统计信息。</p>\n<p>瞧！这就是我们的第一个聚合！</p>\n<h3 id=\"添加度量指标\"><a href=\"#添加度量指标\" class=\"headerlink\" title=\"添加度量指标\"></a>添加度量指标</h3><p>前面的例子告诉我们每个桶里面的文档数量，这很有用。但通常，我们的应用需要提供更复杂的文档度量。 例如，每种颜色汽车的平均价格是多少？</p>\n<p>为了获取更多信息，我们需要告诉 Elasticsearch 使用哪个字段，计算何种度量。 这需要将度量 嵌套 在桶内， 度量会基于桶内的文档计算统计结果。</p>\n<p>让我们继续为汽车的例子加入 average 平均度量：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;: &#123; </span><br><span class=\"line\">      &quot;colors&quot;: &#123;</span><br><span class=\"line\">         &quot;terms&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;color&quot;</span><br><span class=\"line\">         &#125;,</span><br><span class=\"line\">         &quot;aggs&quot;: &#123;    ⑴</span><br><span class=\"line\">            &quot;avg_price&quot;: &#123;    ⑵</span><br><span class=\"line\">               &quot;avg&quot;: &#123;</span><br><span class=\"line\">                  &quot;field&quot;: &quot;price&quot;    ⑶</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 为度量新增 aggs 层。\n⑵ 为度量指定名字： avg_price 。\n⑶ 最后，为 price 字段定义 avg 度量。\n</code></pre>\n<p>正如所见，我们用前面的例子加入了新的 aggs 层。这个新的聚合层让我们可以将 avg 度量嵌套置于 terms 桶内。实际上，这就为每个颜色生成了平均价格。</p>\n<p>正如 颜色 的例子，我们需要给度量起一个名字（ avg_price ）这样可以稍后根据名字获取它的值。最后，我们指定度量本身（ avg ）以及我们想要计算平均值的字段（ price ）：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;colors&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;red&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;avg_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>     ⑴</span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">32500</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;blue&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;avg_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">20000</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;green&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;avg_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">21000</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">]</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 响应中的新字段 avg_price 。\n</code></pre>\n<p>尽管响应只发生很小改变，实际上我们获得的数据是增长了。之前，我们知道有四辆红色的车，现在，红色车的平均价格是 $32，500 美元。这个信息可以直接显示在报表或者图形中。</p>\n<h3 id=\"嵌套桶\"><a href=\"#嵌套桶\" class=\"headerlink\" title=\"嵌套桶\"></a>嵌套桶</h3><p>在我们使用不同的嵌套方案时，聚合的力量才能真正得以显现。 在前例中，我们已经看到如何将一个度量嵌入桶中，它的功能已经十分强大了。</p>\n<p>但真正令人激动的分析来自于将桶嵌套进 另外一个桶 所能得到的结果。 现在，我们想知道每个颜色的汽车制造商的分布：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;: &#123;</span><br><span class=\"line\">      &quot;colors&quot;: &#123;</span><br><span class=\"line\">         &quot;terms&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;color&quot;</span><br><span class=\"line\">         &#125;,</span><br><span class=\"line\">         &quot;aggs&quot;: &#123;</span><br><span class=\"line\">            &quot;avg_price&quot;: &#123;    ⑴</span><br><span class=\"line\">               &quot;avg&quot;: &#123;</span><br><span class=\"line\">                  &quot;field&quot;: &quot;price&quot;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;make&quot;: &#123;     ⑵</span><br><span class=\"line\">                &quot;terms&quot;: &#123;</span><br><span class=\"line\">                    &quot;field&quot;: &quot;make&quot;     ⑶</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 注意前例中的 avg_price 度量仍然保持原位。\n⑵ 另一个聚合 make 被加入到了 color 颜色桶中。\n⑶ 这个聚合是 terms 桶，它会为每个汽车制造商生成唯一的桶。\n</code></pre>\n<p>这里发生了一些有趣的事。 首先，我们可能会观察到之前例子中的 avg_price 度量完全没有变化，还在原来的位置。 一个聚合的每个 <em>层级</em> 都可以有多个度量或桶， avg_price 度量告诉我们每种颜色汽车的平均价格。它与其他的桶和度量相互独立。</p>\n<p>这对我们的应用非常重要，因为这里面有很多相互关联，但又完全不同的度量需要收集。聚合使我们能够用一次数据请求获得所有的这些信息。</p>\n<p>另外一件值得注意的重要事情是我们新增的这个 make 聚合，它是一个 terms 桶（嵌套在 colors 、 terms 桶内）。这意味着它会为数据集中的每个唯一组合生成（ color 、 make ）元组。</p>\n<p>让我们看看返回的响应（为了简单我们只显示部分结果）：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;colors&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;red&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;make&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>    ⑴</span><br><span class=\"line\">                  <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;honda&quot;</span><span class=\"punctuation\">,</span>   ⑵ </span><br><span class=\"line\">                        <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;bmw&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                  <span class=\"punctuation\">]</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;avg_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">32500</span>    ⑶</span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 正如期望的那样，新的聚合嵌入在每个颜色桶中。\n⑵ 现在我们看见按不同制造商分解的每种颜色下车辆信息。\n⑶ 最终，我们看到前例中的 avg_price 度量仍然维持不变。\n</code></pre>\n<p>响应结果告诉我们以下几点：</p>\n<ul>\n<li>红色车有四辆。</li>\n<li>红色车的平均售价是 $32，500 美元。</li>\n<li>其中三辆是 Honda 本田制造，一辆是 BMW 宝马制造。</li>\n</ul>\n<h3 id=\"最后的修改\"><a href=\"#最后的修改\" class=\"headerlink\" title=\"最后的修改\"></a>最后的修改</h3><p>让我们回到话题的原点，在进入新话题之前，对我们的示例做最后一个修改， 为每个汽车生成商计算最低和最高的价格：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;aggs&quot;: &#123;</span><br><span class=\"line\">      &quot;colors&quot;: &#123;</span><br><span class=\"line\">         &quot;terms&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;color&quot;</span><br><span class=\"line\">         &#125;,</span><br><span class=\"line\">         &quot;aggs&quot;: &#123;</span><br><span class=\"line\">            &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;make&quot; : &#123;</span><br><span class=\"line\">                &quot;terms&quot; : &#123;</span><br><span class=\"line\">                    &quot;field&quot; : &quot;make&quot;</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &quot;aggs&quot; : &#123;    ⑴</span><br><span class=\"line\">                    &quot;min_price&quot; : &#123; &quot;min&quot;: &#123; &quot;field&quot;: &quot;price&quot;&#125; &#125;,   ⑵ </span><br><span class=\"line\">                    &quot;max_price&quot; : &#123; &quot;max&quot;: &#123; &quot;field&quot;: &quot;price&quot;&#125; &#125;    ⑶</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 我们需要增加另外一个嵌套的 aggs 层级。\n⑵ 然后包括 min 最小度量。\n⑶ 以及 max 最大度量。\n</code></pre>\n<p>得到以下输出（只显示部分结果）：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;colors&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;red&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;make&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;honda&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;min_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                           <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10000</span>     ⑴</span><br><span class=\"line\">                        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;max_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                           <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">20000</span>     ⑵</span><br><span class=\"line\">                        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;bmw&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;min_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                           <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">80000</span></span><br><span class=\"line\">                        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;max_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                           <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">80000</span></span><br><span class=\"line\">                        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                     <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                  <span class=\"punctuation\">]</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;avg_price&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">32500</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<pre><code>⑴⑵ min 和 max 度量现在出现在每个汽车制造商（ make ）下面。\n</code></pre>\n<p>有了这两个桶，我们可以对查询的结果进行扩展并得到以下信息：</p>\n<ul>\n<li>有四辆红色车。</li>\n<li>红色车的平均售价是 $32，500 美元。</li>\n<li>其中三辆红色车是 Honda 本田制造，一辆是 BMW 宝马制造。</li>\n<li>最便宜的红色本田售价为 $10，000 美元。</li>\n<li>最贵的红色本田售价为 $20，000 美元。</li>\n</ul>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","Aggregations","聚合"]},{"title":"ElasticSearch-聚合（五）聚合示例","url":"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch 聚合（一）简介</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B0%9D%E8%AF%95%E8%81%9A%E5%90%88\">ElasticSearch 聚合（二）尝试聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE\">ElasticSearch 聚合（三）条形图</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E3%80%81%E8%BF%87%E6%BB%A4%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E7%9A%84%E8%81%9A%E5%90%88\">ElasticSearch 聚合（四）基于范围、过滤以及排序的聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B\">ElasticSearch 聚合（五）聚合示例</a></li>\n</ol>\n</div>\n\n<h2 id=\"聚合示例1\"><a href=\"#聚合示例1\" class=\"headerlink\" title=\"聚合示例1\"></a>聚合示例1</h2><div class=\"tabs\" id=\"aggregation-simple1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#aggregation-simple1-1\"><code>Query DSL</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"aggregation-simple1-1\"><p>一行记录代表一个用户的一次考试，查询单个用户的考试，反查各考试的参考人数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /examination_base_info_document/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;   ⑴</span><br><span class=\"line\">    &quot;term&quot;: &#123;</span><br><span class=\"line\">      &quot;userId&quot;: &quot;1709121972885834550&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;track_total_hits&quot;: 2147483647,</span><br><span class=\"line\">  &quot;collapse&quot;: &#123;   ⑵</span><br><span class=\"line\">    &quot;field&quot;: &quot;examinationId&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    &quot;my_exam&quot;: &#123;    ⑶</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;examinationId&quot;,</span><br><span class=\"line\">        &quot;size&quot;: 2147483647</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;all&quot;: &#123;    ⑷</span><br><span class=\"line\">      &quot;global&quot;: &#123;&#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123;</span><br><span class=\"line\">        &quot;total_exam&quot;: &#123;</span><br><span class=\"line\">          &quot;terms&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;examinationId&quot;,</span><br><span class=\"line\">            &quot;size&quot;: 2147483647</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 查询单个用户id\n⑵ 字段去重\n⑶ 单个用户按照考试id分组\n⑷ 全局桶按照考试id分组\n</code></pre></div></div></div>\n\n<h2 id=\"聚合示例2\"><a href=\"#聚合示例2\" class=\"headerlink\" title=\"聚合示例2\"></a>聚合示例2</h2><div class=\"tabs\" id=\"aggregation-simple2\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#aggregation-simple2-1\"><code>Query DSL</code></a></li><li class=\"tab\"><a href=\"#aggregation-simple2-2\"><code>Java 代码实现</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"aggregation-simple2-1\"><p>一行记录代表一道考题的回答是否正确，查询单个考试，统计各试卷各考题的正确率</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /examination_record_document/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot;: 0,</span><br><span class=\"line\">  &quot;query&quot;: &#123;    ⑴</span><br><span class=\"line\">    &quot;term&quot;: &#123;</span><br><span class=\"line\">      &quot;examinationId&quot;: &quot;1709121938526093488&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    &quot;paperId&quot;: &#123;    ⑵</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;paperId&quot;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123;</span><br><span class=\"line\">        &quot;problemId&quot;: &#123;    ⑶</span><br><span class=\"line\">          &quot;terms&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;problemId&quot;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &quot;aggs&quot;: &#123;</span><br><span class=\"line\">            &quot;userAnswerIsRightKey&quot;: &#123;   ⑷</span><br><span class=\"line\">              &quot;stats&quot;: &#123;</span><br><span class=\"line\">                &quot;field&quot;: &quot;userAnswerIsRightKey&quot;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;right-percentage&quot;: &#123;   ⑸</span><br><span class=\"line\">              &quot;bucket_script&quot;: &#123;</span><br><span class=\"line\">                &quot;buckets_path&quot;: &#123;</span><br><span class=\"line\">                  &quot;wrong&quot;: &quot;userAnswerIsRightKey.sum&quot;,</span><br><span class=\"line\">                  &quot;total&quot;: &quot;userAnswerIsRightKey.count&quot;</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &quot;script&quot;: &quot;100 - params.wrong / params.total * 100&quot;,</span><br><span class=\"line\">                &quot;format&quot;: &quot;#.##&quot;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 查询单个考试id\n⑵ 按试卷id分组\n⑶ 嵌套桶按考题id分组\n⑷ 是否正确指标 0正确 1错误\n⑸ 正确率脚本\n</code></pre></div><div class=\"tab-pane\" id=\"aggregation-simple2-2\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Api(tags = &quot;es示例&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/yk/es&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EsController</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCrispsController</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(&quot;aggregations示例&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/aggregations&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">aggregations</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//声明SearchSourceBuilder对象</span></span><br><span class=\"line\">        <span class=\"type\">SearchSourceBuilder</span> <span class=\"variable\">searchSourceBuilder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchSourceBuilder</span>();</span><br><span class=\"line\">        <span class=\"comment\">//声明Bool查询对象</span></span><br><span class=\"line\">        <span class=\"type\">BoolQueryBuilder</span> <span class=\"variable\">bqb</span> <span class=\"operator\">=</span> QueryBuilders.boolQuery();</span><br><span class=\"line\">        <span class=\"comment\">//must类比成mysql里的and条件，termQuery为不进行分词的精确匹配查询</span></span><br><span class=\"line\">        bqb.must(termQuery(<span class=\"string\">&quot;examinationId&quot;</span>, <span class=\"string\">&quot;1709121938526093488&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">//matchQuery为分词查询，将会针对content的内容进行分词后匹配</span></span><br><span class=\"line\"><span class=\"comment\">//        bqb.must(matchQuery(&quot;settlementUserId&quot;, &quot;596127065183256700&quot;));</span></span><br><span class=\"line\">        <span class=\"comment\">//should类比成mysql里的or条件，wildcardQuery为模糊匹配，可以支持左右模糊</span></span><br><span class=\"line\"><span class=\"comment\">//        bqb.should(wildcardQuery(&quot;text&quot;, &quot;你好*&quot;));</span></span><br><span class=\"line\">        <span class=\"comment\">//将条件语句实装</span></span><br><span class=\"line\">        searchSourceBuilder.query(bqb);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 我们并不关心搜索结果的具体内容，所以将返回记录数设置为 0 来提高查询速度。</span></span><br><span class=\"line\">        searchSourceBuilder.size(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 聚合</span></span><br><span class=\"line\">        Map&lt;String, String&gt; scriptParams = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        scriptParams.put(<span class=\"string\">&quot;wrong&quot;</span>, <span class=\"string\">&quot;userAnswerIsRightKey.sum&quot;</span>);</span><br><span class=\"line\">        scriptParams.put(<span class=\"string\">&quot;total&quot;</span>, <span class=\"string\">&quot;userAnswerIsRightKey.count&quot;</span>);</span><br><span class=\"line\">        searchSourceBuilder.aggregation(</span><br><span class=\"line\">                AggregationBuilders.terms(<span class=\"string\">&quot;paperId&quot;</span>).field(<span class=\"string\">&quot;paperId&quot;</span>).size(Integer.MAX_VALUE)</span><br><span class=\"line\">                        .subAggregation(AggregationBuilders.terms(<span class=\"string\">&quot;problemId&quot;</span>).field(<span class=\"string\">&quot;problemId&quot;</span>).size(Integer.MAX_VALUE)</span><br><span class=\"line\">                                .subAggregation(AggregationBuilders.stats(<span class=\"string\">&quot;userAnswerIsRightKey&quot;</span>).field(<span class=\"string\">&quot;userAnswerIsRightKey&quot;</span>))</span><br><span class=\"line\">                                .subAggregation(PipelineAggregatorBuilders.bucketScript(<span class=\"string\">&quot;right-percentage&quot;</span>, scriptParams,</span><br><span class=\"line\">                                        <span class=\"keyword\">new</span> <span class=\"title class_\">Script</span>(<span class=\"string\">&quot;100 - params.wrong / params.total * 100&quot;</span>)).format(<span class=\"string\">&quot;#.##&quot;</span>))));</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;Query DSL: &#123;&#125;&quot;</span>, searchSourceBuilder);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SearchResponse</span> <span class=\"variable\">searchResponse</span> <span class=\"operator\">=</span> dggESTemplate.query(<span class=\"string\">&quot;examination_record_document&quot;</span>, searchSourceBuilder);</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;SearchResponse: &#123;&#125;&quot;</span>, searchResponse);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 取值</span></span><br><span class=\"line\">        <span class=\"type\">ParsedStringTerms</span> <span class=\"variable\">paperTerms</span> <span class=\"operator\">=</span> (ParsedStringTerms) searchResponse.getAggregations().asMap().get(<span class=\"string\">&quot;paperId&quot;</span>);</span><br><span class=\"line\">        paperTerms.getBuckets().forEach(paperBucket -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">ParsedStringTerms</span> <span class=\"variable\">problemTerms</span> <span class=\"operator\">=</span> (ParsedStringTerms) paperBucket.getAggregations().asMap().get(<span class=\"string\">&quot;problemId&quot;</span>);</span><br><span class=\"line\">            problemTerms.getBuckets().forEach(problemBucket -&gt; &#123;</span><br><span class=\"line\">                <span class=\"type\">ParsedSimpleValue</span> <span class=\"variable\">rightPercentage</span> <span class=\"operator\">=</span> (ParsedSimpleValue) problemBucket.getAggregations().asMap().get(<span class=\"string\">&quot;right-percentage&quot;</span>);</span><br><span class=\"line\">                <span class=\"type\">double</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rightPercentage.value();</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;right-percentage: &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></div></div>\n"},{"title":"ElasticSearch 聚合（四）基于范围、过滤以及排序的聚合","url":"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E3%80%81%E8%BF%87%E6%BB%A4%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E7%9A%84%E8%81%9A%E5%90%88/","content":"<p><span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B\">ElasticSearch 聚合（一）简介</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B0%9D%E8%AF%95%E8%81%9A%E5%90%88\">ElasticSearch 聚合（二）尝试聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%89%EF%BC%89%E6%9D%A1%E5%BD%A2%E5%9B%BE\">ElasticSearch 聚合（三）条形图</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E5%9B%9B%EF%BC%89%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E3%80%81%E8%BF%87%E6%BB%A4%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E7%9A%84%E8%81%9A%E5%90%88\">ElasticSearch 聚合（四）基于范围、过滤以及排序的聚合</a></li>\n<li><a href=\"/ElasticSearch-%E8%81%9A%E5%90%88%EF%BC%88%E4%BA%94%EF%BC%89%E8%81%9A%E5%90%88%E7%A4%BA%E4%BE%8B\">ElasticSearch 聚合（五）聚合示例</a></li>\n</ol>\n</div>\n\n<h2 id=\"范围限定的聚合\"><a href=\"#范围限定的聚合\" class=\"headerlink\" title=\"范围限定的聚合\"></a>范围限定的聚合</h2><p>所有聚合的例子到目前为止，你可能已经注意到，我们的搜索请求省略了一个 query 。 整个请求只不过是一个聚合。</p>\n<p>聚合可以与搜索请求同时执行，但是我们需要理解一个新概念： 范围 。 默认情况下，聚合与查询是对同一范围进行操作的，也就是说，聚合是基于我们查询匹配的文档集合进行计算的。</p>\n<p>让我们看看第一个聚合的示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;size&quot; : 0,</span><br><span class=\"line\">    &quot;aggs&quot; : &#123;</span><br><span class=\"line\">        &quot;colors&quot; : &#123;</span><br><span class=\"line\">            &quot;terms&quot; : &#123;</span><br><span class=\"line\">              &quot;field&quot; : &quot;color&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们可以看到聚合是隔离的。现实中，Elasticsearch 认为 &quot;没有指定查询&quot; 和 &quot;查询所有文档&quot; 是等价的。前面这个查询内部会转化成下面的这个请求：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;size&quot; : 0,</span><br><span class=\"line\">    &quot;query&quot; : &#123;</span><br><span class=\"line\">        &quot;match_all&quot; : &#123;&#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;aggs&quot; : &#123;</span><br><span class=\"line\">        &quot;colors&quot; : &#123;</span><br><span class=\"line\">            &quot;terms&quot; : &#123;</span><br><span class=\"line\">              &quot;field&quot; : &quot;color&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为聚合总是对查询范围内的结果进行操作的，所以一个隔离的聚合实际上是在对 match_all 的结果范围操作，即所有的文档。</p>\n<p>一旦有了范围的概念，我们就能更进一步对聚合进行自定义。我们前面所有的示例都是对 所有 数据计算统计信息的：销量最高的汽车，所有汽车的平均售价，最佳销售月份等等。</p>\n<p>利用范围，我们可以问“福特在售车有多少种颜色？”诸如此类的问题。可以简单的在请求中加上一个查询（本例中为 match 查询）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;query&quot; : &#123;</span><br><span class=\"line\">        &quot;match&quot; : &#123;</span><br><span class=\"line\">            &quot;make&quot; : &quot;ford&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;aggs&quot; : &#123;</span><br><span class=\"line\">        &quot;colors&quot; : &#123;</span><br><span class=\"line\">            &quot;terms&quot; : &#123;</span><br><span class=\"line\">              &quot;field&quot; : &quot;color&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为我们没有指定 &quot;size&quot; : 0 ，所以搜索结果和聚合结果都被返回了：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">   <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;total&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max_score&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1.6931472</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;price&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">25000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;blue&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;make&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ford&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;sold&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-02-12&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;_source&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;price&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">30000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;green&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;make&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ford&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;sold&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2014-05-18&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">]</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;aggregations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;colors&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;buckets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;blue&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;green&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;doc_count&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">]</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>看上去这并没有什么，但却对高大上的仪表盘来说至关重要。 加入一个搜索栏可以将任何静态的仪表板变成一个实时数据搜索设备。 这让用户可以搜索数据，查看所有实时更新的图形（由于聚合的支持以及对查询范围的限定）。 这是 Hadoop 无法做到的！</p>\n<h3 id=\"全局桶\"><a href=\"#全局桶\" class=\"headerlink\" title=\"全局桶\"></a>全局桶</h3><p>通常我们希望聚合是在查询范围内的，但有时我们也想要搜索它的子集，而聚合的对象却是 所有 数据。</p>\n<p>例如，比方说我们想知道福特汽车与 <em>所有</em> 汽车平均售价的比较。我们可以用普通的聚合（查询范围内的）得到第一个信息，然后用 <code>全局</code> 桶获得第二个信息。</p>\n<p><code>全局</code> 桶包含 <em>所有</em> 的文档，它无视查询的范围。因为它还是一个桶，我们可以像平常一样将聚合嵌套在内：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;size&quot; : 0,</span><br><span class=\"line\">    &quot;query&quot; : &#123;</span><br><span class=\"line\">        &quot;match&quot; : &#123;</span><br><span class=\"line\">            &quot;make&quot; : &quot;ford&quot;   ⑴</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;aggs&quot; : &#123;</span><br><span class=\"line\">        &quot;single_avg_price&quot;: &#123;</span><br><span class=\"line\">            &quot;avg&quot; : &#123; &quot;field&quot; : &quot;price&quot; &#125; </span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;all&quot;: &#123;</span><br><span class=\"line\">            &quot;global&quot; : &#123;&#125;,    ⑵</span><br><span class=\"line\">            &quot;aggs&quot; : &#123;</span><br><span class=\"line\">                &quot;avg_price&quot;: &#123;</span><br><span class=\"line\">                    &quot;avg&quot; : &#123; &quot;field&quot; : &quot;price&quot; &#125;   ⑶ </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 聚合操作在查询范围内（例如：所有文档匹配 ford ）\n⑵ global 全局桶没有参数。\n⑶ 聚合操作针对所有文档，忽略汽车品牌。\n</code></pre>\n<p>single_avg_price 度量计算是基于查询范围内所有文档，即所有 福特 汽车。avg_price 度量是嵌套在 全局 桶下的，这意味着它完全忽略了范围并对所有文档进行计算。聚合返回的平均值是所有汽车的平均售价。</p>\n<p>如果能一直坚持读到这里，应该知道我们有个真言：尽可能的使用过滤器。它同样可以应用于聚合，在下一章中，我们会展示如何对聚合结果进行过滤而不是仅对查询范围做限定。</p>\n<h2 id=\"过滤和聚合\"><a href=\"#过滤和聚合\" class=\"headerlink\" title=\"过滤和聚合\"></a>过滤和聚合</h2><p>聚合范围限定还有一个自然的扩展就是过滤。因为聚合是在查询结果范围内操作的，任何可以适用于查询的过滤器也可以应用在聚合上。</p>\n<h3 id=\"过滤\"><a href=\"#过滤\" class=\"headerlink\" title=\"过滤\"></a>过滤</h3><p>如果我们想找到售价在 $10,000 美元之上的所有汽车同时也为这些车计算平均售价， 可以简单地使用一个 constant_score 查询和 filter 约束：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;size&quot; : 0,</span><br><span class=\"line\">    &quot;query&quot; : &#123;</span><br><span class=\"line\">        &quot;constant_score&quot;: &#123;</span><br><span class=\"line\">            &quot;filter&quot;: &#123;</span><br><span class=\"line\">                &quot;range&quot;: &#123;</span><br><span class=\"line\">                    &quot;price&quot;: &#123;</span><br><span class=\"line\">                        &quot;gte&quot;: 10000</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;aggs&quot; : &#123;</span><br><span class=\"line\">        &quot;single_avg_price&quot;: &#123;</span><br><span class=\"line\">            &quot;avg&quot; : &#123; &quot;field&quot; : &quot;price&quot; &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这正如我们在前面章节中讨论过那样，从根本上讲，使用 non-scoring 查询和使用 match 查询没有任何区别。查询（包括了一个过滤器）返回一组文档的子集，聚合正是操作这些文档。使用 filtering query 会忽略评分，并有可能会缓存结果数据等等。</p>\n<h3 id=\"过滤桶\"><a href=\"#过滤桶\" class=\"headerlink\" title=\"过滤桶\"></a>过滤桶</h3><p>但是如果我们只想对聚合结果过滤怎么办？ 假设我们正在为汽车经销商创建一个搜索页面， 我们希望显示用户搜索的结果，但是我们同时也想在页面上提供更丰富的信息，包括（与搜索匹配的）上个月度汽车的平均售价。</p>\n<p>这里我们无法简单的做范围限定，因为有两个不同的条件。搜索结果必须是 ford ，但是聚合结果必须满足 <code>ford</code> AND <code>sold &gt; now - 1M</code> 。</p>\n<p>为了解决这个问题，我们可以用一种特殊的桶，叫做 <code>filter</code> （注：过滤桶） 。 我们可以指定一个过滤桶，当文档满足过滤桶的条件时，我们将其加入到桶内。</p>\n<p>查询结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GET /cars/_search</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;size&quot; : 0,</span><br><span class=\"line\">   &quot;query&quot;:&#123;</span><br><span class=\"line\">      &quot;match&quot;: &#123;</span><br><span class=\"line\">         &quot;make&quot;: &quot;ford&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   &quot;aggs&quot;:&#123;</span><br><span class=\"line\">      &quot;recent_sales&quot;: &#123;</span><br><span class=\"line\">         &quot;filter&quot;: &#123;    ⑴</span><br><span class=\"line\">            &quot;range&quot;: &#123;</span><br><span class=\"line\">               &quot;sold&quot;: &#123;</span><br><span class=\"line\">                  &quot;from&quot;: &quot;now-1M&quot;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;,</span><br><span class=\"line\">         &quot;aggs&quot;: &#123;</span><br><span class=\"line\">            &quot;average_price&quot;:&#123;</span><br><span class=\"line\">               &quot;avg&quot;: &#123;</span><br><span class=\"line\">                  &quot;field&quot;: &quot;price&quot;    ⑵</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>⑴ 使用 过滤 桶在 查询 范围基础上应用过滤器。\n⑵ avg 度量只会对 ford 和上个月售出的文档计算平均售价。\n</code></pre>\n<p>因为 <code>filter</code> 桶和其他桶的操作方式一样，所以可以随意将其他桶和度量嵌入其中。所有嵌套的组件都会 &quot;继承&quot; 这个过滤，这使我们可以按需针对聚合过滤出选择部分。</p>\n","categories":["ElasticSearch"],"tags":["ElasticSearch","Aggregations","聚合"]},{"title":"PaaS 公共服务","url":"/PaaS-%E5%85%AC%E5%85%B1%E6%9C%8D%E5%8A%A1/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h2 id=\"🌟-消息中心\"><a href=\"#🌟-消息中心\" class=\"headerlink\" title=\"🌟 消息中心\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LXByb2plY3QvZGdnLXRhYy1tZXNzYWdlLWNlbnRlci90cmVlL2NyaXNwcw==\">消息中心<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>提供接口：根据模板id获取模板内容</li>\n<li>短信运营商回调（含状态报告、上行回复）</li>\n<li>取消mongo日志归档定时任务，已移至中台系统</li>\n</ul>\n<h2 id=\"🌟-技术中台管理系统\"><a href=\"#🌟-技术中台管理系统\" class=\"headerlink\" title=\"🌟 技术中台管理系统\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvZGdnLWZyYW1ld29yay1tYW5hZ2UvdHJlZS9jcmlzcHM=\">技术中台管理系统<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>消息中心通道、账户、签名、模板、日志功能</li>\n<li>缓存管理Redis多数据源配置、梯度更新策略、白名单设置</li>\n</ul>\n<h2 id=\"🌟-第三方服务平台\"><a href=\"#🌟-第三方服务平台\" class=\"headerlink\" title=\"🌟 第三方服务平台\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvZGdnLXRhYy1leHRlcm5hbC1wbGF0Zm9ybS5naXQ=\">第三方服务平台<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>信息查询：身份证实名认证、手机号三要素认证、银行卡四要素认证、企业工商信息查询、OCR图片文字识别</li>\n<li>OSS文件查询：STS临时凭证授权、文件查询精确匹配和模糊匹配、文件物理删除和逻辑删除、恢复逻辑删除文件等</li>\n</ul>\n<h2 id=\"🌟-分布式ID\"><a href=\"#🌟-分布式ID\" class=\"headerlink\" title=\"🌟 分布式ID\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvUEFBUy90cmVlL2NyaXNwcy9kZ2ctZnJhbWV3b3JrLWlkY3JlYXRlcg==\">分布式ID<i class=\"fa fa-external-link-alt\"></i></span></h2><h2 id=\"🌟-TiCDC同步服务\"><a href=\"#🌟-TiCDC同步服务\" class=\"headerlink\" title=\"🌟 TiCDC同步服务\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LXByb2plY3QvY3Jpc3BzLXBhYXMtdGljZGM=\">TiCDC同步服务<i class=\"fa fa-external-link-alt\"></i></span></h2><h2 id=\"🌟-录音中间层服务\"><a href=\"#🌟-录音中间层服务\" class=\"headerlink\" title=\"🌟 录音中间层服务\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LXByb2plY3QvY3Jpc3BzLXBhYXMtdm9pY2UtcmVjb3Jk\">录音中间层服务<i class=\"fa fa-external-link-alt\"></i></span></h2><h2 id=\"🌟-iboss站内信\"><a href=\"#🌟-iboss站内信\" class=\"headerlink\" title=\"🌟 iboss站内信\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3dhbmd4aWFud2VpL2Nsb3VkLW1lc3NhZ2UtaW5zdGF0aW9u\">iboss站内信<i class=\"fa fa-external-link-alt\"></i></span></h2><hr>\n","categories":["paas"],"tags":["消息中心","技术中台","第三方服务","分布式ID","TiCDC同步服务","录音中间层服务","iboss站内信"]},{"title":"PaaS 平台","url":"/PaaS-%E5%B9%B3%E5%8F%B0/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h2 id=\"🌟-Redis-组件\"><a href=\"#🌟-Redis-组件\" class=\"headerlink\" title=\"🌟 Redis 组件\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL3JlZGlzYW5u\">Redis 组件<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>基于 <code>Spring Cache</code> 扩展实现注解式缓存，并接入nacos动态配置缓存更新策略</li>\n<li>自定义注解方式实现分布式锁</li>\n</ul>\n<h2 id=\"🌟-Mongo-组件\"><a href=\"#🌟-Mongo-组件\" class=\"headerlink\" title=\"🌟 Mongo 组件\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL21vbmdvZGJ0eA==\">Mongo 组件<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>基于4.x版本 <code>MongoDB</code> 数据库支持事务</li>\n<li>新增批处理器，支持多数据源，实现 <code>定时任务</code> + <code>异步批处理</code></li>\n</ul>\n<h2 id=\"🌟-JAR包扫描-SDK\"><a href=\"#🌟-JAR包扫描-SDK\" class=\"headerlink\" title=\"🌟 JAR包扫描 SDK\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL2phcnZlcnNpb24=\">JAR包扫描 SDK<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>通过SPI机制实现脚手架工程启动时自动扫描所有依赖JAR包信息</li>\n</ul>\n<h2 id=\"🌟-DOC文档解析-SDK\"><a href=\"#🌟-DOC文档解析-SDK\" class=\"headerlink\" title=\"🌟 DOC文档解析 SDK\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL2RvY3V0aWxz\">DOC文档解析 SDK<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>实现word模板文件内容解析、内容提取、转换PDF格式、文件MD5值校验等功能</li>\n<li>文件上传后异步回调 <code>PaaS平台-第三方OSS服务</code>，接入 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL29zc19mcmFtZXdvcms=\">OSS框架<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<h2 id=\"🌟-第三方服务-SDK\"><a href=\"#🌟-第三方服务-SDK\" class=\"headerlink\" title=\"🌟 第三方服务 SDK\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL2V4dGVybmFsc2VydmljZQ==\">第三方服务 SDK<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>信息查询：身份证实名认证、手机号三要素认证、银行卡四要素认证、企业工商信息查询、OCR图片文字识别</li>\n<li>消息中心：发送短信、企业微信、邮件、APP推送，模板内容查询</li>\n<li>OSS文件查询：STS临时凭证授权、文件查询精确匹配和模糊匹配、文件物理删除和逻辑删除、恢复逻辑删除文件等</li>\n</ul>\n<h2 id=\"🌟-操作日志-SDK\"><a href=\"#🌟-操作日志-SDK\" class=\"headerlink\" title=\"🌟 操作日志 SDK\"></a>🌟 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL29wZXJsb2c=\">操作日志 SDK<i class=\"fa fa-external-link-alt\"></i></span></h2><ul>\n<li>提供项目操作日志统一异步写入ES、统一筛选查询、置顶等功能</li>\n</ul>\n<hr>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL3BhYXM=\">PaaS 平台<i class=\"fa fa-external-link-alt\"></i></span></p>\n","categories":["paas"],"tags":["第三方服务","Redis","MongoDB","JAR包扫描","DOC文档解析","操作日志"]},{"title":"Redis持久化 - RDB和AOF","url":"/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h2 id=\"持久化的作用\"><a href=\"#持久化的作用\" class=\"headerlink\" title=\"持久化的作用\"></a>持久化的作用</h2><h3 id=\"什么是持久化\"><a href=\"#什么是持久化\" class=\"headerlink\" title=\"什么是持久化\"></a>什么是持久化</h3><p>持久化（Persistence），即把数据（如内存中的对象）保存到可永久保存的存储设备中（如磁盘）。<br>持久化 Redis 所有数据保持在内存中，对数据的更新将异步地保存到磁盘上。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/1.jpg\" alt=\"Redis持久化\" loading=\"lazy\"></p>\n<h3 id=\"持久化的实现方式\"><a href=\"#持久化的实现方式\" class=\"headerlink\" title=\"持久化的实现方式\"></a>持久化的实现方式</h3><h4 id=\"快照方式持久化\"><a href=\"#快照方式持久化\" class=\"headerlink\" title=\"快照方式持久化\"></a>快照方式持久化</h4><p>快照方式持久化就是在某时刻把所有数据进行完整备份。<br>例：Mysql 的 Dump 方式、Redis 的 RDB 方式。</p>\n<h4 id=\"写日志方式持久化\"><a href=\"#写日志方式持久化\" class=\"headerlink\" title=\"写日志方式持久化\"></a>写日志方式持久化</h4><p>写日志方式持久化就是把用户执行的所有写指令（增删改）备份到文件中，还原数据时只需要把备份的所有指令重新执行一遍即可。<br>例：Mysql 的 Binlog、Redis 的 AOF、Hbase 的 HLog。</p>\n<h2 id=\"RDB\"><a href=\"#RDB\" class=\"headerlink\" title=\"RDB\"></a>RDB</h2><h3 id=\"什么是-RDB\"><a href=\"#什么是-RDB\" class=\"headerlink\" title=\"什么是 RDB\"></a>什么是 RDB</h3><h4 id=\"RDB-简介\"><a href=\"#RDB-简介\" class=\"headerlink\" title=\"RDB 简介\"></a>RDB 简介</h4><p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/2.jpg\" alt=\"RDB持久化\" loading=\"lazy\"></p>\n<p>RDB 持久化方式能够在指定的时间间隔对你的数据进行快照存储。<br>在默认情况下， Redis 将数据库快照保存在名字为 <code>dump.rdb</code> 的二进制文件中。<br>在 Redis 运行时， RDB 程序将当前内存中的数据库快照保存到磁盘文件中， 在 Redis 重启动时， RDB 程序可以通过载入 RDB 文件来还原数据库的状态。</p>\n<h4 id=\"工作方式\"><a href=\"#工作方式\" class=\"headerlink\" title=\"工作方式\"></a>工作方式</h4><p>当 Redis 需要保存 <code>dump.rdb</code> 文件时， 服务器执行以下操作:</p>\n<ol>\n<li>Redis 调用 <code>forks</code>。同时拥有父进程和子进程。</li>\n<li>子进程将数据集写入到一个临时 RDB 文件中。</li>\n<li>当子进程完成对新 RDB 文件的写入时，Redis 用新 RDB 文件替换原来的 RDB 文件，并删除旧的 RDB 文件。</li>\n</ol>\n<p>这种工作方式使得 Redis 可以从写时复制（copy-on-write）机制中获益。</p>\n<h3 id=\"RDB-的三种主要触发机制\"><a href=\"#RDB-的三种主要触发机制\" class=\"headerlink\" title=\"RDB 的三种主要触发机制\"></a>RDB 的三种主要触发机制</h3><h4 id=\"save-命令（同步数据到磁盘上）\"><a href=\"#save-命令（同步数据到磁盘上）\" class=\"headerlink\" title=\"save 命令（同步数据到磁盘上）\"></a><code>save</code> 命令（同步数据到磁盘上）</h4><p><code>save</code> 命令执行一个同步操作，以 RDB 文件的方式保存所有数据的快照。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; save</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/3.jpg\" alt=\"save命令\" loading=\"lazy\"></p>\n<p>由于 <code>save</code> 命令是同步命令，会占用 Redis 的主进程。若 Redis 数据非常多时，<code>save</code> 命令执行速度会非常慢，阻塞所有客户端的请求。<br>因此很少在生产环境直接使用 <code>SAVE</code> 命令，可以使用 <code>BGSAVE</code> 命令代替。如果在 <code>BGSAVE</code> 命令的保存数据的子进程发生错误的时，用 <code>SAVE</code> 命令保存最新的数据是最后的手段。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/4.jpg\" alt=\"save命令阻塞所有客户端的请求\" loading=\"lazy\"></p>\n<h4 id=\"bgsave-命令（异步保存数据到磁盘上）\"><a href=\"#bgsave-命令（异步保存数据到磁盘上）\" class=\"headerlink\" title=\"bgsave 命令（异步保存数据到磁盘上）\"></a><code>bgsave</code> 命令（异步保存数据到磁盘上）</h4><p><code>bgsave</code> 命令执行一个异步操作，以 RDB 文件的方式保存所有数据的快照。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; bgsave</span><br><span class=\"line\">Background saving started</span><br></pre></td></tr></table></figure>\n\n<p>Redis 使用 Linux 系统的 <code>fock()</code> 生成一个子进程来将 DB 数据保存到磁盘，主进程继续提供服务以供客户端调用。<br>如果操作成功，可以通过客户端命令 <code>LASTSAVE</code> 来检查操作结果。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/5.jpg\" alt=\"bgsave命令\" loading=\"lazy\"></p>\n<h4 id=\"save-与-bgsave-对比\"><a href=\"#save-与-bgsave-对比\" class=\"headerlink\" title=\"save 与 bgsave 对比\"></a><code>save</code> 与 <code>bgsave</code> 对比</h4><table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">save</th>\n<th align=\"center\">bgsave</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">IO类型</td>\n<td align=\"center\">同步</td>\n<td align=\"center\">异步</td>\n</tr>\n<tr>\n<td align=\"center\">阻塞？</td>\n<td align=\"center\">是</td>\n<td align=\"center\">是（阻塞发生在fock()，通常非常快）</td>\n</tr>\n<tr>\n<td align=\"center\">复杂度</td>\n<td align=\"center\">O(n)</td>\n<td align=\"center\">O(n)</td>\n</tr>\n<tr>\n<td align=\"center\">优点</td>\n<td align=\"center\">不会消耗额外的内存</td>\n<td align=\"center\">不阻塞客户端命令</td>\n</tr>\n<tr>\n<td align=\"center\">缺点</td>\n<td align=\"center\">阻塞客户端命令</td>\n<td align=\"center\">需要fock子进程，消耗内存</td>\n</tr>\n</tbody></table>\n<h4 id=\"自动生成-RDB\"><a href=\"#自动生成-RDB\" class=\"headerlink\" title=\"自动生成 RDB\"></a>自动生成 RDB</h4><p>除了手动执行 <code>save</code> 和 <code>bgsave</code> 命令实现RDB持久化以外，Redis 还提供了自动生成RDB的方式。<br>你可以通过配置文件对 Redis 进行设置， 让它在 <code>N 秒内数据集至少有 M 个改动</code> 这一条件被满足时， 自动进行数据集保存操作。<br>比如说， 以下设置会让 Redis 在满足 <code>60 秒内有至少有 1000 个键被改动</code> 这一条件时， 自动进行数据集保存操作:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">save 60 1000</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/6.jpg\" alt=\"自动生成RDB\" loading=\"lazy\"></p>\n<h3 id=\"RDB-相关配置\"><a href=\"#RDB-相关配置\" class=\"headerlink\" title=\"RDB 相关配置\"></a>RDB 相关配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># RDB自动持久化规则</span></span><br><span class=\"line\"><span class=\"comment\"># 当 900 秒内有至少有 1 个键被改动时，自动进行数据集保存操作</span></span><br><span class=\"line\">save 900 1</span><br><span class=\"line\"><span class=\"comment\"># 当 300 秒内有至少有 10 个键被改动时，自动进行数据集保存操作</span></span><br><span class=\"line\">save 300 10</span><br><span class=\"line\"><span class=\"comment\"># 当 60 秒内有至少有 10000 个键被改动时，自动进行数据集保存操作</span></span><br><span class=\"line\">save 60 10000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RDB持久化文件名</span></span><br><span class=\"line\">dbfilename dump-&lt;port&gt;.rdb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据持久化文件存储目录</span></span><br><span class=\"line\"><span class=\"built_in\">dir</span> /var/lib/redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># bgsave发生错误时是否停止写入，通常为yes</span></span><br><span class=\"line\">stop-writes-on-bgsave-error <span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># rdb文件是否使用压缩格式</span></span><br><span class=\"line\">rdbcompression <span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 是否对rdb文件进行校验和检验，通常为yes</span></span><br><span class=\"line\">rdbchecksum <span class=\"built_in\">yes</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RDB-的优点\"><a href=\"#RDB-的优点\" class=\"headerlink\" title=\"RDB 的优点\"></a>RDB 的优点</h3><ol>\n<li>RDB 是一个非常紧凑的文件，它保存了某个时间点的数据集，非常适用于数据集的备份，比如你可以在每个小时报保存一下过去 24 小时内的数据，同时每天保存过去 30 天的数据，这样即使出了问题你也可以根据需求恢复到不同版本的数据集。</li>\n<li>RDB 是一个紧凑的单一文件，很方便传送到另一个远端数据中心或者亚马逊的 S3（可能加密），非常适用于灾难恢复。</li>\n<li>RDB 在保存 RDB 文件时父进程唯一需要做的就是 <code>fork</code> 出一个子进程，接下来的工作全部由子进程来做，父进程不需要再做其它 IO 操作，所以 RDB 持久化方式可以最大化 redis 的性能。</li>\n<li>与 AOF 相比，在恢复大的数据集的时候，RDB 方式会更快一些。</li>\n</ol>\n<h3 id=\"RDB-的缺点\"><a href=\"#RDB-的缺点\" class=\"headerlink\" title=\"RDB 的缺点\"></a>RDB 的缺点</h3><ol>\n<li>耗时、耗性能。RDB 需要经常 <code>fork</code> 子进程来保存数据集到硬盘上，当数据集比较大的时候，<code>fork</code> 的过程是非常耗时的，可能会导致 Redis 在一些毫秒级内不能响应客户端的请求。如果数据集巨大并且 CPU 性能不是很好的情况下，这种情况会持续 1 秒，AOF 也需要 <code>fork</code>，但是你可以调节重写日志文件的频率来提高数据集的耐久度。</li>\n<li>不可控、丢失数据。如果你希望在 redis 意外停止工作（例如电源中断）的情况下丢失的数据最少的话，那么 RDB 不适合你。虽然你可以配置不同的 <code>save</code> 时间点(例如每隔 5 分钟并且对数据集有 100 个写的操作)，但是 Redis 要完整的保存整个数据集是一个比较繁重的工作，你通常会每隔 5 分钟或者更久做一次完整的保存，万一在 Redis 意外宕机，你可能会丢失几分钟的数据。</li>\n</ol>\n<h2 id=\"AOF\"><a href=\"#AOF\" class=\"headerlink\" title=\"AOF\"></a>AOF</h2><h3 id=\"什么是-AOF\"><a href=\"#什么是-AOF\" class=\"headerlink\" title=\"什么是 AOF\"></a>什么是 AOF</h3><p>快照功能（RDB）并不是非常耐久（durable）： 如果 Redis 因为某些原因而造成故障停机， 那么服务器将丢失最近写入、且仍未保存到快照中的那些数据。 从 1.1 版本开始， Redis 增加了一种完全耐久的持久化方式： AOF 持久化。</p>\n<p>你可以在配置文件中打开 AOF 方式：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">appendonly <span class=\"built_in\">yes</span></span><br></pre></td></tr></table></figure>\n\n<p>打开 AOF 后， 每当 Redis 执行一个改变数据集的命令时（比如 <code>SET</code>）， 这个命令就会被追加到 AOF 文件的末尾。这样的话， 当 Redis 重新启时， 程序就可以通过重新执行 AOF 文件中的命令来达到重建数据集的目的。</p>\n<h4 id=\"AOF-运行原理-创建\"><a href=\"#AOF-运行原理-创建\" class=\"headerlink\" title=\"AOF 运行原理 - 创建\"></a>AOF 运行原理 - 创建</h4><p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/7.jpg\" alt=\"创建AOF\" loading=\"lazy\"></p>\n<h4 id=\"AOF-运行原理-恢复\"><a href=\"#AOF-运行原理-恢复\" class=\"headerlink\" title=\"AOF 运行原理 - 恢复\"></a>AOF 运行原理 - 恢复</h4><p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/8.jpg\" alt=\"AOF运行原理 - 恢复\" loading=\"lazy\"></p>\n<h3 id=\"AOF-持久化的三种策略\"><a href=\"#AOF-持久化的三种策略\" class=\"headerlink\" title=\"AOF 持久化的三种策略\"></a>AOF 持久化的三种策略</h3><p>你可以通过配置文件配置 Redis 多久才将数据 fsync 到磁盘一次。</p>\n<h4 id=\"always\"><a href=\"#always\" class=\"headerlink\" title=\"always\"></a>always</h4><p>每次有新命令追加到 AOF 文件时就执行一次 fsync ：非常慢，也非常安全。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/9.jpg\" alt=\"always\" loading=\"lazy\"></p>\n<h4 id=\"everysec\"><a href=\"#everysec\" class=\"headerlink\" title=\"everysec\"></a>everysec</h4><p>每秒 fsync 一次：足够快（和使用 RDB 持久化差不多），并且在故障时只会丢失 1 秒钟的数据。<br>推荐（并且也是默认）的措施为每秒 fsync 一次， 这种 fsync 策略可以兼顾速度和安全性。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/10.jpg\" alt=\"everysec\" loading=\"lazy\"></p>\n<h4 id=\"no\"><a href=\"#no\" class=\"headerlink\" title=\"no\"></a>no</h4><p>从不 fsync ：将数据交给操作系统来处理，由操作系统来决定什么时候同步数据。更快，也更不安全的选择。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/11.jpg\" alt=\"no\" loading=\"lazy\"></p>\n<h4 id=\"always、everysec、no-对比\"><a href=\"#always、everysec、no-对比\" class=\"headerlink\" title=\"always、everysec、no 对比\"></a>always、everysec、no 对比</h4><table>\n<thead>\n<tr>\n<th align=\"center\">命令</th>\n<th align=\"center\">优点</th>\n<th align=\"center\">缺点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">always</td>\n<td align=\"center\">不丢失数据</td>\n<td align=\"center\">IO开销大，一般SATA磁盘只有几百TPS</td>\n</tr>\n<tr>\n<td align=\"center\">everysec</td>\n<td align=\"center\">每秒进行与fsync，最多丢失1秒数据</td>\n<td align=\"center\">可能丢失1秒数据</td>\n</tr>\n<tr>\n<td align=\"center\">no</td>\n<td align=\"center\">不用管</td>\n<td align=\"center\">不可控</td>\n</tr>\n</tbody></table>\n<p>推荐（并且也是默认）的措施为每秒 fsync 一次， 这种 fsync 策略可以兼顾速度和安全性。</p>\n<h3 id=\"AOF-重写\"><a href=\"#AOF-重写\" class=\"headerlink\" title=\"AOF 重写\"></a>AOF 重写</h3><p>因为 AOF 的运作方式是不断地将命令追加到文件的末尾， 所以随着写入命令的不断增加， AOF 文件的体积也会变得越来越大。举个例子， 如果你对一个计数器调用了 100 次 INCR ， 那么仅仅是为了保存这个计数器的当前值， AOF 文件就需要使用 100 条记录（entry）。然而在实际上， 只使用一条 <code>SET</code> 命令已经足以保存计数器的当前值了， 其余 99 条记录实际上都是多余的。<br>为了处理这种情况， Redis 支持一种有趣的特性： 可以在不打断服务客户端的情况下， 对 AOF 文件进行重建（rebuild）。执行 <code>bgrewriteaof</code> 命令， Redis 将生成一个新的 AOF 文件， 这个文件包含重建当前数据集所需的最少命令。<br>Redis 2.2 需要自己手动执行 <code>bgrewriteaof</code> 命令； Redis 2.4 则可以通过配置自动触发 AOF 重写。</p>\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/12.jpg\" alt=\"AOF重写\" loading=\"lazy\"></p>\n<h4 id=\"AOF-重写的作用\"><a href=\"#AOF-重写的作用\" class=\"headerlink\" title=\"AOF 重写的作用\"></a>AOF 重写的作用</h4><ul>\n<li>减少磁盘占用量</li>\n<li>加速数据恢复</li>\n</ul>\n<h4 id=\"AOF-重写的实现方式\"><a href=\"#AOF-重写的实现方式\" class=\"headerlink\" title=\"AOF 重写的实现方式\"></a>AOF 重写的实现方式</h4><ul>\n<li><code>bgrewriteaof</code> 命令</li>\n</ul>\n<p>Redis <code>bgrewriteaof</code> 命令用于异步执行一个 AOF（AppendOnly File）文件重写操作。重写会创建一个当前AOF文件的体积优化版本。<br>即使 <code>bgrewriteaof</code> 执行失败，也不会有任何数据丢失，因为旧的AOF文件在 <code>bgrewriteaof</code> 成功之前不会被修改。<br>AOF 重写由 Redis 自行触发，<code>bgrewriteaof</code> 仅仅用于手动触发重写操作。</p>\n<div class=\"note primary\"><p>具体内容：</p>\n<ul>\n<li>如果一个子 Redis 是通过磁盘快照创建的，AOF 重写将会在 RDB 终止后才开始保存。这种情况下 <code>BGREWRITEAOF</code> 仍然会返回 OK 状态码。从 Redis 2.6 起你可以通过 <code>INFO</code> 命令查看 AOF 重写执行情况。</li>\n<li>如果正在执行的 AOF 重写返回一个错误，AOF 重写将会在稍后一点的时间重新调用。</li>\n</ul>\n</div>\n\n<p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/13.jpg\" alt=\"bgrewriteaof命令\" loading=\"lazy\"></p>\n<ul>\n<li>AOF 重写配置</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">配置名</th>\n<th align=\"center\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">auto-aof-rewrite-min-size</td>\n<td align=\"center\">触发AOF文件执行重写的最小尺寸</td>\n</tr>\n<tr>\n<td align=\"center\">auto-aof-rewrite-percentage</td>\n<td align=\"center\">触发AOF文件执行重写的增长率</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">统计名</td>\n<td align=\"center\">含义</td>\n</tr>\n<tr>\n<td align=\"center\">aof_current_size</td>\n<td align=\"center\">AOF文件当前尺寸（字节）</td>\n</tr>\n<tr>\n<td align=\"center\">aof_base_size</td>\n<td align=\"center\">AOF文件上次启动和重写时的尺寸（字节）</td>\n</tr>\n</tbody></table>\n<div class=\"note success\"><p>AOF 重写自动触发机制，需要同时满足下面两个条件：</p>\n<ul>\n<li>aof_current_size &gt; auto-aof-rewrite-min-size</li>\n<li>(aof_current_size - aof_base_size) * 100 &#x2F; aof_base_size &gt; auto-aof-rewrite-percentage</li>\n</ul>\n</div>\n\n<p>假设 Redis 的配置项为：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br></pre></td></tr></table></figure>\n\n<p>当 AOF 文件的体积大于 64 Mb，并且 AOF 文件的体积比上一次重写之久的体积大了至少一倍（100%）时，Redis 将执行 <code>bgrewriteaof</code> 命令进行重写。</p>\n<h4 id=\"AOF-重写的流程\"><a href=\"#AOF-重写的流程\" class=\"headerlink\" title=\"AOF 重写的流程\"></a>AOF 重写的流程</h4><p><img src=\"/images/Redis%E6%8C%81%E4%B9%85%E5%8C%96-RDB%E5%92%8CAOF/14.jpg\" alt=\"AOF重写的流程*\" loading=\"lazy\"></p>\n<h3 id=\"AOF-相关配置\"><a href=\"#AOF-相关配置\" class=\"headerlink\" title=\"AOF 相关配置\"></a>AOF 相关配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 开启AOF持久化方式</span></span><br><span class=\"line\">appendonly <span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># AOF持久化文件名</span></span><br><span class=\"line\">appendfilename appendonly-&lt;port&gt;.aof</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 每秒把缓冲区的数据同步到磁盘</span></span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据持久化文件存储目录</span></span><br><span class=\"line\"><span class=\"built_in\">dir</span> /var/lib/redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 是否在执行重写时不同步数据到AOF文件</span></span><br><span class=\"line\"><span class=\"comment\"># 这里的 yes，就是执行重写时不同步数据到AOF文件</span></span><br><span class=\"line\">no-appendfsync-on-rewrite <span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 触发AOF文件执行重写的最小尺寸</span></span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 触发AOF文件执行重写的增长率</span></span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"AOF-的优点\"><a href=\"#AOF-的优点\" class=\"headerlink\" title=\"AOF 的优点\"></a>AOF 的优点</h3><ol>\n<li>使用AOF 会让你的 Redis 更加耐久，你可以使用不同的 fsync 策略：无 fsync，每秒 fsync，每次写的时候 fsync。使用默认的每秒 fsync 策略，Redis 的性能依然很好(fsync 是由后台线程进行处理的，主线程会尽力处理客户端请求)，一旦出现故障，你最多丢失 1 秒的数据。</li>\n<li>AOF 文件是一个只进行追加的日志文件，所以不需要写入 seek，即使由于某些原因(磁盘空间已满，写的过程中宕机等等)未执行完整的写入命令，你也也可使用 redis-check-aof 工具修复这些问题。</li>\n<li>Redis 可以在 AOF 文件体积变得过大时，自动地在后台对 AOF 进行重写：重写后的新 AOF 文件包含了恢复当前数据集所需的最小命令集合。 整个重写操作是绝对安全的，因为 Redis 在创建新 AOF 文件的过程中，会继续将命令追加到现有的 AOF 文件里面，即使重写过程中发生停机，现有的 AOF 文件也不会丢失。 而一旦新 AOF 文件创建完毕，Redis 就会从旧 AOF 文件切换到新 AOF 文件，并开始对新 AOF 文件进行追加操作。</li>\n<li>AOF 文件有序地保存了对数据库执行的所有写入操作， 这些写入操作以 Redis 协议的格式保存， 因此 AOF 文件的内容非常容易被人读懂， 对文件进行分析（parse）也很轻松。 导出（export） AOF 文件也非常简单： 举个例子， 如果你不小心执行了 <code>FLUSHALL</code> 命令， 但只要 AOF 文件未被重写， 那么只要停止服务器， 移除 AOF 文件末尾的 <code>FLUSHALL</code> 命令， 并重启 Redis ， 就可以将数据集恢复到 <code>FLUSHALL</code> 执行之前的状态。</li>\n</ol>\n<h3 id=\"AOF-的缺点\"><a href=\"#AOF-的缺点\" class=\"headerlink\" title=\"AOF 的缺点\"></a>AOF 的缺点</h3><ol>\n<li>对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积。</li>\n<li>根据所使用的 fsync 策略，AOF 的速度可能会慢于 RDB 。 在一般情况下， 每秒 fsync 的性能依然非常高， 而关闭 fsync 可以让 AOF 的速度和 RDB 一样快， 即使在高负荷之下也是如此。 不过在处理巨大的写入载入时，RDB 可以提供更有保证的最大延迟时间（latency）。</li>\n</ol>\n<h2 id=\"RDB-和-AOF-的抉择\"><a href=\"#RDB-和-AOF-的抉择\" class=\"headerlink\" title=\"RDB 和 AOF 的抉择\"></a>RDB 和 AOF 的抉择</h2><h3 id=\"RDB-和-AOF-对比\"><a href=\"#RDB-和-AOF-对比\" class=\"headerlink\" title=\"RDB 和 AOF 对比\"></a>RDB 和 AOF 对比</h3><table>\n<thead>\n<tr>\n<th align=\"center\">-</th>\n<th align=\"center\">RDB</th>\n<th align=\"center\">AOF</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">启动优先级</td>\n<td align=\"center\">低</td>\n<td align=\"center\">高</td>\n</tr>\n<tr>\n<td align=\"center\">体积</td>\n<td align=\"center\">小</td>\n<td align=\"center\">大</td>\n</tr>\n<tr>\n<td align=\"center\">恢复速度</td>\n<td align=\"center\">快</td>\n<td align=\"center\">慢</td>\n</tr>\n<tr>\n<td align=\"center\">数据安全性</td>\n<td align=\"center\">丢数据</td>\n<td align=\"center\">根据策略决定</td>\n</tr>\n</tbody></table>\n<h3 id=\"如何选择使用哪种持久化方式？\"><a href=\"#如何选择使用哪种持久化方式？\" class=\"headerlink\" title=\"如何选择使用哪种持久化方式？\"></a>如何选择使用哪种持久化方式？</h3><p>一般来说， 如果想达到足以媲美 PostgreSQL 的数据安全性， 你应该同时使用两种持久化功能。<br>如果你非常关心你的数据， 但仍然可以承受数分钟以内的数据丢失， 那么你可以只使用 RDB 持久化。<br>有很多用户都只使用 AOF 持久化， 但并不推荐这种方式：因为定时生成 RDB 快照（snapshot）非常便于进行数据库备份， 并且 RDB 恢复数据集的速度也要比 AOF 恢复的速度要快。</p>\n","categories":["Redis"],"tags":["Redis持久化","RDB","AOF"]},{"title":"Spring Security Oauth2 从零到一完整实践（一）","url":"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/","content":"<p>\n\n<span id=\"more\"></span>\n\n<div class=\"note info no-icon\"><p>github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nkd3h3L3NwcmluZy1zZWN1cml0eS1vYXV0aDItZGVtbw==\">spring-security-oauth2-demo<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>博客地址：<a href=\"/\">isee.wang</a></p>\n</div>\n\n<h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li>较为详细的学习 oauth2 的四种模式其中的两种授权模式</li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/\">spring boot oauth2 自动配置实现</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/\">spring security oauth2 授权服务器配置</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%9B%9B%EF%BC%89%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8/\">spring security oauth2 资源服务器配置</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%94%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F%EF%BC%88%E6%89%8B%E6%9C%BA%E3%80%81%E9%82%AE%E7%AE%B1%E7%AD%89%EF%BC%89/\">spring security oauth2 自定义授权模式（手机、邮箱等）</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%85%AD%EF%BC%89%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/\">spring security oauth2 踩坑记录</a></li>\n</ol>\n<h2 id=\"预备知识\"><a href=\"#预备知识\" class=\"headerlink\" title=\"预备知识\"></a>预备知识</h2><p>具备以下基础知识能够方便你更好的阅读本篇文章</p>\n<ul>\n<li>spring 基础</li>\n<li>spring boot web 的使用与配置</li>\n<li>spring security 的使用与配置</li>\n<li>postman 的使用</li>\n<li>idea、maven、lombok 的使用与配置</li>\n</ul>\n<h2 id=\"Oauth2\"><a href=\"#Oauth2\" class=\"headerlink\" title=\"Oauth2\"></a>Oauth2</h2><p>学习一项新的东西之前，我们要先了解一下他为我们解决了哪些事，能够带来什么样的便利，而在 IT 行业，了解一个东西最简单的方式就是去他的官网了解，所以我们先去官网了解一下这个协议：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9vYXV0aC5uZXQv\">Oauth2<i class=\"fa fa-external-link-alt\"></i></span></p>\n<div class=\"note info\"><p>An <code>open protocol</code> to allow <code>secure authorization</code> in a <code>simple</code> and <code>standard</code> method from web, mobile and desktop applications.</p>\n</div>\n\n<p>一个允许从Web、移动和桌面应用程序简单和标准方法进行安全授权的开放协议。</p>\n<div class=\"note info\"><p>The OAuth 2.0 authorization framework enables third-party applications to obtain <code>limited</code> access to a web service.</p>\n</div>\n\n<p>OAuth 2.0 授权框架使第三方应用程序能够获得对 Web 服务的有限访问权限。</p>\n<p>从官网的解释就可以知道它可以完成如下两件事：</p>\n<ol>\n<li>对你的应用站点进行安全授权</li>\n<li>使第三方应用程序能够获得对 Web 服务的有限访问权限</li>\n</ol>\n<p>我们这篇教程就是通过 spring security oauth2 来完成这么两件事。我们来详细了解一下这个协议，首先了解什么要使用 oauth2。我们以 web 为例来进行了解。</p>\n<h2 id=\"传统应用\"><a href=\"#传统应用\" class=\"headerlink\" title=\"传统应用\"></a>传统应用</h2><p>在我们传统的 web 应用中，我们的前端页面和后端的逻辑都是一起部署的，大概流程如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/1.png\" loading=\"lazy\"></p>\n<p>当我们发送一个请求的时候，直接先发给后端处理，后端处理完成后将数据发送给前端，然后前端渲染，再交给用户，所以有了模板引擎这个东西，例如 jsp、thymeleaf、freemarker 这些，都是这样的流程。而这些个东西最为重要的就是 session，你可以通过存储在 session 里面的东西对他进行授权&#x2F;认证等操作，大概如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/2.png\" loading=\"lazy\"></p>\n<h2 id=\"现在的应用\"><a href=\"#现在的应用\" class=\"headerlink\" title=\"现在的应用\"></a>现在的应用</h2><p>那么现在我们的应用是什么样的呢？现在的前端已经不再是只有 html、css、javascript 了，也不再是 bootstrap 的天下，也没有 jquery 一出，万人空巷了。前端项目组建工程化，已经能够完整的独立成为一个工程化的项目了。所以我们现在前后端是完全分离的，<strong>前后端各司其职，前端完成前端的事，只做页面，后端完成后端的事，只做逻辑和数据库操作，完全两个独立的引用，通过接口进行交互，</strong>那么我们的大概流程如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/3.png\" loading=\"lazy\"></p>\n<p>用户通过浏览器请求前端应用的页面，然后页面里面加载请求到数据，再渲染页面。那么现在的授权没有 session 了，前后端是完全独立的两个项目了，我们要怎么进行认证授权呢？对于一个受保护的应用来说，他的请求流程如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/4.png\" loading=\"lazy\"></p>\n<p>在这个流程中，我们后端应用其实变成了两个，一个是<code>授权服务器</code>，一个是<code>资源服务器</code>，<strong>当然你完全可以简单把他们两个同时写在一个之中。</strong>单独提出来的好处是什么呢？最主要的一点就是上面提到的 <strong>使第三方应用程序能够获得对 Web 服务的有限访问权限，简单的说就是能够更加方便的另外一个应用接入。当你写好一个授权服务器以后，其他应用就可以共用这个授权服务器，</strong>他们就作为资源服务器亦或是客户端即可。</p>\n<h2 id=\"角色\"><a href=\"#角色\" class=\"headerlink\" title=\"角色\"></a>角色</h2><p>在这个协议中，我们需要明确一个 <code>角色</code> 的概念，在前面的和传统应用的对比中，我们提到了资源服务器和授权服务器，这就是其中两个角色，在 Oauth2 中，总共有四种角色：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">名称</th>\n<th align=\"center\">英文名</th>\n<th align=\"center\">描述</th>\n<th align=\"center\">web例子</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">资源所有者</td>\n<td align=\"center\">resource owner</td>\n<td align=\"center\">能够授予对受保护资源的访问权的实体。当资源所有者是一个人时，它就是用户。</td>\n<td align=\"center\">用户</td>\n</tr>\n<tr>\n<td align=\"center\">资源服务器</td>\n<td align=\"center\">resource server</td>\n<td align=\"center\">承载受保护资源的服务器，能够使用访问令牌接受和响应受保护资源请求。</td>\n<td align=\"center\">后端资源数据</td>\n</tr>\n<tr>\n<td align=\"center\">客户端</td>\n<td align=\"center\">client</td>\n<td align=\"center\">代表资源所有者及其授权发出受保护资源请求的应用程序。“客户端” 并不意味着任何特定的实现特征(例如，应用程序是否在服务器、桌面或其他设备上执行)。</td>\n<td align=\"center\">前端应用</td>\n</tr>\n<tr>\n<td align=\"center\">授权服务器</td>\n<td align=\"center\">authorization server</td>\n<td align=\"center\">在成功认证资源所有者并获得授权后，服务器向客户端发出访问令牌。</td>\n<td align=\"center\">后端授权</td>\n</tr>\n</tbody></table>\n<p>而授权服务器可以是与资源服务器<strong>相同的服务器</strong>或<strong>单独的服务器</strong>。 单个授权服务器可以发出由<strong>多个资源服务器接受的访问令牌</strong>。</p>\n<p>流程图大概如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">+--------+                               +-----------------+</span><br><span class=\"line\">|        |--（A）------- 授权请求 --------&gt;|                 |</span><br><span class=\"line\">|        |                               | 资源所有者（用户） |</span><br><span class=\"line\">|        |&lt;-（B）------- 授权许可 ---------|                 |</span><br><span class=\"line\">|        |                               +-----------------+</span><br><span class=\"line\">|        |</span><br><span class=\"line\">|        |                               +-----------------+</span><br><span class=\"line\">|        |--（C）------- 授权许可 --------&gt;|                 |</span><br><span class=\"line\">| 客户端  |                               |  授权服务器（1    |</span><br><span class=\"line\">|        |&lt;-（D）----- Access Token ----）|                 |</span><br><span class=\"line\">|        |                               +-----------------+</span><br><span class=\"line\">|        |</span><br><span class=\"line\">|        |                               +-----------------+</span><br><span class=\"line\">|        |（-（E）---- Access Token -----&gt;|                 |</span><br><span class=\"line\">|        |                               |   资源服务器（2   |</span><br><span class=\"line\">|        |&lt;-（F）---- 获取受保护的资源 -----|                 |</span><br><span class=\"line\">+--------+                               +-----------------+</span><br></pre></td></tr></table></figure>\n\n<p>图中所示的 抽象 OAuth 2.0 流程描述了四个角色之间的交互，包括以下步骤：</p>\n<p>（A）客户机请求资源所有者（用户）的授权。授权请求可以直接发送给资源所有者(如图所示)，最好通过作为中介的授权服务器间接发送。<strong>简单地说，用户点击登录，会转到登录页面显示给用户。</strong></p>\n<p>（B）客户端接收授权许可，这是表示资源所有者授权的凭据，使用 Oauth2 规范中定义的四种授权类型之一或使用扩展授权类型表示。授权授予类型取决于客户机用于请求授权的方法和授权服务器支持的类型。<strong>简单地说，选择 oauth2 中四种授权模式进行授权。</strong></p>\n<p>（C）客户端通过向授权服务器进行认证并呈现授权授权来请求访问令牌。<strong>简单地说，客户端会向授权服务器使用前面选择的四种方式之一请求认证。</strong></p>\n<p>（D）授权服务器对客户端进行身份验证并验证授权授予，如果有效，则发出访问令牌。<strong>简单地说，授权成功发放令牌。</strong></p>\n<p>（E）客户端从资源服务器请求受保护的资源，并通过呈现访问令牌进行身份验证。<strong>简单地说，携带 令牌 请求资源服务器。</strong></p>\n<p>（F）资源服务器验证访问令牌，如果有效，则为请求服务。<strong>简单地说，如果令牌有效，就允许访问资源。</strong></p>\n<p>（1）授权服务器可以只有一台，一台授权可以发放多个资源服务器。</p>\n<p>（2）资源服务器需要关联一台授权服务器作为资源的保护和认证。</p>\n<p>最为重要的部分为 B 中的 <code>授权许可</code>，它是代表资源所有者的授权（访问其受保护的资源）的<code>凭据</code>，客户端使用该授权来获得访问令牌。该规范定义了四种授权类型——<strong>授权代码、隐式、资源所有者密码凭证和客户端凭证</strong>——以及用于定义其他类型的可扩展性机制（自定义授权）。</p>\n<h2 id=\"四种授权模式\"><a href=\"#四种授权模式\" class=\"headerlink\" title=\"四种授权模式\"></a>四种授权模式</h2><p>客户端必须得到用户的授权（authorization grant），才能获得令牌（access token）。OAuth 2.0定义了四种授权方式如下：</p>\n<ul>\n<li>授权码模式（authorization code）</li>\n<li>密码模式（resource owner password credentials）</li>\n<li>简化模式（implicit）</li>\n<li>客户端模式（client credentials）</li>\n<li>扩展模式（extension）</li>\n</ul>\n<p>最为常用的为第一、二种，我们这篇文章也只会完成第一二种，四种具体请参考 <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTQvMDUvb2F1dGhfMl8wLmh0bWw=\">阮一峰 理解OAuth 2.0<i class=\"fa fa-external-link-alt\"></i></span> ，请注意详细看文章的 <code>名词定义</code> 模块。阮一峰老师的文章已经写的很清楚了，但是我依旧还是需要指明一下我们即将开始的第一二种的 api 设计。</p>\n<div class=\"note warning\"><p>注意：以下 api 设计为 spring security 提供实现，并不是 oauth2 的标准 api 实现</p>\n</div>\n\n<p>不过在那之前，我们先来了解一下 <strong>客户端的加密</strong></p>\n<h2 id=\"客户端加密\"><a href=\"#客户端加密\" class=\"headerlink\" title=\"客户端加密\"></a>客户端加密</h2><p>在 spring security oauth 中，推荐加密我们的客户端信息，客户端和授权服务器建立适合授权服务器安全要求的客户端认证方法。授权服务器可以接受满足其安全要求的任何形式的客户端身份验证。一般来说我们使用的是 <code>密码验证</code> 的方式加密我们的客户端信息。</p>\n<p>推荐的方式是使用 HTTP Basic ，我们需要设置以下参数，当设置成功以后将客户端凭证加密存放在请求头中去请求授权信息，参数如下：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必填</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">client_id</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">客户端 id</td>\n</tr>\n<tr>\n<td align=\"center\">client_secret</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">客户端密码，如果客户机secret是空字符串，则客户机可以省略该参数</td>\n</tr>\n</tbody></table>\n<p>当我们请求的时候，需要设置相应的客户端认证信息，并存放在请求头中，设置方法如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Authorization: Basic client_id：client_secret base64编码</span><br><span class=\"line\">eg:</span><br><span class=\"line\">client_id:web</span><br><span class=\"line\">client_secret:secret</span><br><span class=\"line\">加密“web:secret” 得到 “QmFzaWMgd2ViOnNlY3JldA==”</span><br><span class=\"line\">授权请求头中需要携带如下键值对：</span><br><span class=\"line\">Authorization: Basic QmFzaWMgd2ViOnNlY3JldA==</span><br></pre></td></tr></table></figure>\n\n<p>这是保证客户端安全十分重要的一环，强烈推荐对客户端进行加密！</p>\n<h3 id=\"授权码模式\"><a href=\"#授权码模式\" class=\"headerlink\" title=\"授权码模式\"></a>授权码模式</h3><p>他是一种流程最为严密，安全性最高的授权模式，主要为以下几个步骤：</p>\n<div class=\"note warning\"><p>注意：以下所有请求都必须在请求头中携带上一点中的客户端加密信息！</p>\n</div>\n\n<ol>\n<li>用户进入应用，携带一个 <code>重定向应用地址</code> 到 <strong>授权服务器</strong> 进行登录，在登录成功并且用户同意授权以后，授权服务携带一个生成的 <strong>授权码</strong> 重定向到指定的 <code>重定向应用地址</code> 。</li>\n<li>应用携带接收到的 <strong>授权码</strong> 再次去请求 <strong>授权服务器</strong>，在验证成功后，验证服务器下发 token。</li>\n</ol>\n<p>所以需要两个请求，在 spring security oauth2 中，api 如下，我们将这些 api 称为 <code>端点</code>：</p>\n<h3 id=\"授权端点\"><a href=\"#授权端点\" class=\"headerlink\" title=\"授权端点\"></a>授权端点</h3><ul>\n<li>&#x2F;oauth&#x2F;authorize：授权端点，通过此端点跳转到 <strong>授权服务器</strong> 进行认证，完成第一个请求。携带如下参数：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必填</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">response_type</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">必须为 code</td>\n</tr>\n<tr>\n<td align=\"center\">client_id</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">客户端的 id</td>\n</tr>\n<tr>\n<td align=\"center\">redirect_uri</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">获取授权码后重定向地址</td>\n</tr>\n<tr>\n<td align=\"center\">scope</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">申请的权限范围</td>\n</tr>\n<tr>\n<td align=\"center\">state</td>\n<td align=\"center\">RECOMMENDED</td>\n<td align=\"center\">客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值，推荐。</td>\n</tr>\n</tbody></table>\n<p>授权成功的情况，会携带以下两个参数重定向到到 redirect_uri 中：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必有</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">code</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">授权服务器生成的授权代码。授权代码必须在发布后不久过期，以降低泄漏的风险。最大授权代码生命周期为10分钟</td>\n</tr>\n<tr>\n<td align=\"center\">state</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">如果上一步中提供 state 参数，会原封不动地返回这个值。</td>\n</tr>\n</tbody></table>\n<div class=\"note warning\"><p>注意：官网中给出的解释 code 有 RECOMMENDED 推荐的情况，但是我没找到如何使用，所以没写。</p>\n</div>\n\n<p>授权失败的情况分为两种</p>\n<ol>\n<li>如果请求由于重定向URI丢失、无效或不匹配而失败，或者如果客户端标识符丢失或无效，授权服务器应通知资源所有者错误，并且<strong>不得自动将用户代理重定向到无效的重定向URI</strong>。</li>\n<li>如果资源所有者拒绝访问请求，或者如果请求由于除了丢失或无效重定向URI以外的原因而失败，则授权服务器通过使用 application&#x2F;x-www-form-urlencoded 格式<strong>向重定向 URI 的查询组件添加以下参数来通知客户端</strong>，参数如下：(对于 spring ，目前没有遇到 error_uri 属性)</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必有</th>\n<th align=\"center\">值</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">error</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">invalid_request</td>\n<td align=\"center\">请求缺少必需的参数，包括无效的参数值，不止一次地包含参数，或者存在其他形式的异常。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">unauthorized_client</td>\n<td align=\"center\">未授权客户端使用此方法请求授权代码。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">access_denied</td>\n<td align=\"center\">资源所有者或授权服务器拒绝了该请求。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">unsupported_response_type</td>\n<td align=\"center\">授权服务器不支持使用此方法获取授权代码。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">invalid_scope</td>\n<td align=\"center\">请求的作用域无效、未知或格式不正确。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">server_error</td>\n<td align=\"center\">授权服务器遇到意外情况，无法满足请求。(此错误代码是必需的，因为500内部服务器错误HTTP状态代码不能通过HTTP重定向返回给客户端。)</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">temporarily_unavailable</td>\n<td align=\"center\">由于服务器暂时过载或维护，授权服务器当前无法处理该请求。(此错误代码是必需的，因为503服务不可用的HTTP状态代码不能通过HTTP重定向返回给客户端。)</td>\n</tr>\n<tr>\n<td align=\"center\">error_description</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\"></td>\n<td align=\"center\">提供附加信息的人类可读ASCII [USASCII]文本，用于帮助客户端开发人员理解所发生的错误。</td>\n</tr>\n<tr>\n<td align=\"center\">error_uri</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\"></td>\n<td align=\"center\">一种带有错误信息的可读网页的URI标识，用于向客户端开发人员提供有关错误的附加信息。</td>\n</tr>\n</tbody></table>\n<h3 id=\"令牌端点\"><a href=\"#令牌端点\" class=\"headerlink\" title=\"令牌端点\"></a>令牌端点</h3><ul>\n<li>&#x2F;oauth&#x2F;token：令牌端点，通过上一步获取到的 <strong>授权码</strong> 验证与生成令牌，完成第二个请求，携带如下参数：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必填</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">grant_type</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">使用的授权模式，值固定为&quot;authorization_code&quot;</td>\n</tr>\n<tr>\n<td align=\"center\">code</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">上一步获得的授权码</td>\n</tr>\n<tr>\n<td align=\"center\">redirect_uri</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">重定向URI，必须与上一步中的该参数值保持一致</td>\n</tr>\n<tr>\n<td align=\"center\">client_id</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">客户端的 id</td>\n</tr>\n<tr>\n<td align=\"center\">scope</td>\n<td align=\"center\">RECOMMENDED</td>\n<td align=\"center\">授权范围，必须与第一步相同</td>\n</tr>\n</tbody></table>\n<p>如果访问令牌请求有效且经过授权，授权服务器将发出访问令牌和可选的刷新令牌，可以得到如下响应参数：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必有</th>\n<th align=\"center\">描述</th>\n<th align=\"center\">是否有实现</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">access_token</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">授权服务器颁发的访问令牌</td>\n<td align=\"center\">是</td>\n</tr>\n<tr>\n<td align=\"center\">token_type</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">令牌类型，该值大小写不敏感，可以是bearer类型或mac类型</td>\n<td align=\"center\">是</td>\n</tr>\n<tr>\n<td align=\"center\">expires_in</td>\n<td align=\"center\">RECOMMENDED</td>\n<td align=\"center\">过期时间，单位为秒</td>\n<td align=\"center\">是</td>\n</tr>\n<tr>\n<td align=\"center\">refresh_token</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">表示更新令牌，用来获取下一次的访问令牌</td>\n<td align=\"center\">是，需要设置</td>\n</tr>\n<tr>\n<td align=\"center\">scope</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">权限范围，如果有，则与客户端申请的范围一致</td>\n<td align=\"center\">是</td>\n</tr>\n</tbody></table>\n<p>如果请求客户端身份验证失败或无效，授权服务器将返回错误响应，授权服务器使用HTTP 400（错误请求）状态代码进行响应（除非另有说明），并在响应中包含以下参数：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必有</th>\n<th align=\"center\">值</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">error</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">invalid_request</td>\n<td align=\"center\">请求缺少必需的参数，包含不受支持的参数值(授权类型除外)，重复参数，包含多个凭据，使用多个机制来验证客户端，或者格式不正确。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">invalid_client</td>\n<td align=\"center\">客户端身份验证失败(例如，未知客户端、不包含客户端身份验证或不支持的身份验证方法)。授权服务器可以返回一个超文本传输协议401(未授权)状态码，以指示支持哪些超文本传输协议认证方案。如果客户端试图通过“授权”请求头字段进行身份验证，授权服务器必须用一个HTTP 401(未授权)状态代码进行响应，并包括与客户端使用的身份验证方案相匹配的“WWW-Authenticate”响应头字段。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">invalid_grant</td>\n<td align=\"center\">所提供的授权授予(例如，授权代码、资源所有者凭证)或刷新令牌无效、过期、已撤销、不匹配授权请求中使用的重定向URI，或已向其他客户机发出。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">unauthorized_client</td>\n<td align=\"center\">经过身份验证的客户端无权使用此授权授权类型。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">unsupported_grant_type</td>\n<td align=\"center\">授权服务器不支持授权授权类型。</td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\">invalid_scope</td>\n<td align=\"center\">请求的范围无效、未知、格式错误或超出了资源所有者授予的范围。</td>\n</tr>\n<tr>\n<td align=\"center\">error_description</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">-</td>\n<td align=\"center\">提供附加信息的人类可读ASCII [USASCII]文本，用于帮助客户端开发人员理解所发生的错误。</td>\n</tr>\n<tr>\n<td align=\"center\">error_uri</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">-</td>\n<td align=\"center\">一种带有错误信息的可读网页的URI标识，用于向客户端开发人员提供有关错误的附加信息。</td>\n</tr>\n</tbody></table>\n<h2 id=\"密码模式\"><a href=\"#密码模式\" class=\"headerlink\" title=\"密码模式\"></a>密码模式</h2><p>这种模式可以理解成我们普通应用的用户名密码登录，在第三方接入的时候不建议使用这种模式，但是如果是自己的应用，那么这种模式是最为简单方便快捷的了。步骤只有一个：</p>\n<div class=\"note warning\"><p>注意：以下所有请求都必须在请求头中携带上面所说的客户端加密信息！</p>\n</div>\n\n<ul>\n<li>用户携带用户名密码请求授权服务器，验证通过后下发令牌</li>\n</ul>\n<p>他只需要一个请求，所以她只有一个令牌端点：</p>\n<h3 id=\"令牌端点-1\"><a href=\"#令牌端点-1\" class=\"headerlink\" title=\"令牌端点\"></a>令牌端点</h3><ul>\n<li>&#x2F;oauth&#x2F;token：令牌端点，携带如下参数请求即可：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">请求参数</th>\n<th align=\"center\">是否必填</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">grant_type</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">使用的密码模式，值固定为&quot;password&quot;</td>\n</tr>\n<tr>\n<td align=\"center\">username</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">用户名</td>\n</tr>\n<tr>\n<td align=\"center\">password</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">密码</td>\n</tr>\n<tr>\n<td align=\"center\">scope</td>\n<td align=\"center\">OPTIONAL</td>\n<td align=\"center\">请求权限范围</td>\n</tr>\n</tbody></table>\n<p>请求成功和失败的响应同授权码模式。</p>\n<h2 id=\"安全考虑\"><a href=\"#安全考虑\" class=\"headerlink\" title=\"安全考虑\"></a>安全考虑</h2><div class=\"note warning\"><p>注意：以下所有请求都必须在请求头中携带上面所说的客户端加密信息！</p>\n</div>\n\n<p>作为一个灵活且可扩展的框架，OAuth 的安全考虑取决于许多因素。spring security oauth 为我们提供了一些默认的端点如下：</p>\n<ul>\n<li>&#x2F;oauth&#x2F;authorize：授权端点</li>\n<li>&#x2F;oauth&#x2F;token：令牌端点</li>\n<li>&#x2F;oauth&#x2F;token：令牌端点也同时拥有刷新用户的功能，请求参数如下：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必填</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">grant_type</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">固定值为“refresh_token”</td>\n</tr>\n<tr>\n<td align=\"center\">refresh_token</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">请求到 token 时传过来的 refresh_token</td>\n</tr>\n</tbody></table>\n<ul>\n<li>&#x2F;oauth&#x2F;confirm_access：用户确认授权提交端点</li>\n<li>&#x2F;oauth&#x2F;error：授权服务错误信息端点</li>\n<li>&#x2F;oauth&#x2F;check_token：用于资源服务访问的令牌解析端点，请求参数如下：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名称</th>\n<th align=\"center\">是否必填</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">token</td>\n<td align=\"center\">REQUIRED</td>\n<td align=\"center\">得到的有效的令牌</td>\n</tr>\n</tbody></table>\n<ul>\n<li>&#x2F;oauth&#x2F;token_key：提供公有密匙的端点，如果你使用JWT令牌的话</li>\n</ul>\n<h2 id=\"技术选型\"><a href=\"#技术选型\" class=\"headerlink\" title=\"技术选型\"></a>技术选型</h2><ul>\n<li>核心框架：spring boot</li>\n<li>构建工具：maven</li>\n<li>应用框架：spring boot data jpa</li>\n<li>数据库：mysql</li>\n<li>web： spring boot web</li>\n<li>测试框架：junit5、spring boot test</li>\n<li>开发工具：idea</li>\n<li>安全框架：spring security oauth2</li>\n</ul>\n<h2 id=\"在这之前\"><a href=\"#在这之前\" class=\"headerlink\" title=\"在这之前\"></a>在这之前</h2><p>我们需要对项目的基本初始化，也就是使用 idea 创建我们 spring boot 项目</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/5.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/6.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/7.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/8.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/9.png\" loading=\"lazy\"></p>\n<p>可选，配置阿里云国内源仓库</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--远程依赖库--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--阿里云主仓库，代理了maven central和jcenter仓库--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>aliyun<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--阿里云代理Spring 官方仓库--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/spring<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--远程插件库--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">pluginRepositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--阿里云代理Spring 插件仓库--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">pluginRepository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">pluginRepository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">pluginRepositories</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>注意：请自行配置 lombok 支持！！！</p>\n</div>\n\n<p>这样，我们的父项目基本就构建完成了</p>\n<p>我们下一篇回来完成第二件事，spring security oauth2 自动配置实现。</p>\n","categories":["java"],"tags":["Spring","Security","Oauth2"]},{"title":"Spring Security Oauth2 从零到一完整实践（三）授权服务器","url":"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/","content":"<p>\n\n<span id=\"more\"></span>\n\n<p>前面说了自动配置，现在就是来说自定义配置啦，这个是十分重要的一节，可以说 oauth2 的核心就是授权服务器了，所有的角色都是围绕着授权服务器而运作的，这里基本包含了资源服务器的所有配置。</p>\n<div class=\"note warning\"><p>注意：spring security oauth2 模块已经过期，见 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1wcm9qZWN0cy9zcHJpbmctc2VjdXJpdHktb2F1dGgjLWRlcHJlY2F0aW9uLW5vdGljZS0=\">github<i class=\"fa fa-external-link-alt\"></i></span>。</p>\n</div>\n\n<div class=\"note info no-icon\"><p>github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nkd3h3L3NwcmluZy1zZWN1cml0eS1vYXV0aDItZGVtbw==\">spring-security-oauth2-demo<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>博客地址：<a href=\"/\">isee.wang</a></p>\n</div>\n\n<h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/\">较为详细的学习 oauth2 的四种模式其中的两种授权模式</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/\">spring boot oauth2 自动配置实现</a></li>\n<li>spring security oauth2 授权服务器配置</li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%9B%9B%EF%BC%89%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8/\">spring security oauth2 资源服务器配置</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%94%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F%EF%BC%88%E6%89%8B%E6%9C%BA%E3%80%81%E9%82%AE%E7%AE%B1%E7%AD%89%EF%BC%89/\">spring security oauth2 自定义授权模式（手机、邮箱等）</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%85%AD%EF%BC%89%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/\">spring security oauth2 踩坑记录</a></li>\n</ol>\n<h2 id=\"spring-security-oauth2-授权服务器\"><a href=\"#spring-security-oauth2-授权服务器\" class=\"headerlink\" title=\"spring security oauth2 授权服务器\"></a>spring security oauth2 授权服务器</h2><p>我们首先再次回顾下授权服务器的详细作用：</p>\n<ol>\n<li>客户端的验证与授权</li>\n<li>令牌的生成与发放</li>\n<li>令牌的校验与更新</li>\n</ol>\n<p>所以我们以下的操作都会围绕 <code>客户端</code> 与 <code>令牌</code> 来完成。</p>\n<div class=\"note warning\"><p>注意：以下授权服务器全默认在 8000 端口运行！！！</p>\n</div>\n\n<p>现在我们需要进行的就是授权服务器配置实现，我们完成项目的初始化，和之前创建完全一样，创建完成后，<strong>我们把 8080 端口修改为 8000 端口</strong>，然后项目结构如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/1.png\" loading=\"lazy\"></p>\n<p>同时添加一下如下依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-security<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.security.oauth.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-security-oauth2-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>既然是授权服务器，那么我们也就不用把它注册为资源服务器了，因为我们不对外暴露任何资源，仅仅只是为了令牌的下发，不需要做资源保护。</p>\n<p>在我们配置授权服务器之前，需要先进行我们前面遇到过的配置 spring security web 安全，复制一下上一次的配置，就不截图了，如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> isee.wang.oauth.authorization.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.userdetails.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.provisioning.InMemoryUserDetailsManager;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> &lt;a href=&quot;http://isee.wang&quot;&gt;isee.wang&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/4/20 10:25</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebSecurity</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SecurityConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 密码加密方式，spring 5 后必须对密码进行加密</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> BCryptPasswordEncoder</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> PasswordEncoder <span class=\"title function_\">passwordEncoder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BCryptPasswordEncoder</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建两个内存用户</span></span><br><span class=\"line\"><span class=\"comment\">     * 用户名 user 密码 123456 角色 ROLE_USER</span></span><br><span class=\"line\"><span class=\"comment\">     * 用户名 admin 密码 admin 角色 ROLE_ADMIN</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> InMemoryUserDetailsManager</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> UserDetailsService <span class=\"title function_\">userDetailsService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">InMemoryUserDetailsManager</span> <span class=\"variable\">manager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryUserDetailsManager</span>();</span><br><span class=\"line\">        manager.createUser(User.withUsername(<span class=\"string\">&quot;user&quot;</span>)</span><br><span class=\"line\">                .password(passwordEncoder().encode(<span class=\"string\">&quot;123456&quot;</span>))</span><br><span class=\"line\">                .authorities(<span class=\"string\">&quot;ROLE_USER&quot;</span>).build());</span><br><span class=\"line\">        manager.createUser(User.withUsername(<span class=\"string\">&quot;admin&quot;</span>)</span><br><span class=\"line\">                .password(passwordEncoder().encode(<span class=\"string\">&quot;admin&quot;</span>))</span><br><span class=\"line\">                .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>).build());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> manager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上一部分我们知道 spring-security-oauth2-autoconfigure 是自动配置的包，通过陪配置文件就可以完成一个授权服务器和资源服务器，现在我们需要来自定义他的授权服务器该怎么做呢？我们需要做的就是配置属于我们自己的 AuthorizationServerConfigurer了，当 spring 扫描到我们实现的配置以后，他就不回去自动配置 oauth2 了。为什么这么说呢？可以通过查看他的自动配置的源码你就会发现为什么，如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/2.png\" loading=\"lazy\"></p>\n<p>所以，如果我们配置了 AuthorizationServerConfigurer 的bean，它是不会执行自动配置的。我们现在需要自定义，所以就要来实现一下这个接口。当然，spring 提供了相应的适配器来供我们实现这个接口的，他就是 AuthorizationServerConfigurerAdapter，我们只要继承这个类即可。我们来看看里面的三个配置方法：</p>\n<table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>configure</td>\n<td>AuthorizationServerSecurityConfigurer</td>\n<td>配置授权服务器的安全信息，比如 ssl 配置、checktoken 是否允许访问，是否允许客户端的表单身份验证等。</td>\n</tr>\n<tr>\n<td>configure</td>\n<td>ClientDetailsServiceConfigurer</td>\n<td>配置客户端的 service，也就是应用怎么获取到客户端的信息，一般来说是从内存或者数据库中获取，已经提供了他们的默认实现，你也可以自定义。</td>\n</tr>\n<tr>\n<td>configure</td>\n<td>AuthorizationServerEndpointsConfigurer</td>\n<td>配置授权服务器各个端点的非安全功能，如令牌存储，令牌自定义，用户批准和授权类型。如果需要密码授权模式，需要提供 AuthenticationManager 的 bean。</td>\n</tr>\n</tbody></table>\n<p>所以为了方便，我们先在我们的 SecurityConfig 配置中创建一个 AuthenticationManager Bean，直接调用父类的方法获取即可，如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 认证管理</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 认证管理对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> Exception 认证异常信息</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"meta\">@Bean</span>  <span class=\"comment\">// 重点是这行，父类并没有将它注册为一个 Bean</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> AuthenticationManager <span class=\"title function_\">authenticationManagerBean</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.authenticationManagerBean();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来就是我们配置我们自己的授权服务器了，我们要完成如下的几种授权服务器配置</p>\n<ul>\n<li>基于内存的客户端信息与令牌存储</li>\n<li>基于 mysql 的客户端信息与令牌存储</li>\n<li>基于 redis 的令牌存储</li>\n<li>基于 jwt 的令牌生成与配置</li>\n<li>授权服务器小扩展</li>\n</ul>\n<div class=\"note info no-icon\"><p><strong>以上可以自由组合，例如 mysql 客户端配合 redis 令牌存储等。</strong></p>\n<p><strong>由于内容过多，防止由于依赖的问题导致不好运行查看效果，我每一种方式，都将它放在新的模块之中，模块的创建将会省略不写。分别为 内存、mysql、redis、jwt 四个模块</strong></p>\n</div>\n\n<p>不过在那之前，我们需要准备一个已经继承 AuthorizationServerConfigurerAdapter 的配置类，同时上面提到过，如果需要密码模式，我们要提供 AuthenticationManager 的 bean，所以我们在这里提前进行配置下，后面就不再进行赘述，如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@RequiredArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAuthorizationServer</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Oauth2AuthorizationServerConfig</span></span><br><span class=\"line\">    <span class=\"keyword\">extends</span> <span class=\"title class_\">AuthorizationServerConfigurerAdapter</span> &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"meta\">@NonNull</span> AuthenticationManager authenticationManager;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configure</span><span class=\"params\">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        endpoints.authenticationManager(<span class=\"built_in\">this</span>.authenticationManager);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在的项目结构如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/3.png\" loading=\"lazy\"></p>\n<div class=\"note warning\"><p>注意，为了方便，后面的测试均使用密码模式进行测试！</p>\n</div>\n\n<h2 id=\"基于内存的客户端信息与令牌存储\"><a href=\"#基于内存的客户端信息与令牌存储\" class=\"headerlink\" title=\"基于内存的客户端信息与令牌存储\"></a>基于内存的客户端信息与令牌存储</h2><div class=\"note default no-icon\"><p>代码参见项目模块 spring-security-oauth2-authorization</p>\n</div>\n\n<p>我们将在内存中存储和读取客户端信息以及下发的令牌信息：</p>\n<ul>\n<li><strong>优点</strong>：速度快，读取速度和写入速度都很快，配置也极其方便。</li>\n<li><strong>缺点</strong>：扩展性差，需要在代码中配置，重启应用后已经下发的令牌失效。</li>\n<li><strong>适用场景</strong>：小型不易改变的应用，授权服务器和资源服务器一体的应用。</li>\n</ul>\n<h3 id=\"客户端信息\"><a href=\"#客户端信息\" class=\"headerlink\" title=\"客户端信息\"></a>客户端信息</h3><p>对于客户端信息的配置，你完全可以通过 <code>OAuth2AuthorizationServerConfiguration</code> 这个类学习到，对于客户端的配置我们主要实现对参数为 <code>ClientDetailsServiceConfigurer</code> 的方法配置，我们分来两个方式来学习：</p>\n<ol>\n<li>直接代码写死配置客户端信息</li>\n<li>读取配置文件中的客户端信息</li>\n</ol>\n<h4 id=\"代码配置\"><a href=\"#代码配置\" class=\"headerlink\" title=\"代码配置\"></a>代码配置</h4><p>我们需要以下几步完成配置</p>\n<ol>\n<li>构建内存存储的 ClientDetailsService 实现类（spring security oauth 已经提供）。</li>\n<li>利用构建出来的进行配置客户端。</li>\n</ol>\n<p>所以我们先进行第一步，我们获取他的建造者：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">InMemoryClientDetailsServiceBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> clients.inMemory();</span><br></pre></td></tr></table></figure>\n\n<p>然后通过他构建一个内存客户端：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">builder</span><br><span class=\"line\">\t\t<span class=\"comment\">// 构建一个 id 为 oauth2 的客户端</span></span><br><span class=\"line\">        .withClient(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// 设置她的密钥，加密后的</span></span><br><span class=\"line\">        .secret(<span class=\"string\">&quot;$2a$10$wlgcx61faSJ8O5I4nLiovO9T36HBQgh4RhOQAYNORCzvANlInVlw2&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// 设置允许访问的资源 id</span></span><br><span class=\"line\">        .resourceIds(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// 授权的类型</span></span><br><span class=\"line\">        .authorizedGrantTypes(<span class=\"string\">&quot;password&quot;</span>, <span class=\"string\">&quot;authorization_code&quot;</span>, <span class=\"string\">&quot;refresh_token&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// 可以授权的角色</span></span><br><span class=\"line\">        .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>, <span class=\"string\">&quot;ROLE_USER&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// 授权的范围</span></span><br><span class=\"line\">        .scopes(<span class=\"string\">&quot;all&quot;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// token 有效期</span></span><br><span class=\"line\">        .accessTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">        <span class=\"comment\">// 刷新 token 的有效期</span></span><br><span class=\"line\">        .refreshTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">        <span class=\"comment\">// 授权码模式的重定向地址</span></span><br><span class=\"line\">        .redirectUris(<span class=\"string\">&quot;http://example.com&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>看起来她配置的东西和我们在配置文件中写的东西是基本一致的，不过密码现在是加密后的了，如何获取呢？我是写了一个测试类如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> isee.wang.oauth.authorization;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取加密后的密码</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> &lt;a href=&quot;http://isee.wang&quot;&gt;isee.wang&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/4/27 17:20</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PasswordTest</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">password</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 每次打印的结果都不一样，不影响</span></span><br><span class=\"line\">        System.out.println(<span class=\"keyword\">new</span> <span class=\"title class_\">BCryptPasswordEncoder</span>().encode(<span class=\"string\">&quot;oauth2&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后将打印的密码填入即可，<strong>不过值得注意的是，她每次的加密结果都是不一样的。</strong>现在的文件如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/4.png\" loading=\"lazy\"></p>\n<p>我们启动然后测试一下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/5.png\" loading=\"lazy\"></p>\n<p>这个就从内存中存存储和读取客户端信息了，如果多个客户端呢？复制一遍就好啦</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configure</span><span class=\"params\">(ClientDetailsServiceConfigurer clients)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">InMemoryClientDetailsServiceBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> clients.inMemory();</span><br><span class=\"line\">    builder</span><br><span class=\"line\">            <span class=\"comment\">// 构建一个 id 为 oauth2 的客户端</span></span><br><span class=\"line\">            .withClient(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 设置她的密钥，加密后的</span></span><br><span class=\"line\">            .secret(<span class=\"string\">&quot;$2a$10$8o7CwWaaMVvbUdnMwYs6IeWsUogIznSeWuP60zPiZHlY3OyCWywZC&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 设置允许访问的资源 id</span></span><br><span class=\"line\">            .resourceIds(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 授权的类型</span></span><br><span class=\"line\">            .authorizedGrantTypes(<span class=\"string\">&quot;password&quot;</span>, <span class=\"string\">&quot;authorization_code&quot;</span>, <span class=\"string\">&quot;refresh_token&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 可以授权的角色</span></span><br><span class=\"line\">            .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>, <span class=\"string\">&quot;ROLE_USER&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 授权的范围</span></span><br><span class=\"line\">            .scopes(<span class=\"string\">&quot;all&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// token 有效期</span></span><br><span class=\"line\">            .accessTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            <span class=\"comment\">// 刷新 token 的有效期</span></span><br><span class=\"line\">            .refreshTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            <span class=\"comment\">// 授权码模式的重定向地址</span></span><br><span class=\"line\">            .redirectUris(<span class=\"string\">&quot;http://example.com&quot;</span>);</span><br><span class=\"line\">    builder</span><br><span class=\"line\">            <span class=\"comment\">// 构建一个 id 为 test 的客户端</span></span><br><span class=\"line\">            .withClient(<span class=\"string\">&quot;test&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 设置她的密钥，加密后的</span></span><br><span class=\"line\">            .secret(<span class=\"string\">&quot;$2a$10$8o7CwWaaMVvbUdnMwYs6IeWsUogIznSeWuP60zPiZHlY3OyCWywZC&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 设置允许访问的资源 id</span></span><br><span class=\"line\">            .resourceIds(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 授权的类型</span></span><br><span class=\"line\">            .authorizedGrantTypes(<span class=\"string\">&quot;password&quot;</span>, <span class=\"string\">&quot;authorization_code&quot;</span>, <span class=\"string\">&quot;refresh_token&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 可以授权的角色</span></span><br><span class=\"line\">            .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>, <span class=\"string\">&quot;ROLE_USER&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 授权的范围</span></span><br><span class=\"line\">            .scopes(<span class=\"string\">&quot;all&quot;</span>)</span><br><span class=\"line\">            <span class=\"comment\">// token 有效期</span></span><br><span class=\"line\">            .accessTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            <span class=\"comment\">// 刷新 token 的有效期</span></span><br><span class=\"line\">            .refreshTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            <span class=\"comment\">// 授权码模式的重定向地址</span></span><br><span class=\"line\">            .redirectUris(<span class=\"string\">&quot;http://example.com&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>亦或者完全使用链式结构如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configure</span><span class=\"params\">(ClientDetailsServiceConfigurer clients)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    clients.inMemory()</span><br><span class=\"line\">            .withClient(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">            .secret(<span class=\"string\">&quot;$2a$10$8o7CwWaaMVvbUdnMwYs6IeWsUogIznSeWuP60zPiZHlY3OyCWywZC&quot;</span>)</span><br><span class=\"line\">            .resourceIds(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">            .authorizedGrantTypes(<span class=\"string\">&quot;password&quot;</span>, <span class=\"string\">&quot;authorization_code&quot;</span>, <span class=\"string\">&quot;refresh_token&quot;</span>)</span><br><span class=\"line\">            .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>, <span class=\"string\">&quot;ROLE_USER&quot;</span>)</span><br><span class=\"line\">            .scopes(<span class=\"string\">&quot;all&quot;</span>)</span><br><span class=\"line\">            .accessTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            .refreshTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            .redirectUris(<span class=\"string\">&quot;http://example.com&quot;</span>)</span><br><span class=\"line\">            .and()</span><br><span class=\"line\">            .withClient(<span class=\"string\">&quot;test&quot;</span>)</span><br><span class=\"line\">            .secret(<span class=\"string\">&quot;$2a$10$8o7CwWaaMVvbUdnMwYs6IeWsUogIznSeWuP60zPiZHlY3OyCWywZC&quot;</span>)</span><br><span class=\"line\">            .resourceIds(<span class=\"string\">&quot;oauth2&quot;</span>)</span><br><span class=\"line\">            .authorizedGrantTypes(<span class=\"string\">&quot;password&quot;</span>, <span class=\"string\">&quot;authorization_code&quot;</span>, <span class=\"string\">&quot;refresh_token&quot;</span>)</span><br><span class=\"line\">            .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>, <span class=\"string\">&quot;ROLE_USER&quot;</span>)</span><br><span class=\"line\">            .scopes(<span class=\"string\">&quot;all&quot;</span>)</span><br><span class=\"line\">            .accessTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            .refreshTokenValiditySeconds(Math.toIntExact(Duration.ofHours(<span class=\"number\">1</span>).getSeconds()))</span><br><span class=\"line\">            .redirectUris(<span class=\"string\">&quot;http://example.com&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置文件配置\"><a href=\"#配置文件配置\" class=\"headerlink\" title=\"配置文件配置\"></a>配置文件配置</h4><p>对于配置文件配置其实他已经有了默认的实现了，但是只能对一个客户端进行配置，我们需要多个的时候怎么办呢？就需要我们来扩展了，这个实现其实很简单，就是一个配置类和一个循环的实现，我们来捋一下步骤。</p>\n<ol>\n<li>读取配置文件，多个客户端信息</li>\n<li>逐个配置客户端信息</li>\n</ol>\n<p>先来书写配置类，使用 lombok 自动生成 get&#x2F;set 等方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(&quot;application.security.oauth&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ClientDetails</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;BaseClientDetails&gt; client;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>书写配置文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">application:</span></span><br><span class=\"line\">  <span class=\"attr\">security:</span></span><br><span class=\"line\">    <span class=\"attr\">oauth:</span></span><br><span class=\"line\">      <span class=\"string\">client[0]:</span></span><br><span class=\"line\">        <span class=\"attr\">registered-redirect-uri:</span> <span class=\"string\">http://example.com</span></span><br><span class=\"line\">        <span class=\"comment\"># 客户端 id</span></span><br><span class=\"line\">        <span class=\"attr\">client-id:</span> <span class=\"string\">client1</span></span><br><span class=\"line\">        <span class=\"comment\"># 客户端密钥</span></span><br><span class=\"line\">        <span class=\"attr\">client-secret:</span> <span class=\"string\">$2a$10$8o7CwWaaMVvbUdnMwYs6IeWsUogIznSeWuP60zPiZHlY3OyCWywZC</span></span><br><span class=\"line\">        <span class=\"comment\"># 授权范围</span></span><br><span class=\"line\">        <span class=\"attr\">scope:</span> <span class=\"string\">all</span></span><br><span class=\"line\">        <span class=\"comment\"># token 有效期</span></span><br><span class=\"line\">        <span class=\"attr\">access-token-validity-seconds:</span> <span class=\"number\">6000</span></span><br><span class=\"line\">        <span class=\"comment\"># 刷新 token 的有效期</span></span><br><span class=\"line\">        <span class=\"attr\">refresh-token-validity-seconds:</span> <span class=\"number\">6000</span></span><br><span class=\"line\">        <span class=\"comment\"># 允许的授权类型</span></span><br><span class=\"line\">        <span class=\"attr\">grant-type:</span> <span class=\"string\">authorization_code,password,refresh_token</span></span><br><span class=\"line\">        <span class=\"comment\"># 可以访问的资源 id</span></span><br><span class=\"line\">        <span class=\"attr\">resource-ids:</span> <span class=\"string\">oauth2</span></span><br><span class=\"line\">      <span class=\"string\">client[1]:</span></span><br><span class=\"line\">        <span class=\"attr\">registered-redirect-uri:</span> <span class=\"string\">http://example.com</span></span><br><span class=\"line\">        <span class=\"comment\"># 客户端 id</span></span><br><span class=\"line\">        <span class=\"attr\">client-id:</span> <span class=\"string\">client2</span></span><br><span class=\"line\">        <span class=\"comment\"># 客户端密钥</span></span><br><span class=\"line\">        <span class=\"attr\">client-secret:</span> <span class=\"string\">$2a$10$8o7CwWaaMVvbUdnMwYs6IeWsUogIznSeWuP60zPiZHlY3OyCWywZC</span></span><br><span class=\"line\">        <span class=\"comment\"># 授权范围</span></span><br><span class=\"line\">        <span class=\"attr\">scope:</span> <span class=\"string\">all</span></span><br><span class=\"line\">        <span class=\"comment\"># token 有效期</span></span><br><span class=\"line\">        <span class=\"attr\">access-token-validity-seconds:</span> <span class=\"number\">6000</span></span><br><span class=\"line\">        <span class=\"comment\"># 刷新 token 的有效期</span></span><br><span class=\"line\">        <span class=\"attr\">refresh-token-validity-seconds:</span> <span class=\"number\">6000</span></span><br><span class=\"line\">        <span class=\"comment\"># 允许的授权类型</span></span><br><span class=\"line\">        <span class=\"attr\">grant-type:</span> <span class=\"string\">authorization_code,password,refresh_token</span></span><br><span class=\"line\">        <span class=\"comment\"># 可以访问的资源 id</span></span><br><span class=\"line\">        <span class=\"attr\">resource-ids:</span> <span class=\"string\">oauth2</span></span><br></pre></td></tr></table></figure>\n\n<p>为了防止混淆，我单独写了一个方法来配置，如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configClient</span><span class=\"params\">(ClientDetailsServiceConfigurer clients)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">InMemoryClientDetailsServiceBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> clients.inMemory();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (BaseClientDetails client : clientDetails.getClient()) &#123;</span><br><span class=\"line\">        ClientDetailsServiceBuilder&lt;InMemoryClientDetailsServiceBuilder&gt;.<span class=\"type\">ClientBuilder</span> <span class=\"variable\">clientBuilder</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                builder.withClient(client.getClientId());</span><br><span class=\"line\">        clientBuilder</span><br><span class=\"line\">                .secret(client.getClientSecret())</span><br><span class=\"line\">                .resourceIds(client.getResourceIds().toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[<span class=\"number\">0</span>]))</span><br><span class=\"line\">                .authorizedGrantTypes(client.getAuthorizedGrantTypes().toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[<span class=\"number\">0</span>]))</span><br><span class=\"line\">                .authorities(</span><br><span class=\"line\">                        AuthorityUtils.authorityListToSet(client.getAuthorities())</span><br><span class=\"line\">                                .toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[<span class=\"number\">0</span>]))</span><br><span class=\"line\">                .scopes(client.getScope().toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[<span class=\"number\">0</span>]));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (client.getAutoApproveScopes() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            clientBuilder.autoApprove(</span><br><span class=\"line\">                    client.getAutoApproveScopes().toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[<span class=\"number\">0</span>]));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (client.getAccessTokenValiditySeconds() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            clientBuilder.accessTokenValiditySeconds(</span><br><span class=\"line\">                    client.getAccessTokenValiditySeconds());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (client.getRefreshTokenValiditySeconds() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            clientBuilder.refreshTokenValiditySeconds(</span><br><span class=\"line\">                    client.getRefreshTokenValiditySeconds());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (client.getRegisteredRedirectUri() != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            clientBuilder.redirectUris(</span><br><span class=\"line\">                    client.getRegisteredRedirectUri().toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[<span class=\"number\">0</span>]));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最终如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/6.png\" loading=\"lazy\"></p>\n<p>然后运行测试一下两个客户端</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/7.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/8.png\" loading=\"lazy\"></p>\n<p>这样也实现了效果</p>\n<h3 id=\"令牌存储\"><a href=\"#令牌存储\" class=\"headerlink\" title=\"令牌存储\"></a>令牌存储</h3><p>其实他默认的令牌存储就是使用到内存存储，所以我们无需配置～何以见得呢？我们来简单分析一下。</p>\n<p>在前面我们说过 <code>AuthorizationServerConfigurer</code> 的三个配置方法，其中就有一个参数为 <code>AuthorizationServerEndpointsConfigurer</code> 类型的配置方法，它可以配置我们令牌信息，所以我们就要把目标放在他的上面看看，去找一找他是如何配置的。</p>\n<p>他的核心配置类是 <code>AuthorizationServerEndpointsConfiguration</code>，这个类内容很多，我们只关注他是默认配置的为什么是内存的，首先找到一个工厂类：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/9.png\" loading=\"lazy\"></p>\n<p>我们跟进去看看：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/10.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/11.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/12.png\" loading=\"lazy\"></p>\n<p>这样我们就找到她是如何默认创建的了。</p>\n<h2 id=\"基于-mysql-的客户端信息与令牌存储\"><a href=\"#基于-mysql-的客户端信息与令牌存储\" class=\"headerlink\" title=\"基于 mysql 的客户端信息与令牌存储\"></a>基于 mysql 的客户端信息与令牌存储</h2><div class=\"note default no-icon\"><p>代码参见项目模块 spring-security-oauth2-authorization-mysql</p>\n<p>模块创建步骤省略</p>\n</div>\n\n<p>我们将在 mysql 中存储和读取客户端信息以及下发的令牌信息：</p>\n<ul>\n<li><strong>优点</strong>：扩展性极高，不用修改代码与重启就可以完成客户端管理，安全性高。</li>\n<li><strong>缺点</strong>：使用数据库速度过慢，多客户端高并发情况下可能会造成性能瓶颈</li>\n<li><strong>适用场景</strong>：中大型项目，独立且完整的授权服务器。</li>\n</ul>\n<p>在这之前你要添加如下的 mysql 和 jdbc 依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>配置文件如下，我的 mysql 版本为 5.7 ，url 参数请自行修改</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8000</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/auth?useUnicode=true&amp;characterEncoding=UTF-8&amp;useOldAliasMetadataBehavior=true&amp;autoReconnect=true&amp;serverTimezone=UTC</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"number\">123456</span></span><br><span class=\"line\">    <span class=\"comment\"># 用来初始化数据库的，如果不存在表就自动创建</span></span><br><span class=\"line\">    <span class=\"attr\">initialization-mode:</span> <span class=\"string\">ALWAYS</span></span><br><span class=\"line\">    <span class=\"attr\">schema:</span> <span class=\"string\">classpath:ddl.sql</span></span><br></pre></td></tr></table></figure>\n\n<p>导入 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1wcm9qZWN0cy9zcHJpbmctc2VjdXJpdHktb2F1dGgvYmxvYi9tYXN0ZXIvc3ByaW5nLXNlY3VyaXR5LW9hdXRoMi9zcmMvdGVzdC9yZXNvdXJjZXMvc2NoZW1hLnNxbA==\">官方提供<i class=\"fa fa-external-link-alt\"></i></span> 的 h2 的表，由于官方使用的是 h2 的数据库，有些字段类型不对，我修改成 mysql 的后如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">-- used in tests that use MYSQL</span><br><span class=\"line\">create table if not exists oauth_client_details (</span><br><span class=\"line\">  client_id VARCHAR(256) PRIMARY KEY,</span><br><span class=\"line\">  resource_ids VARCHAR(256),</span><br><span class=\"line\">  client_secret VARCHAR(256),</span><br><span class=\"line\">  scope VARCHAR(256),</span><br><span class=\"line\">  authorized_grant_types VARCHAR(256),</span><br><span class=\"line\">  web_server_redirect_uri VARCHAR(256),</span><br><span class=\"line\">  authorities VARCHAR(256),</span><br><span class=\"line\">  access_token_validity INTEGER,</span><br><span class=\"line\">  refresh_token_validity INTEGER,</span><br><span class=\"line\">  additional_information VARCHAR(4096),</span><br><span class=\"line\">  autoapprove VARCHAR(256)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br><span class=\"line\"></span><br><span class=\"line\">create table if not exists oauth_client_token (</span><br><span class=\"line\">  token_id VARCHAR(256),</span><br><span class=\"line\">  token BLOB,</span><br><span class=\"line\">  authentication_id VARCHAR(256) PRIMARY KEY,</span><br><span class=\"line\">  user_name VARCHAR(256),</span><br><span class=\"line\">  client_id VARCHAR(256)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br><span class=\"line\"></span><br><span class=\"line\">create table if not exists oauth_access_token (</span><br><span class=\"line\">  token_id VARCHAR(256),</span><br><span class=\"line\">  token BLOB,</span><br><span class=\"line\">  authentication_id VARCHAR(256) PRIMARY KEY,</span><br><span class=\"line\">  user_name VARCHAR(256),</span><br><span class=\"line\">  client_id VARCHAR(256),</span><br><span class=\"line\">  authentication BLOB,</span><br><span class=\"line\">  refresh_token VARCHAR(256)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br><span class=\"line\"></span><br><span class=\"line\">create table if not exists oauth_refresh_token (</span><br><span class=\"line\">  token_id VARCHAR(256),</span><br><span class=\"line\">  token BLOB,</span><br><span class=\"line\">  authentication BLOB</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br><span class=\"line\"></span><br><span class=\"line\">create table if not exists oauth_code (</span><br><span class=\"line\">  code VARCHAR(256), authentication BLOB</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br><span class=\"line\"></span><br><span class=\"line\">create table if not exists oauth_approvals (</span><br><span class=\"line\">\tuserId VARCHAR(256),</span><br><span class=\"line\">\tclientId VARCHAR(256),</span><br><span class=\"line\">\tscope VARCHAR(256),</span><br><span class=\"line\">\tstatus VARCHAR(10),</span><br><span class=\"line\">\texpiresAt TIMESTAMP,</span><br><span class=\"line\">\tlastModifiedAt TIMESTAMP</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- customized oauth_client_details table</span><br><span class=\"line\">create table if not exists ClientDetails (</span><br><span class=\"line\">  appId VARCHAR(256) PRIMARY KEY,</span><br><span class=\"line\">  resourceIds VARCHAR(256),</span><br><span class=\"line\">  appSecret VARCHAR(256),</span><br><span class=\"line\">  scope VARCHAR(256),</span><br><span class=\"line\">  grantTypes VARCHAR(256),</span><br><span class=\"line\">  redirectUrl VARCHAR(256),</span><br><span class=\"line\">  authorities VARCHAR(256),</span><br><span class=\"line\">  access_token_validity INTEGER,</span><br><span class=\"line\">  refresh_token_validity INTEGER,</span><br><span class=\"line\">  additionalInformation VARCHAR(4096),</span><br><span class=\"line\">  autoApproveScopes VARCHAR(256)</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;</span><br></pre></td></tr></table></figure>\n\n<p>先给大家介绍一下几张表的具体意思和结构：</p>\n<p>oauth_client_details &#x3D;&#x3D;&#x3D;&gt; 客户端信息</p>\n<table>\n<thead>\n<tr>\n<th>列名</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>client_id（主键）</td>\n<td>VARCHAR(256)</td>\n<td>主键,必须唯一,不能为空. 用于唯一标识每一个客户端(client); 在注册时必须填写(也可由服务端自动生成). 对于不同的grant_type,该字段都是必须的. 在实际应用中的另一个名称叫appKey,与client_id是同一个概念.</td>\n</tr>\n<tr>\n<td>resource_ids</td>\n<td>VARCHAR(256)</td>\n<td>客户端所能访问的资源id集合,多个资源时用逗号(,)分隔</td>\n</tr>\n<tr>\n<td>client_secret</td>\n<td>VARCHAR(256)</td>\n<td>用于指定客户端(client)的访问密匙; 在注册时必须填写(也可由服务端自动生成). 对于不同的grant_type,该字段都是必须的. 在实际应用中的另一个名称叫appSecret,与client_secret是同一个概念.</td>\n</tr>\n<tr>\n<td>scope</td>\n<td>VARCHAR(256)</td>\n<td>指定客户端申请的权限范围,可选值包括read,write,trust;若有多个权限范围用逗号(,)分隔,如: “read,write”.</td>\n</tr>\n<tr>\n<td>authorized_grant_types</td>\n<td>VARCHAR(256)</td>\n<td>指定客户端支持的grant_type,可选值包括authorization_code,password,refresh_token,implicit,client_credentials,若支持多个grant_type用逗号(,)分隔,如: “authorization_code,password”.在实际应用中,当注册时,该字段是一般由服务器端指定的,而不是由申请者去选择的,</td>\n</tr>\n<tr>\n<td>web_server_redirect_uri</td>\n<td>VARCHAR(256)</td>\n<td>客户端的重定向URI,可为空, 当grant_type为authorization_code或implicit时, 在Oauth的流程中会使用并检查与注册时填写的redirect_uri是否一致.</td>\n</tr>\n<tr>\n<td>authorities</td>\n<td>VARCHAR(256)</td>\n<td>指定客户端所拥有的Spring Security的权限值,可选, 若有多个权限值,用逗号(,)分隔, 如: &quot;ROLE_ADMIN&quot;</td>\n</tr>\n<tr>\n<td>access_token_validity</td>\n<td>INTEGER</td>\n<td>设定客户端的access_token的有效时间值(单位:秒),可选, 若不设定值则使用默认的有效时间值(60 * 60 * 12, 12小时).</td>\n</tr>\n<tr>\n<td>refresh_token_validity</td>\n<td>INTEGER</td>\n<td>设定客户端的refresh_token的有效时间值(单位:秒),可选, 若不设定值则使用默认的有效时间值(60 * 60 * 12, 12小时).</td>\n</tr>\n<tr>\n<td>additional_information</td>\n<td>VARCHAR(4096)</td>\n<td>这是一个预留的字段,在Oauth的流程中没有实际的使用,可选,但若设置值,必须是JSON格式的数据,在实际应用中, 可以用该字段来存储关于客户端的一些其他信息</td>\n</tr>\n<tr>\n<td>autoapprove</td>\n<td>VARCHAR(256)</td>\n<td>设置用户是否自动Approval操作, 默认值为 ‘false’, 可选值包括 ‘true’,‘false’, ‘read’,‘write’.该字段只适用于grant_type&#x3D;&quot;authorization_code&quot;的情况,当用户登录成功后,若该值为’true’或支持的scope值,则会跳过用户Approve的页面,直接授权.</td>\n</tr>\n</tbody></table>\n<p>oauth_client_token &#x3D;&#x3D;&#x3D;&gt; 客户端系统中存储从服务端获取的 token 数据</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>字段类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>token_id</td>\n<td>VARCHAR(256)</td>\n<td>从服务器端获取到的access_token的值.</td>\n</tr>\n<tr>\n<td>token</td>\n<td>BLOB</td>\n<td>这是一个二进制的字段, 存储的数据是OAuth2AccessToken.java对象序列化后的二进制数据.</td>\n</tr>\n<tr>\n<td>authentication_id</td>\n<td>VARCHAR(256)</td>\n<td>该字段具有唯一性, 是根据当前的username(如果有),client_id与scope通过MD5加密生成的. 具体实现请参考DefaultClientKeyGenerator.java类.</td>\n</tr>\n<tr>\n<td>user_name</td>\n<td>VARCHAR(256)</td>\n<td>登录时的用户名</td>\n</tr>\n<tr>\n<td>client_id</td>\n<td>VARCHAR(256)</td>\n<td>客户端 id</td>\n</tr>\n</tbody></table>\n<p>oauth_access_token &#x3D;&#x3D;&#x3D;&gt; 生成的 token 数据</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>字段类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>token_id</td>\n<td>VARCHAR(256)</td>\n<td>从服务器端获取到的access_token的值.</td>\n</tr>\n<tr>\n<td>token</td>\n<td>BLOB</td>\n<td>存储将OAuth2AccessToken.java对象序列化后的二进制数据, 是真实的AccessToken的数据值.</td>\n</tr>\n<tr>\n<td>authentication_id</td>\n<td>VARCHAR(256)</td>\n<td>该字段具有唯一性, 其值是根据当前的username(如果有),client_id与scope通过MD5加密生成的.</td>\n</tr>\n<tr>\n<td>user_name</td>\n<td>VARCHAR(256)</td>\n<td>登录时的用户名, 若客户端没有用户名(如grant_type&#x3D;“client_credentials”),则该值等于client_id</td>\n</tr>\n<tr>\n<td>client_id</td>\n<td>VARCHAR(256)</td>\n<td>客户端 id</td>\n</tr>\n<tr>\n<td>authentication</td>\n<td>BLOB</td>\n<td>存储将 OAuth2Authentication 对象序列化后的二进制数据.</td>\n</tr>\n<tr>\n<td>refresh_token</td>\n<td>VARCHAR(256)</td>\n<td>该字段的值是将refresh_token的值通过MD5加密后存储的.</td>\n</tr>\n</tbody></table>\n<p>oauth_refresh_token &#x3D;&#x3D;&#x3D;&gt; 刷新 token</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>字段类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>token_id</td>\n<td>VARCHAR(256)</td>\n<td>该字段的值是将refresh_token的值通过MD5加密后存储的.</td>\n</tr>\n<tr>\n<td>token</td>\n<td>BLOB</td>\n<td>存储将OAuth2RefreshToken.java对象序列化后的二进制数据.</td>\n</tr>\n<tr>\n<td>authentication</td>\n<td>BLOB</td>\n<td>存储将OAuth2Authentication.java对象序列化后的二进制数据.</td>\n</tr>\n</tbody></table>\n<p>oauth_code &#x3D;&#x3D;&#x3D;&gt; 服务端生成的 code 值</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>字段类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>code</td>\n<td>VARCHAR(256)</td>\n<td>存储服务端系统生成的code的值(未加密).</td>\n</tr>\n</tbody></table>\n<p>oauth_approvals &#x3D;&#x3D;&#x3D;&gt; 授权同意信息</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>字段类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>userId</td>\n<td>VARCHAR(256)</td>\n<td>用户 id</td>\n</tr>\n<tr>\n<td>clientId</td>\n<td>VARCHAR(256)</td>\n<td>客户端 id</td>\n</tr>\n<tr>\n<td>scope</td>\n<td>VARCHAR(256)</td>\n<td>请求的范围</td>\n</tr>\n<tr>\n<td>status</td>\n<td>VARCHAR(10)</td>\n<td>授权的状态</td>\n</tr>\n<tr>\n<td>expiresAt</td>\n<td>TIMESTAMP</td>\n<td>时间</td>\n</tr>\n<tr>\n<td>lastModifiedAt</td>\n<td>TIMESTAMP</td>\n<td>最后修改的时间</td>\n</tr>\n</tbody></table>\n<p>最后一张 ClientDetails 是我们要自定义他的 表 的情况，在我们需要自定义的时候使用，但是目前我们暂时不去自定义，所以无用。</p>\n<p>所以你现在的项目结构应该如下</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/13.png\" loading=\"lazy\"></p>\n<p>记得启动测试一下，确定不报错。</p>\n<p>接下来我们就是来进行配置了，同样的，分为客户端信息配置和令牌配置</p>\n<h3 id=\"客户端信息-1\"><a href=\"#客户端信息-1\" class=\"headerlink\" title=\"客户端信息\"></a>客户端信息</h3><p>同样，对于客户端的配置我们主要实现对参数为 ClientDetailsServiceConfigurer 的方法进行配置，我们需要完成以下两步：</p>\n<ol>\n<li>构建一个 jdbc 的 ClientDetailsService，通过他来链接数据库。</li>\n<li>将它配置进 ClientDetailsServiceConfigurer 之中。</li>\n</ol>\n<p>我们首先先来配置一个 jdbc 的 ClientDetailsService ，非常简单，因为他已经提供了默认的实现了的，构建方式如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 数据源</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"meta\">@NonNull</span> DataSource dataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 声明 ClientDetails实现</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> ClientDetailsService</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ClientDetailsService <span class=\"title function_\">clientDetails</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JdbcClientDetailsService</span>(dataSource);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后将他配置进 ClientDetailsServiceConfigurer 之中，如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configure</span><span class=\"params\">(ClientDetailsServiceConfigurer clients)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    clients.withClientDetails(clientDetails());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":["java"],"tags":["Spring","Security","Oauth2"]},{"title":"Spring Security Oauth2 从零到一完整实践（二）自动配置实现","url":"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/","content":"<p>\n\n<span id=\"more\"></span>\n\n<p>前面我们学习了四种授权模式的两种，因为那两种分别满足了方便和安全，已经能够胜任大多数情况，我们从简开始，先来用最简单的方式开始。</p>\n<div class=\"note info no-icon\"><p>github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nkd3h3L3NwcmluZy1zZWN1cml0eS1vYXV0aDItZGVtbw==\">spring-security-oauth2-demo<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>博客地址：<a href=\"/\">isee.wang</a></p>\n</div>\n\n<h2 id=\"系列文章\"><a href=\"#系列文章\" class=\"headerlink\" title=\"系列文章\"></a>系列文章</h2><ol>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/\">较为详细的学习 oauth2 的四种模式其中的两种授权模式</a></li>\n<li>spring boot oauth2 自动配置实现</li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%89%EF%BC%89%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8/\">spring security oauth2 授权服务器配置</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%9B%9B%EF%BC%89%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8/\">spring security oauth2 资源服务器配置</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%94%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F%EF%BC%88%E6%89%8B%E6%9C%BA%E3%80%81%E9%82%AE%E7%AE%B1%E7%AD%89%EF%BC%89/\">spring security oauth2 自定义授权模式（手机、邮箱等）</a></li>\n<li><a href=\"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%85%AD%EF%BC%89%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/\">spring security oauth2 踩坑记录</a></li>\n</ol>\n<h2 id=\"spring-boot-oauth2-自动配置实现\"><a href=\"#spring-boot-oauth2-自动配置实现\" class=\"headerlink\" title=\"spring boot oauth2 自动配置实现\"></a>spring boot oauth2 自动配置实现</h2><p>spring boot 最大一个特点就是 <strong>约定大于配置，去繁就简</strong> 。既然如此，他自然也提供了一套 oauth2 的自动化配置，我们先来实验他完成的自动化配置看看效果。</p>\n<p>首先创建我们的 module 如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/1.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/2.png\" loading=\"lazy\"><br><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/3.png\" loading=\"lazy\"></p>\n<div class=\"note warning\"><p>注意：这个过程以后不再截图演示。</p>\n</div>\n\n<p>在 pom.xml 中添加如下依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-security<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.security.oauth.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-security-oauth2-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"spring-security-保护的资源\"><a href=\"#spring-security-保护的资源\" class=\"headerlink\" title=\"spring security 保护的资源\"></a>spring security 保护的资源</h2><p>默认情况下，我们加入了 spring security 的依赖，他会保护我们的资源。现在添加启动类如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Application</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(Application.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>直接启动，控制台如下</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/4.png\" loading=\"lazy\"></p>\n<p>然后访问 <span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgwLw==\">http://127.0.0.1:8080<i class=\"fa fa-external-link-alt\"></i></span> ，如下</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/5.png\" loading=\"lazy\"></p>\n<p>使用用户名 user 密码为控制台打印的那一串登录即可，成功后如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/6.png\" loading=\"lazy\"></p>\n<p>但是现在默认的是 spring security，我们接下来来实验一下 oauth2 保护我们的资源</p>\n<h2 id=\"spring-security-oauth2-保护资源\"><a href=\"#spring-security-oauth2-保护资源\" class=\"headerlink\" title=\"spring security oauth2 保护资源\"></a>spring security oauth2 保护资源</h2><p>我们在前面提到过 oauth2 的几种角色，我们现在一步一步的来。在下面的授权服务器与资源服务器，我们将他们存在同一个应用之中使用，先以最快速的方式学习与了解，后面再来考虑分离的问题。</p>\n<h2 id=\"授权服务器\"><a href=\"#授权服务器\" class=\"headerlink\" title=\"授权服务器\"></a>授权服务器</h2><p>首先第一步是授权服务器，因为它是我们获取与请求凭证的地方，我们需要他来给我们下发令牌凭证，如何开启呢？需要一个启动注解@EnableAuthorizationServer 添加在启动类上即可。</p>\n<p>同时为了方便测试，我们添加一个 ResourceController 来设置一个资源访问路径如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/7.png\" loading=\"lazy\"></p>\n<p>这个时候我们再启动，然后去访问就会发现不需要登录了</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/8.png\" loading=\"lazy\"></p>\n<p>因为现在 spring security 已经不再去管理你的应用了，<strong>然而现在你只配置了授权服务器，他不会保护你的应用程序的，所以不需要登录了。我们暂时不管，现在授权服务器的任务是验证身份并下发令牌，我们来测试一下。</strong></p>\n<p>为了方便查看路径，我们开启 debug 日志，以便更好的理解整个过程；添加 application.yml 以及内容如下：</p>\n<figure class=\"highlight yaml\"><figcaption><span>application.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">logging:</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span></span><br><span class=\"line\">    <span class=\"attr\">org:</span></span><br><span class=\"line\">      <span class=\"attr\">springframework:</span></span><br><span class=\"line\">        <span class=\"attr\">security:</span> <span class=\"string\">DEBUG</span></span><br></pre></td></tr></table></figure>\n\n<p>然后运行，你会看到如下画面：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/9.png\" loading=\"lazy\"></p>\n<p>在我们启动的时候为我们自动生成的了一些东西：</p>\n<ul>\n<li>用户密码</li>\n<li>客户端 id</li>\n<li>客户端密码</li>\n<li>添加了七个路径</li>\n<li>使用权限表达式设置访问权限</li>\n</ul>\n<h3 id=\"授权码模式\"><a href=\"#授权码模式\" class=\"headerlink\" title=\"授权码模式\"></a>授权码模式</h3><p>spring security oauth 授权服务器默认开启授权码模式。那么按照我们前面说的，<strong>授权码模式是在授权端点 &#x2F;oauth&#x2F;authorize 请求授权码</strong>，路径应该如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/oauth/authorize?response_type=code&amp;client_id=b6a2f868-cba4-4c44-bfec-4cde082e979f&amp;redirect_uri=http://example.com&amp;scope=all</span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning no-icon\"><p><strong>为什么回调地址是 <span class=\"exturl\" data-url=\"aHR0cDovL2V4YW1wbGUuY29tLw==\">http://example.com<i class=\"fa fa-external-link-alt\"></i></span> ？</strong></p>\n<p>因为我们现在没有任何应用，需要一个页面来接收回调后的授权码，所以随便找了一个。</p>\n</div>\n\n<p>访问后会出现如下错误</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/10.png\" loading=\"lazy\"></p>\n<p>这是因为我们没有配置 spring security 造成的，所以需要回去配置一下，使用默认配置即可，添加一个配置类如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/11.png\" loading=\"lazy\"></p>\n<p>重启启动后，你会发现，现在的网页又不能访问了，全都提示需要登录了，暂时不管。</p>\n<p><strong>我们使用新的 client id 去请求授权</strong>，他会自动跳转到登录页面了，如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/12.png\" loading=\"lazy\"></p>\n<p>这里的步骤是在授权服务器上面的，就像我们点击第三方登录的 qq 的时候，是跳转到 腾讯 自己的登录页面的。用户名 user ，密码为控制台生成的，登录后如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/13.png\" loading=\"lazy\"></p>\n<p>它提示我们 <strong>至少为客户端注册一个回调地址</strong> ，我们请求授权的时候传递了一个回调地址了，这里为什么还需要一个呢？这个很容易理解，<strong>因为你传递过来的回调地址授权服务器不知道是否合法，可能会在传输的中途被篡改，所以在授权服务器里面需要你注册一个回调地址，与你传递过来的进行对比，如果匹配才会携带授权码进行回调。</strong>这样就有效避免中途被篡改的问题了，所以现在我们需要去注册一个回调地址，在 application.yml 中配置：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/14.png\" loading=\"lazy\"></p>\n<p>然后重新启动，再次携带新的客户端id进行访问：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/15.png\" loading=\"lazy\"></p>\n<p>当我们确认授权了以后，这个授权流程也就完毕了，也就相当于前面 <strong>角色中的抽象流图的 AB 完成了</strong> ，我们看看得到的授权码</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/16.png\" loading=\"lazy\"></p>\n<p><strong>接下来我们需要使用此授权码去完成请求令牌的操作也就是前面说到的第二个请求</strong>，我们需要 postman 接口测试工具：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/17.png\" loading=\"lazy\"></p>\n<p>当我们设置好授权信息以后他会为我们自动添加一个请求头</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/18.png\" loading=\"lazy\"></p>\n<p>请求头的添加方式就是前面提到的 <strong>客户端加密</strong> 的那一部分，不再赘述。然后我们设置 <strong>第二个请求的请求参数</strong> 如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/19.png\" loading=\"lazy\"></p>\n<p>这样我们就获取到令牌了，到这一步，也就相当于前面 角色中的抽象流图的 CD 也完成了 。这就是授权码模式获取令牌的两个请求的过程。</p>\n<h3 id=\"密码模式\"><a href=\"#密码模式\" class=\"headerlink\" title=\"密码模式\"></a>密码模式</h3><p>接下来我们来试一下 <strong>密码模式</strong> 来获取令牌，就像前面所说，他只有一个请求即可，所以我们只要用 postman 携带参数请求一下就好了。</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/20.png\" loading=\"lazy\"></p>\n<p>相比起来，密码模式就简单太多啦！但是用户名密码是在客户端那里的，而不是在授权服务器这边的，所以只能是完全信得过的应用才能够使用！</p>\n<h3 id=\"快速自定义\"><a href=\"#快速自定义\" class=\"headerlink\" title=\"快速自定义\"></a>快速自定义</h3><p><strong>所谓快速自定义，就是我们不需要写代码，通过配置文件即可完成自定义。</strong>对于 oauth2 客户端，提供了如下配置让我们快速自定义：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/21.png\" loading=\"lazy\"></p>\n<p>当然，只能提供一个客户端使用。我们后面再来详细学习如何自定义</p>\n<h3 id=\"配置用户\"><a href=\"#配置用户\" class=\"headerlink\" title=\"配置用户\"></a>配置用户</h3><p>其实用户就是用的 spring security 的用户，但是由于不能够直接在配置文件中指定用户的密码了，所以我们需要建一个 UserService 的实现类。不过在那之前，我们需要配置一个密码加密器，让我们的密码得到保障，而不是明文传输，spring 5 以后这个是必须指定的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> PasswordEncoder <span class=\"title function_\">passwordEncoder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BCryptPasswordEncoder</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>BCrypt 不可逆的加密算法，无法通过解密密文得到明文，和其他对称或非对称加密方式不同的是，不是直接解密得到明文，也不是二次加密比较密文，而是把明文和存储的密文一块运算得到另一个密文，如果这两个密文相同则验证成功。对于同一个密码，每次加密出来是完全不同的，所以安全性很可靠。</p>\n<p>下面的用户我们用最快捷的方式来进行创建，创建两个内存用户：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> UserDetailsService <span class=\"title function_\">userDetailsService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">InMemoryUserDetailsManager</span> <span class=\"variable\">manager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryUserDetailsManager</span>();</span><br><span class=\"line\">    manager.createUser(User.withUsername(<span class=\"string\">&quot;user&quot;</span>)</span><br><span class=\"line\">                   .password(passwordEncoder().encode(<span class=\"string\">&quot;123456&quot;</span>))</span><br><span class=\"line\">                   .authorities(<span class=\"string\">&quot;ROLE_USER&quot;</span>).build());</span><br><span class=\"line\">    manager.createUser(User.withUsername(<span class=\"string\">&quot;admin&quot;</span>)</span><br><span class=\"line\">                   .password(passwordEncoder().encode(<span class=\"string\">&quot;admin&quot;</span>))</span><br><span class=\"line\">                   .authorities(<span class=\"string\">&quot;ROLE_ADMIN&quot;</span>).build());</span><br><span class=\"line\">    <span class=\"keyword\">return</span> manager;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/22.png\" loading=\"lazy\"></p>\n<p>获取令牌看看</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/23.png\" loading=\"lazy\"></p>\n<h2 id=\"资源服务器\"><a href=\"#资源服务器\" class=\"headerlink\" title=\"资源服务器\"></a>资源服务器</h2><p>现在我们取到了 token，我们来尝试访问一下被保护的资源，使用浏览器访问：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/24.png\" loading=\"lazy\"></p>\n<p>你会发现同样需要你登录，因为现在是由 spring security 进行资源保护的。那么我们看看携带 token 使用 postman 测试一下会怎样呢？</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/25.png\" loading=\"lazy\"></p>\n<p>会发现是 401，也就是令牌是无效的，原因就是因为现在资源的保护是由传统的 spring security 来进行保护的。接下来我们就要配置我们的资源服务器。</p>\n<p>同授权服务器一样，资源服务器的启动也只需要一个注解就可以了：@EnableResourceServer，启动类添加此注解如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAuthorizationServer</span></span><br><span class=\"line\"><span class=\"meta\">@EnableResourceServer</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Application</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(Application.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>启动下应用，通过浏览器看看</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/26.png\" loading=\"lazy\"></p>\n<p>你会发现已经不能够登录了。现在重新用密码模式请求下 token，截图省略，然后获取 token 后去请求我们受保护的资源试一试：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/27.png\" loading=\"lazy\"></p>\n<p>现在携带正确的 token 就可以请求到数据了，这就是已经由 spring security oauth 来进行资源保护了。</p>\n<p>对于资源服务器的自定义配置，目前只有一个地方，就是资源的 id ，如下：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/28.png\" loading=\"lazy\"></p>\n<p>如果两者不相同会抛出如下异常：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;error&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;access_denied&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;error_description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Invalid token does not contain resource id (resource-id)&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>其他的配置我们后面再说，因为他主要涉及到与授权服务器的分离的情况。</p>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p>除了获取 token 和请求以外，她还可以配置一些默认的实现。</p>\n<h3 id=\"解析-token\"><a href=\"#解析-token\" class=\"headerlink\" title=\"解析 token\"></a>解析 token</h3><p>我们需要在配置文件中添加如下配置：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">security:</span></span><br><span class=\"line\">  <span class=\"attr\">oauth2:</span></span><br><span class=\"line\">    <span class=\"attr\">authorization:</span></span><br><span class=\"line\">      <span class=\"comment\"># 允许使用 /oauth/check_token 端点</span></span><br><span class=\"line\">      <span class=\"attr\">check-token-access:</span> <span class=\"string\">isAuthenticated()</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/29.png\" loading=\"lazy\"></p>\n<p>熟悉 SqEL 表达式的同学应该知道 isAuthenticated() 的意思，它允许此端点的访问，重启后获取新的 token，来访问试一试，参数前面已经说过不再赘述：</p>\n<p><img src=\"/images/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0/30.png\" loading=\"lazy\"></p>\n<p>这样就成功解析了我们的 token 信息！</p>\n<div class=\"note warning\"><p>使用默认配置的情况下且不增加类的情况下，我们是没有办法刷新 token 的。</p>\n</div>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这个部分是我们最基础的部分，也是最为简单的部分，使用 spring boot oauth 的自动配置完成了简单的授权服务器和资源服务器的配置， 通过这两个服务器的配置就可以快速搭建起来 oauth2 的授权流程，为我们省掉了很多麻烦事儿，当然，自动配置有好处也有坏处，由于他自动帮我们配置好了很多，能满足很多的小型应用的需求了。但是要求总是在变化的，所以有些不符合我们要求的地方我们需要去自己自定义的，下面我们就要进入 spring security oauth2 完整自定义配置环节，分为两个部分，一个授权服务器，一个资源服务器的配置。</p>\n","categories":["java"],"tags":["Spring","Security","Oauth2"]},{"title":"Spring Security Oauth2 从零到一完整实践（五）自定义授权模式（手机、邮箱等）","url":"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%94%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F%EF%BC%88%E6%89%8B%E6%9C%BA%E3%80%81%E9%82%AE%E7%AE%B1%E7%AD%89%EF%BC%89/","content":"","categories":["java"],"tags":["Spring","Security","Oauth2"]},{"title":"Spring Security Oauth2 从零到一完整实践（六）踩坑记录","url":"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%85%AD%EF%BC%89%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/","content":"","categories":["java"],"tags":["Spring","Security","Oauth2"]},{"title":"Spring Security Oauth2 从零到一完整实践（四）资源服务器","url":"/Spring-Security-Oauth2-%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%8C%E6%95%B4%E5%AE%9E%E8%B7%B5%EF%BC%88%E5%9B%9B%EF%BC%89%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8/","content":"","categories":["java"],"tags":["Spring","Security","Oauth2"]},{"title":"Welcome to the NexT Organization!","url":"/hexo-theme-next/","content":"<p>Welcome to the <a href=\"/docs/\">NexT</a> documentation site! NexT is a high quality elegant theme for <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo<i class=\"fa fa-external-link-alt\"></i></span>. It is crafted from scratch, with love.</p>\n<h3 id=\"User-Guide\"><a href=\"#User-Guide\" class=\"headerlink\" title=\"User Guide\"></a>User Guide</h3><p>It&#39;s easy to set up NexT theme. Just follow <a href=\"/docs/getting-started/\">documentation</a> and create your personal website!</p>\n<h3 id=\"Feedback\"><a href=\"#Feedback\" class=\"headerlink\" title=\"Feedback\"></a>Feedback</h3><ul>\n<li>Visit the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvYXdlc29tZS1uZXh0\">Awesome NexT<i class=\"fa fa-external-link-alt\"></i></span> list to share plugins and tutorials with other users.</li>\n<li>Join our <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXR0ZXIuaW0vaGV4by1uZXh0\">Gitter<i class=\"fa fa-external-link-alt\"></i></span> chats.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcm93ZGluLmNvbS9wcm9qZWN0L2hleG8tdGhlbWUtbmV4dA==\">Add or improve translation<i class=\"fa fa-external-link-alt\"></i></span> in few seconds.</li>\n<li>Report a bug in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L2lzc3Vlcy9uZXc/YXNzaWduZWVzPSZsYWJlbHM9QnVnJnRlbXBsYXRlPWJ1Zy1yZXBvcnQubWQ=\">GitHub Issues<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n<li>Request a new feature on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L2lzc3Vlcy9uZXc/YXNzaWduZWVzPSZsYWJlbHM9RmVhdHVyZStSZXF1ZXN0JnRlbXBsYXRlPWZlYXR1cmUtcmVxdWVzdC5tZA==\">GitHub<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n<li>Vote for <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L2lzc3Vlcz9xPWlzOm9wZW4raXM6aXNzdWUrbGFiZWw6JTIyRmVhdHVyZStSZXF1ZXN0JTIy\">popular feature requests<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n</ul>\n"},{"title":"hexo相关","url":"/hexo%E7%9B%B8%E5%85%B3/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h1 id=\"1-Math\"><a href=\"#1-Math\" class=\"headerlink\" title=\"1 Math\"></a>1 Math</h1><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC85YjljMjQxMTQ2YmM=\">Hexo渲染LaTeX公式<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20vdGhpcmQtcGFydHktc2VydmljZXMuaHRtbCNtYXRoamF4\">MathJax-配置<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>__禁止markdown对<code>-</code>、<code>\\\\</code>、<code>\\&#123;</code>、<code>\\&#125;</code>等进行转义__：修改配置文件<code>node_modules/marked/lib/marked.js</code></p>\n<p>将</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">escape: /^\\\\([\\\\`*&#123;&#125;\\[\\]()# +\\-.!_&gt;])/,</span><br></pre></td></tr></table></figure>\n\n<p>替换为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">escape: /^\\\\([`*\\[\\]()# +\\-.!_&gt;])/,</span><br></pre></td></tr></table></figure>\n\n<p>将</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">em: /^\\b_((?:[^_]|__)+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,</span><br></pre></td></tr></table></figure>\n\n<p>替换为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">em: /^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-来必力评论系统\"><a href=\"#2-来必力评论系统\" class=\"headerlink\" title=\"2 来必力评论系统\"></a>2 来必力评论系统</h1><p><span class=\"exturl\" data-url=\"aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20vdGhpcmQtcGFydHktc2VydmljZXMuaHRtbCNsaXZlcmU=\">来必力-配置<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h1 id=\"3-mermaid流程图\"><a href=\"#3-mermaid流程图\" class=\"headerlink\" title=\"3 mermaid流程图\"></a>3 mermaid流程图</h1><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dlYmFwcGRldmVscC9oZXhvLWZpbHRlci1tZXJtYWlkLWRpYWdyYW1z\">hexo-filter-mermaid-diagrams<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><strong>步骤1：安装插件</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-filter-mermaid-diagrams --save</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤2：修改主题配置文件<code>themes/next/_config.yml</code>，找到<code>mermaid</code>的配置项，将<code>enable</code>改为true即可</strong></p>\n<h2 id=\"3-1-效果：横向流程图\"><a href=\"#3-1-效果：横向流程图\" class=\"headerlink\" title=\"3.1 效果：横向流程图\"></a>3.1 效果：横向流程图</h2><p><strong>源码：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">graph LR</span><br><span class=\"line\">A[方形] --&gt;B(圆角)</span><br><span class=\"line\">    B --&gt; C&#123;条件a&#125;</span><br><span class=\"line\">    C --&gt;|a=1| D[结果1]</span><br><span class=\"line\">    C --&gt;|a=2| E[结果2]</span><br><span class=\"line\">    F[横向流程图]</span><br></pre></td></tr></table></figure>\n\n<p><strong>渲染后：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">graph LR</span><br><span class=\"line\">A[方形] --&gt;B(圆角)</span><br><span class=\"line\">    B --&gt; C&#123;条件a&#125;</span><br><span class=\"line\">    C --&gt;|a=1| D[结果1]</span><br><span class=\"line\">    C --&gt;|a=2| E[结果2]</span><br><span class=\"line\">    F[横向流程图]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-效果：竖向流程图\"><a href=\"#3-2-效果：竖向流程图\" class=\"headerlink\" title=\"3.2 效果：竖向流程图\"></a>3.2 效果：竖向流程图</h2><p><strong>源码：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">graph TD</span><br><span class=\"line\">A[方形] --&gt; B(圆角)</span><br><span class=\"line\">    B --&gt; C&#123;条件a&#125;</span><br><span class=\"line\">    C --&gt; |a=1| D[结果1]</span><br><span class=\"line\">    C --&gt; |a=2| E[结果2]</span><br><span class=\"line\">    F[竖向流程图]</span><br></pre></td></tr></table></figure>\n\n<p><strong>渲染后：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">graph TD</span><br><span class=\"line\">A[方形] --&gt; B(圆角)</span><br><span class=\"line\">    B --&gt; C&#123;条件a&#125;</span><br><span class=\"line\">    C --&gt; |a=1| D[结果1]</span><br><span class=\"line\">    C --&gt; |a=2| E[结果2]</span><br><span class=\"line\">    F[竖向流程图]</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-plantuml时序图\"><a href=\"#4-plantuml时序图\" class=\"headerlink\" title=\"4 plantuml时序图\"></a>4 plantuml时序图</h1><p><strong>步骤1：安装插件</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-filter-plantuml --save</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-1-效果\"><a href=\"#4-1-效果\" class=\"headerlink\" title=\"4.1 效果\"></a>4.1 效果</h2><p><strong>源码：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">skinparam backgroundColor #EEEBDC</span><br><span class=\"line\">skinparam handwritten true</span><br><span class=\"line\"></span><br><span class=\"line\">skinparam sequence &#123;</span><br><span class=\"line\">\tArrowColor DeepSkyBlue</span><br><span class=\"line\">\tActorBorderColor DeepSkyBlue</span><br><span class=\"line\">\tLifeLineBorderColor blue</span><br><span class=\"line\">\tLifeLineBackgroundColor #A9DCDF</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tParticipantBorderColor DeepSkyBlue</span><br><span class=\"line\">\tParticipantBackgroundColor DodgerBlue</span><br><span class=\"line\">\tParticipantFontName Impact</span><br><span class=\"line\">\tParticipantFontSize 17</span><br><span class=\"line\">\tParticipantFontColor #A9DCDF</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tActorBackgroundColor aqua</span><br><span class=\"line\">\tActorFontColor DeepSkyBlue</span><br><span class=\"line\">\tActorFontSize 17</span><br><span class=\"line\">\tActorFontName Aapex</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">actor User</span><br><span class=\"line\">box &quot;foo1&quot;</span><br><span class=\"line\">participant &quot;First Class&quot; as A</span><br><span class=\"line\">end box</span><br><span class=\"line\">box &quot;foo2&quot;</span><br><span class=\"line\">participant &quot;Second Class&quot; as B</span><br><span class=\"line\">end box</span><br><span class=\"line\">box &quot;foo3&quot;</span><br><span class=\"line\">participant &quot;Last Class&quot; as C</span><br><span class=\"line\">end box</span><br><span class=\"line\"></span><br><span class=\"line\">User -&gt; A: DoWork</span><br><span class=\"line\">activate A</span><br><span class=\"line\"></span><br><span class=\"line\">A -&gt; B: Create Request</span><br><span class=\"line\">activate B</span><br><span class=\"line\"></span><br><span class=\"line\">B -&gt; C: DoWork</span><br><span class=\"line\">activate C</span><br><span class=\"line\">C --&gt; B: WorkDone</span><br><span class=\"line\">destroy C</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; A: Request Created</span><br><span class=\"line\">deactivate B</span><br><span class=\"line\"></span><br><span class=\"line\">A --&gt; User: Done</span><br><span class=\"line\">deactivate A</span><br></pre></td></tr></table></figure>\n\n<p><strong>渲染后：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">skinparam backgroundColor #EEEBDC</span><br><span class=\"line\">skinparam handwritten true</span><br><span class=\"line\"></span><br><span class=\"line\">skinparam sequence &#123;</span><br><span class=\"line\">\tArrowColor DeepSkyBlue</span><br><span class=\"line\">\tActorBorderColor DeepSkyBlue</span><br><span class=\"line\">\tLifeLineBorderColor blue</span><br><span class=\"line\">\tLifeLineBackgroundColor #A9DCDF</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tParticipantBorderColor DeepSkyBlue</span><br><span class=\"line\">\tParticipantBackgroundColor DodgerBlue</span><br><span class=\"line\">\tParticipantFontName Impact</span><br><span class=\"line\">\tParticipantFontSize 17</span><br><span class=\"line\">\tParticipantFontColor #A9DCDF</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tActorBackgroundColor aqua</span><br><span class=\"line\">\tActorFontColor DeepSkyBlue</span><br><span class=\"line\">\tActorFontSize 17</span><br><span class=\"line\">\tActorFontName Aapex</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">actor User</span><br><span class=\"line\">box &quot;foo1&quot;</span><br><span class=\"line\">participant &quot;First Class&quot; as A</span><br><span class=\"line\">end box</span><br><span class=\"line\">box &quot;foo2&quot;</span><br><span class=\"line\">participant &quot;Second Class&quot; as B</span><br><span class=\"line\">end box</span><br><span class=\"line\">box &quot;foo3&quot;</span><br><span class=\"line\">participant &quot;Last Class&quot; as C</span><br><span class=\"line\">end box</span><br><span class=\"line\"></span><br><span class=\"line\">User -&gt; A: DoWork</span><br><span class=\"line\">activate A</span><br><span class=\"line\"></span><br><span class=\"line\">A -&gt; B: Create Request</span><br><span class=\"line\">activate B</span><br><span class=\"line\"></span><br><span class=\"line\">B -&gt; C: DoWork</span><br><span class=\"line\">activate C</span><br><span class=\"line\">C --&gt; B: WorkDone</span><br><span class=\"line\">destroy C</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; A: Request Created</span><br><span class=\"line\">deactivate B</span><br><span class=\"line\"></span><br><span class=\"line\">A --&gt; User: Done</span><br><span class=\"line\">deactivate A</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5-flow流程图\"><a href=\"#5-flow流程图\" class=\"headerlink\" title=\"5 flow流程图\"></a>5 flow流程图</h1><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1Ymtvby9oZXhvLWZpbHRlci1mbG93Y2hhcnQ=\">hexo-filter-flowchart<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><strong>步骤1：安装插件</strong></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-filter-flowchart --save </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-1-效果：纵向流程图\"><a href=\"#5-1-效果：纵向流程图\" class=\"headerlink\" title=\"5.1 效果：纵向流程图\"></a>5.1 效果：纵向流程图</h2><p><strong>源码：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">st=&gt;start: 开始框</span><br><span class=\"line\">op=&gt;operation: 处理框</span><br><span class=\"line\">cond=&gt;condition: 判断框(是或否?)</span><br><span class=\"line\">sub1=&gt;subroutine: 子流程</span><br><span class=\"line\">io=&gt;inputoutput: 输入输出框</span><br><span class=\"line\">e=&gt;end: 结束框</span><br><span class=\"line\">st-&gt;op-&gt;cond</span><br><span class=\"line\">cond(yes)-&gt;io-&gt;e</span><br><span class=\"line\">cond(no)-&gt;sub1(right)-&gt;op</span><br></pre></td></tr></table></figure>\n\n<p><strong>渲染后：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">st=&gt;start: 开始框</span><br><span class=\"line\">op=&gt;operation: 处理框</span><br><span class=\"line\">cond=&gt;condition: 判断框(是或否?)</span><br><span class=\"line\">sub1=&gt;subroutine: 子流程</span><br><span class=\"line\">io=&gt;inputoutput: 输入输出框</span><br><span class=\"line\">e=&gt;end: 结束框</span><br><span class=\"line\">st-&gt;op-&gt;cond</span><br><span class=\"line\">cond(yes)-&gt;io-&gt;e</span><br><span class=\"line\">cond(no)-&gt;sub1(right)-&gt;op</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-效果：横向流程图\"><a href=\"#5-2-效果：横向流程图\" class=\"headerlink\" title=\"5.2 效果：横向流程图\"></a>5.2 效果：横向流程图</h2><p><strong>源码：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">st=&gt;start: 开始框</span><br><span class=\"line\">op=&gt;operation: 处理框</span><br><span class=\"line\">cond=&gt;condition: 判断框(是或否?)</span><br><span class=\"line\">sub1=&gt;subroutine: 子流程</span><br><span class=\"line\">io=&gt;inputoutput: 输入输出框</span><br><span class=\"line\">e=&gt;end: 结束框</span><br><span class=\"line\">st(right)-&gt;op(right)-&gt;cond</span><br><span class=\"line\">cond(yes)-&gt;io(bottom)-&gt;e</span><br><span class=\"line\">cond(no)-&gt;sub1(right)-&gt;op</span><br></pre></td></tr></table></figure>\n\n<p><strong>渲染后：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">st=&gt;start: 开始框</span><br><span class=\"line\">op=&gt;operation: 处理框</span><br><span class=\"line\">cond=&gt;condition: 判断框(是或否?)</span><br><span class=\"line\">sub1=&gt;subroutine: 子流程</span><br><span class=\"line\">io=&gt;inputoutput: 输入输出框</span><br><span class=\"line\">e=&gt;end: 结束框</span><br><span class=\"line\">st(right)-&gt;op(right)-&gt;cond</span><br><span class=\"line\">cond(yes)-&gt;io(bottom)-&gt;e</span><br><span class=\"line\">cond(no)-&gt;sub1(right)-&gt;op</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6-sequence时序图\"><a href=\"#6-sequence时序图\" class=\"headerlink\" title=\"6 sequence时序图\"></a>6 sequence时序图</h1><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1Ymtvby9oZXhvLWZpbHRlci1zZXF1ZW5jZQ==\">hexo-filter-sequence<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h1 id=\"7-目录功能\"><a href=\"#7-目录功能\" class=\"headerlink\" title=\"7 目录功能\"></a>7 目录功能</h1><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1Ymtvby9oZXhvLXRvYw==\">hexo-toc<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h1 id=\"8-访问统计\"><a href=\"#8-访问统计\" class=\"headerlink\" title=\"8 访问统计\"></a>8 访问统计</h1><p><span class=\"exturl\" data-url=\"aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20vdGhpcmQtcGFydHktc2VydmljZXMuaHRtbCNhbmFseXRpY3MtdGVuY2VudC1tdGE=\">阅读次数统计-配置<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZXNpb24uY29tL2FydGljbGUvNjM5OTQyODgzNS8=\">解决使用LEANCLOUD配置NEXT主题文章浏览量显示不正常的问题<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnF1c3QuY2MvYXJjaGl2ZXMvNDg2NjUuaHRtbA==\">Hexo Next主题 使用LeanCloud统计文章阅读次数、添加热度排行页面<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>编辑<code>主题</code>配置文件</p>\n<ol>\n<li>关闭<code>leancloud_visitors</code>配置<ul>\n<li><code>enable</code>置为false</li>\n</ul>\n</li>\n<li>打开<code>valine</code>配置<ul>\n<li><code>enable</code>设置为true</li>\n<li>配置<code>appid</code>以及<code>appkey</code></li>\n<li><code>visitor</code>设置为true</li>\n</ul>\n</li>\n</ol>\n<p>编辑<code>站点</code>配置文件</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\"><span class=\"string\">...</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">leancloud_counter_security_sync</span></span><br><span class=\"line\"><span class=\"string\">...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">leancloud_counter_security:</span></span><br><span class=\"line\">  <span class=\"attr\">enable_sync:</span> <span class=\"literal\">true</span> <span class=\"comment\"># 先关了，开启有问题，总是报`Too many requests. [429 GET https://qhehlume.api.lncld.net/1.1/classes/Counter]`</span></span><br><span class=\"line\">  <span class=\"attr\">app_id:</span> <span class=\"string\">xxx</span></span><br><span class=\"line\">  <span class=\"attr\">app_key:</span> <span class=\"string\">xxx</span></span><br><span class=\"line\">  <span class=\"attr\">server_url:</span> <span class=\"string\">https://leancloud.cn</span> <span class=\"comment\"># 内地region需要配置这个</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">&#x27;liuyehcf&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&#x27;19930101&#x27;</span> <span class=\"comment\"># 究极大坑，这里需要用引号</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"9-本地搜索\"><a href=\"#9-本地搜索\" class=\"headerlink\" title=\"9 本地搜索\"></a>9 本地搜索</h1><p><span class=\"exturl\" data-url=\"aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20vdGhpcmQtcGFydHktc2VydmljZXMuaHRtbCNsb2NhbC1zZWFyY2g=\">本地搜索-配置<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudjJleC5jb20vYW1wL3QvMjk4NzI3\">搜索失效<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzYxNjM4ODU5\">Mac 上的 VSCode 编写 Markdown 总是出现隐藏字符？<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h1 id=\"10-背景动画\"><a href=\"#10-背景动画\" class=\"headerlink\" title=\"10 背景动画\"></a>10 背景动画</h1><p><span class=\"exturl\" data-url=\"aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20vdGhlbWUtc2V0dGluZ3MuaHRtbCN1c2UtYmctYW5pbWF0aW9u\">背景动画-配置<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h1 id=\"11-增加菜单\"><a href=\"#11-增加菜单\" class=\"headerlink\" title=\"11 增加菜单\"></a>11 增加菜单</h1><p><code>hexo new page &quot;explore&quot;</code></p>\n<p>修改主题配置文件<code>/themes/next/_config.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">menu:</span><br><span class=\"line\">  home: / || home</span><br><span class=\"line\">  about: /about/ || user</span><br><span class=\"line\">  tags: /tags/ || tags</span><br><span class=\"line\">  categories: /categories/ || th</span><br><span class=\"line\">  archives: /archives/ || archive</span><br><span class=\"line\">  explore: /explore/ || sitemap # 添加这个</span><br></pre></td></tr></table></figure>\n\n<p>修改国际化配置文件<code>/themes/next/languages/_en.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">menu:</span><br><span class=\"line\">  home: Home</span><br><span class=\"line\">  archives: Archives</span><br><span class=\"line\">  categories: Categories</span><br><span class=\"line\">  tags: Tags</span><br><span class=\"line\">  about: About</span><br><span class=\"line\">  explore: Explore  # 添加这个</span><br><span class=\"line\">  search: Search</span><br><span class=\"line\">  schedule: Schedule</span><br><span class=\"line\">  sitemap: Sitemap</span><br><span class=\"line\">  commonweal: Commonweal 404</span><br></pre></td></tr></table></figure>\n\n<p>修改国际化配置文件<code>/themes/next/languages/zh-CN.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">menu:</span><br><span class=\"line\">  home: 首页</span><br><span class=\"line\">  archives: 归档</span><br><span class=\"line\">  categories: 分类</span><br><span class=\"line\">  tags: 标签</span><br><span class=\"line\">  about: 关于</span><br><span class=\"line\">  explore: 发现  # 添加这个</span><br><span class=\"line\">  search: 搜索</span><br><span class=\"line\">  schedule: 日程表</span><br><span class=\"line\">  sitemap: 站点地图</span><br><span class=\"line\">  commonweal: 公益404</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"12-hexo相关的项目\"><a href=\"#12-hexo相关的项目\" class=\"headerlink\" title=\"12 hexo相关的项目\"></a>12 hexo相关的项目</h1><table>\n<thead>\n<tr>\n<th align=\"left\">项目</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpdHRlbi9oZXhvLXRoZW1lLXlpbGlh\">theme-yilia<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo主题</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0\">theme-next<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo主题</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1Ymtvby9oZXhvLWZpbHRlci1zZXF1ZW5jZQ==\">hexo-filter-sequence<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo插件-序列图</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dlYmFwcGRldmVscC9oZXhvLWZpbHRlci1tZXJtYWlkLWRpYWdyYW1z\">hexo-filter-mermaid-diagrams<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo插件-序列图</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dhZmVyLWxpL2hleG8tZmlsdGVyLXBsYW50dW1s\">hexo-filter-plantuml<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo插件-高级时序图</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1Ymtvby9oZXhvLWZpbHRlci1mbG93Y2hhcnQ=\">hexo-filter-flowchart<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo插件-流程图</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J1Ymtvby9oZXhvLXRvYw==\">hexo-toc<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo插件-目录</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dpbGxpbi9oZXhvLXdvcmRjb3VudA==\">hexo-wordcount<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">hexo插件-字数统计</td>\n</tr>\n<tr>\n<td align=\"left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by1zeW1ib2xzLWNvdW50LXRpbWU=\">hexo-symbols-count-time<i class=\"fa fa-external-link-alt\"></i></span></td>\n<td align=\"left\">阅读时间统计</td>\n</tr>\n</tbody></table>\n<h1 id=\"13-取消侧栏编号\"><a href=\"#13-取消侧栏编号\" class=\"headerlink\" title=\"13 取消侧栏编号\"></a>13 取消侧栏编号</h1><p>主题配置文件修改如下配置，将number改为false即可</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">toc:</span><br><span class=\"line\">  <span class=\"built_in\">enable</span>: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Automatically add list number to toc.</span></span><br><span class=\"line\">  number: <span class=\"literal\">false</span> </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># If true, all words will placed on next lines if header width longer then sidebar width.</span></span><br><span class=\"line\">  wrap: <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"14-修改行内代码样式\"><a href=\"#14-修改行内代码样式\" class=\"headerlink\" title=\"14 修改行内代码样式\"></a>14 修改行内代码样式</h1><p><del>修改方式1（这个方式在最新的next版本中好像失效了）：在<code>themes/next/source/css/_custom/custom.styl</code>中增加如下代码</del></p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">// Custom styles.</span><br><span class=\"line\"><span class=\"selector-tag\">code</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#C33258</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#F9F2F4</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>修改方式2：在<code>themes/next/source/css/_common/scaffolding/highlight/highlight.styl</code>中修改<code>code</code>的样式定义</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">// Custom styles.</span><br><span class=\"line\"><span class=\"selector-tag\">code</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#C33258</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#F9F2F4</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"15-修改链接样式\"><a href=\"#15-修改链接样式\" class=\"headerlink\" title=\"15 修改链接样式\"></a>15 修改链接样式</h1><p>链接即如下的语法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% post_link &lt;文章名&gt; %&#125;</span><br><span class=\"line\">[description](url)</span><br></pre></td></tr></table></figure>\n\n<p>修改方式：在<code>themes\\next\\source\\css\\_common\\components\\post\\post.styl</code>中增加如下代码</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 文章链接文本样式</span><br><span class=\"line\"><span class=\"selector-class\">.post-body</span> <span class=\"selector-tag\">p</span> <span class=\"selector-tag\">a</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#0593d3</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-bottom</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#0593d3</span>;</span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#fc6423</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom</span>: none;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#fc6423</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"16-deploy\"><a href=\"#16-deploy\" class=\"headerlink\" title=\"16 deploy\"></a>16 deploy</h1><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>\n\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTM1NjExL2FydGljbGUvZGV0YWlscy8xMDYzMDkzMzU=\">nodejs更新后hexo没法deploy<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h1 id=\"17-参考\"><a href=\"#17-参考\" class=\"headerlink\" title=\"17 参考\"></a>17 参考</h1><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20vZ2V0dGluZy1zdGFydGVkLmh0bWw=\">next官方文档<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZW1wdHlzZXQxMTAvYXJ0aWNsZS9kZXRhaWxzLzUwMTIzMjMx\">搭建一个支持LaTEX的hexo博客<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5qaWFuc2h1LmNvbS9wLzZjMTE5NmYxMjMwMg==\">用 Hexo 搭建个人博客-02：进阶试验<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9hMjMzMDkzN2RlNmM=\">Hexo文章简单加密访问<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAwOTU0NDkyNA==\">hexo的next主题个性化配置教程<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb250YXdlc29tZS5jb20vaWNvbnM/ZD1nYWxsZXJ5\">icon库<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFmZXJ4Lm9ubGluZS8yMDE4LzAyLzExL2xjLXNlY3VyaXR5Lw==\">Leancloud访客统计插件重大安全漏洞修复指南<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3NoZW56ZWt1bi5jbi9oZXhvJUU3JTlBJTg0bmV4dCVFNCVCOCVCQiVFOSVBMiU5OCVFNCVCOCVBQSVFNiU4MCVBNyVFNSU4QyU5NiVFOSU4NSU4RCVFNyVCRCVBRSVFNiU5NSU5OSVFNyVBOCU4Qi5odG1s\">hexo的next主题个性化教程:打造炫酷网站<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dhZmVyLWxpL2hleG8tZmlsdGVyLXBsYW50dW1s\">hexo-filter-plantuml<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3BsYW50dW1sLmNvbS9zZXF1ZW5jZS1kaWFncmFt\">时序图<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90eWxvYWZlci5naXRodWIuaW8vcG9zdHMvNzc5MC8=\">Hexo中引入Mermaid流程图<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n","categories":["Hexo"],"tags":["Hexo"]},{"title":"post-title","url":"/post-title/","content":"<p><span id=\"more\"></span>\n\n<h1 id=\"标题一\"><a href=\"#标题一\" class=\"headerlink\" title=\"标题一\"></a>标题一</h1><h2 id=\"标题二\"><a href=\"#标题二\" class=\"headerlink\" title=\"标题二\"></a>标题二</h2><h3 id=\"标题三\"><a href=\"#标题三\" class=\"headerlink\" title=\"标题三\"></a>标题三</h3><h4 id=\"标题四\"><a href=\"#标题四\" class=\"headerlink\" title=\"标题四\"></a>标题四</h4><h5 id=\"标题五\"><a href=\"#标题五\" class=\"headerlink\" title=\"标题五\"></a>标题五</h5><p><strong>这是加粗</strong></p>\n<p><em>这是斜体</em></p>\n<p><del>这是横线</del></p>\n<ul>\n<li>无序列表</li>\n<li>无序列表</li>\n</ul>\n<ol>\n<li>有序列表1</li>\n<li>有序列表2</li>\n</ol>\n<p><code>内嵌代码</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">代码块</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>引用</p>\n</blockquote>\n","categories":["Markdown"],"tags":["原创"]},{"title":"二级缓存: Caffeine + Redis","url":"/%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98-Caffeine-Redis/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h2 id=\"J2Cache\"><a href=\"#J2Cache\" class=\"headerlink\" title=\"J2Cache\"></a>J2Cache</h2><p>Java 两级缓存框架，可以让应用支持两级缓存框架 ehcache(Caffeine) + redis 。避免完全使用独立缓存系统所带来的网络IO开销问题。</p>\n<p>不少人看到 J2Cache 第一眼时，会认为这就是一个普普通通的缓存框架，和例如 Ehcache、Caffeine、Spring Cache 之类的项目没什么区别，无非是造了一个新轮子而已。事实上完全不是一回事！</p>\n<p>目前缓存的解决方案一般有两种：</p>\n<ul>\n<li>内存缓存（如 Caffeine） ———— 速度快，进程内可用</li>\n<li>集中式缓存（如 Redis） ———— 可同时为多节点提供服务</li>\n</ul>\n<p>现有的缓存框架已经非常成熟而且优秀，J2Cache 无心造一个新轮子，它要解决的几个问题如下：</p>\n<ol>\n<li>使用内存缓存时，一旦应用重启后，由于缓存数据丢失，缓存雪崩，给数据库造成巨大压力，导致应用堵塞</li>\n<li>使用内存缓存时，多个应用节点无法共享缓存数据</li>\n<li>使用集中式缓存，由于大量的数据通过缓存获取，导致缓存服务的数据吞吐量太大，带宽跑满。现象就是 Redis 服务负载不高，但是由于机器网卡带宽跑满，导致数据读取非常慢</li>\n</ol>\n<p>在遭遇问题1、2时，很多人自然而然会想到使用 Redis 来缓存数据，因此就难以避免地导致了问题3的发生。</p>\n<p>当发生问题3时，又有很多人想到 Redis 集群，通过集群来降低缓存服务的压力，特别是带宽压力。</p>\n<p>但其实，这个时候的 Redis 上的数据量并不一定大，仅仅是数据的吞吐量大而已。</p>\n<h2 id=\"咱们假设这样一个场景：\"><a href=\"#咱们假设这样一个场景：\" class=\"headerlink\" title=\"咱们假设这样一个场景：\"></a>咱们假设这样一个场景：</h2><p>有这么一个网站，某个页面每天的访问量是 1000 万，每个页面从缓存读取的数据是 50K 。缓存数据存放在一个 Redis 服务，机器使用千兆网卡。那么这个 Redis 一天要承受 500G 的数据流，相当于平均每秒钟是 5.78M 的数据。而网站一般都会有高峰期和低峰期，两个时间流量的差异可能是百倍以上。我们假设高峰期每秒要承受的流量比平均值高 50 倍，也就是说高峰期 Redis 服务每秒要传输超过 250 兆的数据。请注意这个 250 兆的单位是 <code>byte</code> ，而千兆网卡的单位是 <code>bit</code> ，你懂了吗？这已经远远超过 Redis 服务的网卡带宽。</p>\n<p>所以如果你能发现这样的问题，一般你会这么做：</p>\n<ol>\n<li>升级到万兆网卡 ———— 这个有多麻烦，相信很多人知道，特别是一些云主机根本没有万兆网卡给你使用</li>\n<li>多个 Redis 搭建集群，将流量分摊到多台机器上</li>\n</ol>\n<p>如果你采用第2钟方法来解决上述的场景中碰到的问题，那么你最好准备 5 个 Redis服务来支撑。在缓存服务这块成本直接攀升了 5 倍。你有钱当然没任何问题，但是结构就变得非常复杂了，而且可能你缓存的数据量其实不大，1000 万高频次的缓存读写 Redis 也能轻松应付，可是因为带宽的问题，你不得不付出 5 倍的成本。</p>\n<h2 id=\"那么-J2Cache-的用武之处就在这里\"><a href=\"#那么-J2Cache-的用武之处就在这里\" class=\"headerlink\" title=\"那么 J2Cache 的用武之处就在这里\"></a>那么 J2Cache 的用武之处就在这里</h2><p>如果我们不用每次页面访问的时候都去 Redis 读取数据，那么 Redis 上的数据流量至少降低 1000 倍甚至更多，以至于一台 Redis 可以轻松应付。</p>\n<p>J2Cache 其实不是一个缓存框架，它是一个缓存框架的桥梁。它利用现有优秀的内存缓存框架作为一级缓存，而把 Redis 作为二级缓存。所有数据的读取先从一级缓存中读取，不存在时再从二级缓存读取，这样来确保对二级缓存 Redis 的访问次数降到最低。</p>\n<p>有人会质疑说，那岂不是应用节点的内存占用要飙升？我的答案是 ———— 现在服务器的内存都是几十 G 打底，多则百 G 数百 G，这点点的内存消耗完全不在话下。其次一级缓存框架可以通过配置来控制在内存中存储的数据量，所以不用担心内存溢出的问题。</p>\n<p>剩下的另外一个问题就是，当缓存数据更新的时候，怎么确保每个节点内存中的数据是一致的。而这一点算你问到点子上了，这恰恰是 J2Cache 的核心所在。</p>\n<p>J2Cache 目前提供两种节点数据同步方案 ———— Redis Pub&#x2F;Sub 和 JGroups 。当某个节点的缓存数据需要更新时，J2Cache 会通过 Redis 的消息订阅机制或者是 JGroups 的组播来通知集群内其他节点。当其他节点收到缓存数据更新的通知时，它会清掉自己内存里的数据，然后重新从 Redis 中读取最新数据。</p>\n<p><img src=\"https://oscimg.oschina.net/oscnet/83c677448a6613ea51ff00290eabf78900e.jpg\" loading=\"lazy\"></p>\n<p>这就完成了 J2Cache 缓存数据读写的闭环。</p>\n<h2 id=\"为什么不用-Ehcache-的集群方案？\"><a href=\"#为什么不用-Ehcache-的集群方案？\" class=\"headerlink\" title=\"为什么不用 Ehcache 的集群方案？\"></a>为什么不用 Ehcache 的集群方案？</h2><p>对 Ehcache 比较熟悉的人还会问的就是这个问题，Ehcache 本身是提供集群模式的，可以在多个节点同步缓存数据。但是 Ehcache 的做法是将整个缓存数据在节点间进行传输。如咱们前面的说的，一个页面需要读取 50K 的缓存数据，当这 50K 的缓存数据有更新时，那么需要在几个节点间传递整个 50K 的数据。这也会造成应用节点间大量的数据传输，这个情况完全不可控。</p>\n<p>补充：当然这个单个数据传输量本身并不比使用 J2Cache 多，但是 ehcache 利用 jgroups 来同步数据的做法，在实际测试过程中发现可靠性还是略低，而且 jgroups 的同步数据在云主机上无法使用。</p>\n<p>而 J2Cache 传输的仅仅是缓存的 key 而已，因此相比 Ehcache 的集群模式，J2Cache 要传输的数据及其小，对节点间的数据通信完全不会产生大的影响。</p>\n<p>本文转载自：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9teS5vc2NoaW5hLm5ldC9qYXZheW91L2Jsb2cvMTkzMTM4MQ==\">https://my.oschina.net/javayou/blog/1931381<i class=\"fa fa-external-link-alt\"></i></span></p>\n","categories":["J2Cache"],"tags":["Redis","Cache","二级缓存","Caffeine"]},{"title":"二级缓存中的 Region 到底是什么？","url":"/%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%B8%AD%E7%9A%84-Region-%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/","content":"<p>\n\n<span id=\"more\"></span>\n\n<p>不时有人来询问 J2Cache 里的 Region 到底是什么概念，这里做统一的解答。</p>\n<p>J2Cache 的 Region 来源于 Ehcache 的 Region 概念。</p>\n<p>一般我们在使用像 Redis、Caffeine、Guava Cache 时都没有 Region 这样的概念，特别是 Redis 是一个大哈希表，更没有这个概念。</p>\n<p>在实际的缓存场景中，不同的数据会有不同的 TTL 策略，例如有些缓存数据可以永不失效，而有些缓存我们希望是 30 分钟的有效期，有些是 60 分钟等不同的失效时间策略。在 Redis 我们可以针对不同的 key 设置不同的 TTL 时间。但是一般的 Java 内存缓存框架（如 Ehcache、Caffeine、Guava Cache 等），它没法为每一个 key 设置不同 TTL，因为这样管理起来会非常复杂，而且会检查缓存数据是否失效时性能极差。所以一般内存缓存框架会把一组相同 TTL 策略的缓存数据放在一起进行管理。</p>\n<p>J2Cache 的 Region 概念对应关系如下所示：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Ehcache</th>\n<th align=\"center\">region</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Caffeine</td>\n<td align=\"center\">Cache</td>\n</tr>\n<tr>\n<td align=\"center\">Guava Cache</td>\n<td align=\"center\">Cache</td>\n</tr>\n</tbody></table>\n<p>像 Caffeine 和 Guava Cache 在存放缓存数据时需要先构建一个 Cache 实例，设定好缓存的时间策略，如下代码所示：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Caffeine&lt;Object, Object&gt; caffeine = Caffeine.newBuilder();</span><br><span class=\"line\">caffeine = caffeine.maximumSize(size).expireAfterWrite(expire, TimeUnit.SECONDS);</span><br><span class=\"line\">Cache&lt;String, Object&gt; theCache = caffeine.build();</span><br></pre></td></tr></table></figure>\n\n<p>这时候你才可以往 theCache 写入缓存数据，而不能再单独针对某一个 key 设定不同的 TTL 时间。</p>\n<p>而 Redis 可以让你非常随意的给不同的 key 设置不同的 TTL。</p>\n<p>J2Cache 是内存缓存和 Redis 这类集中式缓存的一个桥梁，因此它只能是兼容两者的特性。</p>\n<p>J2Cache 默认使用 Caffeine 作为一级缓存，其配置文件位于 caffeine.properties 中。一个基本使用场景如下：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#########################################</span></span><br><span class=\"line\"><span class=\"comment\"># Caffeine configuration</span></span><br><span class=\"line\"><span class=\"comment\"># [name] = size, xxxx[s|m|h|d]</span></span><br><span class=\"line\"><span class=\"comment\">#########################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">default</span> = <span class=\"string\">1000, 30m</span></span><br><span class=\"line\"><span class=\"attr\">users</span> = <span class=\"string\">2000, 10m</span></span><br><span class=\"line\"><span class=\"attr\">blogs</span> = <span class=\"string\">5000, 1h</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的配置定义了三个缓存 Region ，分别是：</p>\n<ol>\n<li>默认缓存，大小是 1000 个对象，TTL 是 30 分钟</li>\n<li>users 缓存，大小是 2000 个对象，TTL 是 10 分钟</li>\n<li>blogs 缓存，大小是 5000 个对象，TTL 是 1 个小时</li>\n</ol>\n<p>例如我们可以用 users 来存放用户对象的缓存，用 blogs 来存放博客对象缓存，两种的 TTL 是不同的。</p>\n<p>而 default 是当我们调用如下方法时：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">set</span><span class=\"params\">(String region, String key, Object value)</span></span><br></pre></td></tr></table></figure>\n\n<p>如果我们传入的 region 参数（假设为：region1）没有在 caffeine.properties 中定义的话，那 J2Cache 会自动创建一个名为 region1 的缓存 Region，其配置和 default 的配置一致。</p>\n<p>所以要用好缓存首先要确保以下几点：</p>\n<ol>\n<li>根据业务规划好不同的 region 来存放不同的缓存数据</li>\n<li>根据实际情况确定每个 region 的缓存数据数量和 TTL 时间</li>\n<li>尽量必要未经定义直接使用一个全新的 region （避免使用 default 数据）</li>\n</ol>\n<p>本文转载自：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9teS5vc2NoaW5hLm5ldC9qYXZheW91L2Jsb2cvMzAzMTc3Mw==\">https://my.oschina.net/javayou/blog/3031773<i class=\"fa fa-external-link-alt\"></i></span></p>\n","categories":["J2Cache"],"tags":["Cache","二级缓存","Region"]},{"title":"如何在项目中优雅的校验参数","url":"/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BC%98%E9%9B%85%E7%9A%84%E6%A0%A1%E9%AA%8C%E5%8F%82%E6%95%B0/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h2 id=\"本文看点\"><a href=\"#本文看点\" class=\"headerlink\" title=\"本文看点\"></a>本文看点</h2><p><img src=\"https://dggtechtest.oss-cn-beijing.aliyuncs.com/93e59f718c2342dba75862c2b378139a_1357597123574648832.jpg\" loading=\"lazy\"></p>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>验证数据是贯穿所有应用程序层(从表示层到持久层)的常见任务。通常在每一层实现相同的验证逻辑，这既费时又容易出错。为了避免重复这些验证，开发人员经常将验证逻辑直接捆绑到域模型中，将域类与验证代码混在一起，这些验证代码实际上是关于类本身的元数据，与业务逻辑不相关。</p>\n<p><img src=\"https://dggtechtest.oss-cn-beijing.aliyuncs.com/e5270bc180474845beeec3471f8a34fd_1357597326994198528.png\" loading=\"lazy\"></p>\n<p>JSR 380 — Bean Validation2.0 — 定义了用于实体和方法验证的元数据模型和 API，将数据校验逻辑通过注解的形式封装在实体对象中。</p>\n<p><img src=\"https://dggtechtest.oss-cn-beijing.aliyuncs.com/72a05dcf791747fc96bc3e42cc06271a_1357597413434609664.png\" loading=\"lazy\"></p>\n<h2 id=\"关于JSR\"><a href=\"#关于JSR\" class=\"headerlink\" title=\"关于JSR\"></a>关于JSR</h2><p>JSR 是 Java Specification Requests 的缩写，意思是 Java 规范提案。是指向 JCP(Java Community Process) 提出新增一个标准化技术规范的正式请求。任何人都可以提交 JSR，以向 Java 平台增添新的 API 和服务。JSR 已成为 Java 界的一个重要标准。</p>\n<p>JSR-303 是 JAVA EE 6 中的一项子规范，后来的版本是 Bean Validation 1.1（JSR-349），目前最新版本是 Bean Validation 2.0（JSR-380），Hibernate Validator 是 Bean Validation 的参考实现 ，除了 Jakarta Bean 验证 API 定义的约束之外，Hibernate Validator 还有一些附加的 constraint；并且 spring-boot-starter-web 默认集成了 Hibernate Validator。（springboot 2.3 版本已经移除 hibernate-validator 的依赖，需要手动引入）</p>\n<p><img src=\"https://dggtechtest.oss-cn-beijing.aliyuncs.com/7e6556ed03fc4e7fad715e84955e7c02_1357577860008792064.png\" loading=\"lazy\"></p>\n<h2 id=\"为什么使用-Hibernate-Validator\"><a href=\"#为什么使用-Hibernate-Validator\" class=\"headerlink\" title=\"为什么使用 Hibernate Validator\"></a>为什么使用 Hibernate Validator</h2><ul>\n<li>提高代码整洁度</li>\n<li>验证逻辑与业务逻辑之间进行了分离，降低了程序耦合度</li>\n<li>统一且规范的验证方式，无需你再次编写重复的验证代码</li>\n<li>你将更专注于你的业务，将这些繁琐的事情统统丢在一边</li>\n</ul>\n<h2 id=\"注解介绍\"><a href=\"#注解介绍\" class=\"headerlink\" title=\"注解介绍\"></a>注解介绍</h2><h3 id=\"JSR-380内置常用注解\"><a href=\"#JSR-380内置常用注解\" class=\"headerlink\" title=\"JSR 380内置常用注解\"></a>JSR 380内置常用注解</h3><table>\n<thead>\n<tr>\n<th align=\"center\">注解</th>\n<th align=\"center\">详细信息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">@Null</td>\n<td align=\"center\">被注释的元素必须为 null</td>\n</tr>\n<tr>\n<td align=\"center\">@NotNull</td>\n<td align=\"center\">被注释的元素必须不为 null</td>\n</tr>\n<tr>\n<td align=\"center\">@AssertTrue</td>\n<td align=\"center\">被注释的元素必须为 true</td>\n</tr>\n<tr>\n<td align=\"center\">@AssertFalse</td>\n<td align=\"center\">被注释的元素必须为 false</td>\n</tr>\n<tr>\n<td align=\"center\">@Min(value)</td>\n<td align=\"center\">被注释的元素可以是字符串、数值类型，如果元素是字符串类型，将值转为BigDecimal类型，并与value属性进行比对，值必须大于等于指定的value值</td>\n</tr>\n<tr>\n<td align=\"center\">@Max(value)</td>\n<td align=\"center\">被注释的元素可以是字符串、数值类型，如果元素是字符串类型，将值转为BigDecimal类型，并与value属性进行比对，值必须小于等于指定的value值</td>\n</tr>\n<tr>\n<td align=\"center\">@DecimalMin(value)</td>\n<td align=\"center\">被注释的元素可以是字符串、数值（可以带小数点），将注解内value的值转为BigDecimal类型，必须大于等于指定的最小值（可以配置是否等于value，默认是包含的）</td>\n</tr>\n<tr>\n<td align=\"center\">@DecimalMax(value)</td>\n<td align=\"center\">被注释的元素可以是字符串、数值（可以带小数点），将注解内value的值转为BigDecimal类型，其值必须小于等于指定的最大值（可以配置是否等于value，默认是包含的）</td>\n</tr>\n<tr>\n<td align=\"center\">@Size(max, min)</td>\n<td align=\"center\">被注释的元素的大小必须在指定的范围内，可用于字符串、Collection、Map、数组等类型</td>\n</tr>\n<tr>\n<td align=\"center\">@Digits(integer, fraction)</td>\n<td align=\"center\">被注释的元素必须是一个数字，其值必须在可接受的范围内</td>\n</tr>\n<tr>\n<td align=\"center\">@Past</td>\n<td align=\"center\">被注释的元素必须是一个过去的日期</td>\n</tr>\n<tr>\n<td align=\"center\">@Future</td>\n<td align=\"center\">被注释的元素必须是一个将来的日期</td>\n</tr>\n<tr>\n<td align=\"center\">@Pattern(value)</td>\n<td align=\"center\">被注释的元素必须符合指定的正则表达式</td>\n</tr>\n<tr>\n<td align=\"center\">@Email</td>\n<td align=\"center\">被注释的元素必须是电子邮箱地址</td>\n</tr>\n<tr>\n<td align=\"center\">@NotBlank</td>\n<td align=\"center\">验证字符串非null，且trim后长度必须大于0</td>\n</tr>\n<tr>\n<td align=\"center\">@NotEmpty</td>\n<td align=\"center\">适用于String、Collection、Map或者数组不能为Null且长度或元素个数必须大于0</td>\n</tr>\n<tr>\n<td align=\"center\">@Valid</td>\n<td align=\"center\">具体作用下面会列举</td>\n</tr>\n</tbody></table>\n<h3 id=\"Hibernate-Validator-附加的-constraint\"><a href=\"#Hibernate-Validator-附加的-constraint\" class=\"headerlink\" title=\"Hibernate Validator 附加的 constraint\"></a>Hibernate Validator 附加的 constraint</h3><table>\n<thead>\n<tr>\n<th align=\"center\">注解</th>\n<th align=\"center\">详细信息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">@Length</td>\n<td align=\"center\">被注释的字符串的大小必须在指定的范围内</td>\n</tr>\n<tr>\n<td align=\"center\">@URL</td>\n<td align=\"center\">根据RFC2396标准校验注释的字符串必须是一个的有效的url</td>\n</tr>\n<tr>\n<td align=\"center\">@Range</td>\n<td align=\"center\">被注释的元素必须在合适的范围内，应用于数值或字符串</td>\n</tr>\n<tr>\n<td align=\"center\">@UniqueElements</td>\n<td align=\"center\">检查带注释的集合是否只包含唯一的元素。相等性是使用equals()方法确定的</td>\n</tr>\n<tr>\n<td align=\"center\">@SafeHtml</td>\n<td align=\"center\">检查带注释的值是否包含潜在的恶意片段，如&lt;script&#x2F;&gt;。如用这个注解需要引入jsoup的依赖，用来解析html代码</td>\n</tr>\n</tbody></table>\n<h3 id=\"Validated-与-Valid-的区别\"><a href=\"#Validated-与-Valid-的区别\" class=\"headerlink\" title=\"@Validated 与 @Valid 的区别\"></a>@Validated 与 @Valid 的区别</h3><ul>\n<li>@Validated 注解是 spring 提供的，提供了一个分组功能，可以在入参验证时，根据不同的分组采用不同的验证机制。没有添加分组属性时，默认验证没有分组的验证属性（Default 分组）；</li>\n<li>@Validated 可以用在类、方法和方法参数上，但是不能用在成员属性（字段）上；</li>\n<li>@Validated 用在方法入参上无法单独提供嵌套验证功能，也无法提示框架进行嵌套验证。能配合嵌套验证注解 @Valid 进行嵌套验证。</li>\n<li>@Valid 作为标准 JSR-303 规范，还没有吸收分组的功能；</li>\n<li>@Valid 可以用在方法、方法参数、构造函数、方法参数和成员属性（字段）上；</li>\n<li>@Valid 加在方法参数时并不能够自动进行嵌套验证，而是用在需要嵌套验证类的相应字段上，来配合方法参数上 @Validated 或 @Valid 来进行嵌套验证。</li>\n</ul>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>由于 spring-boot-starter-web（springboot 2.3 以下版本）依赖默认集成了 Hibernate Validator，所以无需添加任何依赖和相关配置，只需要在项目中引入 spring-boot-starter-web 依赖即可（演示 springboot 版本为 2.2.10.RELEASE），由于要用到 @SafeHtml 注解，这里需要加上 jsoup 的依赖。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 解析html片段--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jsoup<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsoup<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.8.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Hibernate Validator 有两种校验模式：</p>\n<ul>\n<li>普通模式(会校验完所有的属性，然后返回所有的验证失败信息，默认是这个模式)</li>\n<li>快速失败返回模式(只要有一个字段验证失败，就返回结果)</li>\n</ul>\n<p>在 @Configuration 类中配置以下代码，将 Validator 设置为快速失败返回模式</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Validator <span class=\"title function_\">validator</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"type\">ValidatorFactory</span> <span class=\"variable\">validatorFactory</span> <span class=\"operator\">=</span> Validation.byProvider( HibernateValidator.class)</span><br><span class=\"line\">            .configure()</span><br><span class=\"line\">            .addProperty( <span class=\"string\">&quot;hibernate.validator.fail_fast&quot;</span>, <span class=\"string\">&quot;true&quot;</span> )</span><br><span class=\"line\">            .buildValidatorFactory();</span><br><span class=\"line\">    <span class=\"type\">Validator</span> <span class=\"variable\">validator</span> <span class=\"operator\">=</span> validatorFactory.getValidator();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> validator;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"单个对象校验\"><a href=\"#单个对象校验\" class=\"headerlink\" title=\"单个对象校验\"></a>单个对象校验</h3><div class=\"tabs\" id=\"signal-object-validator\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#signal-object-validator-1\"><code>User.java</code></a></li><li class=\"tab\"><a href=\"#signal-object-validator-2\"><code>ValidatorController.java</code></a></li><li class=\"tab\"><a href=\"#signal-object-validator-3\"><code>GlobalExceptionHandler.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"signal-object-validator-1\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//注解对静态变量不生效</span></span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;性别不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String sex;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@Size(min = 2, max = 5, message = &quot;姓名长度不规范&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@CheckCase(value = CaseMode.LOWER, message = &quot;名字的拼音需要小写&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;年龄不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@Max(value = 30, message = &quot;年龄超过最大值30&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@Range(min = 30, max = 60)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@DecimalMax(value = &quot;108.88&quot;, message = &quot;超过最大108.88&quot;, inclusive = false)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Past(message = &quot;生日不能大于当前日期&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalDateTime birthday;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Email(message = &quot;电子邮箱格式不正确&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String email;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SafeHtml(message = &quot;非法请求参数&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String content;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"signal-object-validator-2\"><p>进入 Controller 对应方法，在需要校验的对象前添加 @Valid 注解即可（校验对静态变量不生效），在使用 @Valid 注解的参数后可以紧跟着一个 BindingResult 类型的参数，用于获取校验结果（将校验结果封装在 BingdingResult 对象中，不会抛出异常）。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//单个对象校验</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;user&quot;)</span></span><br><span class=\"line\">    <span class=\"comment\">//校验参数后边跟BindingResult,spring不会抛出异常,将校验结果封装在这个对象中</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">person</span><span class=\"params\">(<span class=\"meta\">@Valid</span> User user, BindingResult bindingResult)</span> &#123;</span><br><span class=\"line\">        System.out.println(user);</span><br><span class=\"line\">        <span class=\"type\">StringBuilder</span> <span class=\"variable\">sb</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class=\"line\">            List&lt;ObjectError&gt; allErrors = bindingResult.getAllErrors();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (ObjectError error : allErrors) &#123;</span><br><span class=\"line\">                sb.append(error.getDefaultMessage() + <span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sb.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>@Valid 和 BindingResult 是一一对应的，如果有多个 @Valid，那么每个 @Valid 后面跟着的 BindingResult 就是这个 @Valid 的验证结果，顺序不能乱。</p>\n</div></div><div class=\"tab-pane\" id=\"signal-object-validator-3\"><p>如果此时去掉实体对象后面的 BindingResult，如校验未通过会抛出 BindException 异常，需要在全局异常处理器中捕获并统一处理。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestControllerAdvice</span></span><br><span class=\"line\"><span class=\"meta\">@Slfj</span></span><br><span class=\"line\"><span class=\"meta\">@AutoConfigurationPackage</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GlobalExceptionHandler</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//spring-context包里面的异常</span></span><br><span class=\"line\">    <span class=\"comment\">//实体对象前不加@RequestBody注解,单个对象内属性校验未通过抛出的异常类型</span></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler(BindingException.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseEntity&lt;ExceptionResponseVO&gt; <span class=\"title function_\">methodArguments</span><span class=\"params\">(BindingException e)</span> &#123;</span><br><span class=\"line\">        log.warn(<span class=\"string\">&quot;throw BindingException,&#123;&#125;&quot;</span>, e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST)</span><br><span class=\"line\">                .body(ExceptionResponseVO.error(NEError.INVALID_PARAMETER, e.getBindingResult().getFieldError().getDefaultMessage()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Validation-api包里面的异常</span></span><br><span class=\"line\">    <span class=\"comment\">//实体对象前不加@RequestBody注解,校验方法参数或方法返回值时,未校验通过时抛出的异常</span></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler(ValidationException.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseEntity&lt;ExceptionResponseVO&gt; <span class=\"title function_\">methodArguments</span><span class=\"params\">(ValidationException e)</span> &#123;</span><br><span class=\"line\">        log.warn(<span class=\"string\">&quot;throw ValidationException,&#123;&#125;&quot;</span>, e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(ExceptionResponseVO.error(NEError.INVALID_PARAMETER, e.getCause().getMessage()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//spring-context包里面的异常,实体对象前加@RequestBody注解,抛出的异常为该类异常</span></span><br><span class=\"line\">    <span class=\"comment\">//方法参数如果带有@RequestBody注解，那么spring mvc会使用RequestResponseBodyMethodProcessor  //对参数进行序列化,并对参数做校验</span></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseEntity&lt;ExceptionResponseVO&gt; <span class=\"title function_\">methodArguments</span><span class=\"params\">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class=\"line\">        log.warn(<span class=\"string\">&quot;throw MethodArgumentNotValidException,&#123;&#125;&quot;</span>, e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST)</span><br><span class=\"line\">                .body(ExceptionResponseVO.error(NEError.INVALID_PARAMETER, e.getBindingResult().getFieldError().getDefaultMessage()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler(Exception.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseEntity <span class=\"title function_\">methodArguments</span><span class=\"params\">(Exception e)</span> &#123;</span><br><span class=\"line\">        log.warn(<span class=\"string\">&quot;throw exception,&#123;&#125;&quot;</span>, e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ResponseEntity.badRequest().body(e.getMessage());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"级联对象校验\"><a href=\"#级联对象校验\" class=\"headerlink\" title=\"级联对象校验\"></a>级联对象校验</h3><div class=\"tabs\" id=\"cascade-object-validator\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#cascade-object-validator-1\"><code>User2.java</code></a></li><li class=\"tab\"><a href=\"#cascade-object-validator-2\"><code>Goods.java</code></a></li><li class=\"tab\"><a href=\"#cascade-object-validator-3\"><code>ValidatorController.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"cascade-object-validator-1\"><p>如果一个对象内部包含另一个对象作为属性，属性上加 @Valid，可以验证作为属性的对象内部的验证。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User2</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Max(value = 50, message = &quot;年龄不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Valid</span></span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;商品不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Goods goods;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"cascade-object-validator-2\"><p>如果一个对象内部包含另一个对象作为属性，属性上加 @Valid，可以验证作为属性的对象内部的验证。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Goods</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;商品名称不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String goodsName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;商品价格不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double goodsPrice;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"cascade-object-validator-3\"><p>如果一个对象内部包含另一个对象作为属性，属性上加 @Valid，可以验证作为属性的对象内部的验证。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;cascade&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">cascade</span><span class=\"params\">(<span class=\"meta\">@Valid</span> <span class=\"meta\">@RequestBody</span> User2 user2)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;OK&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"容器元素校验\"><a href=\"#容器元素校验\" class=\"headerlink\" title=\"容器元素校验\"></a>容器元素校验</h3><div class=\"tabs\" id=\"container-element-validator\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#container-element-validator-1\"><code>User3.java</code></a></li><li class=\"tab\"><a href=\"#container-element-validator-2\"><code>Goods.java</code></a></li><li class=\"tab\"><a href=\"#container-element-validator-3\"><code>ValidatorController.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"container-element-validator-1\"><p>用来校验实体对象内集合中的元素，在容器泛型前加注解，可实现对容器单个元素的校验；如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User3</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Max(value = 50, message = &quot;年龄不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Valid</span></span><br><span class=\"line\">    <span class=\"meta\">@NotEmpty(message = &quot;商品列表不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;<span class=\"meta\">@NotNull(message = &quot;商品不能为空&quot;)</span> Goods&gt; goodsList;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"container-element-validator-2\"><p>如果容器元素校验未通过，抛出异常 MethodArgumentNotValidException（与级联校验抛出的一样）。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Goods</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;商品名称不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String goodsName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;商品价格不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double goodsPrice;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"container-element-validator-3\"><p>如果一个对象内部包含另一个对象作为属性，属性上加 @Valid，可以验证作为属性的对象内部的验证。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;container&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">container</span><span class=\"params\">(<span class=\"meta\">@Valid</span> <span class=\"meta\">@RequestBody</span> User3 user3)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;OK&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure></div></div></div>\n\n\n<h3 id=\"方法的校验\"><a href=\"#方法的校验\" class=\"headerlink\" title=\"方法的校验\"></a>方法的校验</h3><p>JSR 303 标准定义接口 ExecutableValidator，用来校验方法参数，Hibernate Validator 实现了该接口（ValidatorImpl.class），不仅对 Object 的属性进行校验，还可以对方法参数、返回值、构造函数参数等进行校验；Spring 在此基础上进行了扩展，添加了 MethodValidationPostProcessor 拦截器，通过AOP实现对方法的校验；此时抛出的异常是 javax.validation.ConstraintViolationException</p>\n<div class=\"tabs\" id=\"method-validator\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#method-validator-1\"><code>ValidatorController.java</code></a></li><li class=\"tab\"><a href=\"#method-validator-2\"><code>UserService.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"method-validator-1\"><div class=\"note warning\"><p>必须在 Controller 上面加上注解 @Validated，否则校验规则无效</p>\n</div>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/nk/validator&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Validated</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ValidatorController</span> &#123;</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;demo1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">test1</span><span class=\"params\">(<span class=\"meta\">@Range(min = 1, max = 100, message = &quot;起始笔数超过区间范围&quot;)</span> <span class=\"meta\">@RequestParam</span> <span class=\"type\">int</span> pageIndex,</span></span><br><span class=\"line\"><span class=\"params\">                        <span class=\"meta\">@Range(min = 1, max = 999, message = &quot;查询笔数超过区间范围&quot;)</span> <span class=\"meta\">@RequestParam</span> <span class=\"type\">int</span> pageSize)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ok&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"method-validator-2\"><p>除了校验 Controller 方法外，也可校验 Service（必须是单例的 bean，否则不生效，因为方法参数校验逻辑底层用 AOP 来实现）等方法，用法如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Validated</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//校验方法参数</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryUserName</span><span class=\"params\">(<span class=\"meta\">@NotNull(message = &quot;用户参数不能为空&quot;)</span> User user)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user.getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//校验方法返回值</span></span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;用户信息不存在&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">queryUser</span><span class=\"params\">(User user)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"分组校验的实现\"><a href=\"#分组校验的实现\" class=\"headerlink\" title=\"分组校验的实现\"></a>分组校验的实现</h3><p><code>分组</code></p>\n<p>同一个校验规则，不可能适用于所有的业务场景，对每一个业务场景去编写一个校验规则，又显得特别冗余。实际上我们可以用到 Hibernate-Validator 的分组功能，达到对不同场景做出不同的校验逻辑，减少 DTO 对象的创建。</p>\n<p>比如一个 User 对象，新增的时候不需要检验 id（系统生成），修改的时候需要检验 id 属性，要想复用 Class，就可以使用 Hibernate Validator 的分组。</p>\n<div class=\"tabs\" id=\"group-validator\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#group-validator-1\"><code>UserGroup.java</code></a></li><li class=\"tab\"><a href=\"#group-validator-2\"><code>ValidatorController.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"group-validator-1\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserGroup</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;id不能为空&quot;,groups = UpdateUser.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;姓名不能为空&quot;,groups = AddUser.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;年龄不能为空&quot;,groups = AddUser.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">AddUser</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">UpdateUser</span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"group-validator-2\"><p>在需要校验的对象前面加 @Validated 注解（不能使用 @Valid 注解），并配置分组 class，此时分组校验规则生效。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//分组校验:添加用户</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;addUser&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">addUser</span><span class=\"params\">(<span class=\"meta\">@Validated(UserGroup.AddUser.class)</span> UserGroup userGroup)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;OK&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//分组校验:修改用户</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;updateUser&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">updateUser</span><span class=\"params\">(<span class=\"meta\">@Validated(UserGroup.UpdateUser.class)</span> UserGroup userGroup)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;OK&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure></div></div></div>\n\n<p>使用分组能极大的复用需要验证的 Class 信息，而不是按业务重复编写冗余的类。</p>\n<div class=\"note warning\"><p>如果指定了校验组，则该属性将不再属于默认的校验组 Default.class，则在省略校验组参数的情况下，将不会校验自定义校验组的属性。</p>\n</div>\n\n<p><code>组序列</code></p>\n<p>除了按组指定是否验证之外，还可以指定组的验证顺序，前面组验证不通过的，后面组不进行验证；其中 @GroupSequence 提供组序列的形式进行顺序式校验，即先校验 AddUser 分组，如果校验不通过就不进行后续的校验分组了。顺序化的校验，场景更多的是在业务处理类，例如联动的属性验证，值的有效性很大程度上不能从代码的枚举或常量类中来校验。</p>\n<div class=\"tabs\" id=\"group-sequence-validator\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#group-sequence-validator-1\"><code>UserDTO.java</code></a></li><li class=\"tab\"><a href=\"#group-sequence-validator-2\"><code>ValidatorController.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"group-sequence-validator-1\"><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserDTO</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;id不能为空&quot;,groups = &#123;UpdateUser.class&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;姓名不能为空&quot;,groups = &#123;AddUser.class&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;年龄不能为空&quot;,groups = &#123;AddUser.class&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;版本不能为空&quot;)</span><span class=\"comment\">//不配置goups，默认就是Default分组</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer version;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GroupSequence(&#123;AddUser.class, UpdateUser.class, Default.class&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">AddUpdateGroup</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">AddUser</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">UpdateUser</span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"group-sequence-validator-2\"><p>首先校验 AddUser 分组的注解，如果 AddUser 校验不通过，就不会去校验 UpdateUser 和 Default 的分组</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;user&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">saveUser</span><span class=\"params\">(<span class=\"meta\">@Validated(UserDTO.AddUpdateGroup.class)</span> UserDTO userDTO)</span>&#123;</span><br><span class=\"line\">        userMapper.addUser(userDTO);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ok&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"自定义-constraint\"><a href=\"#自定义-constraint\" class=\"headerlink\" title=\"自定义 constraint\"></a>自定义 constraint</h3><p>一般情况，自定义验证可以解决很多问题；某些业务场景下又需要做一些特别的参数校验，此时，我们可以实现 validator 的接口，自定义验证器。</p>\n<div class=\"tabs\" id=\"customized-constraint\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#customized-constraint-1\"><code>Sex.java</code></a></li><li class=\"tab\"><a href=\"#customized-constraint-2\"><code>SexConstraintValidator.java</code></a></li><li class=\"tab\"><a href=\"#customized-constraint-3\"><code>UserDTO.java</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"customized-constraint-1\"><p>创建自定义注解 @Sex，该注解是放在字段上的，也可以根据业务场景放在方法或者 Class 上面）用于判断性别是否符合约束</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Constraint(validatedBy = SexConstraintValidator.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Sex &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    String <span class=\"title function_\">message</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;性别参数有误&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Class&lt;?&gt;[] groups() <span class=\"keyword\">default</span> &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">Payload</span>&gt;[] payload() <span class=\"keyword\">default</span> &#123; &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"customized-constraint-2\"><p>创建自定义验证器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SexConstraintValidator</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ConstraintValidator</span>&lt;Sex, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 性别约束逻辑</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> constraintValidatorContext</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isValid</span><span class=\"params\">(String value, ConstraintValidatorContext constraintValidatorContext)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//如果value为null,那么该校验规则不生效;可搭配@NotNull注解使用,更加灵活</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;男&quot;</span>.equals(value) || <span class=\"string\">&quot;女&quot;</span>.equals(value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"customized-constraint-3\"><p>要验证的 DTO 对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserDTO</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;id不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\">    <span class=\"meta\">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;年龄不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    <span class=\"meta\">@NotNull(message = &quot;版本不能为空&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer version;</span><br><span class=\"line\">    <span class=\"meta\">@Sex</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String sex;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></div></div>\n\n<p>在 UserDTO 对象前加 @Valid 注解，可实现对性别字段的合法性校验，sex 只能传入“男”或“女”。</p>\n<p>这只是一个小例子，大家可以根据业务场景自定义参数校验器，例如敏感词校验、预防 sql 注入、js 脚本攻击等等，都可以用自定义校验器来完成。</p>\n","categories":["java"],"tags":["Validator"]},{"title":"脚手架","url":"/%E8%84%9A%E6%89%8B%E6%9E%B6/","content":"<p>\n\n<span id=\"more\"></span>\n\n<h2 id=\"💥-重大更新\"><a href=\"#💥-重大更新\" class=\"headerlink\" title=\"💥 重大更新\"></a>💥 重大更新</h2><ul>\n<li>基于 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL3BhYXM=\">PaaS<i class=\"fa fa-external-link-alt\"></i></span> 平台稳定版组件，发布了脚手架里程碑版本 <code>Cenozoic.SR3</code> (<span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvY3Jpc3BzLWZyYW1ld29yay1kZXBlbmRlbmNpZXMvY29tbWl0L2MxNzhiNzFhY2YzYTA0OWY3MzI2ZTg2MmRkZDdiODI0ODhiMjAwYzU=\">c178b71a<i class=\"fa fa-external-link-alt\"></i></span>)</li>\n</ul>\n<h2 id=\"🌟-新功能\"><a href=\"#🌟-新功能\" class=\"headerlink\" title=\"🌟 新功能\"></a>🌟 新功能</h2><ul>\n<li>新增统一调用用户中心SDK获取用户信息 (<span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvY3Jpc3BzLWZyYW1ld29yay1kZXBlbmRlbmNpZXMvY29tbWl0LzBjZjczZTgzNmE2Mzk4MmEwMjEyMjI3NGVhMzhjNDNmMGVkMGYxNzA=\">0cf73e83<i class=\"fa fa-external-link-alt\"></i></span>)</li>\n</ul>\n<h2 id=\"🐞-Bug修复\"><a href=\"#🐞-Bug修复\" class=\"headerlink\" title=\"🐞 Bug修复\"></a>🐞 Bug修复</h2><ul>\n<li><code>MyBatisPlus</code> 配置类自定义事务管理器，避免与 <code>mongo</code> 事务管理器冲突 (<span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvY3Jpc3BzLWZyYW1ld29yay1kZXBlbmRlbmNpZXMvY29tbWl0LzJiMjkwZDU1NDRmNWIyNzdmNjM4NTQxNjI3YzJlZmUzNzgyM2FkYTA=\">2b290d55<i class=\"fa fa-external-link-alt\"></i></span>)</li>\n</ul>\n<h2 id=\"🛠-优化\"><a href=\"#🛠-优化\" class=\"headerlink\" title=\"🛠 优化\"></a>🛠 优化</h2><ul>\n<li>优化 <code>MyBatisPlus</code> 配置类分页插件 + 防止全表更新与删除插件 (<span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvY3Jpc3BzLWZyYW1ld29yay1kZXBlbmRlbmNpZXMvY29tbWl0LzJiOGZlZGFiOWIyYzE1ZTY4MGI5YTVkMWZjYWQ2MzA2OGI4YjQ3NDA=\">2b8fedab<i class=\"fa fa-external-link-alt\"></i></span>)</li>\n</ul>\n<h2 id=\"🌀-第三方更新\"><a href=\"#🌀-第三方更新\" class=\"headerlink\" title=\"🌀 第三方更新\"></a>🌀 第三方更新</h2><ul>\n<li>新增统一健康监控组件，并集成脚手架 (<span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvY3Jpc3BzLWZyYW1ld29yay1kZXBlbmRlbmNpZXMvY29tbWl0LzBmNzJlZDI4ZmU1ODJkODI0Y2E5OTk3NTcwZGYxYWM5MzExNDRiZjM=\">0f72ed28<i class=\"fa fa-external-link-alt\"></i></span>)</li>\n</ul>\n<h2 id=\"📖-文档\"><a href=\"#📖-文档\" class=\"headerlink\" title=\"📖 文档\"></a>📖 文档</h2><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3dhbmd4aWFud2VpL2Nsb3VkLWZyYW1ld29yay1hcGk=\">脚手架示例工程<i class=\"fa fa-external-link-alt\"></i></span>，集成 <span class=\"exturl\" data-url=\"aHR0cDovL21pbmRvYy5kZ2cxODguY24vZG9jcy9wYWFzMV8xL3BhYXM=\">PaaS<i class=\"fa fa-external-link-alt\"></i></span> 平台各组件使用示例</li>\n</ul>\n<hr>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE3Mi4xNi4wLjI1L3RlY2hub2xvZ3ktYXJjaGl0ZWN0dXJlLWNlbnRlci90ZWNobm9sb2d5LWRlcGFydG1lbnQvY3Jpc3BzLWZyYW1ld29yay1kZXBlbmRlbmNpZXMuZ2l0\">脚手架<i class=\"fa fa-external-link-alt\"></i></span></p>\n","categories":["paas"],"tags":["脚手架"]},{"title":"404","url":"//404.html","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">██╗  ██╗ ██████╗ ██╗  ██╗    ███╗   ██╗ ██████╗ ████████╗</span><br><span class=\"line\">██║  ██║██╔═████╗██║  ██║    ████╗  ██║██╔═══██╗╚══██╔══╝</span><br><span class=\"line\">███████║██║██╔██║███████║    ██╔██╗ ██║██║   ██║   ██║</span><br><span class=\"line\">╚════██║████╔╝██║╚════██║    ██║╚██╗██║██║   ██║   ██║</span><br><span class=\"line\">     ██║╚██████╔╝     ██║    ██║ ╚████║╚██████╔╝   ██║</span><br><span class=\"line\">     ╚═╝ ╚═════╝      ╚═╝    ╚═╝  ╚═══╝ ╚═════╝    ╚═╝</span><br><span class=\"line\"></span><br><span class=\"line\">    ███████╗ ██████╗ ██╗   ██╗███╗   ██╗██████╗</span><br><span class=\"line\">    ██╔════╝██╔═══██╗██║   ██║████╗  ██║██╔══██╗</span><br><span class=\"line\">    █████╗  ██║   ██║██║   ██║██╔██╗ ██║██║  ██║</span><br><span class=\"line\">    ██╔══╝  ██║   ██║██║   ██║██║╚██╗██║██║  ██║</span><br><span class=\"line\">    ██║     ╚██████╔╝╚██████╔╝██║ ╚████║██████╔╝</span><br><span class=\"line\">    ╚═╝      ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝╚═════╝</span><br></pre></td></tr></table></figure>\n"},{"title":"分类","url":"/categories/index.html","content":""},{"title":"Documentation","url":"/docs/index.html","content":"<h3 id=\"Elegant-and-Powerful-Theme-for-Hexo\"><a href=\"#Elegant-and-Powerful-Theme-for-Hexo\" class=\"headerlink\" title=\"Elegant and Powerful Theme for Hexo\"></a>Elegant and Powerful Theme for Hexo</h3><p>Theme NexT has the following features:</p>\n<ul>\n<li>No jQuery.</li>\n<li>Support <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1wcmVmZXJzLWNvbG9yLXNjaGVtZQ==\">native dark mode<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n<li>Support Pjax to deliver a fast browsing experience.</li>\n<li>Integrated KaTeX and MathJax mathematical formula rendering.</li>\n<li>Integrated PDF.js and mermaid diagram.</li>\n<li>Support Disqus, Changyan, LiveRe, Gitalk, Utterances and Isso comment systems.</li>\n<li>Support a large number of third-party statistics and content sharing services.</li>\n<li>Easy to customize content or modify style.</li>\n</ul>\n<h3 id=\"Four-Schemes-in-One\"><a href=\"#Four-Schemes-in-One\" class=\"headerlink\" title=\"Four Schemes in One\"></a>Four Schemes in One</h3><p>By using different Schemes in NexT, you can simply change the style of your blog, and nearly all options can be used in all schemes.</p>\n<style>\n.image-comparison-container {\n    position: relative;\n}\n\n.image-comparison {\n    opacity: 1 !important;\n}\n\n@keyframes next-clip-path {\n    from {\n        clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);\n    }\n    to {\n        clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);\n    }\n}\n\n.image-comparison:last-of-type {\n    animation: next-clip-path 8s alternate ease-in-out infinite;\n    position: absolute;\n    top: 0;\n}\n</style>\n<div class=\"image-comparison-container\">\n    <img class=\"image-comparison\" src=\"/images/next-schemes.png\" alt=\"NexT Schemes\">\n    <img class=\"image-comparison\" src=\"/images/next-schemes-dark.png\" alt=\"NexT Schemes\">\n</div>\n\n<h3 id=\"Multilingual-Support\"><a href=\"#Multilingual-Support\" class=\"headerlink\" title=\"Multilingual Support\"></a>Multilingual Support</h3><p>Thanks to the contribution of our users and developers, <a href=\"/docs/theme-settings/internationalization.html#Choosing-Language\">NexT now supports over 20 languages</a>.</p>\n<div class=\"group-picture\"><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/en.png\" alt=\"English translation\" loading=\"lazy\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/cn.png\" alt=\"Chinese translation\" loading=\"lazy\"></div><div class=\"group-picture-column\"><img src=\"/images/ru.png\" alt=\"Russian translation\" loading=\"lazy\"></div></div></div>\n\n<h3 id=\"Code-Highlighting-Themes\"><a href=\"#Code-Highlighting-Themes\" class=\"headerlink\" title=\"Code Highlighting Themes\"></a>Code Highlighting Themes</h3><p>NexT uses code highlighting themes from the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oaWdobGlnaHRqcy5vcmcv\">Highlight.js<i class=\"fa fa-external-link-alt\"></i></span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wcmlzbWpzLmNvbS8=\">Prism<i class=\"fa fa-external-link-alt\"></i></span> package, and makes <a href=\"/docs/theme-settings/#Codeblock-Style\">more than 120 themes</a> available to you.</p>\n<!-- Inspired by https://github.com/sindresorhus/css-in-readme-like-wat -->\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tomorrow</th>\n<th align=\"center\">Tomorrow Night</th>\n<th align=\"center\">Tomorrow Night Eighties</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><img src=\"/images/tomorrow.svg\" loading=\"lazy\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night.svg\" loading=\"lazy\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night-eighties.svg\" loading=\"lazy\"></td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tomorrow Night Blue</th>\n<th align=\"center\">Tomorrow Night Bright</th>\n<th align=\"center\">Default</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><img src=\"/images/tomorrow-night-blue.svg\" loading=\"lazy\"></td>\n<td align=\"center\"><img src=\"/images/tomorrow-night-bright.svg\" loading=\"lazy\"></td>\n<td align=\"center\"><img src=\"/images/default.svg\" loading=\"lazy\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"Supported-Browsers\"><a href=\"#Supported-Browsers\" class=\"headerlink\" title=\"Supported Browsers\"></a>Supported Browsers</h3><p>We design NexT to support the latest web browsers. We support the current versions of Chrome, Firefox, Safari, and Microsoft Edge. Many CSS3 and ES6 features are used in theme NexT, including CSS Variables, Destructuring assignment, Arrow functions and Spread operator.</p>\n<table>\n<thead>\n<tr>\n<th>Browser</th>\n<th>Supported versions</th>\n<th>Release date</th>\n<th>Limitation</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><i class=\"fab fa-internet-explorer fa-2x\"></i> IE</td>\n<td>N&#x2F;A</td>\n<td>Oct 17, 2013</td>\n<td>N&#x2F;A</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-edge-legacy fa-2x\"></i> Edge</td>\n<td>16+</td>\n<td>Oct 17, 2017</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1jc3MtdmFyaWFibGVz\">CSS Variables<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n<tr>\n<td><i class=\"fab fa-firefox-browser fa-2x\"></i> Firefox</td>\n<td>41+</td>\n<td>Sep 22, 2015</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1tZG4tamF2YXNjcmlwdF9vcGVyYXRvcnNfZGVzdHJ1Y3R1cmluZw==\">Destructuring assignment<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n<tr>\n<td><i class=\"fab fa-chrome fa-2x\"></i> Chrome</td>\n<td>49+</td>\n<td>Mar 3, 2016</td>\n<td>CSS Variables</td>\n</tr>\n<tr>\n<td><i class=\"fab fa-safari fa-2x\"></i> Safari</td>\n<td>10+</td>\n<td>Sep 20, 2016</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1hcnJvdy1mdW5jdGlvbnM=\">Arrow functions<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n<tr>\n<td><i class=\"fab fa-opera fa-2x\"></i> Opera</td>\n<td>37+</td>\n<td>May 4, 2016</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1tZG4tamF2YXNjcmlwdF9vcGVyYXRvcnNfc3ByZWFkX3NwcmVhZF9pbl9hcnJheXM=\">Spread operator<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n</tbody></table>\n<p>Some other new Web APIs, such as <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1pbnRlcnNlY3Rpb25vYnNlcnZlcg==\">IntersectionObserver<i class=\"fa fa-external-link-alt\"></i></span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1mZXRjaA==\">Fetch API<i class=\"fa fa-external-link-alt\"></i></span>, are used by NexT plugins. They are not core functions of NexT, so we have no plans to fix their compatibility issues with legacy browsers.</p>\n<p>In addition, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD1jc3Mtc3RpY2t5\">CSS position: sticky<i class=\"fa fa-external-link-alt\"></i></span> is used for sidebar positioning. On browsers that do not support this property, its fallback style <code>position: static</code> will be used.</p>\n<h3 id=\"Customize-Your-NexT\"><a href=\"#Customize-Your-NexT\" class=\"headerlink\" title=\"Customize Your NexT\"></a>Customize Your NexT</h3><p>NexT have flexible but simple options, and you can make your own blog with built-in third-party support. Now let&#39;s <a href=\"/docs/getting-started/\">get started</a>.</p>\n"},{"title":"Troubleshooting","url":"/docs/troubleshooting.html","content":"<h3 id=\"Quick-Debug-Instructions\"><a href=\"#Quick-Debug-Instructions\" class=\"headerlink\" title=\"Quick Debug Instructions\"></a>Quick Debug Instructions</h3><p><strong>Before submitting an Issue on GitHub, you can follow the steps below to debug:</strong></p>\n<p>If you get an error message from Hexo or your browser:</p>\n<ul>\n<li>If the error comes from a Hexo plugin, such as hexo-enhancer, please submit an Issue to its GitHub repository.</li>\n<li>If the error comes from a third-party service, such as the Gitalk comment system, please submit an Issue to its GitHub repository.</li>\n<li>Otherise, please search in Google &#x2F; Stackoverflow &#x2F; GitHub Issues, or report it to us when submitting a new Issue.</li>\n</ul>\n<p>The following steps will help you determine the cause of the problem:</p>\n<ul>\n<li>Execute <code>hexo clean</code>, clear the browser cache and disable all CDN services (e.g. Cloudflare Rocket Loader) - This may take some time to take effect.</li>\n<li>Disable browser plug-ins or use other devices and browsers to test, because bugs may only occur in specific browsers.</li>\n<li>Switch to another theme and check if the bug still exists (e.g. default theme landscape). In other words, prove that this is a bug of NexT, not Hexo.</li>\n<li>Upgrade theme NexT to the latest version.</li>\n<li>Upgrade Hexo and all Hexo plugins to the latest version.</li>\n<li>Upgrade or downgrade Node.js to the latest LTS version.</li>\n<li>Uninstall all non-essential Hexo plugins, or delete <code>node_modules</code> and then reinstall all plugins using <code>npm install --force</code>.</li>\n</ul>\n<p>If you decide to submit an Issue, please answer the following questions based on the Issue template:</p>\n<ul>\n<li>Can you reproduce the problem? Can you reliably reproduce the issue? If not, provide details about how often the problem happens and under which conditions it normally happens.</li>\n<li>Did the problem start happening recently or was this always a problem?</li>\n<li>If the problem started happening recently, can you reproduce the problem in an older version of NexT? What&#39;s the most recent version in which the problem doesn&#39;t happen? You can download older versions of NexT from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L3JlbGVhc2Vz\">the releases page<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n<li>Which version of Node, Hexo and NexT are you using? You can get the exact version by running <code>node -v</code>, <code>hexo version</code> in your terminal.</li>\n<li>Which packages do you have installed? You can get that list by copying the output from <code>npm ls --depth 0</code> in Hexo root directory.</li>\n</ul>\n<h3 id=\"Keep-Up-Indentation\"><a href=\"#Keep-Up-Indentation\" class=\"headerlink\" title=\"Keep Up Indentation\"></a>Keep Up Indentation</h3><p>When you edit any YAML configs, always need to keep up indents.<br>Currently, in all Hexo and NexT configuration files parameters uses <strong>2 spaces indents</strong> from parent option.</p>\n<p>For example, we want to change NexT scheme from standart <code>Muse</code> to <code>Gemini</code> and want to use <code>theme_config</code> feature with <a href=\"/docs/getting-started/configuration.html#theme-config\">Alternate Theme Config</a>.</p>\n<div class=\"tabs\" id=\"keep-up-indentation\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#keep-up-indentation-1\">NexT Config →</a></li><li class=\"tab\"><a href=\"#keep-up-indentation-2\">Hexo Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"keep-up-indentation-1\"><p>We open <mark class=\"label primary\">theme config file</mark> and under the «Scheme Settings» section copy next parameters:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ---------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># Scheme Settings</span></span><br><span class=\"line\"><span class=\"comment\"># ---------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">scheme:</span> <span class=\"string\">Muse</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Mist</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Pisces</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Gemini</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"keep-up-indentation-2\"><p>Then we open <mark class=\"label info\">site config file</mark> and paste these parameters under <code>theme_config</code> section:</p>\n<div class=\"tabs\" id=\"2-spaces-indents\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#2-spaces-indents-1\"><mark class=\"label danger\">Nothing Happen</mark></a></li><li class=\"tab\"><a href=\"#2-spaces-indents-2\"><mark class=\"label success\">Working Normally</mark></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"2-spaces-indents-1\"><figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme_config:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#scheme: Muse</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Mist</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Pisces</span></span><br><span class=\"line\"><span class=\"attr\">scheme:</span> <span class=\"string\">Gemini</span></span><br></pre></td></tr></table></figure>\n\n<p>Nothing will happen here because indentation not keeped up. Hexo just can&#39;t read these parameters because subparameters (children parameters of <code>theme_config</code> parameter) does not exist. Let&#39;s see <a href=\"#2-spaces-indents-2\">same configuration with indents</a>.</p></div><div class=\"tab-pane\" id=\"2-spaces-indents-2\"><figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme_config:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#scheme: Muse</span></span><br><span class=\"line\">  <span class=\"comment\">#scheme: Mist</span></span><br><span class=\"line\">  <span class=\"comment\">#scheme: Pisces</span></span><br><span class=\"line\">  <span class=\"attr\">scheme:</span> <span class=\"string\">Gemini</span></span><br></pre></td></tr></table></figure>\n\n<p>And here Hexo can read these parameters as <code>theme_config.scheme: Gemini</code> in same way, as NexT can read <code>scheme: Gemini</code> parameter. So, with 2 spaces indents from parent option(s) Hexo will load all NexT parameters and work fine.</p></div></div></div></div></div></div>\n\n<h3 id=\"TOC-Issues\"><a href=\"#TOC-Issues\" class=\"headerlink\" title=\"TOC Issues\"></a>TOC Issues</h3><p>Do not write a skip-level heading in the post. For example, a third-tier heading <code>###</code> followed by a <code>#####</code> is not recommended.<br>See: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2lzc3Vlcy84ODI=\">https://github.com/theme-next/hexo-theme-next/issues/882<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>If you are using <code>hexo-renderer-markdown-it</code>, it&#39;s recommended to install <code>markdown-it-named-headings</code> to make the TOC work correctly.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install markdown-it-named-headings</span><br></pre></td></tr></table></figure>\n<p>See: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2lzc3Vlcy8xMTY4\">https://github.com/theme-next/hexo-theme-next/issues/1168<i class=\"fa fa-external-link-alt\"></i></span><br>Here is the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLXJlbmRlcmVyLW1hcmtkb3duLWl0L3B1bGwvOTA=\">PR with bugfix for default config<i class=\"fa fa-external-link-alt\"></i></span> of <code>hexo-renderer-markdown-it</code> plugin.</p>\n<h3 id=\"Favicon-Set-but-Doesn-39-t-Work\"><a href=\"#Favicon-Set-but-Doesn-39-t-Work\" class=\"headerlink\" title=\"Favicon Set but Doesn&#39;t Work\"></a>Favicon Set but Doesn&#39;t Work</h3><p>Put your <code>favicon</code> under <mark class=\"label info\">site's</mark> <code>source</code> dir. If you find that your Favicon doesn&#39;t work, please clean your browser&#39;s cache first and then visit your Favicon&#39;s URL directly, which should be <code>http(s)://your-domain.com/favicon.ico</code>.</p>\n<div class=\"note warning\"><p>If your site is in a subdirectory please set it to <code>favicon: favicon.ico</code>.</p>\n</div>\n"},{"title":"Plugins","url":"/plugins/index.html","content":"<h3 id=\"Hexo-Plugins\"><a href=\"#Hexo-Plugins\" class=\"headerlink\" title=\"Hexo Plugins\"></a>Hexo Plugins</h3><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1nZW5lcmF0b3Itc2VhcmNoZGI=\">hexo-generator-searchdb<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1maWx0ZXItZW1vamk=\">hexo-filter-emoji<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1wYW5ndQ==\">hexo-pangu<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1maWx0ZXItbWF0aGpheA==\">hexo-filter-mathjax<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by13b3JkLWNvdW50ZXI=\">hexo-word-counter<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<h3 id=\"NexT-Plugins\"><a href=\"#NexT-Plugins\" class=\"headerlink\" title=\"NexT Plugins\"></a>NexT Plugins</h3><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1uZXh0LXRocmVl\">hexo-next-three<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1uZXh0LWZpcmV3b3Jrcw==\">hexo-next-fireworks<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by1uZXh0LWV4aWY=\">hexo-next-exif<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<hr>\n<ul>\n<li>Visit the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvYXdlc29tZS1uZXh0\">Awesome NexT<i class=\"fa fa-external-link-alt\"></i></span> list for more plugins.</li>\n</ul>\n"},{"title":"标签","url":"/tags/index.html","content":""},{"title":"Custom Files","url":"/docs/advanced-settings/custom-files.html","content":"<h3 id=\"Custom-File-Support\"><a href=\"#Custom-File-Support\" class=\"headerlink\" title=\"Custom File Support\"></a>Custom File Support</h3><p>PR <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvODY4\">#868<i class=\"fa fa-external-link-alt\"></i></span> has adjusted the way of customizing the layout or style, canceling the custom files (such as <code>_custom/custom.styl</code>) in the original theme directory, and only retaining the way of specifying the custom file in the <mark class=\"label primary\">theme config file</mark>.</p>\n<p>It is a good practice to separate the custom files from the theme files, so that you can add custom content without modifying the original source code of the theme, and avoid conflicts due to <code>git merge</code>.</p>\n<p>As with <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZGF0YS1maWxlcw==\">Data Files<i class=\"fa fa-external-link-alt\"></i></span>, you can place all custom layouts or styles in a specific location (for example: <code>hexo/source/_data</code>). Add the custom file to <code>hexo/source/_data</code> and uncomment the content under the <code>custom_file_path</code> section in the <mark class=\"label primary\">theme config file</mark>.</p>\n<div class=\"note warning\"><p>The file name and path must be the same in <code>custom_file_path</code>.</p>\n</div>\n\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"comment\">#head: source/_data/head.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#header: source/_data/header.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#sidebar: source/_data/sidebar.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#postMeta: source/_data/post-meta.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#postBodyEnd: source/_data/post-body-end.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#footer: source/_data/footer.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#bodyEnd: source/_data/body-end.njk</span></span><br><span class=\"line\">  <span class=\"comment\">#variable: source/_data/variables.styl</span></span><br><span class=\"line\">  <span class=\"comment\">#mixin: source/_data/mixins.styl</span></span><br><span class=\"line\">  <span class=\"comment\">#style: source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>\n\n<p>In addition to <code>custom_file_path</code>, we also provide a more flexible way to customize, you can read the <a href=\"/docs/advanced-settings/injects.html\">Theme Inject</a> in documentation.</p>\n<h3 id=\"Examples-of-Modifying-Layout\"><a href=\"#Examples-of-Modifying-Layout\" class=\"headerlink\" title=\"Examples of Modifying Layout\"></a>Examples of Modifying Layout</h3><h4 id=\"Live2d-Widget\"><a href=\"#Live2d-Widget\" class=\"headerlink\" title=\"Live2d Widget\"></a>Live2d Widget</h4><p>Edit <code>source/_data/head.njk</code> in <mark class=\"label info\">site root directory</mark> and add the following content:</p>\n<figure class=\"highlight html\"><figcaption><span>hexo/source/_data/head.njk</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Then uncomment <code>head</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">head:</span> <span class=\"string\">source/_data/head.njk</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Netlify-Logo-in-Sidebar\"><a href=\"#Netlify-Logo-in-Sidebar\" class=\"headerlink\" title=\"Netlify Logo in Sidebar\"></a>Netlify Logo in Sidebar</h4><p>Edit <code>source/_data/sidebar.njk</code> in <mark class=\"label info\">site root directory</mark> and add the following content:</p>\n<figure class=\"highlight html\"><figcaption><span>hexo/source/_data/sidebar.njk</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;cc-license animated&quot;</span> <span class=\"attr\">itemprop</span>=<span class=\"string\">&quot;sponsor&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://www.netlify.com&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;cc-opacity&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Deploy with Netlify → https://www.netlify.com&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;80&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://www.netlify.com/img/global/badges/netlify-dark.svg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;Netlify&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Then uncomment <code>sidebar</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">sidebar:</span> <span class=\"string\">source/_data/sidebar.njk</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples-of-Modifying-Style\"><a href=\"#Examples-of-Modifying-Style\" class=\"headerlink\" title=\"Examples of Modifying Style\"></a>Examples of Modifying Style</h3><h4 id=\"How-to-Change-Content-Width\"><a href=\"#How-to-Change-Content-Width\" class=\"headerlink\" title=\"How to Change Content Width\"></a>How to Change Content Width</h4><p>By default NexT has following setting of content width:</p>\n<ul>\n<li>700px → when screen width &lt; 1200px.</li>\n<li>800px → when screen width &gt;&#x3D; 1200px.</li>\n<li>900px → when screen width &gt;&#x3D; 1600px.</li>\n<li>In mobile &#x2F; tablet devices it will use responsive width.</li>\n</ul>\n<p>You can change content width by editing CSS style file. Edit <code>source/_data/variables.styl</code> in <mark class=\"label info\">site root directory</mark> and add varibles:</p>\n<div class=\"tabs\" id=\"change-content-width\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#change-content-width-1\">Muse / Mist schemes</a></li><li class=\"tab\"><a href=\"#change-content-width-2\">Pisces / Gemini schemes</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"change-content-width-1\"><p>Default variables for both Muse and Mist schemes are located in <code>source/css/_variables/base.styl</code> and defined as:</p>\n<figure class=\"highlight styl\"><figcaption><span>next/source/css/_variables/base.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$content</span>-desktop         = <span class=\"number\">700px</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-large   = <span class=\"number\">800px</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-largest = <span class=\"number\">900px</span></span><br></pre></td></tr></table></figure>\n\n<p>For example, you want wider content width. You may redefine this variables with percentage width:</p>\n<figure class=\"highlight styl\"><figcaption><span>hexo/source/_data/variables.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$content</span>-desktop         = <span class=\"number\">90%</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-large   = <span class=\"number\">90%</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-largest = <span class=\"number\">90%</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>If values will in percents, during opening sidebar will dynamically decrease content width to defined by you percent.<br>But in standard behaviour, sidebar must displace content from yourself.<br>To around it, you can specify content width in <code>em</code>:</p>\n<figure class=\"highlight styl\"><figcaption><span>hexo/source/_data/variables.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$content</span>-desktop         = <span class=\"number\">50em</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-large   = <span class=\"number\">55em</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-largest = <span class=\"number\">60em</span></span><br></pre></td></tr></table></figure></div></div><div class=\"tab-pane\" id=\"change-content-width-2\"><p>Default variables for Pisces (and Gemini) scheme are located in <code>source/css/_variables/Pisces.styl</code> and defined as:</p>\n<figure class=\"highlight styl\"><figcaption><span>next/source/css/_variables/Pisces.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$content</span>-desktop         = <span class=\"string\">&#x27;calc(100% - %s)&#x27;</span> % <span class=\"built_in\">unit</span>(<span class=\"variable\">$content</span>-desktop-<span class=\"attribute\">padding</span> / <span class=\"number\">2</span>, <span class=\"string\">&#x27;px&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-large   = <span class=\"number\">1160px</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-largest = <span class=\"number\">73%</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p><code>$content-desktop</code> value in this schemes is auto-responsive by default. It can be changed to any value too, but for better content visibility recommended to stay it as is.</p>\n</div>\n\n<p>In this schemes content width was defined on maximum and already balanced: if desktop width will be wider – content width will more narrowed for easier reading. But if you want to make more narrow content width in wider desktops, here is example:</p>\n<figure class=\"highlight styl\"><figcaption><span>hexo/source/_data/variables.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$content</span>-desktop-large   = <span class=\"number\">65em</span></span><br><span class=\"line\"><span class=\"variable\">$content</span>-desktop-largest = <span class=\"number\">65%</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><p>In fact, Gemini scheme is just fork of Pisces scheme with some style improvements.<br>Therefore, almost all part of variables from Pisces scheme are imported to Gemini scheme too.<br>So, if you want to add any variables or styles to both Pisces and Gemini schemes, need to edit values just in Pisces scheme.</p>\n</div></div></div></div>\n\n<p>Then uncomment <code>variable</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">variable:</span> <span class=\"string\">source/_data/variables.styl</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Custom-Icon-Image\"><a href=\"#Custom-Icon-Image\" class=\"headerlink\" title=\"Custom Icon Image\"></a>Custom Icon Image</h4><p>NexT uses Font Awesome as the default icon library. However, Font Awesome does not include the icons of some Chinese social networking site. In this tutorial, we use local images to replace the missing Font Awesome icons.</p>\n<p>Let&#39;s take the Bilibili icon as an example. You need to prepare a icon in svg format, e.g. <code>/source/images/bilibili.svg</code>.</p>\n<p>Edit <code>source/_data/styles.styl</code> in <mark class=\"label info\">site root directory</mark> and add styles:</p>\n<figure class=\"highlight css\"><figcaption><span>hexo/source/_data/styles.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.fa-bilibili</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(<span class=\"string\">/images/bilibili.svg</span>);</span><br><span class=\"line\">  <span class=\"attribute\">background-position</span>: <span class=\"number\">50%</span> <span class=\"number\">75%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-repeat</span>: no-repeat;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Then uncomment <code>style</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>\n\n<p>The usage is:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">social:</span></span><br><span class=\"line\">  <span class=\"attr\">Bilibili:</span> <span class=\"string\">https://space.bilibili.com/userid/</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-bilibili</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Hide-Sidebar-on-Mobile\"><a href=\"#Hide-Sidebar-on-Mobile\" class=\"headerlink\" title=\"Hide Sidebar on Mobile\"></a>Hide Sidebar on Mobile</h4><p>Edit <code>source/_data/styles.styl</code> in <mark class=\"label info\">site root directory</mark> and add styles:</p>\n<figure class=\"highlight css\"><figcaption><span>hexo/source/_data/styles.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">+tablet-mobile() &#123;</span><br><span class=\"line\">  <span class=\"selector-class\">.sidebar-toggle</span>, <span class=\"selector-class\">.sidebar</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Then uncomment <code>style</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Overriding-Default-Style\"><a href=\"#Overriding-Default-Style\" class=\"headerlink\" title=\"Overriding Default Style\"></a>Overriding Default Style</h4><p>Edit <code>source/_data/styles.styl</code> in <mark class=\"label info\">site root directory</mark> and add styles:</p>\n<figure class=\"highlight css\"><figcaption><span>hexo/source/_data/styles.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.archive</span> <span class=\"selector-class\">.collection-title</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none <span class=\"meta\">!important</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Then uncomment <code>style</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_file_path:</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Front Matter","url":"/docs/advanced-settings/front-matter.html","content":"<blockquote>\n<p>Front-matter is a block of YAML or JSON at the beginning of the file that is used to configure settings for your writings. Front-matter is terminated by three dashes when written in YAML or three semicolons when written in JSON.<br>— from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZnJvbnQtbWF0dGVy\">Hexo site<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</blockquote>\n<p><strong>YAML</strong></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">Hello</span> <span class=\"string\">World</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2013</span><span class=\"string\">/7/13</span> <span class=\"number\">20</span><span class=\"string\">:46:25</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>JSON</strong></p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hello World&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;date&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2013/7/13 20:46:25&quot;</span></span><br><span class=\"line\">;;;</span><br></pre></td></tr></table></figure>\n\n<p>Next extends and provide more variables. It allows users to configure a single page.</p>\n<h3 id=\"Settings-amp-Their-Default-Values\"><a href=\"#Settings-amp-Their-Default-Values\" class=\"headerlink\" title=\"Settings &amp; Their Default Values\"></a>Settings &amp; Their Default Values</h3><table>\n<thead>\n<tr>\n<th>Setting</th>\n<th>Type</th>\n<th>Description</th>\n<th>Default</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>author</code></td>\n<td><code>string</code></td>\n<td>Author name for post copyright</td>\n<td><code>author</code> in Hexo <code>_config.yml</code></td>\n</tr>\n<tr>\n<td><code>post_link</code></td>\n<td><code>string</code></td>\n<td>Post link</td>\n<td>None</td>\n</tr>\n<tr>\n<td><code>description</code></td>\n<td><code>string</code></td>\n<td>Docs <a href=\"/docs/theme-settings/posts.html#Preamble-Text\">here</a></td>\n<td>None</td>\n</tr>\n<tr>\n<td><code>direction</code></td>\n<td><code>string</code></td>\n<td>Available value: <code>rtl</code></td>\n<td>None</td>\n</tr>\n<tr>\n<td><code>header</code></td>\n<td><code>boolean</code></td>\n<td>Whether to display the post header in index page</td>\n<td><code>true</code></td>\n</tr>\n<tr>\n<td><code>mathjax</code></td>\n<td><code>boolean</code></td>\n<td>MathJax support</td>\n<td><code>math.every_page</code> in <code>_config.yml</code></td>\n</tr>\n<tr>\n<td><code>sidebar</code></td>\n<td><code>boolean</code></td>\n<td>Whether the sidebar will be shown</td>\n<td>Depends on <code>sidebar.display</code> in <code>_config.yml</code></td>\n</tr>\n<tr>\n<td><code>copyright</code></td>\n<td><code>boolean</code></td>\n<td>Whether to display copyright notices below the post with <code>theme.creative_commons.license</code> and <code>theme.creative_commons.post</code> enabled</td>\n<td><code>true</code></td>\n</tr>\n<tr>\n<td><code>sticky</code></td>\n<td><code>number</code></td>\n<td>Pin the post to the top of the index page. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLWdlbmVyYXRvci1pbmRleA==\">hexo-generator-index<i class=\"fa fa-external-link-alt\"></i></span> plugin required</td>\n<td>0</td>\n</tr>\n<tr>\n<td><code>quicklink</code></td>\n<td><code>object</code> (1)</td>\n<td>Quicklink support</td>\n<td>From <code>_config.yml</code></td>\n</tr>\n<tr>\n<td><code>reward_settings</code></td>\n<td><code>object</code> (1)</td>\n<td>Reward settings</td>\n<td>From <code>_config.yml</code></td>\n</tr>\n<tr>\n<td><code>toc</code></td>\n<td><code>object</code> (1)</td>\n<td>Table of Contents in the sidebar</td>\n<td>From <code>_config.yml</code></td>\n</tr>\n</tbody></table>\n<p>(1): They have the same structure as the options in <mark class=\"label primary\">theme config file</mark>.</p>\n<p><strong>Example</strong></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">toc:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">number:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">max_depth:</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"attr\">reward_settings:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">comment:</span> <span class=\"string\">Buy</span> <span class=\"string\">me</span> <span class=\"string\">a</span> <span class=\"string\">coffee</span></span><br><span class=\"line\"><span class=\"attr\">quicklink:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">delay:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">timeout:</span> <span class=\"number\">3000</span></span><br><span class=\"line\">  <span class=\"attr\">priority:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">ignores:</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Undocumented-Front-matter-Variables\"><a href=\"#Undocumented-Front-matter-Variables\" class=\"headerlink\" title=\"Undocumented Front-matter Variables\"></a>Undocumented Front-matter Variables</h3><p>The following variables are not mentioned in the Hexo documentation, but are required by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLXRoZW1lLXVuaXQtdGVzdA==\">hexo-theme-unit-test<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<table>\n<thead>\n<tr>\n<th>Setting</th>\n<th>Type</th>\n<th>Example</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>link</code></td>\n<td><code>string</code></td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLXRoZW1lLXVuaXQtdGVzdC9ibG9iL21hc3Rlci9zb3VyY2UvX3Bvc3RzL2xpbmstcG9zdC5tZA==\">link-post<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n<tr>\n<td><code>photos</code></td>\n<td><code>array</code></td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLXRoZW1lLXVuaXQtdGVzdC9ibG9iL21hc3Rlci9zb3VyY2UvX3Bvc3RzL2dhbGxlcnktcG9zdC5tZA==\">gallery-post<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n</tbody></table>\n"},{"title":"Advanced Settings","url":"/docs/advanced-settings/index.html","content":"<p>Besides common <a href=\"/docs/theme-settings/\">Theme Settings</a> and <a href=\"/docs/third-party-services/\">Third-party Services</a>, NexT supports some advanced settings which makes NexT customizable.<br>Please note that those settings may lead to abnormal behavior if they are wrong. Change them only when you know for what they are.</p>\n<ul>\n<li><a href=\"/docs/advanced-settings/vendors.html\">Vendors</a></li>\n<li><a href=\"/docs/advanced-settings/custom-files.html\">Custom Files</a></li>\n<li><a href=\"/docs/advanced-settings/injects.html\">Injects</a></li>\n<li><a href=\"/docs/advanced-settings/front-matter.html\">Front-matter</a></li>\n</ul>\n"},{"title":"Injects","url":"/docs/advanced-settings/injects.html","content":"<h3 id=\"Injects\"><a href=\"#Injects\" class=\"headerlink\" title=\"Injects\"></a>Injects</h3><p>We extended the Hexo filter and added <code>theme_inject</code>, so user can add the desired custom content to any injection point.</p>\n<h4 id=\"Synopsis\"><a href=\"#Synopsis\" class=\"headerlink\" title=\"Synopsis\"></a>Synopsis</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;theme_inject&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">injects</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>A injects argument will get passed into the function, so we can use it add custom code in <code>injectPoint</code> as following.</p>\n<p>For inject view:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// The name of same `injectPoint` suggest be unique. If same, it will override low priority configurations.</span></span><br><span class=\"line\"><span class=\"comment\">// `locals` and `options` is the same as partial https://hexo.io/docs/helpers#partial.</span></span><br><span class=\"line\"><span class=\"comment\">// `order` defines the order of injection, which by default depends on the priority of injection.</span></span><br><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;theme_inject&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">injects</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// it will put code from this filePath into injectPoint.</span></span><br><span class=\"line\">  injects.[injectPoint].<span class=\"title function_\">file</span>(name, filePath, [locals, options, order]);</span><br><span class=\"line\">  <span class=\"comment\">// it will put raw string as code into injectPoint.</span></span><br><span class=\"line\">  injects.[injectPoint].<span class=\"title function_\">raw</span>(name, raw, [locals, options, order]);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>You have to note <code>filePath</code>, it must be absolute path or relative to <code>hexo_dir</code>.</p>\n</div>\n\n<p>For inject style:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;theme_inject&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">injects</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// it will put styleFile into injectPoint.</span></span><br><span class=\"line\">  injects.[injectPoint].<span class=\"title function_\">push</span>(styleFile);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>These are many <code>injectPoint</code>, defined in <a href=\"https://github.com/next-theme/hexo-theme-next/blob/master/scripts/events/lib/injects-point.js\"><code>injects-point.js</code></a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">views</span>: [<span class=\"string\">&#x27;head&#x27;</span>, <span class=\"string\">&#x27;header&#x27;</span>, <span class=\"string\">&#x27;sidebar&#x27;</span>, <span class=\"string\">&#x27;postMeta&#x27;</span>, <span class=\"string\">&#x27;postBodyEnd&#x27;</span>, ..., <span class=\"string\">&#x27;footer&#x27;</span>, <span class=\"string\">&#x27;bodyEnd&#x27;</span>],</span><br><span class=\"line\">  <span class=\"attr\">styles</span>: [<span class=\"string\">&#x27;variable&#x27;</span>, <span class=\"string\">&#x27;mixin&#x27;</span>, <span class=\"string\">&#x27;style&#x27;</span>]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><code>custom_file_path</code> also uses this API, see <a href=\"https://github.com/next-theme/hexo-theme-next/blob/master/scripts/filters/default-injects.js\"><code>default-injects.js</code></a>. It will consume <code>custom</code> name in view inject points. So if you use <code>custom_file_path</code>, please not use <code>custom</code>.</p>\n<h4 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h4><p><strong>One:</strong> load a custom script. We can add it in <code>bodyEnd</code>.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;theme_inject&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">injects</span>) &#123;</span><br><span class=\"line\">  injects.<span class=\"property\">bodyEnd</span>.<span class=\"title function_\">raw</span>(<span class=\"string\">&#x27;load-custom-js&#x27;</span>, <span class=\"string\">&#x27;&lt;script src=&quot;js-path-or-cdn.js&quot;&gt;&lt;/script&gt;&#x27;</span>, &#123;&#125;, &#123;<span class=\"attr\">cache</span>: <span class=\"literal\">true</span>&#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><strong>Two:</strong> add a custom <code>my-favourite-food.njk</code> to sidebar.</p>\n<p>Step1: you should create <code>my-favourite-food.njk</code> in any path(e.g. <code>source/_data/</code>) as below. You can get variable from <code>hexo</code> or <code>local</code> defined in filter.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% for food in foods %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123; food &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Step2: add filter to load it.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;theme_inject&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">injects</span>) &#123;</span><br><span class=\"line\">  injects.<span class=\"property\">sidebar</span>.<span class=\"title function_\">file</span>(<span class=\"string\">&#x27;my-favourite-food&#x27;</span>, <span class=\"string\">&#x27;source/_data/my-favourite-food.njk&#x27;</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">foods</span>: [<span class=\"string\">&#x27;apple&#x27;</span>, <span class=\"string\">&#x27;orange&#x27;</span>]</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><strong>Three:</strong> want to have big header, put <code>big-header.styl</code> to NexT.</p>\n<p>Of course, you need to create this file first(e.g. <code>source/_data/big-header.styl</code>).</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">h1</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And then add it in filter.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;theme_inject&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">injects</span>) &#123;</span><br><span class=\"line\">  injects.<span class=\"property\">style</span>.<span class=\"title function_\">push</span>(<span class=\"string\">&#x27;source/_data/big-header.styl&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Plugin\"><a href=\"#Plugin\" class=\"headerlink\" title=\"Plugin\"></a>Plugin</h4><p>We also support hexo&#39;s plugin system, which makes it easy to extend functions without modifying the source code of the core module. You can see <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvcGx1Z2lucy5odG1sI1BsdWdpbg==\">https://hexo.io/docs/plugins.html#Plugin<i class=\"fa fa-external-link-alt\"></i></span> to learn how to create a plugin.</p>\n"},{"title":"Vendors","url":"/docs/advanced-settings/vendors.html","content":"<h3 id=\"CDN-Settings\"><a href=\"#CDN-Settings\" class=\"headerlink\" title=\"CDN Settings\"></a>CDN Settings</h3><p>This feature is located under <code>vendors</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">vendors:</span></span><br><span class=\"line\">  <span class=\"comment\"># The CDN provider of NexT internal scripts.</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: local | jsdelivr | unpkg | cdnjs</span></span><br><span class=\"line\">  <span class=\"attr\">internal:</span> <span class=\"string\">local</span></span><br><span class=\"line\">  <span class=\"comment\"># The default CDN provider of third-party plugins.</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: local | jsdelivr | unpkg | cdnjs</span></span><br><span class=\"line\">  <span class=\"comment\"># Dependencies for `plugins: local`: https://github.com/next-theme/plugins</span></span><br><span class=\"line\">  <span class=\"attr\">plugins:</span> <span class=\"string\">jsdelivr</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># In the following settings, you can specify the CDN link for each plugin.</span></span><br><span class=\"line\">  <span class=\"comment\"># If left blank, the default CDN provider set by `plugins` option will be used.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Anime.js</span></span><br><span class=\"line\">  <span class=\"comment\"># For more information: https://animejs.com</span></span><br><span class=\"line\">  <span class=\"attr\">anime:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Font Awesome</span></span><br><span class=\"line\">  <span class=\"comment\"># For more information: https://fontawesome.com</span></span><br><span class=\"line\">  <span class=\"attr\">fontawesome:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Core-Plugins\"><a href=\"#Core-Plugins\" class=\"headerlink\" title=\"Core Plugins\"></a>Core Plugins</h4><p><code>internal: local</code> is used to set how to load the internal library, e.g. <code>source/js/utils.js</code>. The core plugins are loaded from your site by default, they are required by the basic functions of NexT. Set <code>internal</code> to <code>jsdelivr</code>, <code>unpkg</code> or <code>cdnjs</code> to load them from the corresponding CDN.</p>\n<div class=\"note info\"><p>If your site is deployed to any free hosting service (Github, Gitlab, etc.), CDN links are recommended for core plugins. CDN usually has faster speeds and no traffic restrictions.</p>\n</div>\n\n<div class=\"note danger\"><p>If you are using the latest master branch of NexT, please set <code>internal: local</code>.</p>\n</div>\n\n<h4 id=\"Third-party-Plugins\"><a href=\"#Third-party-Plugins\" class=\"headerlink\" title=\"Third-party Plugins\"></a>Third-party Plugins</h4><p><code>plugins: jsdelivr</code> is used to set how to load the third-party plugins, e.g. <code>anime.js</code>. Third-party plugins are loaded from <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuanNkZWxpdnIuY29tLw==\">jsDelivr<i class=\"fa fa-external-link-alt\"></i></span> CDN by default.<br>The reason that jsDelivr is chosen to deliver our third-party plugins is because it is fast everywhere, and jsDelivr has the valid ICP license issued by the Chinese government, it can be accessed in China pretty well. jsDelivr does not only provide mirrors for the files from npm packages, but also fetch from the GitHub releases! We could use the following link to reference the js files, just as other CDNs.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">//cdn.jsdelivr.net/gh/user/repo@version/file</span><br></pre></td></tr></table></figure>\n\n<p>And it could automatically minify the JS and CSS files, even if you don&#39;t have the minified version. Just use the <code>filename.min.js</code> or the <code>filename.min.css</code> to replace the file above. For more information: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuanNkZWxpdnIuY29tL2ZlYXR1cmVz\">https://www.jsdelivr.com/features<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>And we also provide other optional CDNs, including the famous <span class=\"exturl\" data-url=\"aHR0cHM6Ly91bnBrZy5jb20v\">UNPKG<i class=\"fa fa-external-link-alt\"></i></span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG5qcy5jb20v\">CDNJS<i class=\"fa fa-external-link-alt\"></i></span>. Set <code>plugins</code> to <code>unpkg</code> or <code>cdnjs</code> to load them from different CDN provider.</p>\n<div class=\"note warning\"><p>Particularly, if you are a Chinese blogger or most of your visits come from China, please note that <strong>the CDNJS is blocked in some parts of China</strong>, don&#39;t use it as your CDN provider.</p>\n</div>\n\n<div class=\"note info\"><p>If your would like to load all third-party plugins from your site, please set <code>plugins</code> to <code>local</code> and install the <code>@next-theme/plugins</code> package: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvcGx1Z2lucw==\">https://github.com/next-theme/plugins<i class=\"fa fa-external-link-alt\"></i></span><br>If your website is deployed in the local area network, then this will have a faster loading speed than CDN services.</p>\n</div>\n\n<p>And next part is the config of each library. Each config is in format of <code>libname: CDN URL</code>. For example:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">anime:</span> <span class=\"string\">//unpkg.com/animejs@3.1.0/lib/anime.min.js</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>If you leave it blank, NexT will use the default CDN provider set by <code>plugins</code> option.</strong></p>\n<p>You can set it to a proper CDN URL, which can make the static assets of third-party plugins load faster. For example, if you want to set the CDN URL for <code>mediumzoom</code>, go to <mark class=\"label primary\">theme config file</mark> and see:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">vendors:</span></span><br><span class=\"line\">  <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"comment\"># Some contents...</span></span><br><span class=\"line\">  <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"attr\">mediumzoom:</span> <span class=\"comment\"># Set or update mediumzoom CDN URL.</span></span><br></pre></td></tr></table></figure>\n\n<p>If you want to try the other CDNs not included in the available values of <code>plugins</code> option, you would better use the corresponding version. Versions in <code>_vendors.yml</code> are recommended by NexT. And if you need other versions you need to test them first.</p>\n"},{"title":"Configuration","url":"/docs/getting-started/configuration.html","content":"<p>How to configure Hexo and NexT? The traditional approach is to store some options in <mark class=\"label info\">site config file</mark> and other options in <mark class=\"label primary\">theme config file</mark>. This approach is applicable, but it is not smooth to update NexT theme from pulling or downloading new releases.</p>\n<p>At present, NexT encourages users to use the Alternate Theme Config. It&#39;s a feature of Hexo and the documentation is here: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvY29uZmlndXJhdGlvbi5odG1sI1VzaW5nLWFuLUFsdGVybmF0ZS1Db25maWc=\">Hexo Configuration<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<p>This tutorial shows you how to configure NexT using Alternate Theme Config. Please choose only one of the following solutions and resume next steps.</p>\n<h3 id=\"config-name-yml\"><a href=\"#config-name-yml\" class=\"headerlink\" title=\"_config.[name].yml\"></a><code>_config.[name].yml</code></h3><p>With this way, all your configurations locate in config file <code>/_config.[name].yml</code>. Replace <code>[name]</code> with the value of <code>theme</code> option in <mark class=\"label info\">site config file</mark>, e.g. <code>next</code>.</p>\n<h4 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h4><ol>\n<li>Please ensure you are using Hexo 5.0 (or later).</li>\n<li>Create a config file in site&#39;s root directory, e.g. <code>_config.next.yml</code>.</li>\n<li>Copy needed NexT theme options from <mark class=\"label primary\">theme config file</mark> into this config file. If it is the first time to install NexT, then copy the whole <mark class=\"label primary\">theme config file</mark> by the following command: <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Installed through npm</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> node_modules/hexo-theme-next/_config.yml _config.next.yml</span><br><span class=\"line\"><span class=\"comment\"># Installed through Git</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> theme/next/_config.yml _config.next.yml</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"theme-config\"><a href=\"#theme-config\" class=\"headerlink\" title=\"theme_config\"></a><code>theme_config</code></h3><p>With this way, all your configurations locate in main <mark class=\"label info\">site config file</mark>. You don&#39;t need to edit <mark class=\"label primary\">theme config file</mark> or create any new files. But you need to <strong><a href=\"/docs/troubleshooting.html#Keep-Up-Indentation\">keep up indentation</a></strong> within <code>theme_config</code> option.</p>\n<h4 id=\"Usage-1\"><a href=\"#Usage-1\" class=\"headerlink\" title=\"Usage\"></a>Usage</h4><ol>\n<li>Please confirm that the <code>/source/_data/next.yml</code> file does not exist (backup and delete it if exists).</li>\n<li>Copy needed NexT theme options from <mark class=\"label primary\">theme config file</mark> into <mark class=\"label info\">site config file</mark>, then<br> 2.1. Move all this settings to the right with two spaces (in Visual Studio Code: select all strings, <kbd>CTRL</kbd> + <kbd>]</kbd>).<br> 2.2. Add <code>theme_config:</code> parameter above all this settings.</li>\n</ol>\n<h3 id=\"next-yml-Deprecated\"><a href=\"#next-yml-Deprecated\" class=\"headerlink\" title=\"next.yml (Deprecated)\"></a><code>next.yml</code> (Deprecated)</h3><p>Older versions of NexT theme also provide another configuration method, which is to place the theme configuration in the <code>/source/_data/next.yml</code> file. This method is deprecated, please use <code>_config.next.yml</code> instead. If the <code>/source/_data/next.yml</code> file exists, move it to the Hexo root directory and rename it to <code>_config.next.yml</code>.</p>\n"},{"title":"Deployment","url":"/docs/getting-started/deployment.html","content":"<h3 id=\"Local-Deployment\"><a href=\"#Local-Deployment\" class=\"headerlink\" title=\"Local Deployment\"></a>Local Deployment</h3><ol>\n<li>Modify files locally.</li>\n<li>Localization testing: <code>hexo clean &amp;&amp; hexo s</code>.</li>\n<li>Deployment: <code>hexo g -d</code>.</li>\n</ol>\n<div class=\"note warning\"><p>For NexT version prior to 8.0.0, the core plugins are placed in the <code>lib</code> directory. If you are using macOS with <code>hexo-deployer-git</code>, make sure that <code>lib/</code> directory is not ignored by git (e.g. check <code>~/.gitignore_global</code>). Otherwise some necessary files may be missing after the deployment.</p>\n</div>\n\n<h3 id=\"Continuous-Integration\"><a href=\"#Continuous-Integration\" class=\"headerlink\" title=\"Continuous Integration\"></a>Continuous Integration</h3><ul>\n<li>Edit the file directly online, effective immediately</li>\n<li>Automatic deployment, simultaneous deployment to multiple locations</li>\n</ul>\n<h4 id=\"Netlify\"><a href=\"#Netlify\" class=\"headerlink\" title=\"Netlify\"></a>Netlify</h4><p>Netlify is an all-in-one platform for automating modern web projects. Replace your hosting infrastructure, continuous integration, and deployment pipeline with a single workflow. Integrate dynamic functionality like serverless functions, user authentication, and form handling as your projects grow.</p>\n<p>Perhaps you have already found that this website is deployed on Netlify. Checkout <code>deploy.sh</code> and <code>netlify.toml</code> in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvdGhlbWUtbmV4dC1kb2Nz\">theme-next-docs<i class=\"fa fa-external-link-alt\"></i></span> repository for more information.</p>\n<h4 id=\"GitHub-Actions\"><a href=\"#GitHub-Actions\" class=\"headerlink\" title=\"GitHub Actions\"></a>GitHub Actions</h4><p>This Github Action automating Hexo deployment workflow, to allow you to leverage GitHub Actions to publish your Hexo site on Github Pages: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NtYTExYmxhY2svaGV4by1hY3Rpb24=\">hexo-action<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<h4 id=\"Travis-CI\"><a href=\"#Travis-CI\" class=\"headerlink\" title=\"Travis CI\"></a>Travis CI</h4><p>Travis CI enables your team to test and ship your apps with confidence. It&#39;s built for everyone and for projects and teams of all sizes, supporting over 20 different languages out of the box, including Javascript and Node.js, Ruby, PHP, Python, Mac&#x2F;iOS, as well as Docker, while giving you full control over the build environment to customize it to your own needs.</p>\n<div class=\"tabs\" id=\"travis-ci\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#travis-ci-1\">Get permissions →</a></li><li class=\"tab\"><a href=\"#travis-ci-2\">Configure <code>.travis.yml</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"travis-ci-1\"><p>There are two ways to obtain the necessary permissions for Travis CI. Deploy Key has the advantage of high security, while Access Token has the advantage of being more flexible.</p>\n<div class=\"tabs\" id=\"get-permissions\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#get-permissions-1\">Access Token</a></li><li class=\"tab\"><a href=\"#get-permissions-2\">Deploy Key</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"get-permissions-1\"><p>This method applies to a warehouse with a private Submodule</p>\n<ul>\n<li>Create an empty branch of <code>source</code> in the repository where the blog source is hosted.</li>\n<li>Get the Access Token: Settings → Developer settings → Personal access token → Generate new token. Set access rights according to the actual situation. It should be noted that the access token is only displayed once on this page, and it should be copied, otherwise it can only be regenerated.</li>\n<li>Use github account to log in to <span class=\"exturl\" data-url=\"aHR0cHM6Ly90cmF2aXMtY2kuY29tLw==\">Travis CI website<i class=\"fa fa-external-link-alt\"></i></span>. You can find the warehouses in the current github account, select the warehouses to be deployed, and then click setting. Fill in the personal access token generated by github and select the branch that the warehouse needs to be monitored by Travis.</li>\n</ul></div><div class=\"tab-pane\" id=\"get-permissions-2\"><p>Deploy key is a SSH key set in your repo to grant client read-only (as well as r&#x2F;w, if you want) access to your repo. This method is suitable for most public blog repositories and there are no private sub-modules in the repositories.</p>\n<ul>\n<li><p>Create an empty branch of <code>source</code> in the repository where the blog source is hosted.</p>\n</li>\n<li><p>Generate a ssh key</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ ssh-keygen -t rsa -b 4096 -C &quot;&#123;email&#125;&quot; -f ~/.ssh/deploy_key</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Add the deployment public key in your repo, and delete it</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm -f deploy_key.pub</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Use the Travis command to encrypt private key, and add it to git</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ gem install travis</span><br><span class=\"line\">$ travis login</span><br><span class=\"line\">$ travis encrypt deploy_key</span><br><span class=\"line\">$ rm -f deploy_key</span><br><span class=\"line\">$ git add deploy_key.enc</span><br></pre></td></tr></table></figure></li>\n</ul></div></div></div></div><div class=\"tab-pane\" id=\"travis-ci-2\"><figure class=\"highlight yml\"><figcaption><span>hexo/.travis.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dist:</span> <span class=\"string\">trusty</span></span><br><span class=\"line\"><span class=\"attr\">sudo:</span> <span class=\"string\">required</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">addons:</span></span><br><span class=\"line\"> <span class=\"attr\">ssh_known_hosts:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"string\">github.com</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"string\">git.coding.net</span></span><br><span class=\"line\"> <span class=\"attr\">apt:</span></span><br><span class=\"line\">   <span class=\"attr\">packages:</span></span><br><span class=\"line\">     <span class=\"bullet\">-</span> <span class=\"string\">nasm</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">env:</span></span><br><span class=\"line\"> <span class=\"attr\">global:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Tokyo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">node_js</span></span><br><span class=\"line\"><span class=\"attr\">node_js:</span> <span class=\"string\">node</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">branches:</span></span><br><span class=\"line\"> <span class=\"attr\">only:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"string\">source</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">git:</span></span><br><span class=\"line\"> <span class=\"attr\">depth:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"> <span class=\"attr\">submodules:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">cache:</span></span><br><span class=\"line\"> <span class=\"attr\">apt:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> <span class=\"attr\">npm:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">before_install:</span></span><br><span class=\"line\"> <span class=\"comment\"># Git Config</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">sed</span> <span class=\"string\">-i</span> <span class=\"string\">&#x27;s/git@github.com:/https:\\/\\/github.com\\//&#x27;</span> <span class=\"string\">.gitmodules</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;YOUR-GITHUB-NAME&quot;</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">&quot;YOUR-EMAIL&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># Restore last modified time</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">&quot;git ls-files -z | while read -d &#x27;&#x27; path; do touch -d \\&quot;$(git log -1 --format=\\&quot;@%ct\\&quot; \\&quot;$path\\&quot;)\\&quot; \\&quot;$path\\&quot;; done&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># Submodules</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">submodule</span> <span class=\"string\">update</span> <span class=\"string\">--recursive</span> <span class=\"string\">--remote</span> <span class=\"string\">--init</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># Deploy history</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">clone</span> <span class=\"string\">--branch=master</span> <span class=\"string\">--single-branch</span> <span class=\"string\">YOUR-BLOG-REPO</span> <span class=\"string\">.deploy_git</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># SSH Setup</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_693585a97b8c_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_693585a97b8c_iv</span> <span class=\"string\">-in</span> <span class=\"string\">deploy_key.enc</span> <span class=\"string\">-out</span> <span class=\"string\">deploy_key</span> <span class=\"string\">-d</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">eval</span> <span class=\"string\">&quot;$(ssh-agent -s)&quot;</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">chmod</span> <span class=\"number\">600</span> <span class=\"string\">./deploy_key</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">ssh-add</span> <span class=\"string\">./deploy_key</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">install:</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">before_script:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">script:</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">clean</span></span><br><span class=\"line\"> <span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">g</span> <span class=\"string\">-d</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Gitlab-CI\"><a href=\"#Gitlab-CI\" class=\"headerlink\" title=\"Gitlab CI\"></a>Gitlab CI</h4><p>GitLab offers a continuous integration service and pages service. If you add a <code>.gitlab-ci.yml</code> file to the root directory of your repository, and configure your GitLab project to use a Runner, then each commit or push, triggers your CI pipeline. The <code>.gitlab-ci.yml</code> file tells the GitLab runner what to do. By default it runs a pipeline with three stages: build, test, and deploy. You don&#39;t need to use all three stages; stages with no jobs are simply ignored. And at the end, your websites will be published on GitLab Host automatically.</p>\n<ol>\n<li>Add <code>.gitlab-ci.yml</code> to the root directory of your repository, and configure it. <figure class=\"highlight yml\"><figcaption><span>hexo/.gitlab-ci.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">image:</span> <span class=\"string\">node:lts</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">before_script:</span></span><br><span class=\"line\">  <span class=\"comment\"># Set TimeZone, eg: Asia/Shanghai</span></span><br><span class=\"line\">  <span class=\"comment\"># - export TZ=&#x27;Asia/Shanghai&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># Restore last modified time</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;git ls-files -z | while read -d &#x27;&#x27; path; do touch -d \\&quot;$(git log -1 --format=\\&quot;@%ct\\&quot; \\&quot;$path\\&quot;)\\&quot; \\&quot;$path\\&quot;; done&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">pages:</span></span><br><span class=\"line\">  <span class=\"attr\">stage:</span> <span class=\"string\">build</span></span><br><span class=\"line\">  <span class=\"attr\">cache:</span></span><br><span class=\"line\">    <span class=\"attr\">paths:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">node_modules/</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npx</span> <span class=\"string\">hexo</span> <span class=\"string\">deploy</span></span><br><span class=\"line\">  <span class=\"attr\">artifacts:</span></span><br><span class=\"line\">    <span class=\"attr\">paths:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">public</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure></li>\n<li>Upload <code>scaffolds</code>, <code>source</code>, <code>themes</code>, <code>.gitignore</code>, <code>.gitlab-ci.yml</code>, <code>_config.yml</code>, and <code>package.json</code> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRsYWIuY29tLw==\">your Gitlab repository<i class=\"fa fa-external-link-alt\"></i></span>. <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git init</span><br><span class=\"line\">$ ssh -T git@gitlab.com</span><br><span class=\"line\">$ git remote add origin YOUR-GITLAB-REPO-SSH-LINK</span><br><span class=\"line\">$ git add .</span><br><span class=\"line\">$ git commit -m &quot;COMMIT MESSAGE&quot;</span><br><span class=\"line\">$ git push -u origin master</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>Now, your static website is available at <code>https://yourname.gitlab.io/project</code> that is similar to GitHub. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRsYWIuY29tL2hlbHAvdXNlci9wcm9qZWN0L3BhZ2VzL2luZGV4Lm1k\">More GitLab Pages config in here<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<p>Of course, you can also pulish static website on GitHub Pages or others pages service. There are two ways to configure <code>.gitlab-ci.yml</code>:</p>\n<div class=\"tabs\" id=\"gitlab-ci\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#gitlab-ci-1\"><code>HTTPS</code></a></li><li class=\"tab\"><a href=\"#gitlab-ci-2\"><code>SSH</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"gitlab-ci-1\"><ul>\n<li>Get the Access Token: <code>Settings</code> → <code>Developer settings</code> → <code>Personal access token</code> → <code>Generate new token</code>. Set access rights according to the actual situation. It should be noted that the access token is only displayed once on this page, and it should be copied, otherwise it can only be regenerated.</li>\n<li>Click <code>SETTINGS-CI/CD → Variables</code> in Gitlab, and defined access token as custom variable <code>GITHUB_ACCESS_TOKEN</code>. Or set <code>USERNAME</code> <code>PASSWORD</code> variable for coding repo.</li>\n<li>Configure <code>.gitlab-ci.yml</code>: <strong>only add deploy stage at the end of this file</strong>  <figure class=\"highlight yml\"><figcaption><span>hexo/.gitlab-ci.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">github:</span></span><br><span class=\"line\">  <span class=\"attr\">stage:</span> <span class=\"string\">deploy</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">cd</span> <span class=\"string\">./public</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">init</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;YOUR-USER-NAME&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">&quot;YOUR-EMAIL&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">add</span> <span class=\"string\">.</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">commit</span> <span class=\"string\">-m</span> <span class=\"string\">&quot;gitlab-auto-deploy&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">push</span> <span class=\"string\">--force</span> <span class=\"string\">--quiet</span> <span class=\"string\">--set-upstream</span> <span class=\"string\">https://$GITHUB_ACCESS_TOKEN@github.com/username/username.github.io.git</span> <span class=\"string\">master</span> <span class=\"comment\"># replace github_access_token</span></span><br><span class=\"line\">  <span class=\"comment\"># - git config http.postBuffer 524288000</span></span><br><span class=\"line\">  <span class=\"comment\"># - git push --force --quiet --set-upstream https://$USERNAME:$PASSWORD@git.coding.net/username/reponame.git master # replace username &amp; password, please escape the password</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure></li>\n</ul></div><div class=\"tab-pane\" id=\"gitlab-ci-2\"><p>Deploy key is a SSH key set in your repo to grant client read-only (as well as r&#x2F;w, if you want) access to your repo. This method is suitable for most public blog repositories and there are no private sub-modules in the repositories.</p>\n<ul>\n<li><p>Generate a deploy key</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ ssh-keygen -t rsa -b 4096 -C &quot;&#123;email&#125;&quot; -f ~/.ssh/deploy_key</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Click <code>SETTINGS-CI/CD → Variables</code> in Gitlab, copy the content of private key and defined it as custom variable <code>DEPLOY_PRIVATE_KEY</code>.</p>\n</li>\n<li><p>Configure <code>.gitlab-ci.yml</code>: <strong>only update script in <code>before_script</code></strong></p>\n  <figure class=\"highlight yml\"><figcaption><span>hexo/.gitlab-ci.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">before_script:</span></span><br><span class=\"line\">  <span class=\"comment\"># Set TimeZone, eg: Asia/Shanghai</span></span><br><span class=\"line\">  <span class=\"comment\"># - export TZ=&#x27;Asia/Shanghai&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;YOUR-USER-NAME&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">&quot;YOUR-EMAIL&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Restore last modified time</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;git ls-files -z | while read -d &#x27;&#x27; path; do touch -d \\&quot;$(git log -1 --format=\\&quot;@%ct\\&quot; \\&quot;$path\\&quot;)\\&quot; \\&quot;$path\\&quot;; done&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># Install ssh-agent if not already installed, it is required by Docker.</span></span><br><span class=\"line\">  <span class=\"comment\"># (change apt-get to yum if you use a CentOS-based image)</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># Run ssh-agent (inside the build environment)</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">eval</span> <span class=\"string\">$(ssh-agent</span> <span class=\"string\">-s)</span></span><br><span class=\"line\">  <span class=\"comment\"># Add the SSH key stored in SSH_PRIVATE_KEY variable to the agent store</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">ssh-add</span> <span class=\"string\">&lt;(echo</span> <span class=\"string\">&quot;$DEPLOY_PRIVATE_KEY&quot;</span><span class=\"string\">)</span></span><br><span class=\"line\">  <span class=\"comment\"># For Docker builds disable host key checking. Be aware that by adding that</span></span><br><span class=\"line\">  <span class=\"comment\"># you are suspectible to man-in-the-middle attacks.</span></span><br><span class=\"line\">  <span class=\"comment\"># WARNING: Use this only with the Docker executor, if you use it with shell</span></span><br><span class=\"line\">  <span class=\"comment\"># you will overwrite your user&#x27;s SSH config.</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">mkdir</span> <span class=\"string\">-p</span> <span class=\"string\">~/.ssh</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;[[ -f /.dockerenv ]] &amp;&amp; echo -e &quot;Host *\\n\\tStrictHostKeyChecking no\\n\\n&quot; &gt; ~/.ssh/config&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># In order to properly check the server&#x27;s host key, assuming you created the</span></span><br><span class=\"line\">  <span class=\"comment\"># SSH_SERVER_HOSTKEYS variable previously, uncomment the following two lines</span></span><br><span class=\"line\">  <span class=\"comment\"># instead.</span></span><br><span class=\"line\">  <span class=\"comment\"># - mkdir -p ~/.ssh</span></span><br><span class=\"line\">  <span class=\"comment\"># - &#x27;[[ -f /.dockerenv ]] &amp;&amp; echo &quot;$SSH_SERVER_HOSTKEYS&quot; &gt; ~/.ssh/known_hosts&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Install pandoc, eg: v1.19.2.1</span></span><br><span class=\"line\">  <span class=\"comment\"># - wget https://github.com/jgm/pandoc/releases/download/1.19.2.1/pandoc-1.19.2.1-1-amd64.deb</span></span><br><span class=\"line\">  <span class=\"comment\"># - dpkg -i ./pandoc-1.19.2.1-1-amd64.deb</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">image:</span> <span class=\"string\">node:lts</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">pages:</span></span><br><span class=\"line\">  <span class=\"attr\">cache:</span></span><br><span class=\"line\">    <span class=\"attr\">paths:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">node_modules/</span></span><br><span class=\"line\">  <span class=\"attr\">script:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">npx</span> <span class=\"string\">hexo</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">artifacts:</span></span><br><span class=\"line\">    <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">public</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure></li>\n</ul></div></div></div>\n\n<div class=\"note danger\"><p>Variables are not masked, and their values can be shown in the job logs if explicitly asked to do so. So make sure gitlab pipelines can only be viewed by yourself.</p>\n</div>\n"},{"title":"Getting Started","url":"/docs/getting-started/index.html","content":"<h3 id=\"Hexo-Installation\"><a href=\"#Hexo-Installation\" class=\"headerlink\" title=\"Hexo Installation\"></a>Hexo Installation</h3><p>If this is your first time using Hexo, you can take some time to review the Hexo Docs to see <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">how to install Hexo<i class=\"fa fa-external-link-alt\"></i></span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2V0dXA=\">initialize a site<i class=\"fa fa-external-link-alt\"></i></span>. After the installation is successful, you should be able to execute <code>hexo</code> (or <code>npx hexo</code>) on the command line, and there must be <code>package.json</code>, <code>source</code>, <code>themes</code> and other directories in your <mark class=\"label info\">site root directory</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">_config.yml  node_modules  package-lock.json  package.json  scaffolds  <span class=\"built_in\">source</span>  themes</span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><p>If you are new to Node.js or Hexo, you can also modify the source code of an existing Hexo website instead of creating a new one, to help you understand how Hexo works. In fact, the document you are reading is generated by Hexo with NexT, and you can install it with the following command:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/theme-next-docs</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> theme-next-docs</span><br><span class=\"line\">$ npm install</span><br></pre></td></tr></table></figure></div>\n\n<p>Make sure that you have installed Hexo and created a site with it successfully, because the following documents require you to operate in the <mark class=\"label info\">site root directory</mark>.</p>\n<h3 id=\"Configuration\"><a href=\"#Configuration\" class=\"headerlink\" title=\"Configuration\"></a>Configuration</h3><p>There are two main configuration files using by Hexo and both called <code>_config.yml</code>:</p>\n<ol>\n<li>The first one is under <mark class=\"label info\">site root directory</mark>, which contains Hexo&#39;s config.</li>\n<li>The second one is under <mark class=\"label primary\">theme root directory</mark>, which is provided by NexT and contains theme&#39;s config.</li>\n</ol>\n<p>Let&#39;s call the first one – <mark class=\"label info\">site config file</mark>, and the second one – <mark class=\"label primary\">theme config file</mark>.<br>However, we do not recommend directly modifying the <mark class=\"label primary\">theme config file</mark>. It is quite often running into conflict status when updating NexT theme via <code>git pull</code>, or need to merge configurations manually when upgrading to new releases. For Hexo 5.0 or later, the theme can be installed through npm and it is also difficult to modify the <mark class=\"label primary\">theme config file</mark> in <code>node_modules</code>.</p>\n<p>In order to resolve this issue, we recommend using the <a href=\"/docs/getting-started/configuration.html\">Alternate Theme Config</a> feature to configure theme NexT.</p>\n<h3 id=\"NexT-Installation\"><a href=\"#NexT-Installation\" class=\"headerlink\" title=\"NexT Installation\"></a>NexT Installation</h3><p>The detailed steps to install or upgrade the theme are as follows.</p>\n<h4 id=\"Downloading-NexT\"><a href=\"#Downloading-NexT\" class=\"headerlink\" title=\"Downloading NexT\"></a>Downloading NexT</h4><p>It&#39;s easy to install Hexo theme: you can choose to install the theme through npm, or download the source code of the theme in the <code>themes</code> directory under <mark class=\"label info\">site root directory</mark>.</p>\n<div class=\"tabs\" id=\"downloading-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#downloading-next-1\">Using <code>npm</code></a></li><li class=\"tab\"><a href=\"#downloading-next-2\">Using <code>git</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"downloading-next-1\"><p>If you&#39;re using Hexo 5.0 or later, the simplest way to install is through npm.</p>\n<p>Open your Terminal, change to Hexo <mark class=\"label info\">site root directory</mark> and install NexT theme:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-theme-next</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"downloading-next-2\"><p>If you know about <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXQtc2NtLmNvbS8=\">Git<i class=\"fa fa-external-link-alt\"></i></span>, you can clone the whole repository and update it in any time with <code>git pull</code> command instead of downloading archive manually.</p>\n<p>Open your terminal, change to Hexo <mark class=\"label info\">site root directory</mark> and clone the latest master branch of NexT theme:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></div></div></div>\n\n<div class=\"note primary\"><p>You can also read <a href=\"/docs/getting-started/installation.html\">detailed installation instructions</a> if you want any other installation variant.</p>\n</div>\n\n<h4 id=\"Upgrading-NexT\"><a href=\"#Upgrading-NexT\" class=\"headerlink\" title=\"Upgrading NexT\"></a>Upgrading NexT</h4><p>A new version of NexT will be released every month. Please read the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L3JlbGVhc2Vz\">release notes<i class=\"fa fa-external-link-alt\"></i></span> before updating the theme. You can update NexT by the following command.</p>\n<div class=\"tabs\" id=\"upgrading-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#upgrading-next-1\">Using <code>npm</code></a></li><li class=\"tab\"><a href=\"#upgrading-next-2\">Using <code>git</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"upgrading-next-1\"><p>Install the latest version throuth npm:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-theme-next@latest</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"upgrading-next-2\"><p>Or update to the latest master branch:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/next</span><br><span class=\"line\">$ git pull origin master</span><br></pre></td></tr></table></figure></div></div></div>\n\n<div class=\"note warning\"><p>If you are still using NexT version 5 or 7, you can read <a href=\"/docs/getting-started/upgrade.html\">instructions for upgrading from legacy version</a>.</p>\n</div>\n\n<h4 id=\"Enabling-NexT\"><a href=\"#Enabling-NexT\" class=\"headerlink\" title=\"Enabling NexT\"></a>Enabling NexT</h4><p>Like all Hexo themes, after you download it, open <mark class=\"label info\">site config file</mark>, find <code>theme</code> section, and change its value to <code>next</code> (or another theme directory name).</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme:</span> <span class=\"string\">next</span></span><br></pre></td></tr></table></figure>\n\n<p>Now you have installed NexT theme and enabled it. The following steps will help you verify whether NexT is enabled correctly.</p>\n<h4 id=\"Checking-NexT\"><a href=\"#Checking-NexT\" class=\"headerlink\" title=\"Checking NexT\"></a>Checking NexT</h4><p>It&#39;s recommended to use <code>hexo clean</code> to clean Hexo&#39;s cache first.<br>Then start Hexo local server with debug parameter (by adding <code>--debug</code>), the whole command is <code>hexo s --debug</code>. You can see the output while running, and if you find problem, you can use the output to help others locate error better. When it prints:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure>\n\n<p>Now you can open <code>http://localhost:4000</code> in your browser, and check whether the site works correctly.</p>\n<div class=\"note success\"><p>If you find your site looks like this picture, you have installed it correctly. That&#39;s default NexT scheme – Muse.<br><img src=\"/images/next-default-scheme.png\" alt=\"Default Scheme – Muse\" loading=\"lazy\"></p>\n</div>\n\n<h3 id=\"Hexo-Configuration\"><a href=\"#Hexo-Configuration\" class=\"headerlink\" title=\"Hexo Configuration\"></a>Hexo Configuration</h3><p>The following settings in <mark class=\"label info\">site config file</mark> are very helpful for optimizing your website.</p>\n<h4 id=\"Configuring-Author\"><a href=\"#Configuring-Author\" class=\"headerlink\" title=\"Configuring Author\"></a>Configuring Author</h4><p>Edit <mark class=\"label info\">site config file</mark> and set the value of <code>author</code> to your nickname.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Site</span></span><br><span class=\"line\"><span class=\"attr\">author:</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Configuring-Description\"><a href=\"#Configuring-Description\" class=\"headerlink\" title=\"Configuring Description\"></a>Configuring Description</h4><p>Edit <mark class=\"label info\">site config file</mark> and set the value of <code>description</code> to your description, which can be a sentence you like.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Site</span></span><br><span class=\"line\"><span class=\"attr\">description:</span></span><br></pre></td></tr></table></figure>\n\n<p>After that we can <a href=\"/docs/getting-started/deployment.html\">configure deployment</a>.</p>\n<p>If everything is OK, in next steps we will change some settings including <a href=\"/docs/theme-settings/\">personalization</a> and <a href=\"/docs/third-party-services/\">third-party services integration</a>.</p>\n"},{"title":"Installation","url":"/docs/getting-started/installation.html","content":"<h3 id=\"Select-Version\"><a href=\"#Select-Version\" class=\"headerlink\" title=\"Select Version\"></a>Select Version</h3><p>A new version of NexT will be released every month. You can choose to install the latest version or choose a stable old version.</p>\n<div class=\"tabs\" id=\"download-next\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#download-next-1\"><mark class=\"label success\">Latest Master Branch</mark></a></li><li class=\"tab\"><a href=\"#download-next-2\">Latest Release Version</a></li><li class=\"tab\"><a href=\"#download-next-3\">Specific Release Version</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"download-next-1\"><p><strong>Option 1: Download the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L2FyY2hpdmUvbWFzdGVyLnppcA==\">Latest Master Branch<i class=\"fa fa-external-link-alt\"></i></span></strong></p>\n<p>May be <strong>unstable</strong>, but includes <strong>latest features</strong>. At most cases useful and recommended for advanced users and for developers.</p></div><div class=\"tab-pane\" id=\"download-next-2\"><p><strong>Option 2: Download the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L3JlbGVhc2VzL2xhdGVzdA==\">Latest Release Version<i class=\"fa fa-external-link-alt\"></i></span></strong></p>\n<p>At most cases <strong>stable</strong>. Recommended for beginners.</p></div><div class=\"tab-pane\" id=\"download-next-3\"><p><strong>Option 3: Download the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L3JlbGVhc2Vz\">Specific Release Version<i class=\"fa fa-external-link-alt\"></i></span></strong></p>\n<p>In rare cases useful, but not recommended.<br>You must define version. Let&#39;s take <code>v8.0.0</code> as an example. Replace it with any version from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0L3RhZ3M=\">tags list<i class=\"fa fa-external-link-alt\"></i></span>.</p></div></div></div>\n\n<h3 id=\"Get-NexT\"><a href=\"#Get-NexT\" class=\"headerlink\" title=\"Get NexT\"></a>Get NexT</h3><p>There are <strong>2 recommended ways</strong> to download NexT: <code>npm</code> and <code>git</code>. You need to <strong>choose only one</strong> of them. Other installation methods, such as downloading and decompressing the theme source code in zip format from GitHub, are no longer recommended, because the installed theme is difficult to manage and upgrade.</p>\n<p>Change dir to <mark class=\"label info\">site root directory</mark> in the command line first, and then continue with the following steps.</p>\n<h4 id=\"Using-npm\"><a href=\"#Using-npm\" class=\"headerlink\" title=\"Using npm\"></a>Using <code>npm</code></h4><p>If you&#39;re using Hexo 5.0 or later, you can install <code>hexo-theme-next</code> through npm.</p>\n<div class=\"tabs\" id=\"using-npm\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#using-npm-1\">Latest Release Version</a></li><li class=\"tab\"><a href=\"#using-npm-2\">Specific Release Version</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"using-npm-1\"><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-theme-next@latest</span><br></pre></td></tr></table></figure>\n\n<p>This variant will install the <strong>latest release version</strong>.</p></div><div class=\"tab-pane\" id=\"using-npm-2\"><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-theme-next@8.0.0</span><br></pre></td></tr></table></figure>\n\n<p>This variant will install the <strong>specific release version</strong>.</p></div></div></div>\n\n<h4 id=\"Using-git\"><a href=\"#Using-git\" class=\"headerlink\" title=\"Using git\"></a>Using <code>git</code></h4><div class=\"tabs\" id=\"using-git\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#using-git-1\">Latest Master Branch</a></li><li class=\"tab\"><a href=\"#using-git-2\">Specific Release Version</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"using-git-1\"><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>\n\n<p>Or download via mirror on GitLab:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://gitlab.com/hexo-theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>\n\n<p>This variant will install the <strong>whole repository</strong> (with <code>.git</code> directory inside).<br>And in any time you can update current version with git (instructions below) and switch to any tagged release or on latest master or any other branch.</p>\n<p>Get tags list:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/next</span><br><span class=\"line\">$ git tag -l</span><br><span class=\"line\">...</span><br><span class=\"line\">v8.0.0-rc.1</span><br><span class=\"line\">v8.0.0-rc.2</span><br><span class=\"line\">v8.0.0-rc.3</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>For example, you want to switch on <code>v8.0.0</code> tagged release version. Input the following command:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git checkout tags/v8.0.0</span><br><span class=\"line\">Note: switching to <span class=\"string\">&#x27;tags/v8.0.0&#x27;</span>.</span><br><span class=\"line\">...</span><br><span class=\"line\">HEAD is now at f27e45b Release v8.0.0</span><br></pre></td></tr></table></figure>\n\n<p>If you want to switch on latest release version without defining tag (optional)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git checkout $(git describe --tags $(git rev-list --tags --max-count=1))</span><br></pre></td></tr></table></figure>\n\n<p>And if you want to switch back on master branch, input this command:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git checkout master</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"using-git-2\"><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> --branch v8.0.0 https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>\n\n<p>Or download via mirror on GitLab:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> --branch v8.0.0 https://gitlab.com/hexo-theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>\n\n<p>This variant will install the <strong>specific release version</strong> (with <code>.git</code> directory inside).<br>And in any time you can switch to any tagged release, but with limit to specific version.</p></div></div></div>\n\n<p>And if you see any error message during update (something like <strong>«Commit your changes or stash them before you can merge»</strong>), recommended to learn <a href=\"/docs/getting-started/configuration.html\">Alternate Theme Config</a> feature. Howbeit, you can bypass update errors by <code>Commit</code>, <code>Stash</code> or <code>Discard</code> local changes. See <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE1NzQ1NDI0LzU4NjE0OTU=\">here<i class=\"fa fa-external-link-alt\"></i></span> how to do it.</p>\n<h3 id=\"Set-It-Up\"><a href=\"#Set-It-Up\" class=\"headerlink\" title=\"Set It Up\"></a>Set It Up</h3><p>When NexT download will complete, we must go back to previous guide and follow <a href=\"/docs/getting-started/#Enabling-NexT\">Enabling NexT</a> instructions.</p>\n"},{"title":"Upgrade","url":"/docs/getting-started/upgrade.html","content":"<h3 id=\"NexT-Compatibility-with-Hexo-Version\"><a href=\"#NexT-Compatibility-with-Hexo-Version\" class=\"headerlink\" title=\"NexT Compatibility with Hexo Version\"></a>NexT Compatibility with Hexo Version</h3><table>\n<thead>\n<tr>\n<th>Version</th>\n<th>Hexo 3.0.0-beta.4 or earlier</th>\n<th>Hexo 3.0.0-rc.1 ~ 3.9</th>\n<th>Hexo 4.0 ~ 4.2.1</th>\n<th>Hexo 5.0 or later</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>NexT v0.4.5.1 or earlier</td>\n<td>✅</td>\n<td>✅</td>\n<td>❌ Icon (2)</td>\n<td>❌ Icon (2)</td>\n</tr>\n<tr>\n<td>NexT v0.4.5.2 ~ v7.4.1</td>\n<td>⚠️ Data Files (1)</td>\n<td>✅</td>\n<td>❌ Icon (2)</td>\n<td>❌ Icon (2)</td>\n</tr>\n<tr>\n<td>NexT v7.4.2 ~ v8.1.0</td>\n<td>⚠️ Data Files (1)</td>\n<td>✅</td>\n<td>✅</td>\n<td>✅</td>\n</tr>\n<tr>\n<td>NexT v8.2.0 or later</td>\n<td>⚠️ Nunjucks (3)</td>\n<td>⚠️ Nunjucks (3)</td>\n<td>⚠️ Nunjucks (3)</td>\n<td>✅</td>\n</tr>\n</tbody></table>\n<p>(1): Hexo 3.0.0-beta.4 or earlier does not support Data Files.<br>(2): Icons may not be displayed normally.<br>(3): Nunjucks renderer plugin required.</p>\n<h3 id=\"NexT-Repositories\"><a href=\"#NexT-Repositories\" class=\"headerlink\" title=\"NexT Repositories\"></a>NexT Repositories</h3><p>Due to historical reasons, NexT has three different repositories.</p>\n<table>\n<thead>\n<tr>\n<th>Years</th>\n<th>Version</th>\n<th>Repository</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>2014 ~ 2017</td>\n<td>v5</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2lpc3NuYW4vaGV4by10aGVtZS1uZXh0\">https://github.com/iissnan/hexo-theme-next<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n<tr>\n<td>2018 ~ 2019</td>\n<td>v6 ~ v7</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0\">https://github.com/theme-next/hexo-theme-next<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n<tr>\n<td>2020</td>\n<td>v8</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0\">https://github.com/next-theme/hexo-theme-next<i class=\"fa fa-external-link-alt\"></i></span></td>\n</tr>\n</tbody></table>\n<h3 id=\"Upgrade-from-Legacy-Version\"><a href=\"#Upgrade-from-Legacy-Version\" class=\"headerlink\" title=\"Upgrade from Legacy Version\"></a>Upgrade from Legacy Version</h3><p>It&#39;s recommended to upgrade NexT to version 8 to get the latest features and supports in the new <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvaGV4by10aGVtZS1uZXh0\">Theme-Next<i class=\"fa fa-external-link-alt\"></i></span> repository.</p>\n<h4 id=\"Breaking-Changes\"><a href=\"#Breaking-Changes\" class=\"headerlink\" title=\"Breaking Changes\"></a>Breaking Changes</h4><p>There are some breaking changes that need attention when upgrading across versions.</p>\n<ol>\n<li><p>Update language configuration (for Simplified Chinese)<br> Since v6.0.3, <code>zh-Hans</code> has been renamed to <code>zh-CN</code>: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3JlbGVhc2VzL3RhZy92Ni4wLjM=\">https://github.com/theme-next/hexo-theme-next/releases/tag/v6.0.3<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p> Users upgrading to v6.0.3 and later need to explicitly modify the <code>language</code> configuration in <mark class=\"label info\">site config file</mark>, otherwise the language display is incorrect.</p>\n</li>\n<li><p>Since v8.0.0, all libraries under the <code>next/source/lib</code> directory was moved out to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25leHQtdGhlbWUvcGx1Z2lucw==\">@next-theme&#x2F;plugins<i class=\"fa fa-external-link-alt\"></i></span>. Please see this article for the new 3rd-party libraries installation method: <a href=\"/docs/third-party-services/#Adding-Plugins\">Adding Plugins</a>.</p>\n</li>\n</ol>\n<h4 id=\"Upgrade\"><a href=\"#Upgrade\" class=\"headerlink\" title=\"Upgrade\"></a>Upgrade</h4><p>So, NexT suggest to upgrade from version 5 or 7 to version 8 in this way:</p>\n<ol>\n<li>You need to do some copies of old NexT files:<br> 1.1. <code>_config.yml</code> or <code>next.yml</code> (if you used <a href=\"/docs/getting-started/configuration.html\">Alternate Theme Config</a>).<br> 1.2. Custom CSS files placed in <code>next/source/css/_custom/*</code> and <code>next/source/css/_variables/*</code> directories.<br> 1.3. Custom layout files placed in <code>next/layout/_custom/*</code>.<br> 1.4. Any another possible custom additions which can be finded by compare tools between repositories.</li>\n<li>Then rename the old NexT folder, for example, rename <code>next</code> to <code>next-old</code>.</li>\n<li>Install the new version according to the method provided in this article: <a href=\"/docs/getting-started/installation.html\">installation instructions</a>. Run <code>hexo clean</code> and <code>hexo s</code> to check whether the site works correctly.</li>\n<li>Update Hexo and Hexo plugin<br> If after completing the above steps, an error occurs when executing <code>hexo s</code> or <code>hexo g</code>, it means that there may be a conflict between the old version of Hexo &#x2F; Hexo plugin and the new version of the theme NexT. We recommend upgrading Hexo to versions 5.0 or later and upgrading Hexo plugins to the latest version. You can run <code>npm outdated</code> to see all the upgradeable plugins.</li>\n<li>If you see any bugs or you simply does not like this version, you can switch back to the old version at any time.</li>\n</ol>\n"},{"title":"Button","url":"/docs/tag-plugins/button.html","content":"<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>button.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% button url, text, icon [class], [title] %&#125;</span><br><span class=\"line\">&lt;!-- Tag Alias --&gt;</span><br><span class=\"line\">&#123;% btn url, text, icon [class], [title] %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">url     : Absolute or relative path to URL.</span><br><span class=\"line\">text    : Button text. Required if no icon specified.</span><br><span class=\"line\">icon    : Font Awesome icon name. Required if no text specified.</span><br><span class=\"line\">[class] : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">          Font Awesome class(es): fa-fw | fa-lg | fa-2x | fa-3x | fa-4x | fa-5x</span></span><br><span class=\"line\"><span class=\"code\">[title] : Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">          Tooltip at mouseover.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% button #, Text %&#125;</span><br></pre></td></tr></table></figure>\n\n<a class=\"btn\" href=\"#\">Text</a>\n\n<h4 id=\"Button-with-text-amp-title\"><a href=\"#Button-with-text-amp-title\" class=\"headerlink\" title=\"Button with text &amp; title\"></a>Button with text &amp; title</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% btn #, Text %&#125;&#123;% btn #, Text &amp; Title,, Title %&#125;</span><br></pre></td></tr></table></figure>\n\n<a class=\"btn\" href=\"#\">Text</a><a class=\"btn\" href=\"#\" title=\"Title\">Text & Title</a>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% btn #, Text %&#125; &#123;% btn #, Text &amp; Title,, Title %&#125;</span><br></pre></td></tr></table></figure>\n\n<a class=\"btn\" href=\"#\">Text</a> <a class=\"btn\" href=\"#\" title=\"Title\">Text & Title</a>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% btn #, Text %&#125;</span><br><span class=\"line\">&#123;% btn #, Text &amp; Title,, Title %&#125;</span><br></pre></td></tr></table></figure>\n\n<a class=\"btn\" href=\"#\">Text</a>\n<a class=\"btn\" href=\"#\" title=\"Title\">Text & Title</a>\n\n<h4 id=\"Button-with-icon\"><a href=\"#Button-with-icon\" class=\"headerlink\" title=\"Button with icon\"></a>Button with icon</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, home fa-5x %&#125;&#123;% btn #,, home fa-5x %&#125;&#123;% btn #,, home fa-5x %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, home fa-4x %&#125;&#123;% btn #,, home fa-4x %&#125;&#123;% btn #,, home fa-4x %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, home fa-3x %&#125;&#123;% btn #,, home fa-3x %&#125;&#123;% btn #,, home fa-3x %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, home fa-2x %&#125;&#123;% btn #,, home fa-2x %&#125;&#123;% btn #,, home fa-2x %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, home fa-lg %&#125;&#123;% btn #,, home fa-lg %&#125;&#123;% btn #,, home fa-lg %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, home %&#125;&#123;% btn #,, home %&#125;&#123;% btn #,, home %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-5x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-5x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-5x\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-4x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-4x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-4x\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-3x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-3x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-3x\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-2x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-2x\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-2x\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-lg\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-lg\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-lg\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-home\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-home\"></i></a></div>\n\n<h4 id=\"Button-with-text-amp-icon\"><a href=\"#Button-with-text-amp-icon\" class=\"headerlink\" title=\"Button with text &amp; icon\"></a>Button with text &amp; icon</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span>&#123;% btn #, Text &amp; Icon (buggy), home %&#125;</span><br><span class=\"line\">&#123;% btn #, Text &amp; Icon (fixed width), home fa-fw %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p><a class=\"btn\" href=\"#\"><i class=\"fa fa-home\"></i>Text & Icon (buggy)</a>\n<a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-fw\"></i>Text & Icon (fixed width)</a></p>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span>&#123;% btn #, Text &amp; Large Icon, home fa-fw fa-lg %&#125;</span><br><span class=\"line\">&#123;% btn #, Text &amp; Large Icon &amp; Title, home fa-fw fa-lg, Title %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-fw fa-lg\"></i>Text & Large Icon</a>\n<a class=\"btn\" href=\"#\" title=\"Title\"><i class=\"fa fa-home fa-fw fa-lg\"></i>Text & Large Icon & Title</a></p>\n\n<h4 id=\"Button-inside-text\"><a href=\"#Button-inside-text\" class=\"headerlink\" title=\"Button inside text\"></a>Button inside text</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">Lorem &#123;% btn #, Lorem, home fa-fw fa-lg %&#125; ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span><br><span class=\"line\"></span><br><span class=\"line\">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident &#123;% btn #, Ipsum, home fa-fw fa-lg %&#125;, sunt in culpa qui officia deserunt mollit anim id est laborum.</span><br></pre></td></tr></table></figure>\n\n<p>Lorem <a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-fw fa-lg\"></i>ipsum</a> dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<br>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure <a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-fw fa-lg\"></i>dolor</a> in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<br>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non <a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-fw fa-lg\"></i>proident</a>, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>\n<h4 id=\"Button-inside-other-tag\"><a href=\"#Button-inside-other-tag\" class=\"headerlink\" title=\"Button inside other tag\"></a>Button inside other tag</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note info %&#125;</span><br><span class=\"line\">&#123;% btn #, Text &amp; Icon, home fa-fw %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% btn #,, home, Title %&#125;&#123;% btn #, Text %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Link</span>](<span class=\"link\">#</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"note info\"><p><a class=\"btn\" href=\"#\"><i class=\"fa fa-home fa-fw fa-lg\"></i>Text &amp; Icon</a></p>\n<p><a class=\"btn\" href=\"#\" title=\"Title\"><i class=\"fa fa-home fa-lg\"></i></a><a class=\"btn\" href=\"#\">Text</a></p>\n<p><a href=\"#\">Link</a></p>\n</div>\n\n<h4 id=\"Button-margin\"><a href=\"#Button-margin\" class=\"headerlink\" title=\"Button margin\"></a>Button margin</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-center&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, heading %&#125;&#123;% btn #,, fab fa-edge %&#125;&#123;% btn #,, times %&#125;&#123;% btn #,, circle-notch %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, italic %&#125;&#123;% btn #,, fab fa-scribd %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span>&#123;% btn #,, fab fa-google %&#125;&#123;% btn #,, fab fa-chrome %&#125;&#123;% btn #,, fab fa-opera %&#125;&#123;% btn #,, gem fa-rotate-270 %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<div class=\"text-center\"><div><a class=\"btn\" href=\"#\"><i class=\"fa fa-heading\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fab fa-edge\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-times\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-circle-notch\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fa fa-italic\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fab fa-scribd\"></i></a></div>\n<div><a class=\"btn\" href=\"#\"><i class=\"fab fa-google\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fab fa-chrome\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fab fa-opera\"></i></a><a class=\"btn\" href=\"#\"><i class=\"fa fa-gem fa-rotate-270\"></i></a></div></div>\n\n<h4 id=\"Button-with-relative-URL\"><a href=\"#Button-with-relative-URL\" class=\"headerlink\" title=\"Button with relative URL\"></a>Button with relative URL</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-center&quot;</span>&gt;</span></span>&#123;% btn #, Previous Chapter, arrow-left fa-fw fa-lg, Previous Chapter (Full Image) %&#125; &#123;% btn #, Next Chapter, arrow-right fa-fw fa-lg, Next Chapter (Label) %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<div class=\"text-center\"><a class=\"btn\" href=\"/docs/tag-plugins/full-image\" title=\"Previous Chapter (Full Image)\"><i class=\"fa fa-arrow-left fa-fw fa-lg\"></i>Previous Chapter</a> <a class=\"btn\" href=\"/docs/tag-plugins/label\" title=\"Next Chapter (Label)\"><i class=\"fa fa-arrow-right fa-fw fa-lg\"></i>Next Chapter</a></div>\n\n<h4 id=\"Button-with-absolute-URL\"><a href=\"#Button-with-absolute-URL\" class=\"headerlink\" title=\"Button with absolute URL\"></a>Button with absolute URL</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-center&quot;</span>&gt;</span></span>&#123;% btn https://github.com, GitHub, fab fa-github fa-fw fa-lg, GitHub %&#125;<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<div class=\"text-center\"><a class=\"btn\" href=\"https://github.com\" title=\"GitHub\"><i class=\"fab fa-github fa-fw fa-lg\"></i>GitHub</a></div>\n"},{"title":"Caniuse","url":"/docs/tag-plugins/caniuse.html","content":"<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>caniuse.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% caniuse feature @ [periods] %&#125;</span><br><span class=\"line\">&lt;!-- Tag Alias --&gt;</span><br><span class=\"line\">&#123;% can feature @ [periods] %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">feature   : Search for the feature you want on https://caniuse.com, then click on the hash sign to the left of the search result heading and you will get the unique name of this feature.</span><br><span class=\"line\">[periods] : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">            Select the browser versions to display. Supported values: past_1, past_2, past_3, past_4, past_5, current, future_3, future_2, future_1. If this value is empty, the default value &#x27;current&#x27; will be used.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><h4 id=\"Caniuse-without-periods\"><a href=\"#Caniuse-without-periods\" class=\"headerlink\" title=\"Caniuse without periods\"></a>Caniuse without periods</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% caniuse fetch %&#125;</span><br></pre></td></tr></table></figure>\n\n<iframe data-feature=\"fetch\" src=\"https://caniuse.bitsofco.de/embed/index.html?feat=fetch&periods=current&accessible-colours=false\" frameborder=\"0\" width=\"100%\" height=\"400px\"></iframe>\n\n<h4 id=\"Caniuse-with-current-period\"><a href=\"#Caniuse-with-current-period\" class=\"headerlink\" title=\"Caniuse with current period\"></a>Caniuse with current period</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% caniuse sharedarraybuffer @ current %&#125;</span><br></pre></td></tr></table></figure>\n\n<iframe data-feature=\"sharedarraybuffer\" src=\"https://caniuse.bitsofco.de/embed/index.html?feat=sharedarraybuffer&periods=current&accessible-colours=false\" frameborder=\"0\" width=\"100%\" height=\"400px\"></iframe>\n\n<h4 id=\"Caniuse-with-future-periods\"><a href=\"#Caniuse-with-future-periods\" class=\"headerlink\" title=\"Caniuse with future periods\"></a>Caniuse with future periods</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% caniuse loading-lazy-attr @ future<span class=\"emphasis\">_3,future_</span>2,future<span class=\"emphasis\">_1 %&#125;</span></span><br></pre></td></tr></table></figure>\n\n<iframe data-feature=\"loading-lazy-attr\" src=\"https://caniuse.bitsofco.de/embed/index.html?feat=loading-lazy-attr&periods=future_3,future_2,future_1&accessible-colours=false\" frameborder=\"0\" width=\"100%\" height=\"400px\"></iframe>\n\n<h4 id=\"Caniuse-with-past-periods\"><a href=\"#Caniuse-with-past-periods\" class=\"headerlink\" title=\"Caniuse with past periods\"></a>Caniuse with past periods</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% caniuse link-rel-modulepreload @ past<span class=\"emphasis\">_1,past_</span>2,past<span class=\"emphasis\">_3,past_</span>4,past<span class=\"emphasis\">_5 %&#125;</span></span><br></pre></td></tr></table></figure>\n\n<iframe data-feature=\"link-rel-modulepreload\" src=\"https://caniuse.bitsofco.de/embed/index.html?feat=link-rel-modulepreload&periods=past_1,past_2,past_3,past_4,past_5&accessible-colours=false\" frameborder=\"0\" width=\"100%\" height=\"400px\"></iframe>\n"},{"title":"Group Pictures","url":"/docs/tag-plugins/group-pictures.html","content":"<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>group-pictures.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% grouppicture [group]-[layout] %&#125;&#123;% endgrouppicture %&#125;</span><br><span class=\"line\">&#123;% gp [group]-[layout] %&#125;&#123;% endgp %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[group]  : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">           Total number of pictures to add in the group.</span></span><br><span class=\"line\"><span class=\"code\">[layout] : Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">           Default picture under the group to show.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% grouppicture 6-3 %&#125;</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">&#123;% endgrouppicture %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"group-picture\"><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div></div></div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% gp 5-2 %&#125;</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">![](<span class=\"link\">/images/next.svg</span>)</span><br><span class=\"line\">&#123;% endgp %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"group-picture\"><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div></div><div class=\"group-picture-row\"><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div><div class=\"group-picture-column\"><img src=\"/images/next.svg\" loading=\"lazy\"></div></div></div>\n"},{"title":"Tag Plugins","url":"/docs/tag-plugins/index.html","content":"<p>Tag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdGFnLXBsdWdpbnM=\">Hexo has a lot of tags<i class=\"fa fa-external-link-alt\"></i></span> which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags are provided by NexT:</p>\n<ul>\n<li><a href=\"/docs/tag-plugins/button.html\">Button</a></li>\n<li><a href=\"/docs/tag-plugins/caniuse.html\">Caniuse</a></li>\n<li><a href=\"#Centered-Quote\">Centered Quote</a></li>\n<li><a href=\"/docs/tag-plugins/group-pictures.html\">Group Pictures</a></li>\n<li><a href=\"/docs/tag-plugins/label.html\">Label</a></li>\n<li><a href=\"/docs/tag-plugins/link-grid.html\">Link Grid</a></li>\n<li><a href=\"/docs/tag-plugins/mermaid.html\">Mermaid</a></li>\n<li><a href=\"/docs/tag-plugins/note.html\">Note</a></li>\n<li><a href=\"/docs/tag-plugins/pdf.html\">PDF</a></li>\n<li><a href=\"/docs/tag-plugins/tabs.html\">Tabs</a></li>\n<li><a href=\"#Video\">Video</a></li>\n</ul>\n<p>These tag plugins are only available in the theme NexT. If you switch to other Hexo themes, they may cause rendering errors.</p>\n<h3 id=\"Centered-Quote\"><a href=\"#Centered-Quote\" class=\"headerlink\" title=\"Centered Quote\"></a>Centered Quote</h3><p>This tag will make a quote with two lines before and after it, and text quoted will be centered. When using centered quote, if we have multi-line text, and each line has a different length, the quote won&#39;t be symmetrical, so it&#39;s recommended to use when only have single line text. For example before article all after article to make a summary.</p>\n<h4 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h4><figure class=\"highlight html\"><figcaption><span>center-quote.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% centerquote %&#125;Something&#123;% endcenterquote %&#125;</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Tag Alias --&gt;</span></span><br><span class=\"line\">&#123;% cq %&#125;Something&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% cq %&#125;Elegant in code, simple in core&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote class=\"blockquote-center\">\n<p>Elegant in code, simple in core</p>\n\n</blockquote>\n\n<h3 id=\"Video\"><a href=\"#Video\" class=\"headerlink\" title=\"Video\"></a>Video</h3><h4 id=\"Usage-1\"><a href=\"#Usage-1\" class=\"headerlink\" title=\"Usage\"></a>Usage</h4><figure class=\"highlight md\"><figcaption><span>video.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% video url %&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Examples-1\"><a href=\"#Examples-1\" class=\"headerlink\" title=\"Examples\"></a>Examples</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% video https://example.com/sample.mp4 %&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% video /path/to/your/video.mp4 %&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"Label","url":"/docs/tag-plugins/label.html","content":"<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>label.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% label [class]@text %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[class] : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">          Supported values: default | primary | success | info | warning | danger.</span></span><br><span class=\"line\"><span class=\"code\">          If not specified, the default style of the browser will be used,</span></span><br><span class=\"line\"><span class=\"code\">          which may be different in different browsers.</span></span><br><span class=\"line\"><span class=\"code\">text    : &#x27;@text&#x27; can be specified with or without space</span></span><br><span class=\"line\"><span class=\"code\">          E.g. &#x27;success @text&#x27; is the same as &#x27;success@text&#x27;.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">Lorem &#123;% label @ipsum %&#125; &#123;% label primary@dolor sit %&#125; amet, consectetur &#123;% label success@adipiscing elit, %&#125; sed &#123;% label info@do eiusmod %&#125; tempor incididunt ut labore et dolore magna aliqua.</span><br><span class=\"line\"></span><br><span class=\"line\">Ut enim <span class=\"emphasis\">*&#123;% label warning @ad %&#125;*</span> minim veniam, quis <span class=\"strong\">**&#123;% label danger@nostrud %&#125;**</span> exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</span><br><span class=\"line\"></span><br><span class=\"line\">Duis aute irure dolor in reprehenderit in voluptate ~~&#123;% label default @velit %&#125;~~ <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">mark</span>&gt;</span></span>esse<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">mark</span>&gt;</span></span> cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span><br></pre></td></tr></table></figure>\n\n<p>Lorem <mark class=\"label \">ipsum</mark> <mark class=\"label primary\">dolor sit</mark> amet, consectetur <mark class=\"label success\">adipiscing elit,</mark> sed <mark class=\"label info\">do eiusmod</mark> tempor incididunt ut labore et dolore magna aliqua.</p>\n<p>Ut enim <em><mark class=\"label warning\">ad</mark></em> minim veniam, quis <strong><mark class=\"label danger\">nostrud</mark></strong> exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>\n<p>Duis aute irure dolor in reprehenderit in voluptate <del><mark class=\"label default\">velit</mark></del> <mark>esse</mark> cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>\n"},{"title":"Link Grid","url":"/docs/tag-plugins/link-grid.html","content":"<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>link-grid.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% linkgrid [image] [delimiter] [comment] %&#125;&#123;% endlinkgrid %&#125;</span><br><span class=\"line\">&#123;% lg [image] [delimiter] [comment] %&#125;&#123;% endlg %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[image]     : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">              Default image URL.</span></span><br><span class=\"line\"><span class=\"code\">[delimiter] : Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">              If the optional delimiter parameter is given, it is interpreted as the delimiter of items in each line.</span></span><br><span class=\"line\"><span class=\"code\">[comment]   : Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">              If the optional comment parameter is given, it is interpreted as the symbol to comment out a line.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% linkgrid %&#125;</span><br><span class=\"line\">Theme NexT | https://theme-next.js.org/ | Stay Simple. Stay NexT. | /images/apple-touch-icon-next.png</span><br><span class=\"line\">Theme NexT | https://theme-next.js.org/ | Stay Simple. Stay NexT. | /images/apple-touch-icon-next.png</span><br><span class=\"line\">Theme NexT | https://theme-next.js.org/ | Stay Simple. Stay NexT. | /images/apple-touch-icon-next.png</span><br><span class=\"line\">Theme NexT | https://theme-next.js.org/ | Stay Simple. Stay NexT. | /images/apple-touch-icon-next.png</span><br><span class=\"line\">% Theme NexT | https://theme-next.js.org/ | Stay Simple. Stay NexT. | /images/apple-touch-icon-next.png</span><br><span class=\"line\">&#123;% endlinkgrid %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"link-grid\"><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div></div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% lg /images/apple-touch-icon-next.png , %&#125;</span><br><span class=\"line\">Theme NexT , https://theme-next.js.org/ , Stay Simple. Stay NexT. , /images/apple-touch-icon-next.png</span><br><span class=\"line\">Theme NexT , https://theme-next.js.org/ , Stay Simple. Stay NexT. , /images/apple-touch-icon-next.png</span><br><span class=\"line\">Theme NexT , https://theme-next.js.org/ , Stay Simple. Stay NexT. , /images/apple-touch-icon-next.png</span><br><span class=\"line\">% Theme NexT , https://theme-next.js.org/ , Stay Simple. Stay NexT. , /images/apple-touch-icon-next.png</span><br><span class=\"line\">&#123;% endlg %&#125;</span><br></pre></td></tr></table></figure>\n<div class=\"link-grid\"><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div><div class=\"link-grid-container\">\n<object class=\"link-grid-image\" data=\"/images/apple-touch-icon-next.png\"></object>\n<p>Theme NexT</p><p>Stay Simple. Stay NexT.</p>\n<a href=\"https://theme-next.js.org/\"></a>\n</div></div>\n"},{"title":"Mermaid","url":"/docs/tag-plugins/mermaid.html","content":"<h3 id=\"Settings\"><a href=\"#Settings\" class=\"headerlink\" title=\"Settings\"></a>Settings</h3><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Mermaid tag</span></span><br><span class=\"line\"><span class=\"attr\">mermaid:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Available themes: default | dark | forest | neutral</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span> <span class=\"string\">forest</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>mermaid.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid type %&#125;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type : type of the mermaid chart, visit https://github.com/mermaid-js/mermaid for more information.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid graph TD %&#125;</span><br><span class=\"line\">A[Hard] --&gt;|Text| B(Round)</span><br><span class=\"line\">B --&gt; C&#123;Decision&#125;</span><br><span class=\"line\">C --&gt;|One| D[Result 1]</span><br><span class=\"line\">C --&gt;|Two| E[Result 2]</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\ngraph TD\nA[Hard] --&gt;|Text| B(Round)\nB --&gt; C{Decision}\nC --&gt;|One| D[Result 1]\nC --&gt;|Two| E[Result 2]\n</pre>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid sequenceDiagram %&#125;</span><br><span class=\"line\">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class=\"line\">loop Healthcheck</span><br><span class=\"line\"><span class=\"code\">    John-&gt;&gt;John: Fight against hypochondria</span></span><br><span class=\"line\"><span class=\"code\">end</span></span><br><span class=\"line\"><span class=\"code\">Note right of John: Rational thoughts!</span></span><br><span class=\"line\"><span class=\"code\">John--&gt;&gt;Alice: Great!</span></span><br><span class=\"line\"><span class=\"code\">John-&gt;&gt;Bob: How about you?</span></span><br><span class=\"line\"><span class=\"code\">Bob--&gt;&gt;John: Jolly good!</span></span><br><span class=\"line\"><span class=\"code\">&#123;% endmermaid %&#125;</span></span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\nsequenceDiagram\nAlice-&gt;&gt;John: Hello John, how are you?\nloop Healthcheck\n    John-&gt;&gt;John: Fight against hypochondria\nend\nNote right of John: Rational thoughts!\nJohn--&gt;&gt;Alice: Great!\nJohn-&gt;&gt;Bob: How about you?\nBob--&gt;&gt;John: Jolly good!\n</pre>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid gantt %&#125;</span><br><span class=\"line\">section Section</span><br><span class=\"line\">Completed :done,    des1, 2014-01-06,2014-01-08</span><br><span class=\"line\">Active        :active,  des2, 2014-01-07, 3d</span><br><span class=\"line\">Parallel 1   :         des3, after des1, 1d</span><br><span class=\"line\">Parallel 2   :         des4, after des1, 1d</span><br><span class=\"line\">Parallel 3   :         des5, after des3, 1d</span><br><span class=\"line\">Parallel 4   :         des6, after des4, 1d</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\ngantt\nsection Section\nCompleted :done,    des1, 2014-01-06,2014-01-08\nActive        :active,  des2, 2014-01-07, 3d\nParallel 1   :         des3, after des1, 1d\nParallel 2   :         des4, after des1, 1d\nParallel 3   :         des5, after des3, 1d\nParallel 4   :         des6, after des4, 1d\n</pre>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid classDiagram %&#125;</span><br><span class=\"line\">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class=\"line\">&lt;<span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">interface</span>&gt;</span></span>&gt; Class01</span><br><span class=\"line\">Class09 --&gt; C2 : Where am i?</span><br><span class=\"line\">Class09 --* C3</span><br><span class=\"line\">Class09 --|&gt; Class07</span><br><span class=\"line\">Class07 : equals()</span><br><span class=\"line\">Class07 : Object[] elementData</span><br><span class=\"line\">Class01 : size()</span><br><span class=\"line\">Class01 : int chimp</span><br><span class=\"line\">Class01 : int gorilla</span><br><span class=\"line\">class Class10 &#123;</span><br><span class=\"line\">  &lt;<span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">service</span>&gt;</span></span>&gt;</span><br><span class=\"line\">  int id</span><br><span class=\"line\">  size()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\nclassDiagram\nClass01 &lt;|-- AveryLongClass : Cool\n&lt;&lt;interface&gt;&gt; Class01\nClass09 --&gt; C2 : Where am i?\nClass09 --* C3\nClass09 --|&gt; Class07\nClass07 : equals()\nClass07 : Object[] elementData\nClass01 : size()\nClass01 : int chimp\nClass01 : int gorilla\nclass Class10 {\n  &lt;&lt;service&gt;&gt;\n  int id\n  size()\n}\n</pre>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid stateDiagram %&#125;</span><br><span class=\"line\">[<span class=\"emphasis\">*] --&gt; Still</span></span><br><span class=\"line\"><span class=\"emphasis\">Still --&gt; [*</span>]</span><br><span class=\"line\">Still --&gt; Moving</span><br><span class=\"line\">Moving --&gt; Still</span><br><span class=\"line\">Moving --&gt; Crash</span><br><span class=\"line\">Crash --&gt; [<span class=\"emphasis\">*]</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endmermaid %&#125;</span></span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\nstateDiagram\n[*] --&gt; Still\nStill --&gt; [*]\nStill --&gt; Moving\nMoving --&gt; Still\nMoving --&gt; Crash\nCrash --&gt; [*]\n</pre>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid pie %&#125;</span><br><span class=\"line\">&quot;Dogs&quot; : 386</span><br><span class=\"line\">&quot;Cats&quot; : 85</span><br><span class=\"line\">&quot;Rats&quot; : 15</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\npie\n&quot;Dogs&quot; : 386\n&quot;Cats&quot; : 85\n&quot;Rats&quot; : 15\n</pre>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% mermaid journey %&#125;</span><br><span class=\"line\">title My working day</span><br><span class=\"line\">section Go to work</span><br><span class=\"line\">  Make tea: 5: Me</span><br><span class=\"line\">  Go upstairs: 3: Me</span><br><span class=\"line\">  Do work: 1: Me, Cat</span><br><span class=\"line\">section Go home</span><br><span class=\"line\">  Go downstairs: 5: Me</span><br><span class=\"line\">  Sit down: 3: Me</span><br><span class=\"line\">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure>\n\n<pre class=\"mermaid\">\njourney\ntitle My working day\nsection Go to work\n  Make tea: 5: Me\n  Go upstairs: 3: Me\n  Do work: 1: Me, Cat\nsection Go home\n  Go downstairs: 5: Me\n  Sit down: 3: Me\n</pre>\n"},{"title":"Note (Bootstrap Callout)","url":"/docs/tag-plugins/note.html","content":"<h3 id=\"Settings\"><a href=\"#Settings\" class=\"headerlink\" title=\"Settings\"></a>Settings</h3><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">note:</span></span><br><span class=\"line\">  <span class=\"comment\"># Note tag style values:</span></span><br><span class=\"line\">  <span class=\"comment\">#  - simple    bs-callout old alert style. Default.</span></span><br><span class=\"line\">  <span class=\"comment\">#  - modern    bs-callout new (v2-v3) alert style.</span></span><br><span class=\"line\">  <span class=\"comment\">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class=\"line\">  <span class=\"comment\">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">simple</span></span><br><span class=\"line\">  <span class=\"attr\">icons:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class=\"line\">  <span class=\"comment\"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class=\"line\">  <span class=\"attr\">light_bg_offset:</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>note.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note [class] [no-icon] [summary] %&#125;</span><br><span class=\"line\">Any content (support inline tags too).</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[class]   : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">            Supported values: default | primary | success | info | warning | danger.</span></span><br><span class=\"line\"><span class=\"code\">[no-icon] : Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">            Disable icon in note.</span></span><br><span class=\"line\"><span class=\"code\">[summary] : Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">            Optional summary of the note.</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br><span class=\"line\">All parameters are optional.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Header</span></span><br><span class=\"line\">(without define class style)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note \"><h4 id=\"Header\"><a href=\"#Header\" class=\"headerlink\" title=\"Header\"></a>Header</h4><p>(without define class style)</p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note default %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Default Header</span></span><br><span class=\"line\">Welcome to [<span class=\"string\">Hexo!</span>](<span class=\"link\">https://hexo.io</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note default\"><h4 id=\"Default-Header\"><a href=\"#Default-Header\" class=\"headerlink\" title=\"Default Header\"></a>Default Header</h4><p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo!<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note primary %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Primary Header</span></span><br><span class=\"line\"><span class=\"strong\">**Welcome**</span> to [<span class=\"string\">Hexo!</span>](<span class=\"link\">https://hexo.io</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note primary\"><h4 id=\"Primary-Header\"><a href=\"#Primary-Header\" class=\"headerlink\" title=\"Primary Header\"></a>Primary Header</h4><p><strong>Welcome</strong> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo!<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note info %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Info Header</span></span><br><span class=\"line\"><span class=\"strong\">**Welcome**</span> to [<span class=\"string\">Hexo!</span>](<span class=\"link\">https://hexo.io</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><h4 id=\"Info-Header\"><a href=\"#Info-Header\" class=\"headerlink\" title=\"Info Header\"></a>Info Header</h4><p><strong>Welcome</strong> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo!<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note success %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Success Header</span></span><br><span class=\"line\"><span class=\"strong\">**Welcome**</span> to [<span class=\"string\">Hexo!</span>](<span class=\"link\">https://hexo.io</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note success\"><h4 id=\"Success-Header\"><a href=\"#Success-Header\" class=\"headerlink\" title=\"Success Header\"></a>Success Header</h4><p><strong>Welcome</strong> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo!<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note warning %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Warning Header</span></span><br><span class=\"line\"><span class=\"strong\">**Welcome**</span> to [<span class=\"string\">Hexo!</span>](<span class=\"link\">https://hexo.io</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><h4 id=\"Warning-Header\"><a href=\"#Warning-Header\" class=\"headerlink\" title=\"Warning Header\"></a>Warning Header</h4><p><strong>Welcome</strong> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo!<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note danger %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Danger Header</span></span><br><span class=\"line\"><span class=\"strong\">**Welcome**</span> to [<span class=\"string\">Hexo!</span>](<span class=\"link\">https://hexo.io</span>)</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note danger\"><h4 id=\"Danger-Header\"><a href=\"#Danger-Header\" class=\"headerlink\" title=\"Danger Header\"></a>Danger Header</h4><p><strong>Welcome</strong> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo!<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note info no-icon %&#125;</span><br><span class=\"line\"><span class=\"section\">#### No icon note</span></span><br><span class=\"line\">Note <span class=\"strong\">**without**</span> icon: <span class=\"code\">`note info no-icon`</span></span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note info no-icon\"><h4 id=\"No-icon-note\"><a href=\"#No-icon-note\" class=\"headerlink\" title=\"No icon note\"></a>No icon note</h4><p>Note <strong>without</strong> icon: <code>note info no-icon</code></p>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note primary This is a summary %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Details and summary</span></span><br><span class=\"line\">Note with summary: <span class=\"code\">`note primary This is a summary`</span></span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<details class=\"note primary\"><summary><p>This is a summary</p>\n</summary>\n<h4 id=\"Details-and-summary\"><a href=\"#Details-and-summary\" class=\"headerlink\" title=\"Details and summary\"></a>Details and summary</h4><p>Note with summary: <code>note primary This is a summary</code></p>\n\n</details>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note info no-icon This is a summary %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Details and summary (No icon)</span></span><br><span class=\"line\">Note with summary: <span class=\"code\">`note info no-icon This is a summary`</span></span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<details class=\"note info no-icon\"><summary><p>This is a summary</p>\n</summary>\n<h4 id=\"Details-and-summary-No-icon\"><a href=\"#Details-and-summary-No-icon\" class=\"headerlink\" title=\"Details and summary (No icon)\"></a>Details and summary (No icon)</h4><p>Note with summary: <code>note info no-icon This is a summary</code></p>\n\n</details>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note success %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Codeblock in note</span></span><br><span class=\"line\">&#123;% code %&#125;</span><br><span class=\"line\">code block in note tag</span><br><span class=\"line\">code block in note tag</span><br><span class=\"line\">code block in note tag</span><br><span class=\"line\">&#123;% endcode %&#125;</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note success\"><h4 id=\"Codeblock-in-note\"><a href=\"#Codeblock-in-note\" class=\"headerlink\" title=\"Codeblock in note\"></a>Codeblock in note</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">code block in note tag</span><br><span class=\"line\">code block in note tag</span><br><span class=\"line\">code block in note tag</span><br></pre></td></tr></table></figure></div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% note default %&#125;</span><br><span class=\"line\"><span class=\"section\">#### Lists in note</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> ul</span><br><span class=\"line\"><span class=\"bullet\">*</span> ul</span><br><span class=\"line\"><span class=\"bullet\">  *</span> ul</span><br><span class=\"line\"><span class=\"bullet\">  *</span> ul</span><br><span class=\"line\"><span class=\"bullet\">*</span> ul</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">1.</span> ol</span><br><span class=\"line\"><span class=\"bullet\">2.</span> ol</span><br><span class=\"line\"><span class=\"bullet\">  1.</span> ol</span><br><span class=\"line\"><span class=\"bullet\">  2.</span> ol</span><br><span class=\"line\"><span class=\"bullet\">3.</span> ol</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note default\"><h4 id=\"Lists-in-note\"><a href=\"#Lists-in-note\" class=\"headerlink\" title=\"Lists in note\"></a>Lists in note</h4><ul>\n<li>ul</li>\n<li>ul<ul>\n<li>ul</li>\n<li>ul</li>\n</ul>\n</li>\n<li>ul</li>\n</ul>\n<ol>\n<li>ol</li>\n<li>ol</li>\n<li>ol</li>\n<li>ol</li>\n<li>ol</li>\n</ol>\n</div>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">#### Table in Note</span></span><br><span class=\"line\">&#123;% note default %&#125;</span><br><span class=\"line\">| 1 | 2 |</span><br><span class=\"line\">| - | - |</span><br><span class=\"line\">| 3 | 4 |</span><br><span class=\"line\">| 5 | 6 |</span><br><span class=\"line\">| 7 | 8 |</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"note default\"><h4 id=\"Table-in-note\"><a href=\"#Table-in-note\" class=\"headerlink\" title=\"Table in note\"></a>Table in note</h4><table>\n<thead>\n<tr>\n<th>1</th>\n<th>2</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>3</td>\n<td>4</td>\n</tr>\n<tr>\n<td>5</td>\n<td>6</td>\n</tr>\n<tr>\n<td>7</td>\n<td>8</td>\n</tr>\n</tbody></table>\n</div>\n"},{"title":"PDF","url":"/docs/tag-plugins/pdf.html","content":"<h3 id=\"Settings\"><a href=\"#Settings\" class=\"headerlink\" title=\"Settings\"></a>Settings</h3><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">pdf:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Default height</span></span><br><span class=\"line\">  <span class=\"attr\">height:</span> <span class=\"string\">500px</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>pdf.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% pdf url [height] %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">url      : The URL (Absolute path) of the PDF file.</span><br><span class=\"line\">[height] : Optional parameter.</span><br><span class=\"line\"><span class=\"code\">           Height of the PDF display element, e.g. 800px.</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>The loading of pdf.js or pdf file might be blocked by CORS policy. If you want to load resources from another website, make sure the Access-Control-Allow-Origin header is set correctly. See also <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbg==\">Access-Control-Allow-Origin - HTTP | MDN<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</div>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% pdf https://example.com/sample.pdf %&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% pdf /path/to/your/file.pdf 600px %&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"Tabs","url":"/docs/tag-plugins/tabs.html","content":"<h3 id=\"Settings\"><a href=\"#Settings\" class=\"headerlink\" title=\"Settings\"></a>Settings</h3><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">tabs:</span></span><br><span class=\"line\">  <span class=\"attr\">transition:</span></span><br><span class=\"line\">    <span class=\"attr\">tabs:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h3><figure class=\"highlight md\"><figcaption><span>tabs.js</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Unique name, [index] %&#125;</span><br><span class=\"line\">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class=\"line\">Any content (support inline tags too).</span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Unique name   : Unique name of tabs block tag without comma.</span><br><span class=\"line\"><span class=\"code\">                Will be used in #id&#x27;s as prefix for each tab with their index numbers.</span></span><br><span class=\"line\"><span class=\"code\">                If there are whitespaces in name, for generate #id all whitespaces will replaced by dashes.</span></span><br><span class=\"line\"><span class=\"code\">                Only for current url of post/page must be unique!</span></span><br><span class=\"line\"><span class=\"code\">[index]       : Index number of active tab.</span></span><br><span class=\"line\"><span class=\"code\">                If not specified, first tab (1) will be selected.</span></span><br><span class=\"line\"><span class=\"code\">                If index is -1, no tab will be selected. It&#x27;s will be something like spoiler.</span></span><br><span class=\"line\"><span class=\"code\">                Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">[Tab caption] : Caption of current tab.</span></span><br><span class=\"line\"><span class=\"code\">                If not caption specified, unique name with tab index suffix will be used as caption of tab.</span></span><br><span class=\"line\"><span class=\"code\">                If not caption specified, but specified icon, caption will empty.</span></span><br><span class=\"line\"><span class=\"code\">                Optional parameter.</span></span><br><span class=\"line\"><span class=\"code\">[@icon]       : Font Awesome icon name.</span></span><br><span class=\"line\"><span class=\"code\">                Can be specified with or without space; e.g. &#x27;Tab caption @icon&#x27; is the same as &#x27;Tab caption@icon&#x27;.</span></span><br><span class=\"line\"><span class=\"code\">                Optional parameter.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs First unique name %&#125;</span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"first-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#first-unique-name-1\">First unique name 1</a></li><li class=\"tab\"><a href=\"#first-unique-name-2\">First unique name 2</a></li><li class=\"tab\"><a href=\"#first-unique-name-3\">First unique name 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"first-unique-name-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"first-unique-name-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"first-unique-name-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-with-3rd-tab-selected\"><a href=\"#Tabs-with-3rd-tab-selected\" class=\"headerlink\" title=\"Tabs with 3rd tab selected\"></a>Tabs with 3rd tab selected</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Second unique name, 3 %&#125;</span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"second-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab\"><a href=\"#second-unique-name-1\">Second unique name 1</a></li><li class=\"tab\"><a href=\"#second-unique-name-2\">Second unique name 2</a></li><li class=\"tab active\"><a href=\"#second-unique-name-3\">Second unique name 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane\" id=\"second-unique-name-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"second-unique-name-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane active\" id=\"second-unique-name-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-with-no-tab-selected\"><a href=\"#Tabs-with-no-tab-selected\" class=\"headerlink\" title=\"Tabs with no tab selected\"></a>Tabs with no tab selected</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Third unique name, -1 %&#125;</span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"third-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab\"><a href=\"#third-unique-name-1\">Third unique name 1</a></li><li class=\"tab\"><a href=\"#third-unique-name-2\">Third unique name 2</a></li><li class=\"tab\"><a href=\"#third-unique-name-3\">Third unique name 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane\" id=\"third-unique-name-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"third-unique-name-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"third-unique-name-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-with-custom-labels\"><a href=\"#Tabs-with-custom-labels\" class=\"headerlink\" title=\"Tabs with custom labels\"></a>Tabs with custom labels</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Fourth unique name %&#125;</span><br><span class=\"line\">&lt;!-- tab Solution 1 --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab Solution 2 --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab Solution 3 --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"fourth-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#fourth-unique-name-1\">Solution 1</a></li><li class=\"tab\"><a href=\"#fourth-unique-name-2\">Solution 2</a></li><li class=\"tab\"><a href=\"#fourth-unique-name-3\">Solution 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"fourth-unique-name-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"fourth-unique-name-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"fourth-unique-name-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-with-icons-only\"><a href=\"#Tabs-with-icons-only\" class=\"headerlink\" title=\"Tabs with icons only\"></a>Tabs with icons only</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Fifth unique name %&#125;</span><br><span class=\"line\">&lt;!-- tab @text-width --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab @font --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab @bold --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"fifth-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#fifth-unique-name-1\"><i class=\"fa fa-text-width\"></i></a></li><li class=\"tab\"><a href=\"#fifth-unique-name-2\"><i class=\"fa fa-font\"></i></a></li><li class=\"tab\"><a href=\"#fifth-unique-name-3\"><i class=\"fa fa-bold\"></i></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"fifth-unique-name-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"fifth-unique-name-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"fifth-unique-name-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-with-icons-and-labels\"><a href=\"#Tabs-with-icons-and-labels\" class=\"headerlink\" title=\"Tabs with icons and labels\"></a>Tabs with icons and labels</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Sixth unique name %&#125;</span><br><span class=\"line\">&lt;!-- tab Solution 1@text-width --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab Solution 2@font --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab Solution 3@bold --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"sixth-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#sixth-unique-name-1\"><i class=\"fa fa-text-width\"></i>Solution 1</a></li><li class=\"tab\"><a href=\"#sixth-unique-name-2\"><i class=\"fa fa-font\"></i>Solution 2</a></li><li class=\"tab\"><a href=\"#sixth-unique-name-3\"><i class=\"fa fa-bold\"></i>Solution 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"sixth-unique-name-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"sixth-unique-name-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"sixth-unique-name-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-permalinks-test\"><a href=\"#Tabs-permalinks-test\" class=\"headerlink\" title=\"Tabs permalinks test\"></a>Tabs permalinks test</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab one</span>](<span class=\"link\">#tab-one</span>).</span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab one 1</span>](<span class=\"link\">#tab-one-1</span>).</span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab one 2</span>](<span class=\"link\">#tab-one-2</span>).</span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab one 3</span>](<span class=\"link\">#tab-one-3</span>).</span><br><span class=\"line\"></span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab two</span>](<span class=\"link\">#tab-two</span>).</span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab two 1</span>](<span class=\"link\">#tab-two-1</span>).</span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab two 2</span>](<span class=\"link\">#tab-two-2</span>).</span><br><span class=\"line\">Permalink for &gt; [<span class=\"string\">Tab two 3</span>](<span class=\"link\">#tab-two-3</span>).</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% tabs Tab one %&#125;</span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% tabs Tab two %&#125;</span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 3.**</span></span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Permalink for &gt; <a href=\"#tab-one\">Tab one</a>.<br>Permalink for &gt; <a href=\"#tab-one-1\">Tab one 1</a>.<br>Permalink for &gt; <a href=\"#tab-one-2\">Tab one 2</a>.<br>Permalink for &gt; <a href=\"#tab-one-3\">Tab one 3</a>.</p>\n<p>Permalink for &gt; <a href=\"#tab-two\">Tab two</a>.<br>Permalink for &gt; <a href=\"#tab-two-1\">Tab two 1</a>.<br>Permalink for &gt; <a href=\"#tab-two-2\">Tab two 2</a>.<br>Permalink for &gt; <a href=\"#tab-two-3\">Tab two 3</a>.</p>\n<div class=\"tabs\" id=\"tab-one\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tab-one-1\">Tab one 1</a></li><li class=\"tab\"><a href=\"#tab-one-2\">Tab one 2</a></li><li class=\"tab\"><a href=\"#tab-one-3\">Tab one 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-one-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"tab-one-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"tab-one-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<div class=\"tabs\" id=\"tab-two\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tab-two-1\">Tab two 1</a></li><li class=\"tab\"><a href=\"#tab-two-2\">Tab two 2</a></li><li class=\"tab\"><a href=\"#tab-two-3\">Tab two 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-two-1\"><p><strong>This is Tab 1.</strong></p></div><div class=\"tab-pane\" id=\"tab-two-2\"><p><strong>This is Tab 2.</strong></p></div><div class=\"tab-pane\" id=\"tab-two-3\"><p><strong>This is Tab 3.</strong></p></div></div></div>\n\n<h4 id=\"Tabs-with-other-tags\"><a href=\"#Tabs-with-other-tags\" class=\"headerlink\" title=\"Tabs with other tags\"></a>Tabs with other tags</h4><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% tabs Tags %&#125;</span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 1.**</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">1.</span> One</span><br><span class=\"line\"><span class=\"bullet\">2.</span> Two</span><br><span class=\"line\"><span class=\"bullet\">3.</span> Three</span><br><span class=\"line\"></span><br><span class=\"line\">Indented code block:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">    nano /etc</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br><span class=\"line\">Tagged code block:</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% code %&#125;</span><br><span class=\"line\">code tag</span><br><span class=\"line\">code tag</span><br><span class=\"line\">code tag</span><br><span class=\"line\">&#123;% endcode %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% note default %&#125;</span><br><span class=\"line\">Note default tag.</span><br><span class=\"line\">&#123;% endnote %&#125;</span><br><span class=\"line\">&lt;!-- endtab --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- tab --&gt;</span><br><span class=\"line\"><span class=\"strong\">**This is Tab 2.**</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Five</span><br><span class=\"line\"><span class=\"bullet\">*</span> Six</span><br><span class=\"line\"><span class=\"bullet\">*</span> Seven</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% note primary %&#125;</span><br><span class=\"line\">&#123;% youtube Kt7u5kr<span class=\"emphasis\">_P5o %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Tab 3.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% subtabs Sub Tabs %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Sub Tab 1.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note success %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note warning %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Sub Tab 2.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note success %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note danger %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Sub Tab 3.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% subtabs Sub-Sub Tabs %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Sub-Sub Tab 1 of Sub Tab 3.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note success %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Sub-Sub Tab 2 of Sub Tab 3.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note success %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note warning %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- tab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">**This is Sub-Sub Tab 3 of Sub Tab 3.**</span></span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note success %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note warning %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% note danger %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endnote %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endsubtabs %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endsubtabs %&#125;</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">&lt;!-- endtab --&gt;</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;% endtabs %&#125;</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"tags\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tags-1\">Tags 1</a></li><li class=\"tab\"><a href=\"#tags-2\">Tags 2</a></li><li class=\"tab\"><a href=\"#tags-3\">Tags 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tags-1\"><p><strong>This is Tab 1.</strong></p>\n<ol>\n<li>One</li>\n<li>Two</li>\n<li>Three</li>\n</ol>\n<p>Indented code block:</p>\n<pre><code>nano /etc\n</code></pre>\n<p>Tagged code block:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">code tag</span><br><span class=\"line\">code tag</span><br><span class=\"line\">code tag</span><br></pre></td></tr></table></figure>\n\n<div class=\"note default\"><p>Note default tag.</p>\n</div></div><div class=\"tab-pane\" id=\"tags-2\"><p><strong>This is Tab 2.</strong></p>\n<ul>\n<li>Five</li>\n<li>Six</li>\n<li>Seven</li>\n</ul>\n<div class=\"note primary\"><div class=\"video-container\"><iframe src=\"https://www.youtube.com/embed/Kt7u5kr_P5o\" frameborder=\"0\" loading=\"lazy\" allowfullscreen></iframe></div></div></div><div class=\"tab-pane\" id=\"tags-3\"><p><strong>This is Tab 3.</strong></p>\n<div class=\"tabs\" id=\"sub-tabs\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#sub-tabs-1\">Sub Tabs 1</a></li><li class=\"tab\"><a href=\"#sub-tabs-2\">Sub Tabs 2</a></li><li class=\"tab\"><a href=\"#sub-tabs-3\">Sub Tabs 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"sub-tabs-1\"><p><strong>This is Sub Tab 1.</strong></p>\n<div class=\"note success\"><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</p>\n<div class=\"note warning\"><p>Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</p>\n</div>\n\n<p>Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</p>\n</div></div><div class=\"tab-pane\" id=\"sub-tabs-2\"><p><strong>This is Sub Tab 2.</strong></p>\n<div class=\"note success\"><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</p>\n<p>Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</p>\n<div class=\"note danger\"><p>Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</p>\n</div></div></div><div class=\"tab-pane\" id=\"sub-tabs-3\"><p><strong>This is Sub Tab 3.</strong></p>\n<div class=\"tabs\" id=\"sub-sub-tabs\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#sub-sub-tabs-1\">Sub-Sub Tabs 1</a></li><li class=\"tab\"><a href=\"#sub-sub-tabs-2\">Sub-Sub Tabs 2</a></li><li class=\"tab\"><a href=\"#sub-sub-tabs-3\">Sub-Sub Tabs 3</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"sub-sub-tabs-1\"><p><strong>This is Sub-Sub Tab 1 of Sub Tab 3.</strong></p>\n<div class=\"note success\"><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</p>\n<p>Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</p>\n<p>Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</p>\n</div></div><div class=\"tab-pane\" id=\"sub-sub-tabs-2\"><p><strong>This is Sub-Sub Tab 2 of Sub Tab 3.</strong></p>\n<div class=\"note success\"><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</p>\n<div class=\"note warning\"><p>Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</p>\n<p>Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</p>\n</div>\n</div></div><div class=\"tab-pane\" id=\"sub-sub-tabs-3\"><p><strong>This is Sub-Sub Tab 3 of Sub Tab 3.</strong></p>\n<div class=\"note success\"><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Phasellus hendrerit. Pellentesque aliquet nibh nec urna. In nisi neque, aliquet vel, dapibus id, mattis vel, nisi. Sed pretium, ligula sollicitudin laoreet viverra, tortor libero sodales leo, eget blandit nunc tortor eu nibh. Nullam mollis. Ut justo. Suspendisse potenti. Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</p>\n<div class=\"note warning\"><p>Sed egestas, ante et vulputate volutpat, eros pede semper est, vitae luctus metus libero eu augue. Morbi purus libero, faucibus adipiscing, commodo quis, gravida id, est. Sed lectus. Praesent elementum hendrerit tortor. Sed semper lorem at felis. Vestibulum volutpat, lacus a ultrices sagittis, mi neque euismod dui, eu pulvinar nunc sapien ornare nisl. Phasellus pede arcu, dapibus eu, fermentum et, dapibus sed, urna.</p>\n<div class=\"note danger\"><p>Morbi interdum mollis sapien. Sed ac risus. Phasellus lacinia, magna a ullamcorper laoreet, lectus arcu pulvinar risus, vitae facilisis libero dolor a purus. Sed vel lacus. Mauris nibh felis, adipiscing varius, adipiscing in, lacinia vel, tellus. Suspendisse ac urna. Etiam pellentesque mauris ut lectus. Nunc tellus ante, mattis eget, gravida vitae, ultricies ac, leo. Integer leo pede, ornare a, lacinia eu, vulputate vel, nisl.</p>\n</div>\n</div>\n</div></div></div></div></div></div></div></div></div></div>\n"},{"title":"Custom Pages","url":"/docs/theme-settings/custom-pages.html","content":"<h3 id=\"Custom-Page-Support\"><a href=\"#Custom-Page-Support\" class=\"headerlink\" title=\"Custom Page Support\"></a>Custom Page Support</h3><p>Next allows users to add custom pages in menu.</p>\n<div class=\"tabs\" id=\"adding-custom-page\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#adding-custom-page-1\">Adding New Page →</a></li><li class=\"tab\"><a href=\"#adding-custom-page-2\">Setting Front-matter Values →</a></li><li class=\"tab\"><a href=\"#adding-custom-page-3\">Editting Menu</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"adding-custom-page-1\"><p>Change to <mark class=\"label info\">site root directory</mark> in your terminal. Use <code>hexo new page custom-name</code> to create a new <code>custom-name</code> page:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ hexo new page custom-name</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"adding-custom-page-2\"><p>Front-matter is a block of YAML or JSON at the beginning of the file that is used to configure settings for your writings. Settings front-matter values and more detailed can be found in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZnJvbnQtbWF0dGVy\">front-matter<i class=\"fa fa-external-link-alt\"></i></span>. You can also add contents in <code>custom-name/index.md</code> if you like.</p>\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">title: custom-name</span><br><span class=\"line\"><span class=\"section\">date: 2014-12-22 12:39:04</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"adding-custom-page-3\"><p>Add <code>custom-name</code> to <code>menu</code> by editing <mark class=\"label primary\">theme config file</mark>, like adding <code>about</code> page:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-home</span></span><br><span class=\"line\">  <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-archive</span></span><br><span class=\"line\">  <span class=\"attr\">about:</span> <span class=\"string\">/about/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-user</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<p>If you want to add Tags or Categories page, please continue reading.<br>Please read <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZnJvbnQtbWF0dGVyI0NhdGVnb3JpZXMtYW1wLVRhZ3M=\">Hexo&#39;s Docs of Categories &amp; Tags<i class=\"fa fa-external-link-alt\"></i></span> to know how to add tags or categories for articles.<br>Following code shows you a example of article with tags:</p>\n<div class=\"tabs\" id=\"tags-variants\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tags-variants-1\">Variant 1</a></li><li class=\"tab\"><a href=\"#tags-variants-2\">Variant 2</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tags-variants-1\"><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">title: Tags Testing Article</span><br><span class=\"line\"><span class=\"section\">tags: [Testing, Another Tag]</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"tags-variants-2\"><figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">title: Tags Testing Article</span><br><span class=\"line\">tags:</span><br><span class=\"line\"><span class=\"bullet\">  -</span> Testing</span><br><span class=\"line\"><span class=\"section\">  - Another Tag</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Use-Archive-Page-as-Home-Page\"><a href=\"#Use-Archive-Page-as-Home-Page\" class=\"headerlink\" title=\"Use Archive Page as Home Page\"></a>Use Archive Page as Home Page</h3><p>You can configure the path of archive and index generator in <mark class=\"label info\">site config file</mark>, e.g.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">archive_dir:</span> <span class=\"string\">/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">index_generator:</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">archives</span></span><br><span class=\"line\">  <span class=\"attr\">per_page:</span> <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"attr\">order_by:</span> <span class=\"string\">-date</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Adding-«Tags»-Page\"><a href=\"#Adding-«Tags»-Page\" class=\"headerlink\" title=\"Adding «Tags» Page\"></a>Adding «Tags» Page</h3><p>Adding «Tags» page and show «Tags» link in menu. «Tags» page will show all tags of site. If no article has tags, this page will leave blank.</p>\n<div class=\"tabs\" id=\"adding-tags-page\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#adding-tags-page-1\">Adding New Page →</a></li><li class=\"tab\"><a href=\"#adding-tags-page-2\">Setting Page Type →</a></li><li class=\"tab\"><a href=\"#adding-tags-page-3\">Editting Menu</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"adding-tags-page-1\"><p>Change to <mark class=\"label info\">site root directory</mark> in your terminal. Use <code>hexo new page tags</code> to create a new <code>tags</code> page:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ hexo new page tags</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"adding-tags-page-2\"><p>Edit the new page and change the type to <code>tags</code>, theme will show tags cloud automatically in this page. Page content looks like following:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">title: Tags</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"section\">type: tags</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"adding-tags-page-3\"><p>Add <code>tags</code> to <code>menu</code> by editing <mark class=\"label primary\">theme config file</mark>, like following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-home</span></span><br><span class=\"line\">  <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-archive</span></span><br><span class=\"line\">  <span class=\"attr\">tags:</span> <span class=\"string\">/tags/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-tags</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<div class=\"note warning\"><p>If you enable any comment system for your site, comments will be shown for all posts and pages.<br>See <a href=\"/docs/third-party-services/comments.html#How-to-Disable-Comments-on-Page\">«How to Disable Comments on Page»</a> if you want to do it for pages like <code>tags</code> or <code>categories</code>.</p>\n</div>\n\n<h4 id=\"Tagcloud\"><a href=\"#Tagcloud\" class=\"headerlink\" title=\"Tagcloud\"></a>Tagcloud</h4><p>By default, NexT has setted font color and size for tagcloud in tags page.<br>From NexT v7.0.2 you can customize them, just set related values in <mark class=\"label primary\">theme config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TagCloud settings for tags page.</span></span><br><span class=\"line\"><span class=\"attr\">tagcloud:</span></span><br><span class=\"line\">  <span class=\"attr\">min:</span> <span class=\"number\">12</span> <span class=\"comment\"># Minimun font size in px</span></span><br><span class=\"line\">  <span class=\"attr\">max:</span> <span class=\"number\">30</span> <span class=\"comment\"># Maxium font size in px</span></span><br><span class=\"line\">  <span class=\"attr\">amount:</span> <span class=\"number\">200</span> <span class=\"comment\"># Total amount of tags</span></span><br><span class=\"line\">  <span class=\"attr\">orderby:</span> <span class=\"string\">name</span> <span class=\"comment\"># Order of tags</span></span><br><span class=\"line\">  <span class=\"attr\">order:</span> <span class=\"number\">1</span> <span class=\"comment\"># Sort order</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Adding-«Categories»-Page\"><a href=\"#Adding-«Categories»-Page\" class=\"headerlink\" title=\"Adding «Categories» Page\"></a>Adding «Categories» Page</h3><div class=\"note default\"><p>«Categories» page can be added in similar way as <a href=\"#Adding-%C2%ABTags%C2%BB-Page\">«Tags» page</a>, only name there is difference: just need to replace <code>tags</code> with <code>categories</code>.</p>\n</div>\n\n<h3 id=\"Adding-Google-Calendar-Page\"><a href=\"#Adding-Google-Calendar-Page\" class=\"headerlink\" title=\"Adding Google Calendar Page\"></a>Adding Google Calendar Page</h3><div class=\"tabs\" id=\"calendar\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#calendar-1\">Setting Google Calendar →</a></li><li class=\"tab\"><a href=\"#calendar-2\">Adding Schedule Page →</a></li><li class=\"tab\"><a href=\"#calendar-3\">Setting Page Type →</a></li><li class=\"tab\"><a href=\"#calendar-4\">Editting Menu</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"calendar-1\"><div class=\"tabs\" id=\"calendar1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#calendar1-1\">Get calendar ID and API KEY →</a></li><li class=\"tab\"><a href=\"#calendar1-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"calendar1-1\"><p>Login to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb25zb2xlLmRldmVsb3BlcnMuZ29vZ2xlLmNvbS9mbG93cy9lbmFibGVhcGk/YXBpaWQ9Y2FsZW5kYXI=\">Google developers<i class=\"fa fa-external-link-alt\"></i></span> and add Google Calendar API, you will get your calendar ID and API KEY. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vY2FsZW5kYXIvcXVpY2tzdGFydC9qcw==\">More detailed documentation<i class=\"fa fa-external-link-alt\"></i></span></p>\n<p>References:</p>\n<ul>\n<li>API Documentation: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vZ29vZ2xlLWFwcHMvY2FsZW5kYXIvdjMvcmVmZXJlbmNlL2V2ZW50cy9saXN0\">https://developers.google.com/google-apps/calendar/v3/reference/events/list<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li>To get api_key: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb25zb2xlLmRldmVsb3BlcnMuZ29vZ2xlLmNvbS8=\">https://console.developers.google.com<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li>Create &amp; manage a public Google calendar: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmdvb2dsZS5jb20vY2FsZW5kYXIvYW5zd2VyLzM3MDgz\">https://support.google.com/calendar/answer/37083<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul></div><div class=\"tab-pane\" id=\"calendar1-2\"><p>You can enable it by setting values in <code>calendar</code> part. Copy the value of calendar ID and API KEY in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">calendar:</span></span><br><span class=\"line\">  <span class=\"attr\">calendar_id:</span> <span class=\"string\">&lt;required&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">api_key:</span> <span class=\"string\">&lt;required&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">orderBy:</span> <span class=\"string\">startTime</span></span><br><span class=\"line\">  <span class=\"attr\">showLocation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">offsetMax:</span> <span class=\"number\">72</span></span><br><span class=\"line\">  <span class=\"attr\">offsetMin:</span> <span class=\"number\">4</span></span><br><span class=\"line\">  <span class=\"attr\">showDeleted:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">singleEvents:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">maxResults:</span> <span class=\"number\">250</span></span><br></pre></td></tr></table></figure></div></div></div></div><div class=\"tab-pane\" id=\"calendar-2\"><p>Change to <mark class=\"label info\">site root directory</mark> in your terminal. Use <code>hexo new page schedule</code> to create a new <code>schedule</code> page:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ hexo new page schedule</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"calendar-3\"><p>Edit the new page and change the type to <code>schedule</code>, theme will show schedule automatically in this page. Page content looks like following:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">title: Schedule</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"section\">type: schedule</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"calendar-4\"><p>Add <code>schedule</code> to <code>menu</code> by editing <mark class=\"label primary\">theme config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-home</span></span><br><span class=\"line\">  <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-archive</span></span><br><span class=\"line\">  <span class=\"attr\">schedule:</span> <span class=\"string\">/schedule/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-calendar</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Custom-404-Page\"><a href=\"#Custom-404-Page\" class=\"headerlink\" title=\"Custom 404 Page\"></a>Custom 404 Page</h3><p>In your terminal, change to the <code>source</code> folder of <mark class=\"label info\">site root directory</mark>. Create a new folder called <code>404</code>, then create a new page in it:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ hexo new page 404</span><br></pre></td></tr></table></figure>\n\n<p>Make sure <code>relative_link</code> is disabled in <mark class=\"label info\">site config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">relative_link:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>Whether users can be redirected to the 404 page depends on the settings of the website hosting service or web server, not Hexo. For example, if you use Nginx as the server, you also need to configure the 404 page in <code>nginx.conf</code> file.</p>\n</div>\n\n<h4 id=\"Commonweal-404\"><a href=\"#Commonweal-404\" class=\"headerlink\" title=\"Commonweal 404\"></a>Commonweal 404</h4><p>If you would like to enable <code>commonweal 404</code> (A service provided by Tencent in China), Edit <code>404/index.md</code> like this:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: &#x27;404&#x27;</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"section\">comments: false</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span> <span class=\"attr\">homePageUrl</span>=<span class=\"string\">&quot;/&quot;</span> <span class=\"attr\">homePageName</span>=<span class=\"string\">&quot;Back to home&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>You can also add any content you want to it.</p>\n<p>Add <code>404</code> to <code>menu</code> by editing <mark class=\"label primary\">theme config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-home</span></span><br><span class=\"line\">  <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-archive</span></span><br><span class=\"line\">  <span class=\"attr\">commonweal:</span> <span class=\"string\">/404/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-heartbeat</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Footer","url":"/docs/theme-settings/footer.html","content":"<h3 id=\"Site-Footer-Setting\"><a href=\"#Site-Footer-Setting\" class=\"headerlink\" title=\"Site Footer Setting\"></a>Site Footer Setting</h3><h4 id=\"Site-Start-Time\"><a href=\"#Site-Start-Time\" class=\"headerlink\" title=\"Site Start Time\"></a>Site Start Time</h4><p>By default NexT shows current year in the footer like <code>© 2020</code>. You can configure it to show the time gap like <code>© 2015 - 2020</code> by editing values in <code>since</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">since:</span> <span class=\"number\">2020</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Site-Footer-Icon\"><a href=\"#Site-Footer-Icon\" class=\"headerlink\" title=\"Site Footer Icon\"></a>Site Footer Icon</h4><p>By default NexT shows red <code>heart</code> icon <a class=\"btn\" href=\"#\"><i class=\"fa fa-heart\"></i></a> with animation between year and copyright information in the footer. You can configure it by editing values in <code>icon</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<div class=\"tabs\" id=\"icon\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#icon-1\"><code>name</code></a></li><li class=\"tab\"><a href=\"#icon-2\"><code>animated</code></a></li><li class=\"tab\"><a href=\"#icon-3\"><code>color</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"icon-1\"><p>The name of footer icon can be founded in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb250YXdlc29tZS5jb20v\">Font Awesome<i class=\"fa fa-external-link-alt\"></i></span> site. <code>heart</code> is recommended.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">icon:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">fa</span> <span class=\"string\">fa-user</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"icon-2\"><p>Set up animated of footer icon by changing the value of <code>icon.animated</code>:</p>\n<ul>\n<li><strong><code>true</code></strong> → Icon will be animated.</li>\n<li><code>false</code> → Icon will not be animated.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">icon:</span></span><br><span class=\"line\">    <span class=\"attr\">animated:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"icon-3\"><p>Set up color of footer icon by changing the value of <code>icon.color</code>. Please use Hex Code, and red (#ff0000) is recommended for <code>heart</code> icon.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">icon:</span></span><br><span class=\"line\">    <span class=\"attr\">color:</span> <span class=\"string\">&quot;#808080&quot;</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Site-Copyright-Name\"><a href=\"#Site-Copyright-Name\" class=\"headerlink\" title=\"Site Copyright Name\"></a>Site Copyright Name</h4><p>By default NexT shows the name of <code>author</code> from <mark class=\"label info\">site config file</mark>. You can configure it by editing values in <code>copyright</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">copyright:</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>This option will only customize the author name in the footer. The name in the Creative Commons License section at the end of each post is not affected.</p>\n</div>\n\n<h4 id=\"Site-Platform-Information\"><a href=\"#Site-Platform-Information\" class=\"headerlink\" title=\"Site Platform Information\"></a>Site Platform Information</h4><p>By default NexT shows Hexo and Theme &amp; scheme information like <code>Powered by Hexo &amp; NexT.Muse</code>. You can configure it by editing <code>powered</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">powered:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Site-Beian-Information\"><a href=\"#Site-Beian-Information\" class=\"headerlink\" title=\"Site Beian Information\"></a>Site Beian Information</h4><p>Beian information is for Chinese users. By default NexT will not show the information of beian. You can configure it by editing values in <code>beian</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">  <span class=\"attr\">beian:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">icp:</span> <span class=\"string\">京ICP备</span> <span class=\"number\">1234567890</span><span class=\"string\">号-1</span></span><br><span class=\"line\">    <span class=\"attr\">gongan_id:</span> <span class=\"number\">1234567890</span></span><br><span class=\"line\">    <span class=\"attr\">gongan_num:</span> <span class=\"string\">京公网安备</span> <span class=\"number\">1234567890</span><span class=\"string\">号</span></span><br><span class=\"line\">    <span class=\"attr\">gongan_icon_url:</span> <span class=\"string\">/uploads/beian.png</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Theme Settings","url":"/docs/theme-settings/index.html","content":"<p>One of the guiding principles of NexT is to hide complex details and give you a simple but flexible config, so you can use it easily.</p>\n<div class=\"note info\"><p>The values given in the document are often typical allowable values rather than default values. They may be different from those in <mark class=\"label primary\">theme config file</mark>.</p>\n</div>\n\n<h3 id=\"NexT-Quick-Start\"><a href=\"#NexT-Quick-Start\" class=\"headerlink\" title=\"NexT Quick Start\"></a>NexT Quick Start</h3><h4 id=\"Cache-Support\"><a href=\"#Cache-Support\" class=\"headerlink\" title=\"Cache Support\"></a>Cache Support</h4><p>NexT v6+ allows to cache content generation. Set the value <code>enable</code> to <code>true</code> in <code>cache</code> section in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Allow to cache content generation.</span></span><br><span class=\"line\"><span class=\"attr\">cache:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Minify-Support\"><a href=\"#Minify-Support\" class=\"headerlink\" title=\"Minify Support\"></a>Minify Support</h4><p>NexT allows to minify Hexo generation. Set the value <code>minify</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Remove unnecessary files after hexo generate.</span></span><br><span class=\"line\"><span class=\"attr\">minify:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Choosing-Scheme\"><a href=\"#Choosing-Scheme\" class=\"headerlink\" title=\"Choosing Scheme\"></a>Choosing Scheme</h4><p>Scheme is a feature supported by NexT, by using Scheme NexT gives you different views. And nearly all config can be used by those Schemes. Till now NexT supports 4 schemes, and they are:</p>\n<ul>\n<li><strong><code>Muse</code></strong> → Default Scheme, this is the initial version of NexT. Uses black-white tone and mainly looks cleanly.</li>\n<li><code>Mist</code> → A tighter version of Muse with a tidy single-column view.</li>\n<li><code>Pisces</code> → Double-column Scheme, fresh like your neighbor&#39;s daughter.</li>\n<li><code>Gemini</code> → Looks like Pisces, but have distinct column blocks with shadow to appear more sensitive to view.</li>\n</ul>\n<p>You can change Scheme by editing <mark class=\"label primary\">theme config file</mark>, searching <code>scheme</code> keyword. You&#39;ll see 4 lines of scheme settings and can enable one of them by removing it&#39;s <code>#</code> and added <code>#</code> to previous.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#scheme: Muse</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Mist</span></span><br><span class=\"line\"><span class=\"comment\">#scheme: Pisces</span></span><br><span class=\"line\"><span class=\"attr\">scheme:</span> <span class=\"string\">Gemini</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Dark-Mode\"><a href=\"#Dark-Mode\" class=\"headerlink\" title=\"Dark Mode\"></a>Dark Mode</h4><style>\n.image-comparison-container {\n    position: relative;\n}\n\n.image-comparison {\n    opacity: 1 !important;\n}\n\n@keyframes next-clip-path {\n    from {\n        clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);\n    }\n    to {\n        clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);\n    }\n}\n\n.image-comparison:last-of-type {\n    animation: next-clip-path 8s alternate ease-in-out infinite;\n    position: absolute;\n    top: 0;\n}\n</style>\n<div class=\"image-comparison-container\">\n    <img class=\"image-comparison\" src=\"/images/next-schemes.png\" alt=\"NexT Schemes\">\n    <img class=\"image-comparison\" src=\"/images/next-schemes-dark.png\" alt=\"NexT Schemes\">\n</div>\n\n<p>You can enable Dark Mode by setting <code>darkmode</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">darkmode:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>The <code>prefers-color-scheme</code> CSS media feature is used to bring Dark Mode to all 4 schemes above, make sure your browser supports it.</p>\n<iframe data-feature=\"prefers-color-scheme\" src=\"https://caniuse.bitsofco.de/embed/index.html?feat=prefers-color-scheme&periods=current,past_1,past_2,past_3,past_4,past_5&accessible-colours=false\" frameborder=\"0\" width=\"100%\" height=\"400px\"></iframe>\n\n<p>Theme NexT automatically shows Dark Mode if the OS prefered theme is dark. It&#39;s supported by macOS Mojave, iOS 13 and Android 10 or later. Relevant docs:<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0LmFwcGxlLmNvbS9lbi11cy9IVDIwODk3Ng==\">How to use Dark Mode on your Mac<i class=\"fa fa-external-link-alt\"></i></span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0LmFwcGxlLmNvbS9lbi11cy9IVDIxMDMzMg==\">Use Dark Mode on your iPhone, iPad, or iPod touch<i class=\"fa fa-external-link-alt\"></i></span><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vZ3VpZGUvdG9waWNzL3VpL2xvb2stYW5kLWZlZWwvZGFya3RoZW1l\">Dark theme | Android Developers<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"Configuring-Favicon\"><a href=\"#Configuring-Favicon\" class=\"headerlink\" title=\"Configuring Favicon\"></a>Configuring Favicon</h4><p>By default the Hexo site use NexT favicons in <code>hexo-site/themes/next/source/images/</code> directory with different size for different device. You can replace them with your own favicons.</p>\n<p>For example, you can put your favicons in <code>hexo-site/source/images/</code> directory. Then you need to rename them and change the settings in <code>favicon</code> section in <mark class=\"label primary\">theme config file</mark>, otherwise icons from Next will rewrite your custom icons in Hexo.</p>\n<p>You can also put custom favicons into <code>hexo-site/source/</code> directory. In this way, you <strong>must remove</strong> <code>/images</code> prefix from paths.</p>\n<p>To generate custom favicons, you can visit <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZWFsZmF2aWNvbmdlbmVyYXRvci5uZXQv\">Favicon Generator<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">favicon:</span></span><br><span class=\"line\">  <span class=\"attr\">small:</span> <span class=\"string\">/images/favicon-16x16-next.png</span></span><br><span class=\"line\">  <span class=\"attr\">medium:</span> <span class=\"string\">/images/favicon-32x32-next.png</span></span><br><span class=\"line\">  <span class=\"attr\">apple_touch_icon:</span> <span class=\"string\">/images/apple-touch-icon-next.png</span></span><br><span class=\"line\">  <span class=\"attr\">safari_pinned_tab:</span> <span class=\"string\">/images/logo.svg</span></span><br><span class=\"line\">  <span class=\"attr\">android_manifest:</span> <span class=\"string\">/images/manifest.json</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Custom-Logo-Support\"><a href=\"#Custom-Logo-Support\" class=\"headerlink\" title=\"Custom Logo Support\"></a>Custom Logo Support</h4><p>NexT supports the site logo personalization.</p>\n<p>You can enable it by adding images&#39;s url to <code>custom_logo</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">custom_logo:</span> <span class=\"string\">/uploads/custom-logo.jpg</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note danger\"><p>Scheme Mist does not support custom logo setting.</p>\n</div>\n\n<h4 id=\"Creative-Commons\"><a href=\"#Creative-Commons\" class=\"headerlink\" title=\"Creative Commons\"></a>Creative Commons</h4><p>NexT supports the display of <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnLw==\">Creative Commons 4.0 International License<i class=\"fa fa-external-link-alt\"></i></span> in sidebar and post including <code>by</code>, <code>by-nc</code>, <code>by-nc-nd</code>, <code>by-nc-sa</code>, <code>by-nd</code>, <code>by-sa</code>, <code>zero</code>. These licenses allow creators to communicate which rights they reserve, and which rights they waive for the benefit of recipients or other creators.</p>\n<p>You can configure it by editing values in <code>creative_commons</code> section in <mark class=\"label primary\">theme config file</mark>, for example:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">creative_commons:</span></span><br><span class=\"line\">  <span class=\"attr\">license:</span> <span class=\"string\">by-nc-sa</span></span><br><span class=\"line\">  <span class=\"attr\">sidebar:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">post:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">language:</span> <span class=\"string\">deed.zh</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Configuring-Menu-Items\"><a href=\"#Configuring-Menu-Items\" class=\"headerlink\" title=\"Configuring Menu Items\"></a>Configuring Menu Items</h4><p>Menu settings items have format <code>Key: /link/ || icon</code> which contains 3 values:</p>\n<div class=\"tabs\" id=\"menu-items\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#menu-items-1\"><code>Key</code></a></li><li class=\"tab\"><a href=\"#menu-items-2\"><code>link</code></a></li><li class=\"tab\"><a href=\"#menu-items-3\"><code>icon</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"menu-items-1\"><p><code>Key</code> → is the name of menu item (<code>home</code>, <code>archives</code>, etc.).<br>If translate for this menu will be found in languages, this translate will be loaded; if not, <code>Key</code> name will be used.</p>\n<div class=\"note danger\"><p><code>Key</code> value is case sensitive (e.g. <code>home</code> is not same as <code>Home</code>).</p>\n</div></div><div class=\"tab-pane\" id=\"menu-items-2\"><p>Value before <code>||</code> delimeter (<code>/link/</code>) → is the target link to relative url inside your site.</p></div><div class=\"tab-pane\" id=\"menu-items-3\"><p>Value after <code>||</code> delimeter (<code>icon</code>) → is the name of Font Awesome icon.<br>Names of that icons can be found in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb250YXdlc29tZS5jb20v\">Font Awesome<i class=\"fa fa-external-link-alt\"></i></span> site.</p></div></div></div>\n\n<p>By default, all menu items are commented out to ensure that you can override them in the <a href=\"/docs/getting-started/configuration.html\">Alternate Theme Config</a>.<br>To customize menu items, edit the following content in <mark class=\"label primary\">theme config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-home</span></span><br><span class=\"line\">  <span class=\"comment\">#about: /about/ || fa fa-user</span></span><br><span class=\"line\">  <span class=\"comment\">#tags: /tags/ || fa fa-tags</span></span><br><span class=\"line\">  <span class=\"comment\">#categories: /categories/ || fa fa-th</span></span><br><span class=\"line\">  <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-archive</span></span><br><span class=\"line\">  <span class=\"comment\">#schedule: /schedule/ || fa fa-calendar</span></span><br><span class=\"line\">  <span class=\"comment\">#sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class=\"line\">  <span class=\"comment\">#commonweal: /404/ || fa fa-heartbeat</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note danger\"><p>Except <code>home</code> and <code>archives</code>, all custom pages under <code>menu</code> section need to be created manually. See <a href=\"/docs/theme-settings/custom-pages.html\">«Custom Page Support»</a>.</p>\n<p>Besides, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLWdlbmVyYXRvci1zaXRlbWFw\">hexo-generator-sitemap<i class=\"fa fa-external-link-alt\"></i></span> plugin is required for <code>sitemap</code> support.</p>\n</div>\n\n<p>Dynamic sub-menu within hierarchy structure is also supported. Add your sub-menu items in <code>menu</code> section in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-home</span></span><br><span class=\"line\">  <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-archive</span></span><br><span class=\"line\">  <span class=\"attr\">Docs:</span></span><br><span class=\"line\">    <span class=\"attr\">default:</span> <span class=\"string\">/docs/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-book</span></span><br><span class=\"line\">    <span class=\"attr\">Getting Started:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span> <span class=\"string\">/getting-started/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-flag</span></span><br><span class=\"line\">      <span class=\"attr\">Installation:</span> <span class=\"string\">/installation.html</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-download</span></span><br><span class=\"line\">      <span class=\"attr\">Configuration:</span> <span class=\"string\">/configuration.html</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-wrench</span></span><br><span class=\"line\">    <span class=\"attr\">Third Party Services:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span> <span class=\"string\">/third-party-services/</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-puzzle-piece</span></span><br><span class=\"line\">      <span class=\"attr\">Math Equations:</span> <span class=\"string\">/math-equations.html</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-square-root-alt</span></span><br><span class=\"line\">      <span class=\"attr\">Comment Systems:</span> <span class=\"string\">/comments.html</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-comment-alt</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note danger\"><p>A <code>default</code> page is required for each sub-menu item.</p>\n</div>\n\n<p>By default NexT shows the icons of menu items without badges.</p>\n<div class=\"tabs\" id=\"menu_settings\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#menu_settings-1\"><code>icons</code></a></li><li class=\"tab\"><a href=\"#menu_settings-2\"><code>badges</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"menu_settings-1\"><p>You can configure it by editing values in <code>menu_settings.icons</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu_settings:</span></span><br><span class=\"line\">  <span class=\"attr\">icons:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"menu_settings-2\"><p>Set the value <code>badges</code> to <code>true</code> to display the count of Posts &#x2F; Categories &#x2F; Tags within menu items in <code>menu_settings</code> section in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu_settings:</span></span><br><span class=\"line\">  <span class=\"attr\">badges:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n"},{"title":"Internationalization","url":"/docs/theme-settings/internationalization.html","content":"<h3 id=\"Choosing-Language\"><a href=\"#Choosing-Language\" class=\"headerlink\" title=\"Choosing Language\"></a>Choosing Language</h3><p>Edit <mark class=\"label info\">site config file</mark>, set the value of <code>language</code> to the language you need. For example, English looks like this:</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">en</span></span><br></pre></td></tr></table></figure>\n\n<p>NexT now supports following languages:</p>\n<table>\n<thead>\n<tr>\n<th>Language</th>\n<th>Example</th>\n<th>Code</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Arabic</td>\n<td>عربي</td>\n<td><code>ar</code></td>\n</tr>\n<tr>\n<td>Chinese (Simplified)</td>\n<td>简体中文</td>\n<td><code>zh-CN</code></td>\n</tr>\n<tr>\n<td>Chinese (Traditional)</td>\n<td>繁體中文</td>\n<td><code>zh-TW</code></td>\n</tr>\n<tr>\n<td>Chinese (Hong Kong)</td>\n<td>繁體中文-香港</td>\n<td><code>zh-HK</code></td>\n</tr>\n<tr>\n<td>Dutch</td>\n<td>Niederländisch</td>\n<td><code>nl</code></td>\n</tr>\n<tr>\n<td>English</td>\n<td>English</td>\n<td><code>en</code></td>\n</tr>\n<tr>\n<td>French</td>\n<td>Français</td>\n<td><code>fr</code></td>\n</tr>\n<tr>\n<td>German</td>\n<td>Deutsch</td>\n<td><code>de</code></td>\n</tr>\n<tr>\n<td>Indonesian</td>\n<td>Indonesia</td>\n<td><code>id</code></td>\n</tr>\n<tr>\n<td>Italian</td>\n<td>Italiano</td>\n<td><code>it</code></td>\n</tr>\n<tr>\n<td>Japanese</td>\n<td>日本語</td>\n<td><code>ja</code></td>\n</tr>\n<tr>\n<td>Korean</td>\n<td>한국어</td>\n<td><code>ko</code></td>\n</tr>\n<tr>\n<td>Persian</td>\n<td>فارسی</td>\n<td><code>fa</code></td>\n</tr>\n<tr>\n<td>Portuguese</td>\n<td>Português</td>\n<td><code>pt</code></td>\n</tr>\n<tr>\n<td>Portuguese (Brazilian)</td>\n<td>Português (Brazilian)</td>\n<td><code>pt-BR</code></td>\n</tr>\n<tr>\n<td>Russian</td>\n<td>Русский</td>\n<td><code>ru</code></td>\n</tr>\n<tr>\n<td>Spanish</td>\n<td>Español</td>\n<td><code>es</code></td>\n</tr>\n<tr>\n<td>Turkish</td>\n<td>Türk</td>\n<td><code>tr</code></td>\n</tr>\n<tr>\n<td>Ukrainian</td>\n<td>Український</td>\n<td><code>uk</code></td>\n</tr>\n<tr>\n<td>Vietnamese</td>\n<td>Tiếng Việt</td>\n<td><code>vi</code></td>\n</tr>\n</tbody></table>\n<div class=\"note primary\"><p>The files in the <code>language</code> directory are automatically generated, you do not need to modify them directly. Please submit translations via <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcm93ZGluLmNvbS9wcm9qZWN0L2hleG8tdGhlbWUtbmV4dA==\">Crowdin<i class=\"fa fa-external-link-alt\"></i></span> if you would like to add or improve translation for NexT theme.</p>\n</div>\n\n<h3 id=\"Multilingual-Switcher\"><a href=\"#Multilingual-Switcher\" class=\"headerlink\" title=\"Multilingual Switcher\"></a>Multilingual Switcher</h3><p>Set multiple languages in <mark class=\"label info\">site config file</mark>, e.g.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">language:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">zh-CN</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">en</span></span><br></pre></td></tr></table></figure>\n\n<p>Then turn on <code>language_switcher</code> in <mark class=\"label primary\">theme config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Show multilingual switcher in footer.</span></span><br><span class=\"line\"><span class=\"attr\">language_switcher:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Override-Default-Translations\"><a href=\"#Override-Default-Translations\" class=\"headerlink\" title=\"Override Default Translations\"></a>Override Default Translations</h3><p>If you would like to customize the default translation, you do not need to modify the translation files in the <code>languages</code> directory. You can override all translations using <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZGF0YS1maWxlcw==\">Data Files<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<ol>\n<li><p>Creat a <code>languages.yml</code> in <code>source/_data</code>.</p>\n</li>\n<li><p>Insert following codes: (be careful about the two-space indent)</p>\n <figure class=\"highlight yml\"><figcaption><span>languages.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># language</span></span><br><span class=\"line\"><span class=\"attr\">zh-CN:</span></span><br><span class=\"line\">  <span class=\"comment\"># items</span></span><br><span class=\"line\">  <span class=\"attr\">post:</span></span><br><span class=\"line\">    <span class=\"attr\">copyright:</span></span><br><span class=\"line\">      <span class=\"comment\"># the translation you perfer</span></span><br><span class=\"line\">      <span class=\"attr\">author:</span> <span class=\"string\">本文博主</span></span><br><span class=\"line\"><span class=\"attr\">en:</span></span><br><span class=\"line\">  <span class=\"attr\">menu:</span></span><br><span class=\"line\">    <span class=\"attr\">schedule:</span> <span class=\"string\">Calendar</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>This situation is also available for off-list items. For example, Next uses <a href=\"/docs/advanced-settings/injects.html\">Theme Inject</a> to introduce the commments systems. You can rename the returned value in chinese as followed:</p>\n<figure class=\"highlight yml\"><figcaption><span>languages.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># language</span></span><br><span class=\"line\"><span class=\"attr\">zh-CN:</span></span><br><span class=\"line\">  <span class=\"comment\"># items</span></span><br><span class=\"line\">  <span class=\"attr\">post:</span></span><br><span class=\"line\">    <span class=\"attr\">comments:</span></span><br><span class=\"line\">      <span class=\"attr\">disqus:</span> <span class=\"string\">评论</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Misc Theme Settings","url":"/docs/theme-settings/miscellaneous.html","content":"<h3 id=\"Preconnect\"><a href=\"#Preconnect\" class=\"headerlink\" title=\"Preconnect\"></a>Preconnect</h3><p>NexT supports adding preconnect resource hints to establish early connections to fonts and plugins origins.</p>\n<p>You can enable it by setting <code>preconnect: true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Preconnect CDN for fonts and plugins.</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://www.w3.org/TR/resource-hints/#preconnect</span></span><br><span class=\"line\"><span class=\"attr\">preconnect:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Text-Align\"><a href=\"#Text-Align\" class=\"headerlink\" title=\"Text Align\"></a>Text Align</h3><p>NexT allows to customize the text alignment in posts &#x2F; pages. The <code>text-align</code> CSS property sets the horizontal alignment of a block element or table-cell box.</p>\n<table>\n<thead>\n<tr>\n<th>Values</th>\n<th>Effect</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>start</code></td>\n<td>The same as <code>left</code> if direction is left-to-right and <code>right</code> if direction is right-to-left.</td>\n</tr>\n<tr>\n<td><code>end</code></td>\n<td>The same as <code>right</code> if direction is left-to-right and <code>left</code> if direction is right-to-left.</td>\n</tr>\n<tr>\n<td><code>left</code></td>\n<td>The inline contents are aligned to the left edge of the line box.</td>\n</tr>\n<tr>\n<td><code>right</code></td>\n<td>The inline contents are aligned to the right edge of the line box.</td>\n</tr>\n<tr>\n<td><code>center</code></td>\n<td>The inline contents are centered within the line box.</td>\n</tr>\n<tr>\n<td><code>justify</code></td>\n<td>The inline contents are justified. Text should be spaced to line up its left and right edges to the left and right edges of the line box, except for the last line.</td>\n</tr>\n<tr>\n<td><code>justify-all</code></td>\n<td>Same as <code>justify</code>, but also forces the last line to be justified.</td>\n</tr>\n<tr>\n<td><code>match-parent</code></td>\n<td>Similar to <code>inherit</code>, but the values <code>start</code> and <code>end</code> are calculated according to the parent&#39;s direction and are replaced by the appropriate <code>left</code> or <code>right</code> value.</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Set the text alignment in the posts.</span></span><br><span class=\"line\"><span class=\"attr\">text_align:</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: start | end | left | right | center | justify | justify-all | match-parent</span></span><br><span class=\"line\">  <span class=\"attr\">desktop:</span> <span class=\"string\">justify</span></span><br><span class=\"line\">  <span class=\"attr\">mobile:</span> <span class=\"string\">justify</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Mobile-Devices-Adaptation\"><a href=\"#Mobile-Devices-Adaptation\" class=\"headerlink\" title=\"Mobile Devices Adaptation\"></a>Mobile Devices Adaptation</h3><div class=\"tabs\" id=\"mobile-adaptation\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#mobile-adaptation-1\"><code>mobile_layout_economy</code></a></li><li class=\"tab\"><a href=\"#mobile-adaptation-2\"><code>android_chrome_color</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"mobile-adaptation-1\"><p>If you want to reduce padding&#x2F;margin indents on devices with narrow width, you can enable it by setting value <code>mobile_layout_economy</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mobile_layout_economy:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"mobile-adaptation-2\"><p>By default NexT uses black-deep (<code>#222</code>) as the color of android Chrome header panel. You can configure it by editing values with Hex color in <code>android_chrome_color</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">android_chrome_color:</span> <span class=\"string\">&quot;#222&quot;</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Codeblock-Style\"><a href=\"#Codeblock-Style\" class=\"headerlink\" title=\"Codeblock Style\"></a>Codeblock Style</h3><div class=\"tabs\" id=\"codeblock\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#codeblock-1\"><code>theme</code></a></li><li class=\"tab\"><a href=\"#codeblock-2\"><code>copy_button</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"codeblock-1\"><p>NexT uses the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oaWdobGlnaHRqcy5vcmcv\">Highlight.js<i class=\"fa fa-external-link-alt\"></i></span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wcmlzbWpzLmNvbS8=\">Prism<i class=\"fa fa-external-link-alt\"></i></span> package to support code highlight.</p>\n<div class=\"note warning\"><p>Please read Hexo&#39;s documentation on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc3ludGF4LWhpZ2hsaWdodA==\">Syntax Highlighting<i class=\"fa fa-external-link-alt\"></i></span> first, and set it up in <mark class=\"label info\">site config file</mark>.</p>\n</div>\n\n<p>You can preview all available Code Highlight themes here: <span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9oaWdobGlnaHQv\">NexT Highlight Theme Preview<i class=\"fa fa-external-link-alt\"></i></span>. Change the value of <code>theme</code> and <code>prism</code> to choose the highlight style you like.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codeblock:</span></span><br><span class=\"line\">  <span class=\"comment\"># Code Highlight theme</span></span><br><span class=\"line\">  <span class=\"comment\"># All available themes: https://theme-next.js.org/highlight/</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span></span><br><span class=\"line\">    <span class=\"attr\">light:</span> <span class=\"string\">default</span></span><br><span class=\"line\">    <span class=\"attr\">dark:</span> <span class=\"string\">tomorrow-night</span></span><br><span class=\"line\">  <span class=\"attr\">prism:</span></span><br><span class=\"line\">    <span class=\"attr\">light:</span> <span class=\"string\">prism</span></span><br><span class=\"line\">    <span class=\"attr\">dark:</span> <span class=\"string\">prism-dark</span></span><br></pre></td></tr></table></figure>\n\n<p>If Dark Mode is enabled, dark code highlighting themes will be available.</p></div><div class=\"tab-pane\" id=\"codeblock-2\"><p>NexT supports the copy-and-paste functionality of codeblock.</p>\n<div class=\"tabs\" id=\"codeblock1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#codeblock1-1\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#codeblock1-2\"><code>style</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"codeblock1-1\"><p>You can enable it by setting value <code>copy_button.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>. By default NexT shows copy result of the copy-and-paste functionality.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codeblock:</span></span><br><span class=\"line\">  <span class=\"attr\">copy_button:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"codeblock1-2\"><p>With <code>style</code> option, you can change your copy button style.<br>There are three style available currently: <code>default</code> (Just leave it empty), <code>flat</code> and <code>mac</code>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codeblock:</span></span><br><span class=\"line\">  <span class=\"attr\">copy_button:</span></span><br><span class=\"line\">    <span class=\"attr\">style:</span> <span class=\"string\">flat</span></span><br></pre></td></tr></table></figure></div></div></div></div></div></div>\n\n<h3 id=\"Back-To-Top\"><a href=\"#Back-To-Top\" class=\"headerlink\" title=\"Back To Top\"></a>Back To Top</h3><div class=\"tabs\" id=\"b2t\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#b2t-1\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#b2t-2\"><code>sidebar</code></a></li><li class=\"tab\"><a href=\"#b2t-3\"><code>scrollpercent</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"b2t-1\"><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">back2top:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>Set the value <code>back2top.enable</code> to <code>true</code> to display <code>Back to top</code> button.</p></div><div class=\"tab-pane\" id=\"b2t-2\"><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">back2top:</span></span><br><span class=\"line\">  <span class=\"comment\"># Back to top in sidebar.</span></span><br><span class=\"line\">  <span class=\"attr\">sidebar:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>Set the value <code>back2top.sidebar</code> to <code>true</code> to put the button in sidebar.</p></div><div class=\"tab-pane\" id=\"b2t-3\"><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">back2top:</span></span><br><span class=\"line\">  <span class=\"comment\"># Scroll percent label in b2t button.</span></span><br><span class=\"line\">  <span class=\"attr\">scrollpercent:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>Set the value <code>back2top.scrollpercent</code> to <code>true</code> to display scroll percent label in <code>Back to top</code> button.</p></div></div></div>\n\n<h3 id=\"Reading-Progress\"><a href=\"#Reading-Progress\" class=\"headerlink\" title=\"Reading Progress\"></a>Reading Progress</h3><p>NexT supports the page scroll reading progress indicator.</p>\n<p>You can enable it by setting value <code>reading_progress.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">reading_progress:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">color:</span> <span class=\"string\">&quot;#37c6c0&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">height:</span> <span class=\"string\">2px</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Bookmark\"><a href=\"#Bookmark\" class=\"headerlink\" title=\"Bookmark\"></a>Bookmark</h3><p>Bookmark is a plugin that allow the users save their reading progress. Users could just click the bookmark icon (like 🔖) in left-top of the page to save the scroll position. And when they visit your blog in the next time, they can resume the last scroll position of each page automatically.</p>\n<p>You can enable it by setting value <code>bookmark.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">bookmark:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Customize the color of the bookmark.</span></span><br><span class=\"line\">  <span class=\"attr\">color:</span> <span class=\"string\">&quot;#222&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># If auto, save the reading progress when closing the page or clicking the bookmark-icon.</span></span><br><span class=\"line\">  <span class=\"comment\"># If manual, only save it by clicking the bookmark-icon.</span></span><br><span class=\"line\">  <span class=\"attr\">save:</span> <span class=\"string\">auto</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"GitHub-Banner\"><a href=\"#GitHub-Banner\" class=\"headerlink\" title=\"GitHub Banner\"></a>GitHub Banner</h3><p>NexT provides <code>Follow me on GitHub</code> banner in right-top corner.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Follow me on GitHub banner in right-top corner.</span></span><br><span class=\"line\"><span class=\"attr\">github_banner:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">permalink:</span> <span class=\"string\">https://github.com/yourname</span></span><br><span class=\"line\">  <span class=\"attr\">title:</span> <span class=\"string\">Follow</span> <span class=\"string\">me</span> <span class=\"string\">on</span> <span class=\"string\">GitHub</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"tabs\" id=\"github-banner\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#github-banner-1\"><code>permalink</code></a></li><li class=\"tab\"><a href=\"#github-banner-2\"><code>title</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"github-banner-1\"><p><code>permalink</code> → is the specified link must have full url path.</p></div><div class=\"tab-pane\" id=\"github-banner-2\"><p><code>title</code> → is the title and aria-label name.</p></div></div></div>\n\n<p>You can set <code>enable</code> to <code>true</code> and add your own GitHub link.</p>\n<h3 id=\"Fonts-Customization\"><a href=\"#Fonts-Customization\" class=\"headerlink\" title=\"Fonts Customization\"></a>Fonts Customization</h3><p>NexT gives you 5 specific font settings, they are:</p>\n<ul>\n<li>Global Font: Font used in the whole site.</li>\n<li>Title Font: Font used by site title.</li>\n<li>Headlines Font: Font used by headings in articles (h1, h2, h3, h4, h5, h6).</li>\n<li>Article Font: Font used by articles.</li>\n<li>Code Font: Font used by code blocks in articles.</li>\n</ul>\n<p>Each font will be used as the first font of this class, NexT will fallback to internal font settings if they are unavalible.</p>\n<ul>\n<li>Non-code Font: Fallback to <code>&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif</code></li>\n<li>Code Font: Fallback to <code>consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace</code></li>\n</ul>\n<p>Plus each section has a <code>external</code> attribute, this controls whether to use the font library CDN.<br>Use this can help you to use fonts installed in system and reduce unnecessary requests.</p>\n<div class=\"note info\"><p>To solve the unstable of <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9mb250cw==\">Google Fonts API<i class=\"fa fa-external-link-alt\"></i></span> in some countries, NexT supports custom URL of fonts library by setting <code>font.host</code>.<br>In addition, we noticed that for requests from certain websites, Google Fonts will return 403. At this time, it is necessary to use <code>font.host</code> to set up a mirror site.<br>Relevant issues: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2lzc3Vlcy82MTM=\">#613<i class=\"fa fa-external-link-alt\"></i></span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2lzc3Vlcy8xMzMz\">#1333<i class=\"fa fa-external-link-alt\"></i></span></p>\n</div>\n\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">font:</span></span><br><span class=\"line\">  <span class=\"comment\"># Use custom fonts families or not.</span></span><br><span class=\"line\">  <span class=\"comment\"># Depended options: `external` and `family`.</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Uri of fonts host, e.g. https://fonts.googleapis.com (Default).</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Font options:</span></span><br><span class=\"line\">  <span class=\"comment\"># `external: true` will load this font family from `host` above.</span></span><br><span class=\"line\">  <span class=\"comment\"># `family: Times New Roman`. Without any quotes.</span></span><br><span class=\"line\">  <span class=\"comment\"># `size: x.x`. Use `em` as unit. Default: 1 (16px)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Global font settings used for all elements inside &lt;body&gt;.</span></span><br><span class=\"line\">  <span class=\"attr\">global:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">family:</span> <span class=\"string\">Monda</span></span><br><span class=\"line\">    <span class=\"attr\">size:</span> <span class=\"number\">1.125</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Font settings for site title (.site-title).</span></span><br><span class=\"line\">  <span class=\"attr\">title:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">family:</span> <span class=\"string\">Lobster</span> <span class=\"string\">Two</span></span><br><span class=\"line\">    <span class=\"attr\">size:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;).</span></span><br><span class=\"line\">  <span class=\"attr\">headings:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">family:</span> <span class=\"string\">Amita</span></span><br><span class=\"line\">    <span class=\"attr\">size:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Font settings for posts (.post-body).</span></span><br><span class=\"line\">  <span class=\"attr\">posts:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">family:</span> <span class=\"string\">Montserrat</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class=\"line\">  <span class=\"attr\">codes:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">family:</span> <span class=\"string\">PT</span> <span class=\"string\">Mono</span></span><br></pre></td></tr></table></figure>\n\n<p>And you can apply multiple font families for each option. This is especially useful for those who often writes both Chinese and English.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">font:</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">title:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">family:</span> <span class=\"string\">Roboto</span> <span class=\"string\">Slab,</span> <span class=\"string\">Noto</span> <span class=\"string\">Serif</span> <span class=\"string\">SC</span></span><br><span class=\"line\">    <span class=\"attr\">size:</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><p>According to the <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMTgvUkVDLWNzcy1mb250cy0zLTIwMTgwOTIwLyNwcm9wZGVmLWZvbnQtZmFtaWx5\">CSS Fonts Module Level 3<i class=\"fa fa-external-link-alt\"></i></span> spec:</p>\n<blockquote>\n<p>Font family names other than generic families must either be given quoted as strings, or unquoted as a sequence of one or more identifiers.</p>\n</blockquote>\n<p>To avoid escaping mistakes, quote font family names if necessary.</p>\n</div>\n\n<p>If you still need more customization, following change will cover Fonts Customization function. Edit <code>source/_data/variables.styl</code> in <mark class=\"label info\">site root directory</mark> and add two varibles:</p>\n<figure class=\"highlight styl\"><figcaption><span>hexo/source/_data/variables.styl</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Title Font, set it to font family you want.</span></span><br><span class=\"line\"><span class=\"variable\">$font</span>-family-headings = Georgia, sans</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set it to font family you want.</span></span><br><span class=\"line\"><span class=\"variable\">$font</span>-family-base = <span class=\"string\">&quot;Microsoft YaHei&quot;</span>, Verdana, sans-serif</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Code Font.</span></span><br><span class=\"line\"><span class=\"variable\">$code</span>-<span class=\"attribute\">font-family</span> = <span class=\"string\">&quot;Input Mono&quot;</span>, <span class=\"string\">&quot;PT Mono&quot;</span>, Consolas, Monaco, Menlo, monospace</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Font size of articles.</span></span><br><span class=\"line\"><span class=\"variable\">$font</span>-size-base = <span class=\"number\">16px</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Font size of table and code.</span></span><br><span class=\"line\"><span class=\"variable\">$table</span>-<span class=\"attribute\">font-size</span> = <span class=\"number\">13px</span></span><br></pre></td></tr></table></figure>\n\n<p>Then uncomment <code>variable</code> under the <code>custom_file_path</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n"},{"title":"Post Settings","url":"/docs/theme-settings/posts.html","content":"<h3 id=\"Preamble-Text\"><a href=\"#Preamble-Text\" class=\"headerlink\" title=\"Preamble Text\"></a>Preamble Text</h3><p>It&#39;s a common need to show some part of article in home page and then give a link to full article. NexT gives two ways to control how article is shown in home page. In other words, you can use following ways to show summary of articles and a <strong>Read More</strong> button.</p>\n<div class=\"tabs\" id=\"preamble\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#preamble-1\"><mark class=\"label success\">Tag more</mark></a></li><li class=\"tab\"><a href=\"#preamble-2\"><code>excerpt_description</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"preamble-1\"><p>Use <code>&lt;!-- more --&gt;</code> in your article to break your article manually, which is recommended by Hexo.</p></div><div class=\"tab-pane\" id=\"preamble-2\"><p>If you have added <code>description</code> and set its value to your article summary in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZnJvbnQtbWF0dGVy\">front-matter<i class=\"fa fa-external-link-alt\"></i></span>, NexT excerpts <code>description</code> as preamble text in homepage by default. Without <code>description</code>, the full contents would be the preamble text in homepage.</p>\n<p>You can disable it by setting value <code>excerpt_description</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">excerpt_description:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<div class=\"note info\"><p>It is recommended to use <code>&lt;!-- more --&gt;</code> (the first way) which can not only control what you want to show better, but also let Hexo&#39;s plugins use it easily.</p>\n</div>\n\n<h3 id=\"Post-Meta-Display\"><a href=\"#Post-Meta-Display\" class=\"headerlink\" title=\"Post Meta Display\"></a>Post Meta Display</h3><p>NexT supports post created date, post updated date and post categories display.</p>\n<div class=\"tabs\" id=\"postmeta\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#postmeta-1\"><code>item_text</code></a></li><li class=\"tab\"><a href=\"#postmeta-2\"><code>created_at</code></a></li><li class=\"tab\"><a href=\"#postmeta-3\"><code>updated_at</code></a></li><li class=\"tab\"><a href=\"#postmeta-4\"><code>categories</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"postmeta-1\"><p>By default NexT shows the description text of post meta. You can disable it by setting value <code>post_meta.item_text</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_meta:</span></span><br><span class=\"line\">  <span class=\"attr\">item_text:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"postmeta-2\"><p>By default NexT shows the post created date in post meta section and created time in popup. You can disable it by setting value <code>post_meta.created_at</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_meta:</span></span><br><span class=\"line\">  <span class=\"attr\">created_at:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"postmeta-3\"><div class=\"note warning\"><p>Make sure you set <code>use_date_for_updated</code> and <code>updated_option</code> in <mark class=\"label info\">site config file</mark> correctly, otherwise this option will not take effect. See also <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvY29uZmlndXJhdGlvbiNEYXRlLVRpbWUtZm9ybWF0\">Date &#x2F; Time format<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</div>\n\n<div class=\"tabs\" id=\"postmeta1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#postmeta1-1\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#postmeta1-2\"><code>another_day</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"postmeta1-1\"><p>By default NexT shows the post updated date in post meta section and updated time in popup. You can disable it by setting value <code>post_meta.updated_at.enable</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_meta:</span></span><br><span class=\"line\">  <span class=\"attr\">updated_at:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"postmeta1-2\"><p>By default, if updated&#x2F;edited date is the same as created date, edited time would be displayed in popup message. You can disable it by setting value <code>post_meta.updated_at.another_day</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.<br>In other words:</p>\n<ul>\n<li>If true, show updated date label only if <code>updated date</code> is different from <code>created date</code> (post edited in another day than was created).</li>\n<li>And if post was edited in same day as created, edited time will show in popup title under created time label.</li>\n<li>If false show anyway, but if post edited in same day, show only edited time.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_meta:</span></span><br><span class=\"line\">  <span class=\"attr\">updated_at:</span></span><br><span class=\"line\">    <span class=\"attr\">another_day:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div></div><div class=\"tab-pane\" id=\"postmeta-4\"><p>By default NexT shows the post categorie in post meta section. You can disable it by setting value <code>post_meta.categories</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_meta:</span></span><br><span class=\"line\">  <span class=\"attr\">categories:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Post-Wordcount\"><a href=\"#Post-Wordcount\" class=\"headerlink\" title=\"Post Wordcount\"></a>Post Wordcount</h3><div class=\"tabs\" id=\"wordcount\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#wordcount-1\">Installation →</a></li><li class=\"tab\"><a href=\"#wordcount-2\">Hexo Config →</a></li><li class=\"tab\"><a href=\"#wordcount-3\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"wordcount-1\"><p>Install <code>hexo-word-counter</code> by executing the following command in <mark class=\"label info\">site root dir</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-word-counter</span><br><span class=\"line\">$ hexo clean</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount-2\"><p>Activate this plugin in <mark class=\"label info\">site config file</mark> by enabled any option:</p>\n<div class=\"tabs\" id=\"wordcount1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#wordcount1-1\"><code>symbols</code></a></li><li class=\"tab\"><a href=\"#wordcount1-2\"><code>time</code></a></li><li class=\"tab\"><a href=\"#wordcount1-3\"><code>total_symbols</code></a></li><li class=\"tab\"><a href=\"#wordcount1-4\"><code>total_time</code></a></li><li class=\"tab\"><a href=\"#wordcount1-5\"><code>awl</code></a></li><li class=\"tab\"><a href=\"#wordcount1-6\"><code>wpm</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"wordcount1-1\"><p>By default NexT shows the number of post words in post meta section. You can disable it by setting value <code>symbols_count_time.symbols</code> to <code>false</code> in <mark class=\"label info\">site config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">symbols:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount1-2\"><p>By default NexT shows the estimated reading time of post in post meta section. You can disable it by setting value <code>symbols_count_time.time</code> to <code>false</code> in <mark class=\"label info\">site config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">time:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount1-3\"><p>By default NexT shows the number of all posts words in footer section. You can disable it by setting value <code>symbols_count_time.total_symbols</code> to <code>false</code> in <mark class=\"label info\">site config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">total_symbols:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount1-4\"><p>By default NexT shows the estimated reading time of all posts in footer section. You can disable it by setting value <code>symbols_count_time.total_time</code> to <code>false</code> in <mark class=\"label info\">site config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">total_time:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount1-5\"><p><code>awl</code> means the average Word Length (chars count in word). You can check this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGFyYWN0ZXJjb3VudHRvb2wuY29tLw==\">here<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">awl:</span> <span class=\"number\">4</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount1-6\"><p><code>wpm</code> means the average words per minute. You can check this <span class=\"exturl\" data-url=\"aHR0cHM6Ly93b3JkY291bnRlci5uZXQv\">here<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">wpm:</span> <span class=\"number\">275</span></span><br></pre></td></tr></table></figure></div></div></div></div><div class=\"tab-pane\" id=\"wordcount-3\"><p>After the plugin enabled, you may adjust options in <code>symbols_count_time</code> section in <mark class=\"label primary\">theme config file</mark>:</p>\n<div class=\"tabs\" id=\"wordcount2\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#wordcount2-1\"><code>separated_meta</code></a></li><li class=\"tab\"><a href=\"#wordcount2-2\"><code>item_text_total</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"wordcount2-1\"><p>By default NexT shows the words counts and estimated reading time in a separated line. You can add them into one line by setting value <code>symbols_count_time.separated_meta</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">separated_meta:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"wordcount2-2\"><p>By default NexT doesn&#39;t shows the text description of the words counts and estimated reading time in footer section. You can enable it by setting value <code>symbols_count_time.item_text_total</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">item_text_total:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div></div></div></div>\n\n<h3 id=\"Tag-Icon\"><a href=\"#Tag-Icon\" class=\"headerlink\" title=\"Tag Icon\"></a>Tag Icon</h3><p>By default, tags at the bottom of posts have a symbol # at there left side.</p>\n<p>If you prefer icon instead of symbol, edit <mark class=\"label primary\">theme config file</mark> like following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">tag_icon:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Donate-Settings\"><a href=\"#Donate-Settings\" class=\"headerlink\" title=\"Donate Settings\"></a>Donate Settings</h3><p>More and more online blogging platforms (e.g. WeChat public accounts, Jianshu, Zhihu) support donate (sponsor). To catch paid reading trends, we added donate feature, supports WeChat, Alipay and Bitcoin. What you need is:</p>\n<ol>\n<li><p>Get your WeChat &#x2F; Alipay &#x2F; Bitcoin receive money QRcode image(s) and put into <code>source/images</code> under <mark class=\"label primary\">theme directory</mark> or upload it(them) to an image cloud to get the absolute HTTP address(es).</p>\n</li>\n<li><p>Set needed values in  <mark class=\"label primary\">theme config file</mark>:</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Donate (Sponsor) settings</span></span><br><span class=\"line\"><span class=\"comment\"># Front-matter variable (unsupport animation).</span></span><br><span class=\"line\"><span class=\"attr\">reward_settings:</span></span><br><span class=\"line\">  <span class=\"comment\"># If true, a donate button will be displayed in every article by default.</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">animation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">#comment: Buy me a coffee</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">reward:</span></span><br><span class=\"line\">  <span class=\"attr\">wechatpay:</span> <span class=\"string\">/images/wechatpay.png</span></span><br><span class=\"line\">  <span class=\"attr\">alipay:</span> <span class=\"string\">/images/alipay.png</span></span><br><span class=\"line\">  <span class=\"attr\">bitcoin:</span> <span class=\"string\">/images/bitcoin.png</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>You can also add QRcode of other platforms, e.g.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">paypal:</span> <span class=\"string\">/images/paypal.png</span></span><br><span class=\"line\"><span class=\"attr\">monero:</span> <span class=\"string\">/images/monero.png</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Follow-Me\"><a href=\"#Follow-Me\" class=\"headerlink\" title=\"Follow Me\"></a>Follow Me</h3><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Subscribe through Telegram Channel, Twitter, etc.</span></span><br><span class=\"line\"><span class=\"comment\"># Usage: `Key: permalink || icon` (Font Awesome)</span></span><br><span class=\"line\"><span class=\"attr\">follow_me:</span></span><br><span class=\"line\">  <span class=\"comment\">#Twitter: https://twitter.com/username || fab fa-twitter</span></span><br><span class=\"line\">  <span class=\"comment\">#Telegram: https://t.me/channel_name || fab fa-telegram</span></span><br><span class=\"line\">  <span class=\"comment\">#WeChat: /images/wechat_channel.jpg || fab fa-weixin</span></span><br><span class=\"line\">  <span class=\"comment\">#RSS: /atom.xml || fa fa-rss</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Related-Popular-Posts\"><a href=\"#Related-Popular-Posts\" class=\"headerlink\" title=\"Related Popular Posts\"></a>Related Popular Posts</h3><p>NexT supports the related posts functionality according to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RlYTMvaGV4by1yZWxhdGVkLXBvcHVsYXItcG9zdHM=\">hexo-related-popular-posts<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<div class=\"tabs\" id=\"related_posts\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#related_posts-1\">Installation →</a></li><li class=\"tab\"><a href=\"#related_posts-2\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#related_posts-3\"><code>title</code></a></li><li class=\"tab\"><a href=\"#related_posts-4\"><code>display_in_home</code></a></li><li class=\"tab\"><a href=\"#related_posts-5\"><code>params</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"related_posts-1\"><p>Install <code>hexo-related-popular-posts</code> by executing the following command in <mark class=\"label info\">site root dir</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-related-popular-posts</span><br><span class=\"line\">$ hexo clean</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts-2\"><p>You can enable it by setting value <code>related_posts.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts-3\"><p>By default NexT uses &#39;Related Posts&#39; as title by default. You can configure it by editing value in <code>related_posts.title</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">title:</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts-4\"><p>By default NexT doesn&#39;t show the related posts in homepage. You can enable it by setting value <code>related_posts.display_in_home</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">display_in_home:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts-5\"><p>By default NexT shows up to 5 related posts and their titles without any date, image and excerpt. You can change the default behavior by editing values of <code>related_posts.params</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<div class=\"tabs\" id=\"related_posts1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#related_posts1-1\"><code>maxCount</code></a></li><li class=\"tab\"><a href=\"#related_posts1-2\"><code>PPMixingRate</code></a></li><li class=\"tab\"><a href=\"#related_posts1-3\"><code>isDate</code></a></li><li class=\"tab\"><a href=\"#related_posts1-4\"><code>isImage</code></a></li><li class=\"tab\"><a href=\"#related_posts1-5\"><code>isExcerpt</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"related_posts1-1\"><p>Maximum count of a list, change it by yourself.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">params:</span></span><br><span class=\"line\">    <span class=\"attr\">maxCount:</span> <span class=\"number\">5</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts1-2\"><p>Mixing ratio of popular posts and related posts.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">params:</span></span><br><span class=\"line\">    <span class=\"comment\">#PPMixingRate: 0.0</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts1-3\"><p>Uncomment and set true to display dates of related post.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">params:</span></span><br><span class=\"line\">    <span class=\"attr\">isDate:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts1-4\"><p>Uncomment and set true to display images of related posts.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">params:</span></span><br><span class=\"line\">    <span class=\"attr\">isImage:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"related_posts1-5\"><p>Uncomment and set true to display excerpts of related posts.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">related_posts:</span></span><br><span class=\"line\">  <span class=\"attr\">params:</span></span><br><span class=\"line\">    <span class=\"attr\">isExcerpt:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div></div></div></div>\n\n<h3 id=\"Post-Edit\"><a href=\"#Post-Edit\" class=\"headerlink\" title=\"Post Edit\"></a>Post Edit</h3><p>NexT supports the edit functionality of your posts. By enabling this feature, users can quickly browse and modify the blog&#39;s source code on GitHub.</p>\n<div class=\"tabs\" id=\"post_edit\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#post_edit-1\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#post_edit-2\"><code>url</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"post_edit-1\"><p>You can enable it by setting value <code>post_edit.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_edit:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"post_edit-2\"><p>You should create a source repository of your post files. The <code>url</code> setting depends on the source project in github.</p>\n<ul>\n<li>For site repository<ul>\n<li>Link for view source: <code>url: https://github.com/.../tree/master/source/_posts/</code></li>\n<li>Link for fork &amp; edit: <code>url: https://github.com/.../edit/master/source/_posts/</code></li>\n</ul>\n</li>\n<li>For post repository<ul>\n<li>Link for view source: <code>url: https://github.com/.../_posts/tree/master/</code></li>\n<li>Link for fork &amp; edit: <code>url: https://github.com/.../_posts/edit/master/</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_edit:</span></span><br><span class=\"line\">  <span class=\"attr\">url:</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Post-Navigation\"><a href=\"#Post-Navigation\" class=\"headerlink\" title=\"Post Navigation\"></a>Post Navigation</h3><p>Show previous post and next post in post footer if exists.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">post_navigation:</span> <span class=\"string\">left</span></span><br></pre></td></tr></table></figure>\n"},{"title":"SEO","url":"/docs/theme-settings/seo.html","content":"<h3 id=\"SEO-Setting\"><a href=\"#SEO-Setting\" class=\"headerlink\" title=\"SEO Setting\"></a>SEO Setting</h3><p>Next provides useful options for better Search Engine Optimization (SEO).</p>\n<div class=\"note info\"><p>By default a canonical link tag is created in Hexo after you have set up your URL <code>url: http://example.com</code> in <mark class=\"label info\">site config file</mark>. More detailed information can be found in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmdvb2dsZS5jb20vd2VibWFzdGVycy9hbnN3ZXIvMTM5MDY2\">Consolidate duplicate URLs<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</div>\n\n<div class=\"tabs\" id=\"seo\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#seo-1\"><code>disable_baidu_transformation</code></a></li><li class=\"tab\"><a href=\"#seo-2\"><code>index_with_subtitle</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"seo-1\"><p>By default China&#39;s search engine Baidu will cache and rewrite your site to provide a webpage snapshot for mobile users. You can disable this by setting the value <code>disable_baidu_transformation</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">disable_baidu_transformation:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"seo-2\"><p>Set the value <code>enable</code> to <code>true</code> in <code>index_with_subtitle</code> section to add <code>subtitle</code> information in <mark class=\"label info\">site config file</mark> to index page.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">index_with_subtitle:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Webmaster-Tools\"><a href=\"#Webmaster-Tools\" class=\"headerlink\" title=\"Webmaster Tools\"></a>Webmaster Tools</h3><h4 id=\"Google-Webmaster-Tools\"><a href=\"#Google-Webmaster-Tools\" class=\"headerlink\" title=\"Google Webmaster Tools\"></a>Google Webmaster Tools</h4><p>Set the verification string of <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc2VhcmNo\">Google Webmaster Tools<i class=\"fa fa-external-link-alt\"></i></span> which is used in submitting sitemap.</p>\n<div class=\"tabs\" id=\"google-webmaster-tools\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#google-webmaster-tools-1\">Get Verification Code →</a></li><li class=\"tab\"><a href=\"#google-webmaster-tools-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"google-webmaster-tools-1\"><p>Login to Google Webmaster Tools and go to verification methods and choose <code>HTML Tag</code>, you will get some code:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;google-site-verification&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;XXXXXXXXXXXXXXXXXXXXXXX&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"google-webmaster-tools-2\"><p>Copy <code>XXXXXXXXXXXXXXXXXXXXXXX</code> value of <code>content</code> key.<br>Edit <mark class=\"label primary\">theme config file</mark> and add or change <code>google_site_verification</code> section:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">google_site_verification:</span> <span class=\"string\">XXXXXXXXXXXXXXXXXXXXXXX</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Bing-Webmaster-Tools\"><a href=\"#Bing-Webmaster-Tools\" class=\"headerlink\" title=\"Bing Webmaster Tools\"></a>Bing Webmaster Tools</h4><p>Set the verification string of <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmluZy5jb20vd2VibWFzdGVycw==\">Bing Webmaster Tools<i class=\"fa fa-external-link-alt\"></i></span> which is used in submitting sitemap.</p>\n<div class=\"tabs\" id=\"bing-webmaster-tools\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#bing-webmaster-tools-1\">Get Verification Code →</a></li><li class=\"tab\"><a href=\"#bing-webmaster-tools-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"bing-webmaster-tools-1\"><p>Login to Bing Webmaster Tools and go to verification methods and choose <code>HTML Tag</code>, you will get some code:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;msvalidate.01&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;XXXXXXXXXXXXXXXXXXXXXXX&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"bing-webmaster-tools-2\"><p>Copy <code>XXXXXXXXXXXXXXXXXXXXXXX</code> value of <code>content</code> key.<br>Edit <mark class=\"label primary\">theme config file</mark> and add or change <code>bing_site_verification</code> section:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">bing_site_verification:</span> <span class=\"string\">XXXXXXXXXXXXXXXXXXXXXXX</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Yandex-Webmaster-Tools\"><a href=\"#Yandex-Webmaster-Tools\" class=\"headerlink\" title=\"Yandex Webmaster Tools\"></a>Yandex Webmaster Tools</h4><p>Set the verification string of <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJtYXN0ZXIueWFuZGV4LnJ1Lw==\">Yandex Webmaster Tools<i class=\"fa fa-external-link-alt\"></i></span> which is used in submitting sitemap.</p>\n<div class=\"tabs\" id=\"yandex-webmaster-tools\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#yandex-webmaster-tools-1\">Get Verification Code →</a></li><li class=\"tab\"><a href=\"#yandex-webmaster-tools-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"yandex-webmaster-tools-1\"><p>Login to Yandex Webmaster Tools and go to verification methods and choose <code>Meta Tag</code>, you will get some code:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;yandex-verification&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;XXXXXXXXXXXXXXXXXXXXXXX&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"yandex-webmaster-tools-2\"><p>Copy <code>XXXXXXXXXXXXXXXXXXXXXXX</code> value of <code>content</code> key.<br>Edit <mark class=\"label primary\">theme config file</mark> and add or change <code>yandex_site_verification</code> section:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">yandex_site_verification:</span> <span class=\"string\">XXXXXXXXXXXXXXXXXXXXXXX</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Baidu-Webmaster-Tools\"><a href=\"#Baidu-Webmaster-Tools\" class=\"headerlink\" title=\"Baidu Webmaster Tools\"></a>Baidu Webmaster Tools</h4><p>Set the verification string of <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aXl1YW4uYmFpZHUuY29tL3NpdGUv\">Baidu Webmaster Tools<i class=\"fa fa-external-link-alt\"></i></span> which is used in submitting sitemap.</p>\n<div class=\"tabs\" id=\"baidu-webmaster-tools\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#baidu-webmaster-tools-1\">Get Verification Code →</a></li><li class=\"tab\"><a href=\"#baidu-webmaster-tools-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"baidu-webmaster-tools-1\"><p>Login to Baidu Webmaster Tools and go to verification methods and choose <code>HTML Tag</code>, you will get some code:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;baidu-site-verification&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;XXXXXXXXXXXXXXXXXXXXXXX&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"baidu-webmaster-tools-2\"><p>Copy <code>XXXXXXXXXXXXXXXXXXXXXXX</code> value of <code>content</code> key.<br>Edit <mark class=\"label primary\">theme config file</mark> and add or change <code>baidu_site_verification</code> section:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">baidu_site_verification:</span> <span class=\"string\">XXXXXXXXXXXXXXXXXXXXXXX</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<p>NexT also supports the baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO. You can enable it by setting value <code>baidu_push</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">baidu_push:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Sidebar Setting","url":"/docs/theme-settings/sidebar.html","content":"<h3 id=\"Sidebar-Style\"><a href=\"#Sidebar-Style\" class=\"headerlink\" title=\"Sidebar Style\"></a>Sidebar Style</h3><p>By default sidebar only shows in posts (have a table of content), and is placed in left side. You can change it by editing values under <code>sidebar</code> setting in <mark class=\"label primary\">theme config file</mark>.</p>\n<p>Sidebar has several options, including <code>position</code>, <code>width</code>, <code>display</code>, <code>padding</code> and <code>offset</code>.</p>\n<div class=\"tabs\" id=\"setting-sidebar\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#setting-sidebar-1\"><code>position</code></a></li><li class=\"tab\"><a href=\"#setting-sidebar-2\"><code>width</code></a></li><li class=\"tab\"><a href=\"#setting-sidebar-3\"><code>display</code></a></li><li class=\"tab\"><a href=\"#setting-sidebar-4\"><code>padding</code></a></li><li class=\"tab\"><a href=\"#setting-sidebar-5\"><code>offset</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"setting-sidebar-1\"><p>Set up sidebar position by changing the value of <code>sidebar.position</code>, which can be one of following:</p>\n<ul>\n<li><strong><code>left</code></strong> → Place at the left of the screen.</li>\n<li><code>right</code> → Place at the right of the screen.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sidebar:</span></span><br><span class=\"line\">  <span class=\"attr\">position:</span> <span class=\"string\">left</span></span><br><span class=\"line\">  <span class=\"comment\">#position: right</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"setting-sidebar-2\"><p>You can change sidebar width by specify <code>sidebar.width</code> setting in pixels, for example:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sidebar:</span></span><br><span class=\"line\">  <span class=\"attr\">width:</span> <span class=\"number\">300</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note info\"><p>This option is commented out by default and values are:</p>\n<ul>\n<li>For Muse | Mist schemes: <code>320</code></li>\n<li>For Pisces | Gemini schemes: <code>240</code></li>\n</ul>\n</div></div><div class=\"tab-pane\" id=\"setting-sidebar-3\"><p>Set up conditions under which sidebar will show by editing <code>sidebar.display</code> value, which can be one of following:</p>\n<ul>\n<li><strong><code>post</code></strong> → Show sidebar only in posts which have index.</li>\n<li><code>always</code> → Show sidebar in all pages.</li>\n<li><code>hide</code> → Hide it in all pages (but can be opened by user manually).</li>\n<li><code>remove</code> → Remove sidebar totally.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sidebar:</span></span><br><span class=\"line\">  <span class=\"attr\">display:</span> <span class=\"string\">post</span></span><br><span class=\"line\">  <span class=\"comment\">#display: always</span></span><br><span class=\"line\">  <span class=\"comment\">#display: hide</span></span><br><span class=\"line\">  <span class=\"comment\">#display: remove</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"setting-sidebar-4\"><p>Set up sidebar padding in pixels by changing the value of <code>sidebar.padding</code>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sidebar:</span></span><br><span class=\"line\">  <span class=\"attr\">padding:</span> <span class=\"number\">18</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"setting-sidebar-5\"><p>Set up sidebar offset from top menubar in pixels by changing the value of <code>sidebar.offset</code>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sidebar:</span></span><br><span class=\"line\">  <span class=\"attr\">offset:</span> <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note danger\"><p>For now only Pisces &#x2F; Gemini Schemes supports <code>offset</code> setting under <strong>6.0.x</strong> version or later.</p>\n</div></div></div></div>\n\n<h3 id=\"Configuring-Avatar\"><a href=\"#Configuring-Avatar\" class=\"headerlink\" title=\"Configuring Avatar\"></a>Configuring Avatar</h3><p>By default NexT doesn&#39;t show avatar in sidebar. You can configure it by editing values under <code>avatar</code> setting in <mark class=\"label primary\">theme config file</mark>.</p>\n<div class=\"tabs\" id=\"avatar\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#avatar-1\"><code>url</code></a></li><li class=\"tab\"><a href=\"#avatar-2\"><code>rounded</code></a></li><li class=\"tab\"><a href=\"#avatar-3\"><code>rotated</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"avatar-1\"><p>For first test you can uncomment <code>/images/avatar.gif</code> value near the <code>avatar.url</code> setting to see default avatar:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">avatar:</span></span><br><span class=\"line\">  <span class=\"attr\">url:</span> <span class=\"string\">/images/avatar.gif</span></span><br></pre></td></tr></table></figure>\n\n<p>Then you need to specify your own avatar. It can be done one of the ways below:</p>\n<div class=\"tabs\" id=\"avatar1\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#avatar1-1\"><mark class=\"label success\">Hexo directory</mark></a></li><li class=\"tab\"><a href=\"#avatar1-2\">NexT directory</a></li><li class=\"tab\"><a href=\"#avatar1-3\">Absolute URL from Internet</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"avatar1-1\"><p>Put your avatar under <mark class=\"label info\">site directory</mark> <code>source/uploads/</code> (create directory if it doesn&#39;t exists).<br>And then change option to <code>url: /uploads/avatar.png</code>.</p></div><div class=\"tab-pane\" id=\"avatar1-2\"><p>Put your avatar under <mark class=\"label primary\">theme directory</mark> <code>source/images/</code>.<br>And then change option to <code>url: /images/avatar.png</code>.</p>\n<div class=\"note info\"><p>Current site uses avatar under <mark class=\"label primary\">theme directory</mark> from file located in <code>next/source/images/apple-touch-icon-next.png</code> with following config:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">avatar:</span></span><br><span class=\"line\">  <span class=\"attr\">url:</span> <span class=\"string\">/images/apple-touch-icon-next.png</span></span><br></pre></td></tr></table></figure>\n</div></div><div class=\"tab-pane\" id=\"avatar1-3\"><p>You can also specify any external URL with absolute path to image: <code>http(s)://example.com/avatar.png</code></p></div></div></div></div><div class=\"tab-pane\" id=\"avatar-2\"><p>Set up rounded of avatar by changing the value of <code>avatar.rounded</code>:</p>\n<ul>\n<li><code>true</code> → Avatar will be rounded.</li>\n<li><strong><code>false</code></strong> → Avatar will be squared.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">avatar:</span></span><br><span class=\"line\">  <span class=\"attr\">rounded:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"avatar-3\"><p>Set up rotated of avatar by changing the value of <code>avatar.rotated</code>:</p>\n<ul>\n<li><code>true</code> → Avatar will be rotate under the mouse hovering.</li>\n<li><strong><code>false</code></strong> → Avatar will not rotate under the mouse hovering.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">avatar:</span></span><br><span class=\"line\">  <span class=\"attr\">rotated:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Sidebar-Site-State\"><a href=\"#Sidebar-Site-State\" class=\"headerlink\" title=\"Sidebar Site State\"></a>Sidebar Site State</h3><p>By default NexT shows the categories and counts of Posts &#x2F; Categories &#x2F; Tags in sidebar. You can configure it by editing value <code>site_state</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">site_state:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Sidebar-Social-Links\"><a href=\"#Sidebar-Social-Links\" class=\"headerlink\" title=\"Sidebar Social Links\"></a>Sidebar Social Links</h3><div class=\"note default\"><p>Social Links have similar structure as <a href=\"/docs/theme-settings/#Configuring-Menu-Items\">Menu Items</a>, only target link there is difference: specified link must have full url path (permalink).</p>\n</div>\n\n<p>Edit the <code>social</code> section in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">social:</span></span><br><span class=\"line\">  <span class=\"attr\">GitHub:</span> <span class=\"string\">https://github.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-github</span></span><br><span class=\"line\">  <span class=\"attr\">E-Mail:</span> <span class=\"string\">mailto:yourname@gmail.com</span> <span class=\"string\">||</span> <span class=\"string\">fa</span> <span class=\"string\">fa-envelope</span></span><br><span class=\"line\">  <span class=\"attr\">Weibo:</span> <span class=\"string\">https://weibo.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-weibo</span></span><br><span class=\"line\">  <span class=\"attr\">Google:</span> <span class=\"string\">https://plus.google.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-google</span></span><br><span class=\"line\">  <span class=\"attr\">Twitter:</span> <span class=\"string\">https://twitter.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-twitter</span></span><br><span class=\"line\">  <span class=\"attr\">FB Page:</span> <span class=\"string\">https://www.facebook.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-facebook</span></span><br><span class=\"line\">  <span class=\"attr\">StackOverflow:</span> <span class=\"string\">https://stackoverflow.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-stack-overflow</span></span><br><span class=\"line\">  <span class=\"attr\">YouTube:</span> <span class=\"string\">https://youtube.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-youtube</span></span><br><span class=\"line\">  <span class=\"attr\">Instagram:</span> <span class=\"string\">https://instagram.com/yourname</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-instagram</span></span><br><span class=\"line\">  <span class=\"attr\">Skype:</span> <span class=\"string\">skype:yourname?call|chat</span> <span class=\"string\">||</span> <span class=\"string\">fab</span> <span class=\"string\">fa-skype</span></span><br></pre></td></tr></table></figure>\n\n<p>By default NexT shows the icons of social links in sidebar.</p>\n<div class=\"tabs\" id=\"social_icons\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#social_icons-1\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#social_icons-2\"><code>icons_only</code></a></li><li class=\"tab\"><a href=\"#social_icons-3\"><code>transition</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"social_icons-1\"><p>You can configure it by editing value <code>enable</code> in <code>social_icons</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">social_icons:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"social_icons-2\"><p>Set the value <code>icons_only</code> to <code>true</code> to display social icons without description in <code>social_icons</code> section in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">social_icons:</span></span><br><span class=\"line\">  <span class=\"attr\">icons_only:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"social_icons-3\"><p>Set the value <code>transition</code> to <code>true</code> to display social icons with transition effects in <code>social_icons</code> section in <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">social_icons:</span></span><br><span class=\"line\">  <span class=\"attr\">transition:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Sidebar-Blogrolls\"><a href=\"#Sidebar-Blogrolls\" class=\"headerlink\" title=\"Sidebar Blogrolls\"></a>Sidebar Blogrolls</h3><p>You can add blog rolls within sidebar in NexT.</p>\n<div class=\"tabs\" id=\"blogrolls\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#blogrolls-1\"><code>links_settings</code></a></li><li class=\"tab\"><a href=\"#blogrolls-2\"><code>links</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"blogrolls-1\"><p>By default NexT shows the <code>globe</code> icon <a class=\"btn\" href=\"#\"><i class=\"fa fa-globe\"></i></a> before <code>title</code>. The name of icon can be found in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb250YXdlc29tZS5jb20v\">Font Awesome<i class=\"fa fa-external-link-alt\"></i></span> site. You can configure it by editing value <code>icon</code> in <code>links_settings</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">links_settings:</span></span><br><span class=\"line\">  <span class=\"attr\">icon:</span> <span class=\"string\">fa</span> <span class=\"string\">fa-globe</span></span><br></pre></td></tr></table></figure>\n\n<p>By default NexT uses <code>Links</code> as the name of blogroll. You can configure it by editing value <code>title</code> in <code>links_settings</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">links_settings:</span></span><br><span class=\"line\">  <span class=\"attr\">title:</span> <span class=\"string\">Links</span></span><br></pre></td></tr></table></figure>\n\n<p>By default all blogrolls are displayed in block. You can configure it to <code>inline</code> by editing value <code>layout</code> in <code>links_settings</code> section in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">links_settings:</span></span><br><span class=\"line\">  <span class=\"attr\">layout:</span> <span class=\"string\">block</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"blogrolls-2\"><p>Edit the <code>links</code> section in <mark class=\"label primary\">theme config file</mark> and add your favorite links:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">links:</span></span><br><span class=\"line\">  <span class=\"attr\">Title1:</span> <span class=\"string\">https://example1.com/</span></span><br><span class=\"line\">  <span class=\"attr\">Title2:</span> <span class=\"string\">https://example2.com/</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Sidebar-TOC\"><a href=\"#Sidebar-TOC\" class=\"headerlink\" title=\"Sidebar TOC\"></a>Sidebar TOC</h3><div class=\"tabs\" id=\"toc\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#toc-1\"><code>enable</code></a></li><li class=\"tab\"><a href=\"#toc-2\"><code>number</code></a></li><li class=\"tab\"><a href=\"#toc-3\"><code>wrap</code></a></li><li class=\"tab\"><a href=\"#toc-4\"><code>expand_all</code></a></li><li class=\"tab\"><a href=\"#toc-5\"><code>max_depth</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"toc-1\"><p>By default NexT shows <code>Table Of Contents (TOC)</code> in the sidebar. You can disable it by setting <code>toc.enable</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">toc:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"toc-2\"><p>By default NexT adds list number to TOC automatically. You can disable it by setting <code>toc.number</code> to <code>false</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">toc:</span></span><br><span class=\"line\">  <span class=\"attr\">number:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"toc-3\"><p>If the post header width longer than sidebar width, you can wrap the header words in next lines by setting <code>toc.wrap</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">toc:</span></span><br><span class=\"line\">  <span class=\"attr\">wrap:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"toc-4\"><p>If you want all level of TOC in a post to be displayed, rather than the activated part of it, you can set <code>toc.expand_all</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">toc:</span></span><br><span class=\"line\">  <span class=\"attr\">expand_all:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"toc-5\"><p>By default maximum heading depth of generated toc is 6. You can set it by setting <code>toc.max_depth</code> to <code>another number</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">toc:</span></span><br><span class=\"line\">  <span class=\"attr\">max_depth:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure></div></div></div>\n"},{"title":"Chat Services","url":"/docs/third-party-services/chat-services.html","content":"<h3 id=\"Chatra\"><a href=\"#Chatra\" class=\"headerlink\" title=\"Chatra\"></a>Chatra</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGF0cmEuY29tLw==\">Chatra<i class=\"fa fa-external-link-alt\"></i></span> is a live chat messenger app for your website.</p>\n<div class=\"tabs\" id=\"chatra\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#chatra-1\">Enable Chatra →</a></li><li class=\"tab\"><a href=\"#chatra-2\">Activate sidebar button</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"chatra-1\"><p>Visit <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcHAuY2hhdHJhLmlvL3NldHRpbmdzL2dlbmVyYWw=\">Dashboard<i class=\"fa fa-external-link-alt\"></i></span> to get your ChatraID.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Chatra Support</span></span><br><span class=\"line\"><span class=\"comment\"># See: https://chatra.com</span></span><br><span class=\"line\"><span class=\"comment\"># Dashboard: https://app.chatra.io/settings/general</span></span><br><span class=\"line\"><span class=\"attr\">chatra:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">async:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">id:</span> <span class=\"string\">&lt;ChatraID&gt;</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"chatra-2\"><p>After Chatra enabled, you can set <code>chat.enable</code> to <code>true</code> and set <code>chat.service</code> to <code>chatra</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># A button to open designated chat widget in sidebar.</span></span><br><span class=\"line\"><span class=\"comment\"># Firstly, you need enable the chat service you want to activate its sidebar button.</span></span><br><span class=\"line\"><span class=\"attr\">chat:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">service:</span> <span class=\"string\">chatra</span></span><br><span class=\"line\">  <span class=\"attr\">icon:</span> <span class=\"string\">fa</span> <span class=\"string\">fa-comment</span></span><br><span class=\"line\">  <span class=\"attr\">text:</span> <span class=\"string\">Chat</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Tidio\"><a href=\"#Tidio\" class=\"headerlink\" title=\"Tidio\"></a>Tidio</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGlkaW8uY29tLw==\">Tidio<i class=\"fa fa-external-link-alt\"></i></span> is a live chat messenger app for your website.</p>\n<div class=\"tabs\" id=\"tidio\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tidio-1\">Enable Tidio →</a></li><li class=\"tab\"><a href=\"#tidio-2\">Activate sidebar button</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tidio-1\"><p>Visit <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGlkaW8uY29tL3BhbmVsL2Rhc2hib2FyZA==\">Dashboard<i class=\"fa fa-external-link-alt\"></i></span> to get your Public Key.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Tidio Support</span></span><br><span class=\"line\"><span class=\"comment\"># See: https://www.tidio.com</span></span><br><span class=\"line\"><span class=\"comment\"># Dashboard: https://www.tidio.com/panel/dashboard</span></span><br><span class=\"line\"><span class=\"attr\">tidio:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">key:</span> <span class=\"string\">&lt;Publick</span> <span class=\"string\">Key&gt;</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"tidio-2\"><p>After Tidio enabled, you can set <code>chat.enable</code> to <code>true</code> and set <code>chat.service</code> to <code>tidio</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># A button to open designated chat widget in sidebar.</span></span><br><span class=\"line\"><span class=\"comment\"># Firstly, you need enable the chat service you want to activate its sidebar button.</span></span><br><span class=\"line\"><span class=\"attr\">chat:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">service:</span> <span class=\"string\">tidio</span></span><br><span class=\"line\">  <span class=\"attr\">icon:</span> <span class=\"string\">fa</span> <span class=\"string\">fa-comment</span></span><br><span class=\"line\">  <span class=\"attr\">text:</span> <span class=\"string\">Chat</span></span><br></pre></td></tr></table></figure></div></div></div>\n"},{"title":"Comment Systems","url":"/docs/third-party-services/comments.html","content":"<h3 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h3><h4 id=\"Multiple-Comment-System-Support\"><a href=\"#Multiple-Comment-System-Support\" class=\"headerlink\" title=\"Multiple Comment System Support\"></a>Multiple Comment System Support</h4><p>NexT allows you to enable multiple commenting systems at the same time. You can modify the following configuration to adjust the style or behavior of multiple commenting systems.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Multiple Comment System Support</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: tabs | buttons</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">tabs</span></span><br><span class=\"line\">  <span class=\"comment\"># Choose a comment system to be displayed by default</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances | isso</span></span><br><span class=\"line\">  <span class=\"attr\">active:</span></span><br><span class=\"line\">  <span class=\"comment\"># Setting `true` means remembering the comment system selected by the visitor</span></span><br><span class=\"line\">  <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Lazyload all comment systems.</span></span><br><span class=\"line\">  <span class=\"attr\">lazyload:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Modify icons and texts for any style, here are some examples</span></span><br><span class=\"line\">  <span class=\"attr\">nav:</span></span><br><span class=\"line\">    <span class=\"comment\">#disqus:</span></span><br><span class=\"line\">    <span class=\"comment\">#  text: Load Disqus</span></span><br><span class=\"line\">    <span class=\"comment\">#  order: -1</span></span><br><span class=\"line\">    <span class=\"comment\">#gitalk:</span></span><br><span class=\"line\">    <span class=\"comment\">#  order: -2</span></span><br></pre></td></tr></table></figure>\n\n<p>You can enable lazyload by setting value <code>comments.lazyload</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>. NexT uses IntersectionObserver to lazyload the comments, which is not supported by IE and most browsers released before 2017.</p>\n<iframe data-feature=\"intersectionobserver\" src=\"https://caniuse.bitsofco.de/embed/index.html?feat=intersectionobserver&periods=current,past_1,past_2,past_3,past_4,past_5&accessible-colours=false\" frameborder=\"0\" width=\"100%\" height=\"400px\"></iframe>\n\n<p>If your blog readers are mostly using legacy browsers, please consider using <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3czYy9JbnRlcnNlY3Rpb25PYnNlcnZlci90cmVlL21hc3Rlci9wb2x5ZmlsbA==\">Intersection Observer polyfill<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<h4 id=\"How-to-Disable-Comments-on-Page\"><a href=\"#How-to-Disable-Comments-on-Page\" class=\"headerlink\" title=\"How to Disable Comments on Page\"></a>How to Disable Comments on Page</h4><p>When you enabled comment service like Disqus, all new page will have comment service automatically. If you want to disable it in one page, just add <code>comments</code> key to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZnJvbnQtbWF0dGVy\">front-matter<i class=\"fa fa-external-link-alt\"></i></span> and set its value to <code>false</code>. Like following:</p>\n<figure class=\"highlight md\"><figcaption><span>your-post.md</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">title: All tags</span><br><span class=\"line\">type: &quot;tags&quot;</span><br><span class=\"line\"><span class=\"section\">comments: false</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Rename-Comment-Count-Text\"><a href=\"#Rename-Comment-Count-Text\" class=\"headerlink\" title=\"Rename Comment Count Text\"></a>Rename Comment Count Text</h4><p>You can rename the post meta text of comment count using <code>languages.yml</code>: <a href=\"/docs/theme-settings/internationalization.html#Override-Default-Translations\">Override Default Translations</a>.</p>\n<h3 id=\"Disqus\"><a href=\"#Disqus\" class=\"headerlink\" title=\"Disqus\"></a>Disqus</h3><p>Disqus is a global comment system that improves discussion on websites and connects conversations across the web.</p>\n<ol>\n<li>Create an account and log into <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaXNxdXMuY29tLw==\">Disqus<i class=\"fa fa-external-link-alt\"></i></span>. Once logged in, click the <code>GET STARTED</code> button on the homepage, then select <code>I want to install Disqus on my site</code> option and you will see the <code>Create a new site</code> interface.</li>\n<li>Enter your <code>Website Name</code>, which will serve as your Disqus shortname, and select a Category from the drop-down menu. Then click <code>Create Site</code> button.</li>\n<li>Choose <code>I don&#39;t see my platform listed, install manually with Universal Code</code>, configure Disqus for your site, and click <code>Complete Setup</code> button.</li>\n<li>Set the value <code>enable</code> to <code>true</code>, add the obtained Disqus shortname (<code>shortname</code>), and edit other configurations in <code>disqus</code> section in the <mark class=\"label primary\">theme config file</mark> as following: <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">disqus:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">shortname:</span> <span class=\"string\">your-short-disqus-name</span></span><br><span class=\"line\">  <span class=\"attr\">count:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"DisqusJS\"><a href=\"#DisqusJS\" class=\"headerlink\" title=\"DisqusJS\"></a>DisqusJS</h3><p>Render Disqus comment component using Disqus API.</p>\n<ol>\n<li>Get your Disqus API Key from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaXNxdXMuY29tL2FwaS9hcHBsaWNhdGlvbnMv\">Disqus API Application<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n<li>Go to the settings page of your Disqus Application, enter your domain in Settings → Domains.</li>\n<li>Get your Disqus Shortname from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaXNxdXMuY29tL2FkbWluL3NldHRpbmdzL2dlbmVyYWwv\">General Settings - Disqus Admin<i class=\"fa fa-external-link-alt\"></i></span>.</li>\n<li>Set the value <code>enable</code> to <code>true</code>, add the obtained Disqus API Key (<code>apikey</code>) and Shortname (<code>shortname</code>), and edit other configurations in <code>disqusjs</code> section in the <mark class=\"label primary\">theme config file</mark> as following: <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DisqusJS</span></span><br><span class=\"line\"><span class=\"comment\"># Demo: https://disqusjs.skk.moe</span></span><br><span class=\"line\"><span class=\"attr\">disqusjs:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># API Endpoint of Disqus API (https://disqus.com/api/docs/)</span></span><br><span class=\"line\">  <span class=\"comment\"># leave api empty if you are able to connect to Disqus API</span></span><br><span class=\"line\">  <span class=\"comment\"># otherwise you need a reverse proxy for Disqus API</span></span><br><span class=\"line\">  <span class=\"comment\"># For example:</span></span><br><span class=\"line\">  <span class=\"comment\"># api: https://disqus.skk.moe/disqus/</span></span><br><span class=\"line\">  <span class=\"attr\">api:</span></span><br><span class=\"line\">  <span class=\"attr\">apikey:</span> <span class=\"comment\"># register new application from https://disqus.com/api/applications/</span></span><br><span class=\"line\">  <span class=\"attr\">shortname:</span> <span class=\"comment\"># See: https://disqus.com/admin/settings/general/</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"Changyan-China\"><a href=\"#Changyan-China\" class=\"headerlink\" title=\"Changyan (China)\"></a>Changyan (China)</h3><p>Changyan is the industry&#39;s leading social commenting system, supporting both PC and mobile access methods, providing a new way of commenting on websites. Changyan has a variety of common account login, triple filtering mechanism, real-time data statistics, fast data export, comprehensive support for mobile and other leading functions. It fully satisfies the needs of major websites for user login, comment, sharing, and review.</p>\n<ol>\n<li><p>Create an account or log into <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGFuZ3lhbi5rdWFpemhhbi5jb20v\">Changyan<i class=\"fa fa-external-link-alt\"></i></span>, then add your site to get APP ID and APP KEY.</p>\n</li>\n<li><p>Set the value <code>enable</code> to <code>true</code>, and add the obtained APP ID (<code>appid</code>) and APP KEY (<code>appkey</code>) to the <code>changyan</code> section in the <mark class=\"label primary\">theme config file</mark> as following:</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># changyan</span></span><br><span class=\"line\"><span class=\"attr\">changyan:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">appid:</span></span><br><span class=\"line\">  <span class=\"attr\">appkey:</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"LiveRe\"><a href=\"#LiveRe\" class=\"headerlink\" title=\"LiveRe\"></a>LiveRe</h3><p>LiveRe is a content platform based on social networking site reviews to help users communicate freely.</p>\n<ol>\n<li><p>Create an account or log into <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saXZlcmUuY29tLw==\">LiveRe<i class=\"fa fa-external-link-alt\"></i></span>, click on the <code>installation</code> button and select the free city version, then click on the <code>install now</code> button.</p>\n</li>\n<li><p>Copy the <code>data-uid</code> field in the installation code to get your LiveRe UID.</p>\n</li>\n<li><p>Add the obtained LiveRe UID to the <code>livere_uid</code> section in the <mark class=\"label primary\">theme config file</mark> as following:</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Support for LiveRe comments system.</span></span><br><span class=\"line\"><span class=\"comment\"># You can get your uid from https://livere.com/insight/myCode (General web site)</span></span><br><span class=\"line\"><span class=\"attr\">livere_uid:</span> <span class=\"string\">your_uid</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"Gitalk\"><a href=\"#Gitalk\" class=\"headerlink\" title=\"Gitalk\"></a>Gitalk</h3><p>Gitalk is a modern comment component based on Github Issue and Preact.</p>\n<ol>\n<li><p>Click here to sign up for a <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL2FwcGxpY2F0aW9ucy9uZXc=\">new OAuth Application<i class=\"fa fa-external-link-alt\"></i></span>. Other content can be filled in at will, but be sure to fill in the correct callback URL (usually the domain name corresponding to the comment page). Then you will get a Client ID and a Client secret.</p>\n</li>\n<li><p>Create a repository you want to store Gitalk comments in your GitHub.</p>\n</li>\n<li><p>Set the value <code>enable</code> to <code>true</code>, add Client ID (<code>client_id</code>) and Client secret (<code>client_secret</code>) in step 1, add your Github username (<code>github_id</code> and <code>admin_user</code>) and the created repository name (<code>repo</code>) in step 2, and edit other configurations in <code>gitalk</code> section in the <mark class=\"label primary\">theme config file</mark> as following:</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Gitalk</span></span><br><span class=\"line\"><span class=\"comment\"># Demo: https://gitalk.github.io</span></span><br><span class=\"line\"><span class=\"attr\">gitalk:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">github_id:</span>  <span class=\"comment\"># Github repo owner</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span>  <span class=\"comment\"># Repository name to store issues</span></span><br><span class=\"line\">  <span class=\"attr\">client_id:</span>  <span class=\"comment\"># Github Application Client ID</span></span><br><span class=\"line\">  <span class=\"attr\">client_secret:</span>  <span class=\"comment\"># Github Application Client Secret</span></span><br><span class=\"line\">  <span class=\"attr\">admin_user:</span>  <span class=\"comment\"># GitHub repo owner and collaborators, only these guys can initialize github issues</span></span><br><span class=\"line\">  <span class=\"attr\">distraction_free_mode:</span> <span class=\"literal\">true</span> <span class=\"comment\"># Facebook-like distraction free mode</span></span><br><span class=\"line\">  <span class=\"comment\"># Gitalk&#x27;s display language depends on user&#x27;s browser or system environment</span></span><br><span class=\"line\">  <span class=\"comment\"># If you want everyone visiting your site to see a uniform language, you can set a force language value</span></span><br><span class=\"line\">  <span class=\"comment\"># Available value: en, es-ES, fr, ru, zh-CN, zh-TW</span></span><br><span class=\"line\">  <span class=\"attr\">language:</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<div class=\"note warning\"><p>Hexo has encode URLs by default since version 4.0: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL3B1bGwvMzcwOA==\">PR 3708<i class=\"fa fa-external-link-alt\"></i></span>.<br>Gitalk relies on the md5 value of the page path for tagging, and this may cause issues. It&#39;s recommended to upgrade Hexo to 4.0 (or later), NexT to 7.7.0 (or later) to use Gitalk.</p>\n</div>\n\n<h3 id=\"Utterances\"><a href=\"#Utterances\" class=\"headerlink\" title=\"Utterances\"></a>Utterances</h3><p>A lightweight comments widget built on GitHub issues. Use GitHub issues for blog comments, wiki pages and more!</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Utterances</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://utteranc.es</span></span><br><span class=\"line\"><span class=\"attr\">utterances:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"comment\"># Github repository name</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: pathname | url | title | og:title</span></span><br><span class=\"line\">  <span class=\"attr\">issue_term:</span> <span class=\"string\">pathname</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: github-light | github-dark | preferred-color-scheme | github-dark-orange | icy-dark | dark-blue | photon-dark | boxy-light</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span> <span class=\"string\">github-light</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Isso\"><a href=\"#Isso\" class=\"headerlink\" title=\"Isso\"></a>Isso</h3><p>Isso – <em>Ich schrei sonst</em> – is a lightweight commenting server written in Python and JavaScript. It aims to be a drop-in replacement for Disqus.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Isso</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://posativ.org/isso/</span></span><br><span class=\"line\"><span class=\"attr\">isso:</span> <span class=\"comment\"># &lt;data_isso&gt;</span></span><br></pre></td></tr></table></figure>\n"},{"title":"External Libraries","url":"/docs/third-party-services/external-libraries.html","content":"<h3 id=\"PJAX\"><a href=\"#PJAX\" class=\"headerlink\" title=\"PJAX\"></a>PJAX</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL01vT3gvcGpheA==\">Pjax<i class=\"fa fa-external-link-alt\"></i></span> is a standalone JavaScript module that uses AJAX (XmlHttpRequest) and <code>pushState()</code> to deliver a fast browsing experience.</p>\n<p>It allows you to completely transform the user experience of standard websites (server-side generated or static ones) to make users feel like they are browsing an app, especially for those with low bandwidth connections.</p>\n<div class=\"note warning\"><p>Please use the absolute path of the image or <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdGFnLXBsdWdpbnMjSW5jbHVkZS1Bc3NldHM=\">Hexo asset_img tag<i class=\"fa fa-external-link-alt\"></i></span> in your posts, otherwise the images may fail to load during Pjax refresh.</p>\n</div>\n\n<p>You can enable it by setting value <code>pjax</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Easily enable fast Ajax navigation on your website.</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://github.com/next-theme/pjax</span></span><br><span class=\"line\"><span class=\"attr\">pjax:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Fancybox\"><a href=\"#Fancybox\" class=\"headerlink\" title=\"Fancybox\"></a>Fancybox</h3><p>NexT supports the fancybox plugin, which is a jQuery lightbox script for displaying images, videos and more. Touch enabled, responsive and fully customizable.</p>\n<p>You can enable it by setting value <code>fancybox</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">fancybox:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Medium-Zoom\"><a href=\"#Medium-Zoom\" class=\"headerlink\" title=\"Medium Zoom\"></a>Medium Zoom</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZyYW5jb2lzY2hhbGlmb3VyL21lZGl1bS16b29t\">Medium Zoom<i class=\"fa fa-external-link-alt\"></i></span> is a JavaScript library for zooming images like Medium.</p>\n<p>You can enable it by setting value <code>mediumzoom</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># A JavaScript library for zooming images like Medium.</span></span><br><span class=\"line\"><span class=\"attr\">mediumzoom:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note warning\"><p>Do not enable both <code>fancybox</code> and <code>mediumzoom</code>.</p>\n</div>\n\n<h3 id=\"Lazyload\"><a href=\"#Lazyload\" class=\"headerlink\" title=\"Lazyload\"></a>Lazyload</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0Fwb29ydlNheGVuYS9sb3phZC5qcw==\">Lozad.js<i class=\"fa fa-external-link-alt\"></i></span> is a lazy loader plugin in modern vanilla JavaScript. It delays loading of images in long web pages. Images outside of viewport will not be loaded before user scrolls to them. This is opposite of image preloading.</p>\n<p>You can enable it by setting value <code>lazyload</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Vanilla JavaScript plugin for lazyloading images.</span></span><br><span class=\"line\"><span class=\"attr\">lazyload:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>Then run the following command in <mark class=\"label info\">site root dir</mark> to ensure that <code>lazyload</code> can be enabled or disabled correctly:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo clean</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Pangu-Autospace\"><a href=\"#Pangu-Autospace\" class=\"headerlink\" title=\"Pangu Autospace\"></a>Pangu Autospace</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3Bhbmd1Lmpz\">pangu.js<i class=\"fa fa-external-link-alt\"></i></span> will automatically insert a blank space between all the Chinese characters and the hexagonal English numeric symbols on the page.</p>\n<p>You can enable it by setting value <code>pangu</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Pangu Support</span></span><br><span class=\"line\"><span class=\"attr\">pangu:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Quicklink\"><a href=\"#Quicklink\" class=\"headerlink\" title=\"Quicklink\"></a>Quicklink</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dvb2dsZUNocm9tZUxhYnMvcXVpY2tsaW5r\">Quicklink<i class=\"fa fa-external-link-alt\"></i></span> is a JavaScript plugin that faster subsequent page-loads by prefetching in-viewport links during idle time. Chrome, Firefox, Edge are supported without polyfills.</p>\n<p>You can enable it by setting value <code>quicklink.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">...</span></span><br><span class=\"line\"><span class=\"attr\">quicklink:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">archive:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">delay:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">timeout:</span> <span class=\"number\">3000</span></span><br><span class=\"line\">  <span class=\"attr\">priority:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">ignores:</span></span><br><span class=\"line\"><span class=\"string\">...</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Animation-Effect\"><a href=\"#Animation-Effect\" class=\"headerlink\" title=\"Animation Effect\"></a>Animation Effect</h3><p>NexT enables animation effect by default which is supported by Anime.js and Animate.css, so it will wait for JavaScript loaded to show content.<br>If you need speed you can set this section <code>enable</code> to <code>false</code> to disable it.</p>\n<p>Edit <mark class=\"label primary\">theme config file</mark> and set the needed values under the <code>motion</code> to fit your demand. You can preview all Transition variants here: <span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9hbmltYXRlLw==\">NexT Animation Effect Preview<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Use Animate.css to animate everything.</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://animate.style</span></span><br><span class=\"line\"><span class=\"attr\">motion:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">async:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">transition:</span></span><br><span class=\"line\">    <span class=\"comment\"># All available Transition variants: https://theme-next.js.org/animate/</span></span><br><span class=\"line\">    <span class=\"attr\">post_block:</span> <span class=\"string\">fadeIn</span></span><br><span class=\"line\">    <span class=\"attr\">post_header:</span> <span class=\"string\">fadeInDown</span></span><br><span class=\"line\">    <span class=\"attr\">post_body:</span> <span class=\"string\">fadeInDown</span></span><br><span class=\"line\">    <span class=\"attr\">coll_header:</span> <span class=\"string\">fadeInLeft</span></span><br><span class=\"line\">    <span class=\"comment\"># Only for Pisces | Gemini.</span></span><br><span class=\"line\">    <span class=\"attr\">sidebar:</span> <span class=\"string\">fadeInUp</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Progress-Bar\"><a href=\"#Progress-Bar\" class=\"headerlink\" title=\"Progress Bar\"></a>Progress Bar</h3><p>NProgress will automatically monitor your Ajax requests, event loop lag, document ready state and elements on your page to decide on the progress.</p>\n<div class=\"tabs\" id=\"nprogress\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#nprogress-1\"><code>nprogress</code></a></li><li class=\"tab\"><a href=\"#nprogress-2\"><code>spinner</code></a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"nprogress-1\"><p>You can enable it by setting value <code>nprogress.enable</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">nprogress:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"nprogress-2\"><p>Turn off loading spinner by setting it to <code>false</code>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">nprogress:</span></span><br><span class=\"line\">  <span class=\"attr\">spinner:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Canvas-Ribbon\"><a href=\"#Canvas-Ribbon\" class=\"headerlink\" title=\"Canvas Ribbon\"></a>Canvas Ribbon</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2h1c3RjYy9yaWJib24uanM=\">canvas-ribbon.js<i class=\"fa fa-external-link-alt\"></i></span> is a ribbon backgroud of website draw on canvas.</p>\n<p>You can enable it by setting value <code>canvas_ribbon</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>. You can also configure the ribbon setting by editing values in <code>canvas_ribbon</code> section:</p>\n<ul>\n<li>size: The width of the ribbon.</li>\n<li>alpha: The transparency of the ribbon.</li>\n<li>zIndex: The display level of the ribbon.</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">canvas_ribbon:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">size:</span> <span class=\"number\">300</span></span><br><span class=\"line\">  <span class=\"attr\">alpha:</span> <span class=\"number\">0.6</span></span><br><span class=\"line\">  <span class=\"attr\">zIndex:</span> <span class=\"number\">-1</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Third-party Services","url":"/docs/third-party-services/index.html","content":"<p>Static website is limited in some functions, so we need third-party services to extend our site.<br>In any time you can extend needed functions by using third-party services supported by NexT.</p>\n<h3 id=\"Adding-Plugins\"><a href=\"#Adding-Plugins\" class=\"headerlink\" title=\"Adding Plugins\"></a>Adding Plugins</h3><p>Plugins extend and expand the functionality of NexT. There are two types of plugins: core plugins and third-party plugins. The core plugins are loaded from your site by default, they are required by the basic functions of NexT. Third-party plugins provide a large number of optional features. They are loaded from jsDelivr CDN by default, because it is fast in everywhere.</p>\n<p>Configuring these plugins is very easy. For example, if you want to use <code>pjax</code> in your site, just set <code>pjax</code> to <code>true</code> in <mark class=\"label primary\">theme config file</mark>:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Easily enable fast Ajax navigation on your website.</span></span><br><span class=\"line\"><span class=\"comment\"># For more information: https://github.com/next-theme/pjax</span></span><br><span class=\"line\"><span class=\"attr\">pjax:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>If you want to specify the CDN provider for any plugins, you need to set &#x2F; update the CDN URL. See <a href=\"/docs/advanced-settings/vendors.html\">Advanced Settings</a> for more information.</p>\n<p>Detailed documentation about these plugins is listed below.</p>\n<h3 id=\"Math-Equations\"><a href=\"#Math-Equations\" class=\"headerlink\" title=\"Math Equations\"></a>Math Equations</h3><ul>\n<li><a href=\"/docs/third-party-services/math-equations.html\">Math Equations</a></li>\n</ul>\n<h3 id=\"Comment-Systems\"><a href=\"#Comment-Systems\" class=\"headerlink\" title=\"Comment Systems\"></a>Comment Systems</h3><ul>\n<li><a href=\"/docs/third-party-services/comments.html#Overview\">Overview</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#Disqus\">Disqus</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#DisqusJS\">DisqusJS</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#Changyan\">Changyan (China)</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#LiveRe\">LiveRe</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#Gitalk\">Gitalk</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#Utterances\">Utterances</a></li>\n<li><a href=\"/docs/third-party-services/comments.html#Isso\">Isso</a></li>\n</ul>\n<h3 id=\"Statistics-and-Analytics\"><a href=\"#Statistics-and-Analytics\" class=\"headerlink\" title=\"Statistics and Analytics\"></a>Statistics and Analytics</h3><h4 id=\"Analytics\"><a href=\"#Analytics\" class=\"headerlink\" title=\"Analytics\"></a>Analytics</h4><ul>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#Google-Analytics\">Google Analytics</a></li>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#Baidu-Analytics-China\">Baidu Analytics (China)</a></li>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#Growingio-Analytics\">Growingio Analytics</a></li>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#CNZZ-Analytics-China\">CNZZ Analytics (China)</a></li>\n</ul>\n<h4 id=\"Statistics\"><a href=\"#Statistics\" class=\"headerlink\" title=\"Statistics\"></a>Statistics</h4><ul>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#LeanCloud-China\">LeanCloud (China)</a></li>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#Firebase\">Firebase</a></li>\n<li><a href=\"/docs/third-party-services/statistics-and-analytics.html#Busuanzi-Counting-China\">Busuanzi Counting</a></li>\n</ul>\n<h3 id=\"Post-Widgets\"><a href=\"#Post-Widgets\" class=\"headerlink\" title=\"Post Widgets\"></a>Post Widgets</h3><ul>\n<li><a href=\"/docs/third-party-services/post-widgets.html#Widgetpack-Rating\">Widgetpack Rating</a></li>\n<li><a href=\"/docs/third-party-services/post-widgets.html#AddThis\">AddThis</a></li>\n</ul>\n<h3 id=\"Search-Services\"><a href=\"#Search-Services\" class=\"headerlink\" title=\"Search Services\"></a>Search Services</h3><ul>\n<li><a href=\"/docs/third-party-services/search-services.html#Algolia-Search\">Algolia Search</a></li>\n<li><a href=\"/docs/third-party-services/search-services.html#Local-Search\">Local Search</a></li>\n<li><a href=\"/docs/third-party-services/search-services.html#Swiftype-Search\">Swiftype</a></li>\n</ul>\n<h3 id=\"Chat-Services\"><a href=\"#Chat-Services\" class=\"headerlink\" title=\"Chat Services\"></a>Chat Services</h3><ul>\n<li><a href=\"/docs/third-party-services/chat-services.html#Chatra\">Chatra</a></li>\n<li><a href=\"/docs/third-party-services/chat-services.html#Tidio\">Tidio</a></li>\n</ul>\n<h3 id=\"External-Libraries\"><a href=\"#External-Libraries\" class=\"headerlink\" title=\"External Libraries\"></a>External Libraries</h3><ul>\n<li><a href=\"/docs/third-party-services/external-libraries.html#PJAX\">PJAX</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Fancybox\">Fancybox</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Medium-Zoom\">MediumZoom</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Lazyload\">Lazyload</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Pangu-Autospace\">Pangu Autospace</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Quicklink\">Quicklink</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Animation-Effect\">Motion</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Progress-Bar\">Progress bar</a></li>\n<li><a href=\"/docs/third-party-services/external-libraries.html#Canvas-Ribbon\">Canvas Ribbon</a></li>\n</ul>\n"},{"title":"Math Equations","url":"/docs/third-party-services/math-equations.html","content":"<h3 id=\"Settings\"><a href=\"#Settings\" class=\"headerlink\" title=\"Settings\"></a>Settings</h3><figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Math Formulas Render Support</span></span><br><span class=\"line\"><span class=\"attr\">math:</span></span><br><span class=\"line\">  <span class=\"comment\"># Default (false) will load mathjax / katex script on demand.</span></span><br><span class=\"line\">  <span class=\"comment\"># That is it only render those page which has `mathjax: true` in front-matter.</span></span><br><span class=\"line\">  <span class=\"comment\"># If you set it to true, it will load mathjax / katex srcipt EVERY PAGE.</span></span><br><span class=\"line\">  <span class=\"attr\">every_page:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">mathjax:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># Available values: none | ams | all</span></span><br><span class=\"line\">    <span class=\"attr\">tags:</span> <span class=\"string\">none</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">katex:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\"># See: https://github.com/KaTeX/KaTeX/tree/master/contrib/copy-tex</span></span><br><span class=\"line\">    <span class=\"attr\">copy_tex:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>The <code>every_page</code> option controls whether to render Math Equations every page.</p>\n<ul>\n<li><strong><code>false</code></strong> → Equations will be processed on demand. It will only render those posts which have <code>mathjax: true</code> in their front-matter.</li>\n<li><code>true</code> → Equations will be processed on every page. Even if they not exists on one or another page.</li>\n</ul>\n<details class=\"note default\"><summary><p><strong>Examples with <code>every_page: false</code> option</strong></p>\n</summary>\n<ul>\n<li><p>This post will render the Math Equations</p>\n  <figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Will Render Math</span><br><span class=\"line\"><span class=\"section\">mathjax: true</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>This post will NOT render the Math Equations</p>\n  <figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Not Render Math</span><br><span class=\"line\"><span class=\"section\">mathjax: false</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>This post will NOT render the Math Equations either</p>\n  <figure class=\"highlight md\"><table><tr><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\"><span class=\"section\">title: Not Render Math Either</span></span><br><span class=\"line\"><span class=\"section\">---</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n\n</details>\n\n<p>The <code>mathjax</code> and <code>katex</code> options are used to set the rendering engine. Please read the detailed document below.</p>\n<h3 id=\"Render-Engines\"><a href=\"#Render-Engines\" class=\"headerlink\" title=\"Render Engines\"></a>Render Engines</h3><p>For now, NexT provides two render engines for displaying Math Equations: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWF0aGpheC5vcmcv\">MathJax<i class=\"fa fa-external-link-alt\"></i></span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXRleC5vcmcv\">KaTeX<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<p>MathJax is a JavaScript display engine for mathematics that works in all browsers. It is highly modular on input and output. Use MathML, TeX, and ASCIImath as input and produce HTML+CSS, SVG, or MathML as output.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW50bWF0aC5jb20vY2c1L2thdGV4LW1hdGhqYXgtY29tcGFyaXNvbi5waHA=\">KaTeX is a faster<i class=\"fa fa-external-link-alt\"></i></span> math render engine compared to MathJax 3. And it could survive without JavaScript. But, for now <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0thVGVYL0thVGVYL3dpa2kvVGhpbmdzLXRoYXQtS2FUZVgtZG9lcy1ub3QtKHlldCktc3VwcG9ydA==\">KaTeX supports less features<i class=\"fa fa-external-link-alt\"></i></span> than MathJax. Here is a list of <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXRleC5vcmcvZG9jcy9zdXBwb3J0ZWQuaHRtbA==\">TeX functions supported by KaTeX<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<p>To use this feature, firstly you need to choose a render engine and turn on <code>enable</code> for it (located in <mark class=\"label primary\">theme config file</mark>). Then you need to install the <strong>corresponding Hexo Renderer</strong> to fully support the display of Math Equations - Only turn on <code>enable</code> <strong>may not let you see the displayed equations correctly</strong>.</p>\n<div class=\"tabs\" id=\"render-engines\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#render-engines-1\">MathJax</a></li><li class=\"tab\"><a href=\"#render-engines-2\">KaTeX</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"render-engines-1\"><p><strong>Renderer Choosing</strong></p>\n<p>If you use MathJax to render Math Equations, you can choose one of the Markdown renderers below:</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3d6cGFuL2hleG8tcmVuZGVyZXItcGFuZG9j\">hexo-renderer-pandoc<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<p>hexo-renderer-pandoc is recommended because it can handle mathematical formulas in markdown documents perfectly.</p>\n<div class=\"note warning\"><p>If you are using other renderers, such as <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLXJlbmRlcmVyLW1hcmtlZA==\">hexo-renderer-marked<i class=\"fa fa-external-link-alt\"></i></span>, you need to be aware of the conflict between LaTeX and Markdown syntax. For example, an underscore (<code>_</code>) may be interpreted as the start of italic text in Markdown, or subscripted mark in TeX. To avoid syntax errors, please use escape characters (<code>\\_</code>) instead:</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-$\\epsilon_0$</span></span><br><span class=\"line\"><span class=\"addition\">+$\\epsilon\\_0$</span></span><br><span class=\"line\"><span class=\"deletion\">-\\begin&#123;eqnarray*&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+\\begin&#123;eqnarray\\*&#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-\\\\</span></span><br><span class=\"line\"><span class=\"addition\">+\\\\\\\\</span></span><br></pre></td></tr></table></figure></div>\n\n<p><strong>Installation</strong></p>\n<ol>\n<li><p>Firstly, set <code>mathjax</code> as render engine in <mark class=\"label primary\">theme config file</mark>.</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">math:</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">mathjax:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then you need to uninstall the original renderer <code>hexo-renderer-marked</code>, and install <code>hexo-renderer-pandoc</code>:</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm un hexo-renderer-marked</span><br><span class=\"line\">$ npm i hexo-renderer-pandoc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pnbS9wYW5kb2M=\">pandoc<i class=\"fa fa-external-link-alt\"></i></span> is required for hexo-renderer-pandoc, here&#39;s <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pnbS9wYW5kb2MvYmxvYi9tYXN0ZXIvSU5TVEFMTC5tZA==\">how to install pandoc<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</li>\n</ol>\n<p><strong>Plugins</strong></p>\n<p>All extensions of MathJax are loaded automatically. For example, <code>mhchem</code> is a tool for writing beautiful chemical equations easily. It implements the <code>\\ce</code> and <code>\\pu</code> chemical equation macros of the LaTeX mhchem package. More infomation: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9taGNoZW0uZ2l0aHViLmlvL01hdGhKYXgtbWhjaGVtLw==\">MathJax&#x2F;mhchem Manual<i class=\"fa fa-external-link-alt\"></i></span>.</p></div><div class=\"tab-pane\" id=\"render-engines-2\"><p><strong>Renderer Choosing</strong></p>\n<p>If you use KaTeX to render Math Equations, you can choose one of the Markdown renderers below:</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NIRU5YQ0hFTi9oZXhvLXJlbmRlcmVyLW1hcmtkb3duLWl0LXBsdXM=\">hexo-renderer-markdown-it-plus<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvLXJlbmRlcmVyLW1hcmtkb3duLWl0\">hexo-renderer-markdown-it<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<p><strong>Installation</strong></p>\n<ol>\n<li><p>Firstly, set <code>katex</code> as render engine in <mark class=\"label primary\">theme config file</mark>.</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">math:</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">katex:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Then you need to uninstall the original renderer <code>hexo-renderer-marked</code> and install one of the renderer plugins:</p>\n</li>\n</ol>\n<div class=\"tabs\" id=\"katex-renderer\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#katex-renderer-1\">hexo-renderer-markdown-it-plus</a></li><li class=\"tab\"><a href=\"#katex-renderer-2\">hexo-renderer-markdown-it</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"katex-renderer-1\"><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm un hexo-renderer-marked</span><br><span class=\"line\">$ npm i hexo-renderer-markdown-it-plus</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"katex-renderer-2\"><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm un hexo-renderer-marked</span><br><span class=\"line\">$ npm i hexo-renderer-markdown-it</span><br></pre></td></tr></table></figure>\n\n<p>If you use <code>hexo-renderer-markdown-it</code>, you also need to install <code>markdown-it-katex</code>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm i markdown-it-katex</span><br></pre></td></tr></table></figure>\n\n<p>And then in <mark class=\"label info\">site config file</mark> you need to add <code>markdown-it-katex</code> as a plugin for <code>hexo-renderer-markdown-it</code>:</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># config of hexo-renderer-markdown-it</span></span><br><span class=\"line\"><span class=\"attr\">markdown:</span></span><br><span class=\"line\">  <span class=\"attr\">render:</span></span><br><span class=\"line\">    <span class=\"attr\">html:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">xhtmlOut:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">breaks:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">linkify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">typographer:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">quotes:</span> <span class=\"string\">&#x27;“”‘’&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">plugins:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">markdown-it-katex</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<p><strong>Plugins</strong></p>\n<p>Copy-tex extension for KaTeX modifes the copy&#x2F;paste behavior in any browser supporting the Clipboard API so that, when selecting and copying whole KaTeX-rendered elements, the text content of the resulting clipboard renders KaTeX elements as their LaTeX source surrounded by specified delimiters. More infomation: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0thVGVYL0thVGVYL3RyZWUvbWFzdGVyL2NvbnRyaWIvY29weS10ZXg=\">Copy-tex extension<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">math:</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">katex:</span></span><br><span class=\"line\">    <span class=\"comment\"># See: https://github.com/KaTeX/KaTeX/tree/master/contrib/copy-tex</span></span><br><span class=\"line\">    <span class=\"attr\">copy_tex:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"note danger\"><p><strong>Known Issues</strong></p>\n<ol>\n<li>Firstly, please check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXRleC5vcmcvZG9jcy9pc3N1ZXMuaHRtbA==\">Common Issues<i class=\"fa fa-external-link-alt\"></i></span> of KaTeX.</li>\n<li>Displayed Math (i.e. <code>$$...$$</code>) needs to started with new clear line.<br> In other words: you must not have any characters (except of whitespaces) <strong>before the opening <code>$$</code> and after the ending <code>$$</code></strong> (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMzIjaXNzdWVjb21tZW50LTM1NzQ4OTUwOQ==\">comment #32<i class=\"fa fa-external-link-alt\"></i></span>).</li>\n<li>Don&#39;t support Unicode (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMzIjaXNzdWVjb21tZW50LTM1NzQ4OTUwOQ==\">comment #32<i class=\"fa fa-external-link-alt\"></i></span>).</li>\n<li>Inline Math (..<code>$...$</code>) must not have white spaces <strong>after the opening <code>$</code> and before the ending <code>$</code></strong> (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMzIjaXNzdWVjb21tZW50LTM1NzQ4OTUwOQ==\">comment #32<i class=\"fa fa-external-link-alt\"></i></span>).</li>\n<li>If you use math in Heading (i.e. <code>## Heading</code>).<br> Then in corresponding TOC item it will show the related LaTeX code 3 times (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMzIjaXNzdWVjb21tZW50LTM1OTAxODY5NA==\">comment #32<i class=\"fa fa-external-link-alt\"></i></span>).</li>\n<li>If you use math in your post&#39;s title, it will not be rendered (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMzIjaXNzdWVjb21tZW50LTM1OTE0Mjg3OQ==\">comment #32<i class=\"fa fa-external-link-alt\"></i></span>).</li>\n</ol>\n</div></div></div></div>\n\n<div class=\"note warning\"><p>After setting up the math rendering engine or installing &#x2F; uninstalling the Markdown renderer, please execute <code>hexo clean</code>. Run standard Hexo generate, deploy process or start the server to test whether the plugin is working properly:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo clean &amp;&amp; hexo g -d</span><br><span class=\"line\"><span class=\"comment\"># or hexo clean &amp;&amp; hexo s</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"note warning\"><p>Except for the required renderer, any other Hexo math plugins are unnecessary and there is no need to manually import any JS or CSS files. If you have installed plugins such as <code>hexo-math</code> or <code>hexo-katex</code>, they may conflict with the built-in render engine of NexT.</p>\n</div>\n\n<h3 id=\"Examples\"><a href=\"#Examples\" class=\"headerlink\" title=\"Examples\"></a>Examples</h3><div class=\"note info\"><p>The following examples are rendered by <code>mathjax</code> engine.</p>\n</div>\n\n<h4 id=\"Numbering-and-referring-equations-in-MathJax\"><a href=\"#Numbering-and-referring-equations-in-MathJax\" class=\"headerlink\" title=\"Numbering and referring equations in MathJax\"></a>Numbering and referring equations in MathJax</h4><p>In NexT v6.3.0, we have added feature to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1hdGhqYXgub3JnL2VuL2xhdGVzdC9pbnB1dC90ZXgvZXFudW1iZXJzLmh0bWw=\">automatic equation numbering<i class=\"fa fa-external-link-alt\"></i></span> with opportunity to make reference to that equations. We briefly describe how to use this feature below.</p>\n<p>In general, to make the automatic equation numbering work, you have to wrap your LaTeX equations in <code>equation</code> environment. Using the plain old style (i.e., wrap an equation with two dollar signs in each side) will not work. How to refer to an equation? Just give a <code>\\label&#123;&#125;</code> tag and then in your later text, use <code>\\ref&#123;&#125;</code> or <code>\\eqref&#123;&#125;</code> to refer it. Using <code>\\eqref&#123;&#125;</code> is preferred since if you use <code>\\ref&#123;&#125;</code>, there are no parentheses around the equation number. Below are some of the common scenarios for equation numbering.</p>\n<h4 id=\"Simple-Equation\"><a href=\"#Simple-Equation\" class=\"headerlink\" title=\"Simple Equation\"></a>Simple Equation</h4><p>For simple equations, use the following form to give a tag,</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span><span class=\"keyword\">\\begin</span>&#123;equation&#125; <span class=\"keyword\">\\label</span>&#123;eq1&#125;</span><br><span class=\"line\">e=mc<span class=\"built_in\">^</span>2</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;equation&#125;<span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n\n<p>$$\\begin{equation} \\label{eq1}<br>e&#x3D;mc^2<br>\\end{equation}$$</p>\n<p>Then, you can refer to this equation in your text easily by using something like:</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\">The famous matter-energy equation <span class=\"built_in\">$</span><span class=\"keyword\">\\eqref</span>&#123;eq1&#125;<span class=\"built_in\">$</span> proposed by Einstein...</span><br></pre></td></tr></table></figure>\n\n<p>The famous matter-energy equation $\\eqref{eq1}$ proposed by Einstein...</p>\n<h4 id=\"Multi-line-Equation\"><a href=\"#Multi-line-Equation\" class=\"headerlink\" title=\"Multi-line Equation\"></a>Multi-line Equation</h4><p>For multi-line equations, inside the <code>equation</code> environment, you can use the <code>aligned</code> environment to split it into multiple lines:</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span><span class=\"keyword\">\\begin</span>&#123;equation&#125; <span class=\"keyword\">\\label</span>&#123;eq2&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\begin</span>&#123;aligned&#125;</span><br><span class=\"line\">a <span class=\"built_in\">&amp;</span>= b + c <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"built_in\">&amp;</span>= d + e + f + g <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">  <span class=\"built_in\">&amp;</span>= h + i</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;aligned&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;equation&#125;<span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n\n<p>$$\\begin{equation} \\label{eq2}<br>\\begin{aligned}<br>a &amp;&#x3D; b + c \\\\<br>  &amp;&#x3D; d + e + f + g \\\\<br>  &amp;&#x3D; h + i<br>\\end{aligned}<br>\\end{equation}$$</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\">Equation <span class=\"built_in\">$</span><span class=\"keyword\">\\eqref</span>&#123;eq2&#125;<span class=\"built_in\">$</span> is a multi-line equation.</span><br></pre></td></tr></table></figure>\n\n<p>Equation $\\eqref{eq2}$ is a multi-line equation.</p>\n<h4 id=\"Multiple-Aligned-Equations\"><a href=\"#Multiple-Aligned-Equations\" class=\"headerlink\" title=\"Multiple Aligned Equations\"></a>Multiple Aligned Equations</h4><p>We can use <code>align</code> environment to align multiple equations. Each of these equations will get its own numbers.</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span><span class=\"keyword\">\\begin</span>&#123;align&#125;</span><br><span class=\"line\">a <span class=\"built_in\">&amp;</span>= b + c <span class=\"keyword\">\\label</span>&#123;eq3&#125; <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">x <span class=\"built_in\">&amp;</span>= yz <span class=\"keyword\">\\label</span>&#123;eq4&#125; <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">l <span class=\"built_in\">&amp;</span>= m - n <span class=\"keyword\">\\label</span>&#123;eq5&#125;</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;align&#125;<span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n\n<p>$$\\begin{align}<br>a &amp;&#x3D; b + c \\label{eq3} \\\\<br>x &amp;&#x3D; yz \\label{eq4} \\\\<br>l &amp;&#x3D; m - n \\label{eq5}<br>\\end{align}$$</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\">There are three aligned equations: equation <span class=\"built_in\">$</span><span class=\"keyword\">\\eqref</span>&#123;eq3&#125;<span class=\"built_in\">$</span>, equation <span class=\"built_in\">$</span><span class=\"keyword\">\\eqref</span>&#123;eq4&#125;<span class=\"built_in\">$</span> and equation <span class=\"built_in\">$</span><span class=\"keyword\">\\eqref</span>&#123;eq5&#125;<span class=\"built_in\">$</span>.</span><br></pre></td></tr></table></figure>\n\n<p>There are three aligned equations: equation $\\eqref{eq3}$, equation $\\eqref{eq4}$ and equation $\\eqref{eq5}$.</p>\n<p>Since <code>align</code> in and of itself is a complete equation environment (read <span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZXguc3RhY2tleGNoYW5nZS5jb20vcXVlc3Rpb25zLzk1NDAyL3doYXQtaXMtdGhlLWRpZmZlcmVuY2UtYmV0d2Vlbi1hbGlnbmVkLWluLWRpc3BsYXllZC1tb2RlLWFuZC1zdGFycmVkLWFsaWdu\">here<i class=\"fa fa-external-link-alt\"></i></span> about the difference between <code>aligned</code> and <code>align</code> in LaTeX). You do not need to wrap it with <code>equation</code> environment.</p>\n<h4 id=\"Exclude-equations-from-numbering\"><a href=\"#Exclude-equations-from-numbering\" class=\"headerlink\" title=\"Exclude equations from numbering\"></a>Exclude equations from numbering</h4><p>In the <code>align</code> environment, if you do not want to number one or some equations, just use <code>\\nonumber</code> right behind these equations. Like the following:</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span><span class=\"keyword\">\\begin</span>&#123;align&#125;</span><br><span class=\"line\">-4 + 5x <span class=\"built_in\">&amp;</span>= 2 + y <span class=\"keyword\">\\nonumber</span> <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">w + 2 <span class=\"built_in\">&amp;</span>= -1 + w <span class=\"keyword\">\\\\</span></span><br><span class=\"line\">ab <span class=\"built_in\">&amp;</span>= cb</span><br><span class=\"line\"><span class=\"keyword\">\\end</span>&#123;align&#125;<span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n\n<p>$$\\begin{align}<br>-4 + 5x &amp;&#x3D; 2 + y \\nonumber \\\\<br>w + 2 &amp;&#x3D; -1 + w \\\\<br>ab &amp;&#x3D; cb<br>\\end{align}$$</p>\n<h4 id=\"Use-tag-to-tag-equations\"><a href=\"#Use-tag-to-tag-equations\" class=\"headerlink\" title=\"Use \\tag to tag equations\"></a>Use <code>\\tag</code> to tag equations</h4><p>Sometimes, you want to use more «exotic» style to refer your equation. You can use <code>\\tag&#123;&#125;</code> to achieve this. For example:</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">$</span><span class=\"built_in\">$</span>x+1<span class=\"keyword\">\\over</span><span class=\"keyword\">\\sqrt</span>&#123;1-x<span class=\"built_in\">^</span>2&#125; <span class=\"keyword\">\\tag</span>&#123;i&#125;<span class=\"keyword\">\\label</span>&#123;eq<span class=\"built_in\">_</span>tag&#125;<span class=\"built_in\">$</span><span class=\"built_in\">$</span></span><br></pre></td></tr></table></figure>\n\n<p>$$x+1\\over\\sqrt{1-x^2} \\tag{i}\\label{eq_tag}$$</p>\n<figure class=\"highlight latex\"><table><tr><td class=\"code\"><pre><span class=\"line\">Equation <span class=\"built_in\">$</span><span class=\"keyword\">\\eqref</span>&#123;eq<span class=\"built_in\">_</span>tag&#125;<span class=\"built_in\">$</span> use `<span class=\"keyword\">\\tag</span>&#123;&#125;` instead of automatic numbering.</span><br></pre></td></tr></table></figure>\n\n<p>Equation $\\eqref{eq_tag}$ use <code>\\tag&#123;&#125;</code> instead of automatic numbering.</p>\n"},{"title":"Post Widgets","url":"/docs/third-party-services/post-widgets.html","content":"<h3 id=\"Widgetpack-Rating\"><a href=\"#Widgetpack-Rating\" class=\"headerlink\" title=\"Widgetpack Rating\"></a>Widgetpack Rating</h3><p>Rating service with login through any social networks like Facebook, Twitter, Google+, LinkedIn, Instagram and others.</p>\n<div class=\"tabs\" id=\"rating\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#rating-1\">Get ID →</a></li><li class=\"tab\"><a href=\"#rating-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"rating-1\"><p>Login to <span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWRnZXRwYWNrLmNvbS9hZG1pbiNzaWduaW4=\">widgetpack<i class=\"fa fa-external-link-alt\"></i></span> and add new site, you will get your site ID:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">wpac_init.push(&#123;widget: &#x27;Rating&#x27;, id: ID&#125;);</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"rating-2\"><p>You can enable it by setting value <code>rating.enable</code> to <code>true</code>, and copy <code>ID</code> value of <code>id</code> in <mark class=\"label primary\">theme config file</mark>. You can also configure the rating color by editing values in <code>rating.color</code> section.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rating:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">id:</span>     <span class=\"string\">ID</span> <span class=\"comment\">#&lt;app_id&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">color:</span>  <span class=\"string\">&quot;#fc6423&quot;</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"AddThis\"><a href=\"#AddThis\" class=\"headerlink\" title=\"AddThis\"></a>AddThis</h3><div class=\"tabs\" id=\"addthis\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#addthis-1\">Sign Up →</a></li><li class=\"tab\"><a href=\"#addthis-2\">AddThis ID →</a></li><li class=\"tab\"><a href=\"#addthis-3\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"addthis-1\"><p>Sign up in <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYWRkdGhpcy5jb20v\">AddThis<i class=\"fa fa-external-link-alt\"></i></span>. You can use Google &#x2F; Facebook &#x2F; Twitter to login.</p></div><div class=\"tab-pane\" id=\"addthis-2\"><p>Get AddThis ID in this menu: <code>Profile Settings</code> → <code>General</code> → <code>ID</code>. See example on the picture below:<br><img src=\"/images/add-this-id.png\" alt=\"AddThis ID\" loading=\"lazy\"></p></div><div class=\"tab-pane\" id=\"addthis-3\"><p>Edit the configurations in <code>add_this_id</code> section in the <mark class=\"label primary\">theme config file</mark> as following:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">add_this_id:</span> <span class=\"string\">your_add_this_id</span></span><br></pre></td></tr></table></figure></div></div></div>\n"},{"title":"Search Services","url":"/docs/third-party-services/search-services.html","content":"<h3 id=\"Algolia-Search\"><a href=\"#Algolia-Search\" class=\"headerlink\" title=\"Algolia Search\"></a>Algolia Search</h3><p>NexT provides Algolia search plugin to search your Hexo website content. It should be noted that only turn on <code>enable</code> of <code>algolia_search</code> in <mark class=\"label primary\">theme config file</mark> does not allow you to use the Algolia search correctly. You need to install the corresponding Hexo plugin to index your website on Algolia: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29uY2xldG9tL2hleG8tYWxnb2xpYQ==\">Hexo Algolia<i class=\"fa fa-external-link-alt\"></i></span> or <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0xvdWlzQmFycmFucXVlaXJvL2hleG8tYWxnb2xpYXNlYXJjaA==\">Hexo Algoliasearch<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<div class=\"note danger\"><p><strong>Known Issues</strong></p>\n<ol>\n<li>The latest version of the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29uY2xldG9tL2hleG8tYWxnb2xpYQ==\">Hexo Algolia<i class=\"fa fa-external-link-alt\"></i></span> plugin removes the content indexing feature, given Algolia&#39;s free account limitation.</li>\n<li>The <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0xvdWlzQmFycmFucXVlaXJvL2hleG8tYWxnb2xpYXNlYXJjaA==\">Hexo Algoliasearch<i class=\"fa fa-external-link-alt\"></i></span> plugin provides content indexing functionality. The same problem exists with <code>Record Too Big</code> for Algolia&#39;s free account.</li>\n</ol>\n</div>\n\n<p>Follow the steps described below to complete the installation of Algolia search.</p>\n<div class=\"tabs\" id=\"algolia-search\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#algolia-search-1\">Registration →</a></li><li class=\"tab\"><a href=\"#algolia-search-2\">Algolia Config →</a></li><li class=\"tab\"><a href=\"#algolia-search-3\">Algolia Plugin →</a></li><li class=\"tab\"><a href=\"#algolia-search-4\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"algolia-search-1\"><p>Register at <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYWxnb2xpYS5jb20v\">Algolia<i class=\"fa fa-external-link-alt\"></i></span>, you can log in directly using GitHub or Google Account. Upon Customer&#39;s initial sign-up for an Account, Customer will have a free, fourteen (14) day evaluation period (the «Evaluation Period») for the Algolia Services commencing on the Effective Date, subject to the limitations on Algolia&#39;s website. After that, Algolia offers a free, branded version for up to 10k records and 100k operations per month.</p>\n<p>If a tutorial pops up, you can skip it. Go straight to create an <code>Index</code> which will be used later.<br><img src=\"/images/algolia-1.png\" alt=\"Algolia Create Index\" loading=\"lazy\"></p></div><div class=\"tab-pane\" id=\"algolia-search-2\"><ol>\n<li><p>Go to the <code>API Keys</code> page and find your credentials. You will need the <code>Application ID</code> and the <code>Search-only API key</code> in the following sections. The <code>Admin API key</code> need to keep confidential. Never store your Admin API Key as <code>apiKey</code> in <mark class=\"label info\">site config file</mark>: it would give full control of your Algolia index to others and you don&#39;t want to face the consequences.<br><img src=\"/images/algolia-2.png\" alt=\"Algolia API Keys\" loading=\"lazy\"></p>\n</li>\n<li><p>In the <code>API Keys</code> page, click the <code>All API Keys</code> button to switch to the corresponding tab. Then click the <code>New API Key</code> button to activate a pop-up box where you can setup authorizations and restrictions with a great level of precision. Enter <code>addObject</code>, <code>deleteObject</code>, <code>listIndexes</code>, <code>deleteIndex</code> features in ACL permissions that will be allowed for the given API key. And then click the <code>Create</code> button. Copy this newly created key to the clipboard, we call it a <code>High-privilege API key</code>.<br><img src=\"/images/algolia-3.png\" alt=\"Algolia API Keys 2\" loading=\"lazy\"><br><img src=\"/images/algolia-4.png\" alt=\"Algolia Configuring Records\" loading=\"lazy\"></p>\n</li>\n</ol></div><div class=\"tab-pane\" id=\"algolia-search-3\"><p>Algolia requires users to upload their search index data either manually or via provided APIs. You need to choose one of the following two plugins to install. Both plugins will index your site and upload selected data to Algolia.</p>\n<div class=\"tabs\" id=\"algolia-plugin\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#algolia-plugin-1\">Hexo Algolia</a></li><li class=\"tab\"><a href=\"#algolia-plugin-2\">Hexo Algoliasearch</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"algolia-plugin-1\"><p>Install and configure <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29uY2xldG9tL2hleG8tYWxnb2xpYQ==\">Hexo Algolia<i class=\"fa fa-external-link-alt\"></i></span> in your Hexo directory.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-algolia</span><br></pre></td></tr></table></figure>\n\n<p>In your <mark class=\"label info\">site config file</mark>, add the following configuration and replace the <code>Application ID</code>, <code>Search-only API key</code> and <code>indexName</code> with corresponding fields obtained at Algolia.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">algolia:</span></span><br><span class=\"line\">  <span class=\"attr\">applicationID:</span> <span class=\"string\">&quot;Application ID&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">apiKey:</span> <span class=\"string\">&quot;Search-only API key&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">indexName:</span> <span class=\"string\">&quot;indexName&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>Run the following command to upload index data, keep a weather eye out the output of the command.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">export</span> HEXO_ALGOLIA_INDEXING_KEY=High-privilege API key <span class=\"comment\"># Use Git Bash</span></span><br><span class=\"line\"><span class=\"comment\"># set HEXO_ALGOLIA_INDEXING_KEY=High-privilege API key # Use Windows command line</span></span><br><span class=\"line\">$ hexo clean</span><br><span class=\"line\">$ hexo algolia</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/algolia-5.png\" alt=\"Reload Index\" loading=\"lazy\"></p></div><div class=\"tab-pane\" id=\"algolia-plugin-2\"><p>Install and configure <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0xvdWlzQmFycmFucXVlaXJvL2hleG8tYWxnb2xpYXNlYXJjaA==\">Hexo Algoliasearch<i class=\"fa fa-external-link-alt\"></i></span> in your Hexo directory.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> hexo-site</span><br><span class=\"line\">$ npm install hexo-algoliasearch</span><br></pre></td></tr></table></figure>\n\n<p>In your <mark class=\"label info\">site config file</mark>, add the following configuration and replace the <code>Application ID</code>, <code>Search-only API key</code>, <code>High-privilege API key</code> and <code>indexName</code> with corresponding fields obtained at Algolia.</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">algolia:</span></span><br><span class=\"line\">  <span class=\"attr\">appId:</span> <span class=\"string\">&quot;Application ID&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">apiKey:</span> <span class=\"string\">&quot;Search-only API key&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">adminApiKey:</span> <span class=\"string\">&quot;High-privilege API key&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">indexName:</span> <span class=\"string\">&quot;indexName&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">chunkSize:</span> <span class=\"number\">5000</span></span><br><span class=\"line\">  <span class=\"attr\">fields:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">content:strip:truncate,0,500</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">excerpt:strip</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">gallery</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">permalink</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">photos</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">slug</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">tags</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">title</span></span><br></pre></td></tr></table></figure>\n\n<p>Run the following command to upload index data, keep a weather eye out the output of the command.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo clean</span><br><span class=\"line\">$ hexo algolia</span><br></pre></td></tr></table></figure></div></div></div></div><div class=\"tab-pane\" id=\"algolia-search-4\"><p>In <mark class=\"label primary\">theme config file</mark>, turn on <code>enable</code> of <code>algolia_search</code>. At the same time, you need to <strong>turn off other search plugins</strong> like Local Search. You can also adjust the text in <code>labels</code> according to your needs.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Algolia Search</span></span><br><span class=\"line\"><span class=\"attr\">algolia_search:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">hits:</span></span><br><span class=\"line\">    <span class=\"attr\">per_page:</span> <span class=\"number\">10</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h3 id=\"Local-Search\"><a href=\"#Local-Search\" class=\"headerlink\" title=\"Local Search\"></a>Local Search</h3><p>Local search does not require any external 3rd-party services and can be extra indexed by search engines. This search method is recommended for most users.</p>\n<div class=\"tabs\" id=\"local-search\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#local-search-1\">Installation →</a></li><li class=\"tab\"><a href=\"#local-search-2\">Hexo Config →</a></li><li class=\"tab\"><a href=\"#local-search-3\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"local-search-1\"><p>Install <code>hexo-generator-searchdb</code> by executing the following command in <mark class=\"label info\">site root dir</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-generator-searchdb</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"local-search-2\"><p>Edit <mark class=\"label info\">site config file</mark> and add following content:</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">search:</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">search.xml</span></span><br><span class=\"line\">  <span class=\"attr\">field:</span> <span class=\"string\">post</span></span><br><span class=\"line\">  <span class=\"attr\">content:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">format:</span> <span class=\"string\">html</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"local-search-3\"><p>Edit <mark class=\"label primary\">theme config file</mark> to enable Local Search:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Local search</span></span><br><span class=\"line\"><span class=\"comment\"># Dependencies: https://github.com/next-theme/hexo-generator-searchdb</span></span><br><span class=\"line\"><span class=\"attr\">local_search:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># If auto, trigger search by changing input.</span></span><br><span class=\"line\">  <span class=\"comment\"># If manual, trigger search by pressing enter key or search button.</span></span><br><span class=\"line\">  <span class=\"attr\">trigger:</span> <span class=\"string\">auto</span></span><br><span class=\"line\">  <span class=\"comment\"># Show top n results per article, show all results by setting to -1</span></span><br><span class=\"line\">  <span class=\"attr\">top_n_per_article:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"comment\"># Unescape html strings to the readable one.</span></span><br><span class=\"line\">  <span class=\"attr\">unescape:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Preload the search data when the page loads.</span></span><br><span class=\"line\">  <span class=\"attr\">preload:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure></div></div></div>\n"},{"title":"Statistics and Analytics","url":"/docs/third-party-services/statistics-and-analytics.html","content":"<div class=\"note warning\"><p>NexT will not send record to analytics service provider as long as the page&#39;s host name does not match <code>url</code> option set in <mark class=\"label info\">site config file</mark>. This will prevent local debugging from polluting analytics. Make sure you have configured <code>url</code> correctly, otherwise these statistics tools may not work as expected.</p>\n</div>\n\n<h3 id=\"Analytics-Tools\"><a href=\"#Analytics-Tools\" class=\"headerlink\" title=\"Analytics Tools\"></a>Analytics Tools</h3><h4 id=\"Google-Analytics\"><a href=\"#Google-Analytics\" class=\"headerlink\" title=\"Google Analytics\"></a>Google Analytics</h4><ol>\n<li><p>Create an account and log into <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbmFseXRpY3MuZ29vZ2xlLmNvbS8=\">Google Analytics<i class=\"fa fa-external-link-alt\"></i></span>. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmdvb2dsZS5jb20vYW5hbHl0aWNzLz9obD1lbiN0b3BpYz0zNTQ0OTA2\">More detailed documentation<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li><p>Edit <mark class=\"label primary\">theme config file</mark> and fill <code>tracking_id</code> under section <code>google_analytics</code> with your Google track ID. Google track ID always starts with <code>UA-</code>.</p>\n <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Google Analytics</span></span><br><span class=\"line\"><span class=\"attr\">google_analytics:</span></span><br><span class=\"line\">  <span class=\"attr\">tracking_id:</span> <span class=\"string\">UA-XXXXXXXX-X</span></span><br><span class=\"line\">  <span class=\"attr\">only_pageview:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>When field <code>only_pageview</code> is set to true, NexT will only send <code>pageview</code> event to Google Analytics.<br>The benefit of using this instead of <code>only_pageview: false</code> is reduce a external script on your site, which will give you better performance but no complete analytics function.</p>\n</li>\n</ol>\n<h4 id=\"Baidu-Analytics-China\"><a href=\"#Baidu-Analytics-China\" class=\"headerlink\" title=\"Baidu Analytics (China)\"></a>Baidu Analytics (China)</h4><div class=\"tabs\" id=\"baidu-analytics\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#baidu-analytics-1\">Login →</a></li><li class=\"tab\"><a href=\"#baidu-analytics-2\">Script ID →</a></li><li class=\"tab\"><a href=\"#baidu-analytics-3\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"baidu-analytics-1\"><p>Login to <span class=\"exturl\" data-url=\"aHR0cHM6Ly90b25namkuYmFpZHUuY29tLw==\">Baidu Analytics<i class=\"fa fa-external-link-alt\"></i></span> and locate to site code getting page.</p></div><div class=\"tab-pane\" id=\"baidu-analytics-2\"><p>Copy the script ID after <code>hm.js?</code>, like the following picture:<br><img src=\"/images/analytics-baidu-id.png\" alt=\"NexT Baidu Analytics\" loading=\"lazy\"></p></div><div class=\"tab-pane\" id=\"baidu-analytics-3\"><p>Edit <mark class=\"label primary\">theme config file</mark> and change section <code>baidu_analytics</code> to your script ID.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Baidu Analytics ID</span></span><br><span class=\"line\"><span class=\"attr\">baidu_analytics:</span> <span class=\"string\">your_id</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Growingio-Analytics\"><a href=\"#Growingio-Analytics\" class=\"headerlink\" title=\"Growingio Analytics\"></a>Growingio Analytics</h4><p>Official documentation: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdyb3dpbmdpby5jb20vc2RrLWludGVncmF0aW9uL3Nkay0yLngtZG9jcy8=\">https://docs.growingio.com/sdk-integration/sdk-2.x-docs/<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h4 id=\"CNZZ-Analytics-China\"><a href=\"#CNZZ-Analytics-China\" class=\"headerlink\" title=\"CNZZ Analytics (China)\"></a>CNZZ Analytics (China)</h4><ol>\n<li>Create an account and log into <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudW1lbmcuY29tLw==\">CNZZ Analytics<i class=\"fa fa-external-link-alt\"></i></span>. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIudW1lbmcuY29tL2RvY3MvNjc5NjMvZGV0YWlsLzY4NjA5\">More detailed documentation<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li>Set the value of section <code>cnzz_siteid</code> in <mark class=\"label primary\">theme config file</mark> to your CNZZ site ID. You can find this ID in link or the auto-generated script. <figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CNZZ count</span></span><br><span class=\"line\"><span class=\"comment\">#cnzz_siteid:</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<div class=\"note info\"><p>The script will show «Webmaster Statistics» and it&#39;s not elegant, so we used a <code>display: none;</code> to hide it.</p>\n</div>\n\n<h3 id=\"Counting-Tools\"><a href=\"#Counting-Tools\" class=\"headerlink\" title=\"Counting Tools\"></a>Counting Tools</h3><h4 id=\"LeanCloud-China\"><a href=\"#LeanCloud-China\" class=\"headerlink\" title=\"LeanCloud (China)\"></a>LeanCloud (China)</h4><p>Adding article reading times counting to NexT theme. Documentation how to set the counter up and running safely aviable in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by1sZWFuY2xvdWQtY291bnRlci1zZWN1cml0eQ==\">hexo-leancloud-counter-security<i class=\"fa fa-external-link-alt\"></i></span>.</p>\n<div class=\"tabs\" id=\"leancloud-counter\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#leancloud-counter-1\">Get App Keys →</a></li><li class=\"tab\"><a href=\"#leancloud-counter-2\">Installation →</a></li><li class=\"tab\"><a href=\"#leancloud-counter-3\">Hexo Config →</a></li><li class=\"tab\"><a href=\"#leancloud-counter-4\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"leancloud-counter-1\"><ol>\n<li>Create an account or log into <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhbmNsb3VkLmNuL2Rhc2hib2FyZC9sb2dpbi5odG1sIy9zaWduaW4=\">LeanCloud<i class=\"fa fa-external-link-alt\"></i></span>, and then click on the bottom left corner to <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhbmNsb3VkLmNuL2Rhc2hib2FyZC9hcHBsaXN0Lmh0bWwjL25ld2FwcA==\">create the application<i class=\"fa fa-external-link-alt\"></i></span> in <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhbmNsb3VkLmNuL2Rhc2hib2FyZC9hcHBsaXN0Lmh0bWwjL2FwcHM=\">dashboard<i class=\"fa fa-external-link-alt\"></i></span>.<br> <img src=\"/images/valine-1.png\" alt=\"LeanCloud\" loading=\"lazy\"></li>\n<li>Go to the application you just created, select <code>Settings → App Keys</code> in the lower left corner, and you will see your APP ID and APP Key.<br> <img src=\"/images/valine-2.png\" alt=\"LeanCloud\" loading=\"lazy\"></li>\n</ol></div><div class=\"tab-pane\" id=\"leancloud-counter-2\"><p>Install <code>hexo-leancloud-counter-security</code> by executing the following command in <mark class=\"label info\">site root dir</mark>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-leancloud-counter-security</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"leancloud-counter-3\"><p>Edit <mark class=\"label info\">site config file</mark> and add following content:</p>\n<figure class=\"highlight yml\"><figcaption><span>hexo/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">leancloud_counter_security:</span></span><br><span class=\"line\">  <span class=\"attr\">enable_sync:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">app_id:</span> <span class=\"string\">&lt;your</span> <span class=\"string\">app</span> <span class=\"string\">id&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">app_key:</span> <span class=\"string\">&lt;your</span> <span class=\"string\">app</span> <span class=\"string\">key&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">&lt;your</span> <span class=\"string\">username&gt;</span> <span class=\"comment\"># Will be asked while deploying if is left blank</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&lt;your</span> <span class=\"string\">password&gt;</span> <span class=\"comment\"># Recommmended to be left blank. Will be asked while deploying if is left blank</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"leancloud-counter-4\"><p>Edit <mark class=\"label primary\">theme config file</mark> and fill options under <code>leancloud_visitors</code> section.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Show number of visitors to each article.</span></span><br><span class=\"line\"><span class=\"comment\"># You can visit https://www.leancloud.cn get AppID and AppKey.</span></span><br><span class=\"line\"><span class=\"attr\">leancloud_visitors:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">app_id:</span> <span class=\"comment\">#&lt;app_id&gt;</span></span><br><span class=\"line\">  <span class=\"attr\">app_key:</span> <span class=\"comment\">#&lt;app_key&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># Required for apps from CN region</span></span><br><span class=\"line\">  <span class=\"attr\">server_url:</span> <span class=\"comment\"># &lt;your server url&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security</span></span><br><span class=\"line\">  <span class=\"comment\"># If you don&#x27;t care about security in lc counter and just want to use it directly</span></span><br><span class=\"line\">  <span class=\"comment\"># (without hexo-leancloud-counter-security plugin), set the `security` to `false`.</span></span><br><span class=\"line\">  <span class=\"attr\">security:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Firebase\"><a href=\"#Firebase\" class=\"headerlink\" title=\"Firebase\"></a>Firebase</h4><p>Firebase Analytics provides the functionality of visitor statistics.</p>\n<div class=\"tabs\" id=\"firestore\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#firestore-1\">Get apiKey & projectId →</a></li><li class=\"tab\"><a href=\"#firestore-2\">NexT Config</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"firestore-1\"><p>Login to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb25zb2xlLmZpcmViYXNlLmdvb2dsZS5jb20vdS8wLw==\">Firebase<i class=\"fa fa-external-link-alt\"></i></span> to get apiKey and projectId. The Web API Key gets generated once you go into the &quot;Authentication&quot; section for the first time.</p>\n<p><img src=\"/images/firebase.png\" alt=\"Firebase\" loading=\"lazy\"></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZmlyZXN0b3JlLw==\">More detailed documentation<i class=\"fa fa-external-link-alt\"></i></span></p></div><div class=\"tab-pane\" id=\"firestore-2\"><p>Edit <mark class=\"label primary\">theme config file</mark> and add or change <code>firestore</code> section:</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">firestore:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">collection:</span> <span class=\"string\">articles</span> <span class=\"comment\">#required, a string collection name to access firestore database</span></span><br><span class=\"line\">  <span class=\"attr\">apiKey:</span> <span class=\"comment\">#required</span></span><br><span class=\"line\">  <span class=\"attr\">projectId:</span> <span class=\"comment\">#required</span></span><br></pre></td></tr></table></figure></div></div></div>\n\n<h4 id=\"Busuanzi-Counting-China\"><a href=\"#Busuanzi-Counting-China\" class=\"headerlink\" title=\"Busuanzi Counting (China)\"></a>Busuanzi Counting (China)</h4><div class=\"tabs\" id=\"busuanzi-counting\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#busuanzi-counting-1\">Global Settings →</a></li><li class=\"tab\"><a href=\"#busuanzi-counting-2\">Site UV Settings →</a></li><li class=\"tab\"><a href=\"#busuanzi-counting-3\">Site PV Settings →</a></li><li class=\"tab\"><a href=\"#busuanzi-counting-4\">Per-page PV Settings</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"busuanzi-counting-1\"><p>Edit <code>busuanzi_count</code> option in <mark class=\"label primary\">theme config file</mark>.<br>When <code>enable: true</code>, global setting is enabled. If <code>total_visitors</code>, <code>total_views</code>, <code>post_views</code> are all <code>false</code>, Busuanzi only counts but never shows.</p></div><div class=\"tab-pane\" id=\"busuanzi-counting-2\"><p>When <code>total_visitors: true</code>, it will show site UV in footer. You can also use font-awesome by setting <code>total_visitors_icon</code> to the name of the icon.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">busuanzi_count:</span></span><br><span class=\"line\">  <span class=\"attr\">total_visitors:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">total_visitors_icon:</span> <span class=\"string\">fa</span> <span class=\"string\">fa-user</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"busuanzi-counting-3\"><p>When <code>total_views: true</code>, it will show site UV in footer. You can also use font-awesome by setting <code>total_views_icon</code> to the name of the icon.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">busuanzi_count:</span></span><br><span class=\"line\">  <span class=\"attr\">total_views:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">total_views_icon:</span> <span class=\"string\">fa</span> <span class=\"string\">fa-eye</span></span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"busuanzi-counting-4\"><p>When <code>post_views: true</code>, it will show page PV in post meta. You can also use font-awesome by setting <code>post_views_icon</code> to the name of the icon.</p>\n<figure class=\"highlight yml\"><figcaption><span>next/_config.yml</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">busuanzi_count:</span></span><br><span class=\"line\">  <span class=\"attr\">post_views:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">post_views_icon:</span> <span class=\"string\">far</span> <span class=\"string\">fa-eye</span></span><br></pre></td></tr></table></figure></div></div></div>\n"}]